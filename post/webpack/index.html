<!DOCTYPE html>
<html lang="zh-cn" dir="ltr">
    <head><script src="/blogs/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=blogs/livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content="webpacké…ç½®åŠå…¶åŸç†">
<title>Webpack</title>

<link rel='canonical' href='http://localhost:1313/blogs/post/webpack/'>

<link rel="stylesheet" href="/blogs/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css"><meta property='og:title' content="Webpack">
<meta property='og:description' content="webpacké…ç½®åŠå…¶åŸç†">
<meta property='og:url' content='http://localhost:1313/blogs/post/webpack/'>
<meta property='og:site_name' content='æœå¡çš„åšå®¢'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='webpack' /><meta property='article:published_time' content='2025-03-12T15:02:09&#43;08:00'/><meta property='article:modified_time' content='2025-03-12T15:02:09&#43;08:00'/><meta property='og:image' content='http://localhost:1313/blogs/post/webpack/877.jpg' />
<meta name="twitter:title" content="Webpack">
<meta name="twitter:description" content="webpacké…ç½®åŠå…¶åŸç†"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='http://localhost:1313/blogs/post/webpack/877.jpg' />
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="åˆ‡æ¢èœå•">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/blogs/">
                
                    
                    
                    
                        
                        <img src="/blogs/img/avatar_hu_6c7406f7e9b83504.jpg" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ğŸ¥</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/blogs">æœå¡çš„åšå®¢</a></h1>
            <h2 class="site-description">å­¦ä¹ å’Œç”Ÿæ´»çš„è®°å½•</h2>
        </div>
    </header><ol class="menu-social">
            
                <li>
                    <a 
                        href='https://github.com/dukkhaybw'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://juejin.cn/user/3465312480538343'
                        target="_blank"
                        title="æ˜é‡‘"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/blogs/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>ä¸»é¡µ</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blogs/page/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>å…³äºæˆ‘</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blogs/page/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blogs/page/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/blogs/page/links/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M10 14a3.5 3.5 0 0 0 5 0l4 -4a3.5 3.5 0 0 0 -5 -5l-.5 .5" />
  <path d="M14 10a3.5 3.5 0 0 0 -5 0l-4 4a3.5 3.5 0 0 0 5 5l.5 -.5" />
</svg>



                
                <span>Links</span>
            </a>
        </li>
        
        <li class="menu-bottom-section">
            <ol class="menu">

                
                    <li id="dark-mode-toggle">
                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                        <span>æš—è‰²æ¨¡å¼</span>
                    </li>
                
            </ol>
        </li>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">ç›®å½•</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#webpack">Webpack</a></li>
    <li><a href="#æµè§ˆå™¨ä½¿ç”¨-es-module">æµè§ˆå™¨ä½¿ç”¨ ES module</a></li>
    <li><a href="#entry">entry</a></li>
    <li><a href="#output">output</a></li>
    <li><a href="#loader">loader</a>
      <ol>
        <li><a href="#oneof">oneOf</a>
          <ol>
            <li><a href="#oneof-1"><strong><code>oneOf</code> çš„å·¥ä½œæ–¹å¼</strong></a></li>
            <li><a href="#oneof-2"><strong><code>oneOf</code> çš„ä¼˜ç‚¹</strong></a></li>
            <li><a href="#oneof-3"><strong><code>oneOf</code> çš„æ³¨æ„äº‹é¡¹</strong></a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#plugin">plugin</a></li>
    <li><a href="#æ¨¡å¼mode">æ¨¡å¼(mode)</a></li>
    <li><a href="#åŒºåˆ†ç¯å¢ƒ">åŒºåˆ†ç¯å¢ƒ</a>
      <ol>
        <li><a href="#windows">Windows</a>
          <ol>
            <li><a href="#cmd">CMD</a></li>
            <li><a href="#powershell">Powershell</a></li>
          </ol>
        </li>
        <li><a href="#mac">Mac</a></li>
        <li><a href="#lunix">Lunix</a></li>
      </ol>
    </li>
    <li><a href="#é…ç½®-packagejson">é…ç½® package.json</a>
      <ol>
        <li><a href="#windows-ç³»ç»Ÿ">Windows ç³»ç»Ÿ</a></li>
        <li><a href="#mac-ç³»ç»Ÿ">Mac ç³»ç»Ÿ</a></li>
        <li><a href="#è·¨å¹³å°---cross-env">è·¨å¹³å° - cross-env</a></li>
      </ol>
    </li>
    <li><a href="#browserlist">Browserlist</a></li>
    <li><a href="#webpack-dev-server">webpack-dev-server</a></li>
    <li><a href="#css-loader-é…ç½®">css-loader é…ç½®</a></li>
    <li><a href="#webpack-dev-middleware">webpack-dev-middleware</a></li>
    <li><a href="#css-å…¼å®¹æ€§">CSS å…¼å®¹æ€§</a></li>
    <li><a href="#èµ„æºæ¨¡å—">èµ„æºæ¨¡å—</a>
      <ol>
        <li><a href="#query">query</a></li>
        <li><a href="#å›¾ç‰‡å‹ç¼©">å›¾ç‰‡å‹ç¼©</a></li>
        <li><a href="#å›¾ç‰‡å“åº”å¼">å›¾ç‰‡å“åº”å¼</a></li>
      </ol>
    </li>
    <li><a href="#js-å…¼å®¹æ€§å¤„ç†">JS å…¼å®¹æ€§å¤„ç†</a>
      <ol>
        <li><a href="#babel-polyfill">babel-polyfill</a>
          <ol>
            <li><a href="#usebuiltins-false">useBuiltIns: false</a></li>
            <li><a href="#usebuiltins"><strong>useBuiltIns: &ldquo;entry&rdquo;</strong></a></li>
            <li><a href="#webpackconfigjs">webpack.config.js</a></li>
            <li><a href="#usebuiltins-usage-">**&ldquo;useBuiltIns&rdquo;: &ldquo;usage&rdquo; **</a></li>
          </ol>
        </li>
        <li><a href="#babel-runtime">babel-runtime</a></li>
        <li><a href="#babel-plugin-transform-runtime">babel-plugin-transform-runtime</a>
          <ol>
            <li><a href="#helpers-true">helpers: true</a></li>
            <li><a href="#regenerator-true">regenerator: true</a></li>
            <li><a href="#æœ€ä½³å®è·µ">æœ€ä½³å®è·µ</a></li>
            <li><a href="#é¡¹ç›®å¼€å‘">é¡¹ç›®å¼€å‘</a></li>
            <li><a href="#ç±»åº“å¼€å‘">ç±»åº“å¼€å‘</a></li>
            <li><a href="#polyfill-service">polyfill-service</a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#ts">TS</a>
      <ol>
        <li><a href="#é€‰æ‹©">é€‰æ‹©</a></li>
        <li><a href="#æœ€ä½³å®è·µ-1">æœ€ä½³å®è·µ</a></li>
      </ol>
    </li>
    <li><a href="#eslint">eslint</a>
      <ol>
        <li><a href="#æ—§ç‰ˆé…ç½®">æ—§ç‰ˆé…ç½®</a></li>
        <li><a href="#æ–°ç‰ˆé…ç½®">æ–°ç‰ˆé…ç½®</a></li>
      </ol>
    </li>
    <li><a href="#map-é¡¹ç›®é…ç½®">MAP é¡¹ç›®é…ç½®</a>
      <ol>
        <li><a href="#chunks"><strong><code>chunks</code> é€‰é¡¹çš„ä¸»è¦åŠŸèƒ½</strong></a></li>
        <li><a href="#chunks-1"><strong><code>chunks</code> çš„ä½¿ç”¨åœºæ™¯</strong></a>
          <ol>
            <li><a href="#1-å¤šå…¥å£é…ç½®">1. å¤šå…¥å£é…ç½®</a></li>
            <li><a href="#2-å¼•å…¥å¤šä¸ªå…¥å£æ–‡ä»¶">2. å¼•å…¥å¤šä¸ªå…¥å£æ–‡ä»¶</a></li>
          </ol>
        </li>
        <li><a href="#ä¸ä½¿ç”¨"><strong>ä¸ä½¿ç”¨ <code>chunks</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong></a></li>
        <li><a href="#å¯¹æ¯”"><strong>å¯¹æ¯” <code>chunks</code> å’Œ <code>excludeChunks</code></strong></a></li>
        <li><a href="#æ€»ç»“">æ€»ç»“</a></li>
      </ol>
    </li>
    <li><a href="#webpack-åŸç†é¢„å¤‡çŸ¥è¯†">webpack åŸç†é¢„å¤‡çŸ¥è¯†</a>
      <ol>
        <li><a href="#commonjs-åŠ è½½-commonjs">common.js åŠ è½½ common.js</a></li>
        <li><a href="#commonjs-åŠ è½½-es6-modules">common.js åŠ è½½ ES6 modules</a></li>
        <li><a href="#es6-modules-åŠ è½½-es6-modules">ES6 modules åŠ è½½ ES6 modules</a></li>
        <li><a href="#es6-modules-åŠ è½½-commonjs">ES6 modules åŠ è½½ common.js</a></li>
      </ol>
    </li>
    <li><a href="#å¼‚æ­¥åŠ è½½">å¼‚æ­¥åŠ è½½</a></li>
    <li><a href="#ast">AST</a>
      <ol>
        <li><a href="#ç”¨é€”">ç”¨é€”</a></li>
        <li><a href="#ast-èŠ‚ç‚¹">AST èŠ‚ç‚¹</a></li>
        <li><a href="#éå†è¯­æ³•æ ‘">éå†è¯­æ³•æ ‘</a></li>
      </ol>
    </li>
    <li><a href="#babel">Babel</a>
      <ol>
        <li><a href="#babel-æ’ä»¶">babel æ’ä»¶</a></li>
      </ol>
    </li>
    <li><a href="#ast-çš„å‰ç½®çŸ¥è¯†">AST çš„å‰ç½®çŸ¥è¯†</a>
      <ol>
        <li><a href="#è®¿é—®å™¨æ¨¡å¼">è®¿é—®å™¨æ¨¡å¼</a></li>
        <li><a href="#path">path</a></li>
        <li><a href="#scope">scope</a></li>
        <li><a href="#è½¬æ¢ç®­å¤´å‡½æ•°æ’ä»¶">è½¬æ¢ç®­å¤´å‡½æ•°æ’ä»¶</a></li>
        <li><a href="#æ—¥å¿—æ’ä»¶">æ—¥å¿—æ’ä»¶</a></li>
        <li><a href="#æ•°æ®åŸ‹ç‚¹">æ•°æ®åŸ‹ç‚¹</a></li>
        <li><a href="#æ¨¡æ‹Ÿ-eslint">æ¨¡æ‹Ÿ eslint</a></li>
        <li><a href="#ä»£ç å‹ç¼©">ä»£ç å‹ç¼©</a></li>
        <li><a href="#æŒ‰éœ€åŠ è½½">æŒ‰éœ€åŠ è½½</a></li>
      </ol>
    </li>
    <li><a href="#webpack-å·¥ä½œæµ">webpack å·¥ä½œæµ</a>
      <ol>
        <li><a href="#è°ƒè¯•-webpack">è°ƒè¯• webpack</a></li>
        <li><a href="#loader-1">loader</a></li>
        <li><a href="#tapable">tapable</a></li>
        <li><a href="#plugin-1">plugin</a></li>
        <li><a href="#webpack-ç¼–è¯‘æµç¨‹">webpack ç¼–è¯‘æµç¨‹</a></li>
      </ol>
    </li>
    <li><a href="#loader-2">loader</a>
      <ol>
        <li><a href="#loader-æ‰§è¡Œæ—¶æœº">loader æ‰§è¡Œæ—¶æœº</a></li>
        <li><a href="#loader-åˆ†ç±»">loader åˆ†ç±»</a></li>
        <li><a href="#loader-çš„å·¥ä½œ">loader çš„å·¥ä½œ</a></li>
        <li><a href="#å†…è”-loader-çš„ç‰¹æ®Šé…ç½®">å†…è” loader çš„ç‰¹æ®Šé…ç½®</a></li>
        <li><a href="#pitch">pitch</a></li>
        <li><a href="#babel-loader">babel-loader</a></li>
        <li><a href="#babel-loaderjs">babel-loader.js</a></li>
        <li><a href="#style-loader">style-loader</a></li>
        <li><a href="#less-loader">less-loader</a></li>
        <li><a href="#loader-runner-å®ç°">loader-runner å®ç°</a></li>
      </ol>
    </li>
    <li><a href="#æ¨¡æ‹Ÿå®ç°å¾®å‹çš„-webpack">æ¨¡æ‹Ÿå®ç°å¾®å‹çš„ webpack</a>
      <ol>
        <li><a href="#ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼</a>
          <ol>
            <li><a href="#1-å®šä¹‰-loader">1. å®šä¹‰ Loader</a></li>
            <li><a href="#2-å®šä¹‰æ’ä»¶">2. å®šä¹‰æ’ä»¶</a></li>
            <li><a href="#3-webpack-é…ç½®">3. Webpack é…ç½®</a></li>
          </ol>
        </li>
        <li><a href="#è¿è¡Œæ‰“åŒ…æµç¨‹">è¿è¡Œæ‰“åŒ…æµç¨‹</a></li>
      </ol>
    </li>
    <li><a href="#æ’ä»¶">æ’ä»¶</a>
      <ol>
        <li><a href="#å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†</a>
          <ol>
            <li><a href="#æ’ä»¶æ ¸å¿ƒ-tapable">æ’ä»¶æ ¸å¿ƒ tapable</a></li>
            <li><a href="#tapable-åˆ†ç±»">tapable åˆ†ç±»</a></li>
            <li><a href="#tapable-åŸç†">tapable åŸç†</a></li>
          </ol>
        </li>
        <li><a href="#æ’ä»¶-1">æ’ä»¶</a>
          <ol>
            <li><a href="#è‡ªåŠ¨å¤–è”æ’ä»¶"><strong>è‡ªåŠ¨å¤–è”æ’ä»¶</strong></a></li>
          </ol>
        </li>
      </ol>
    </li>
    <li><a href="#asyncqueue">AsyncQueue</a>
      <ol>
        <li><a href="#æ€»ç»“-1"><strong>æ€»ç»“</strong></a></li>
      </ol>
    </li>
    <li><a href="#webpack-ä¼˜åŒ–">webpack ä¼˜åŒ–</a></li>
    <li><a href="#webpack-æ„å»ºåº“">webpack æ„å»ºåº“</a></li>
    <li><a href="#æå–-css">æå– CSS</a></li>
    <li><a href="#å¼€å‘æ¨¡å¼ä¸‹å‹ç¼©æ–‡ä»¶">å¼€å‘æ¨¡å¼ä¸‹å‹ç¼©æ–‡ä»¶</a></li>
    <li><a href="#cdn">CDN</a></li>
    <li><a href="#æ–‡ä»¶æŒ‡çº¹">æ–‡ä»¶æŒ‡çº¹</a></li>
    <li><a href="#moduleids--chunkids-çš„ä¼˜åŒ–">moduleIds &amp; chunkIds çš„ä¼˜åŒ–</a></li>
    <li><a href="#æ¨¡å—è”é‚¦">æ¨¡å—è”é‚¦</a></li>
    <li><a href="#ä»£ç åˆ†å‰²">ä»£ç åˆ†å‰²</a>
      <ol>
        <li><a href="#æ–¹å¼ä¸€"><strong>æ–¹å¼ä¸€</strong></a></li>
        <li><a href="#æ–¹å¼äºŒ"><strong>æ–¹å¼äºŒ</strong></a></li>
        <li><a href="#æ–¹å¼ä¸‰">æ–¹å¼ä¸‰</a></li>
      </ol>
    </li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/blogs/post/webpack/">
                <img src="/blogs/post/webpack/877_hu_8d90949689e262ee.jpg"
                        srcset="/blogs/post/webpack/877_hu_8d90949689e262ee.jpg 800w, /blogs/post/webpack/877_hu_92f4d2ba33135eb0.jpg 1600w"
                        width="800" 
                        height="533" 
                        loading="lazy"
                        alt="Featured image of post Webpack" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/blogs/categories/webpack/" >
                Webpack
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/blogs/post/webpack/">Webpack</a>
        </h2>
    
        
        <h3 class="article-subtitle">
            webpacké…ç½®åŠå…¶åŸç†
        </h3>
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2025-03-12</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 147 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="å‰ç«¯å·¥ç¨‹åŒ–">å‰ç«¯å·¥ç¨‹åŒ–
</h1><p>webpack ä½¿ç”¨ã€åŸç†å’Œä¼˜åŒ–</p>
<h2 id="webpack">Webpack
</h2><p>webpack æ˜¯ä¸€ä¸ª JS åº”ç”¨ç¨‹åºçš„é™æ€æ–‡ä»¶æ‰“åŒ…å·¥å…·ã€‚</p>
<p>åœ¨ webpack ä¸­ä¼šå°†å„ç§ç±»å‹çš„æ–‡ä»¶éƒ½çœ‹ä½œä¸€ä¸ªæ¨¡å—ï¼Œä¸”æ¨¡å—ä¹‹é—´å¯èƒ½ç›¸äº’ä¾èµ–ã€‚webpack æ‰“åŒ…æ‰€æœ‰çš„è¿™äº›èµ„æºæ–‡ä»¶å¹¶ç¼–è¯‘ä¸ºä¸€äº›å‰ç«¯ç¯å¢ƒ(æµè§ˆå™¨ç¯å¢ƒ)èƒ½è¯†åˆ«çš„ä¸€äº›æ–‡ä»¶ï¼ˆé™æ€èµ„æºï¼‰ï¼Œæ¯”å¦‚ jsï¼Œcssï¼Œpng ç­‰ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm init -y
</span></span><span class="line"><span class="cl">npm install webpack webpack-cli --save-dev
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>webpackï¼šæ ¸å¿ƒåŒ…</li>
<li>webpack-cliï¼šå‘½ä»¤è¡Œå·¥å…·ï¼Œä¸»è¦æ˜¯åœ¨æ‰§è¡Œ webpack å‘½ä»¤æ—¶ï¼Œè§£æå‘½ä»¤è¡Œä¸­è®¾ç½®çš„ä¸€ç³»åˆ—å‚æ•°ï¼ˆä¸€ç»„å‘½ä»¤å’Œé€‰é¡¹ï¼‰ï¼ŒåŠ è½½ webpack é…ç½®æ–‡ä»¶ï¼ˆé»˜è®¤ webpack.config.jsï¼‰ï¼Œè°ƒç”¨ webpack æ ¸å¿ƒåŒ…ä¸­çš„æ–¹æ³•è¿›è¡Œæ„å»ºæ‰“åŒ…ã€‚é€šè¿‡ webpack-cliï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­æŒ‡å®š Webpack çš„é…ç½®æ–‡ä»¶ã€æ‰§è¡Œä¸åŒçš„æ„å»ºæ¨¡å¼ï¼ˆå¦‚å¼€å‘æ¨¡å¼æˆ–ç”Ÿäº§æ¨¡å¼ï¼‰ã€è§‚å¯Ÿæ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°æ„å»ºç­‰ã€‚</li>
</ul>
<p>åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥ <code>webpack</code> å¹¶é™„å¸¦ä¸€äº›é€‰é¡¹æ—¶ï¼ŒWebpack CLI ä¼šæ‰§è¡Œä»¥ä¸‹æ­¥éª¤æ¥å¤„ç†å‘½ä»¤ï¼š</p>
<ol>
<li>è§£æå‘½ä»¤è¡Œå‚æ•°ï¼šWebpack CLI ä¼šè§£æå‘½ä»¤è¡Œä¸­è¾“å…¥çš„é€‰é¡¹å’Œå‚æ•°ï¼Œå¹¶æ ¹æ®å®ƒä»¬çš„å€¼è¿›è¡Œé…ç½®ã€‚</li>
<li>åŠ è½½é…ç½®æ–‡ä»¶ï¼šWebpack CLI ä¼šå°è¯•åŠ è½½é»˜è®¤çš„é…ç½®æ–‡ä»¶ <code>webpack.config.js</code>ï¼Œå¦‚æœå­˜åœ¨çš„è¯ã€‚å¦‚æœå‘½ä»¤è¡Œä¸­ä½¿ç”¨äº† <code>--config</code> é€‰é¡¹æŒ‡å®šäº†å…¶ä»–é…ç½®æ–‡ä»¶ï¼ŒWebpack CLI ä¼šåŠ è½½è¯¥æ–‡ä»¶ã€‚</li>
<li>åˆå¹¶é…ç½®ï¼šWebpack CLI ä¼šå°†å‘½ä»¤è¡Œé€‰é¡¹å’Œé…ç½®æ–‡ä»¶ä¸­çš„é…ç½®åˆå¹¶ï¼Œä»¥å½¢æˆæœ€ç»ˆçš„ Webpack é…ç½®å¯¹è±¡ã€‚</li>
<li>åˆ›å»º Webpack ç¼–è¯‘å™¨ç±»å¯¹è±¡ï¼šWebpack CLI ä½¿ç”¨åˆå¹¶åçš„é…ç½®åˆ›å»ºä¸€ä¸ª Webpack ç¼–è¯‘å™¨ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè¯¥ç¼–è¯‘å™¨å¯¹è±¡å°†è´Ÿè´£å¤„ç†æ‰“åŒ…è¿‡ç¨‹ã€‚</li>
<li>æ‰§è¡Œ Webpack ç¼–è¯‘å™¨ï¼šWebpack ç¼–è¯‘å™¨å¼€å§‹æ‰§è¡Œæ‰“åŒ…è¿‡ç¨‹ã€‚å®ƒä¼šæ ¹æ®é…ç½®ä¸­çš„å…¥å£æ–‡ä»¶å’Œä¾èµ–å…³ç³»ï¼Œ<strong>é€’å½’åœ°è§£æå’Œå¤„ç†</strong>å„ä¸ªæ¨¡å—ï¼Œå¹¶å°†å®ƒä»¬æ‰“åŒ…æˆæœ€ç»ˆçš„è¾“å‡ºæ–‡ä»¶ã€‚</li>
<li>è¾“å‡ºæ‰“åŒ…ç»“æœï¼šä¸€æ—¦ Webpack ç¼–è¯‘å™¨å®Œæˆæ‰“åŒ…è¿‡ç¨‹ï¼Œå®ƒä¼šå°†ç”Ÿæˆçš„è¾“å‡ºæ–‡ä»¶å†™å…¥æŒ‡å®šçš„è¾“å‡ºç›®å½•ã€‚</li>
</ol>
<p>åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒWebpack CLI è¿˜å¯ä»¥æ ¹æ®å‘½ä»¤è¡Œé€‰é¡¹å’Œé…ç½®æ–‡ä»¶ä¸­çš„å…¶ä»–é…ç½®ï¼Œæ‰§è¡Œä¸€äº›é¢å¤–çš„æ“ä½œï¼Œä¾‹å¦‚å¯åŠ¨å¼€å‘æœåŠ¡å™¨ã€ç›‘å¬æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°æ‰“åŒ…ç­‰ã€‚</p>
<h2 id="æµè§ˆå™¨ä½¿ç”¨-es-module">æµè§ˆå™¨ä½¿ç”¨ ES module
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;./src/index.js&#34;</span> <span class="na">type</span><span class="o">=</span><span class="s">&#34;module&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">// å¿…é¡»æŒ‡æ˜typeä¸ºmodule
</span></span></code></pre></td></tr></table>
</div>
</div><p>ES6 æ¨¡å—åŒ–è¯­æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="p">{</span> <span class="nx">sum</span><span class="p">,</span> <span class="nx">mul</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;./js/math.js&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">sum</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">mul</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">30</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">math</span><span class="p">.</span><span class="nx">js</span><span class="o">:</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">sum</span> <span class="o">=</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span><span class="nx">num2</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">num1</span> <span class="o">+</span> <span class="nx">num2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">mul</span> <span class="o">=</span><span class="p">(</span><span class="nx">num1</span><span class="p">,</span><span class="nx">num2</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">num1</span> <span class="o">*</span> <span class="nx">num2</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ES6 çš„æ¨¡å—åŒ–è§„èŒƒåœ¨æµè§ˆå™¨ä¸­æ˜¯éœ€è¦å‘èµ·ç½‘ç»œè¯·æ±‚ï¼š</strong></p>
<p><img src="/blogs/post/webpack/images/image-20220310071821033.png"
	width="1914"
	height="757"
	srcset="/blogs/post/webpack/images/image-20220310071821033_hu_e3d6d9ae9765cfa8.png 480w, /blogs/post/webpack/images/image-20220310071821033_hu_302b7e33157f3c41.png 1024w"
	loading="lazy"
	
		alt="image-20220310071821033"
	
	
		class="gallery-image" 
		data-flex-grow="252"
		data-flex-basis="606px"
	
></p>
<p><img src="/blogs/post/webpack/images/image-20220310072112724.png"
	width="1920"
	height="293"
	srcset="/blogs/post/webpack/images/image-20220310072112724_hu_101b7c63591bbd9e.png 480w, /blogs/post/webpack/images/image-20220310072112724_hu_a74530cd382b5b46.png 1024w"
	loading="lazy"
	
		alt="image-20220310072112724"
	
	
		class="gallery-image" 
		data-flex-grow="655"
		data-flex-basis="1572px"
	
></p>
<p>åœ¨ä¸Šé¢ï¼Œç›´æ¥ä½¿ç”¨ file åè®®æ‰“å¼€æœ¬åœ°çš„ index.html æ–‡ä»¶ï¼Œäº§ç”Ÿè·¨åŸŸè¯·æ±‚ï¼ŒåŒæ—¶ç½‘ç»œé¢æ¿ä¸­ä¹Ÿæœ‰é’ˆå¯¹ index.js çš„ç½‘ç»œè¯·æ±‚ã€‚è¯´æ˜ ES6 çš„ import è¯­æ³•æ˜¯éœ€è¦å‘èµ·ç½‘ç»œè¯·æ±‚çš„ã€‚</p>
<h2 id="entry">entry
</h2><ul>
<li>
<p>å…¥å£(entry point)å‘Šè¯‰ webpack ä½¿ç”¨å“ªä¸ªæ¨¡å—æˆ–è€…å“ªå‡ ä¸ªæ¨¡å—ï¼Œä½œä¸ºæ„å»ºå…¶å†…éƒ¨ä¾èµ–å›¾(dependency graph) çš„å¼€å§‹ã€‚è¿›å…¥å…¥å£åï¼Œwebpack ä¼šæ‰¾å‡ºæœ‰å“ªäº›æ¨¡å—å’Œåº“æ˜¯å…¥å£èµ·ç‚¹ï¼ˆç›´æ¥å’Œé—´æ¥ï¼‰ä¾èµ–çš„</p>
</li>
<li>
<p>é»˜è®¤å€¼æ˜¯ <code>./src/index.js</code>ï¼Œä½†å¯ä»¥é€šè¿‡åœ¨ <code>webpack configuration</code> ä¸­é…ç½® <code>entry</code> å±æ€§ï¼Œæ¥æŒ‡å®šä¸€ä¸ªï¼ˆæˆ–å¤šä¸ªï¼‰ä¸åŒ src å…¥å£èµ·ç‚¹</p>
</li>
<li>
<p><strong>entry ä¸­é…ç½®çš„ç›¸å¯¹è·¯å¾„ä¼šä»¥è„šæœ¬å‘½ä»¤æ‰§è¡Œæ—¶æ‰€åœ¨çš„è·¯å¾„ï¼ˆprocess.cwd()ï¼‰ä½œä¸ºåŸºå‡†è·¯å¾„ã€‚</strong></p>
<p>æ¯”å¦‚ï¼šå½“å‰é¡¹ç›®æ ¹ç›®å½•ä¸º testï¼Œè¯¥ç›®å½•ä¸‹æœ‰ webpack.config.js æ–‡ä»¶ï¼Œå…¶ä¸­çš„ entry å­—æ®µå€¼ä¸ºï¼š&rsquo;./src/index.js&rsquo;ï¼Œå¦‚æœè·³è½¬åˆ° test çš„ä¸Šçº§ç›®å½•ä¸‹ï¼Œæ‰§è¡Œ webpack &ndash;config ./test/webpack.config.jsï¼Œé‚£ä¹ˆå°†å› ä¸ºæ‰¾ä¸åˆ°å…¥å£æ–‡ä»¶è€ŒæŠ¥é”™ã€‚</p>
<p>æŠ¥é”™ä¿¡æ¯å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">PS C:\Users\Desktop\webpack202208\test&gt; cd ..
</span></span><span class="line"><span class="cl">PS C:\Users\Desktop\webpack202208&gt; npx webpack --config .\test\webpack.config.js
</span></span><span class="line"><span class="cl">Active code page: 65001
</span></span><span class="line"><span class="cl">asset index.html 2.62 KiB [emitted]
</span></span><span class="line"><span class="cl">asset main.js 99 bytes [emitted] (name: main)
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ERROR in main
</span></span><span class="line"><span class="cl">Module not found: Error: Can&#39;t resolve &#39;./src/index.js&#39; in &#39;C:\Users\Desktop\webpack202208&#39;
</span></span><span class="line"><span class="cl">resolve &#39;./src/index.js&#39; in &#39;C:\Users\dukkha\Desktop\webpack202208&#39;
</span></span><span class="line"><span class="cl">  using description file: C:\Users\dukkha\package.json (relative path: ./Desktop/webpack202208)
</span></span><span class="line"><span class="cl">    Field &#39;browser&#39; doesn&#39;t contain a valid alias configuration
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">entry</span><span class="o">:</span> <span class="s1">&#39;./src/index.js&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">entry</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;url1&#39;</span><span class="p">,</span><span class="s1">&#39;url2&#39;</span><span class="p">]</span>  <span class="c1">// è¿™ä¸¤ä¸ªæ–‡ä»¶çš„å†…å®¹éƒ½ä¼šæ‰“åŒ…åˆ°ä¸€ä¸ªmain.jsæ–‡ä»¶ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1">// å•å…¥å£ç­‰ä»·äºä¸‹é¢è¿™ç§å†™æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">main</span><span class="o">:</span> <span class="s1">&#39;./src.index.js&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">entry</span><span class="o">:</span><span class="p">(</span><span class="nx">context</span><span class="p">,</span> <span class="nx">environment</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Context:&#39;</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Environment:&#39;</span><span class="p">,</span> <span class="nx">environment</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ ¹æ®ç¯å¢ƒå˜é‡åŠ¨æ€è¿”å›å…¥å£æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">environment</span><span class="p">.</span><span class="nx">production</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="s1">&#39;./src/index.prod.js&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="s1">&#39;./src/index.dev.js&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//  ä¹Ÿå¯ä»¥è¿”å›å¯¹è±¡æˆ–è€…æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">main</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="kr">import</span> <span class="s1">&#39;./src/index.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">dependOn</span><span class="o">:</span><span class="s1">&#39;xxx&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">runtime</span><span class="o">:</span><span class="s1">&#39;runtime-name&#39;</span><span class="c1">// å•ç‹¬è®¾ç½®è¿™ä¸ªå…¥å£æ¨¡å—çš„runtimeä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ <code>entry</code> å­—æ®µè¢«é…ç½®ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆ Webpack ä¼šåœ¨è¿è¡Œæ—¶è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œå¹¶ä¼ é€’ä¸€äº›ç‰¹å®šçš„å‚æ•°ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ Webpack å†…éƒ¨å¯¹ <code>entry</code> å‡½æ•°çš„å¤„ç†é€»è¾‘åŠå…¶ä¼ å‚çš„è¯¦ç»†è§£é‡Šï¼š</p>
<ul>
<li><strong><code>context</code></strong>: Webpack çš„ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œé€šå¸¸æ˜¯é…ç½®ä¸­çš„ <code>context</code> å­—æ®µå€¼ã€‚å¦‚æœæ²¡æœ‰æ˜¾å¼è®¾ç½® <code>context</code>ï¼Œé»˜è®¤æ˜¯ Webpack é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚</li>
<li><strong><code>environment</code></strong>: ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å« Webpack CLI æˆ–æ„å»ºè„šæœ¬ä¸­ä¼ é€’çš„ <code>mode</code> å’Œå…¶ä»–ç¯å¢ƒå˜é‡ã€‚</li>
</ul>
<h2 id="output">output
</h2><ul>
<li>
<p><code>output</code> å±æ€§å‘Šè¯‰ webpack åœ¨å“ªé‡Œè¾“å‡ºå®ƒæ‰€åˆ›å»ºçš„ bundleï¼Œä»¥åŠ<strong>å¦‚ä½•å‘½åè¿™äº›æ–‡ä»¶</strong></p>
<p>ä¸»è¦è¾“å‡ºæ–‡ä»¶çš„é»˜è®¤å€¼æ˜¯ï¼š./dist/main.jsï¼Œå…¶ä»–ç”Ÿæˆæ–‡ä»¶é»˜è®¤æ”¾ç½®åœ¨./dist æ–‡ä»¶å¤¹ä¸­</p>
</li>
<li>
<p>output ä¸­çš„ path è·¯å¾„åˆ™æ˜¯ä¸€ä¸ªç»å¯¹è·¯å¾„ï¼Œå…·ä½“æ‰“åŒ…åç”Ÿæˆçš„æ‰“åŒ…æ–‡ä»¶å¤¹åœ¨å“ªé‡Œå–å†³äº path çš„å€¼</p>
</li>
<li>
<p><strong>å¦‚æœä¸é…ç½® output ä¸­çš„ path é€‰é¡¹ï¼Œåˆ™è¯¥é¡¹çš„é»˜è®¤å€¼æ˜¯ï¼šprocess.cwd()ï¼Œè€Œä¸æ˜¯&rsquo;./dist&rsquo;è¿™ç§ç›¸å¯¹è·¯å¾„æˆ–è€… path.resolve(__dirname, &ldquo;dist&rdquo;)</strong>ï¼Œä½†é»˜è®¤çš„é…ç½®æ–‡ä»¶æœ‰é…ç½®è¿™ä¸ªå±æ€§çš„å€¼</p>
</li>
</ul>
<h2 id="loader">loader
</h2><ul>
<li>webpack åªèƒ½ç†è§£ <code>JavaScript</code> å’Œ <code>JSON</code> æ–‡ä»¶</li>
<li>loader è®© <code>webpack</code> èƒ½å¤Ÿå»å¤„ç†å…¶ä»–ç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºæœ‰æ•ˆæ¨¡å—ï¼Œä»¥ä¾›åº”ç”¨ç¨‹åºä½¿ç”¨ï¼Œä»¥åŠè¢«æ·»åŠ åˆ° webpack ä¾èµ–å›¾ä¸­</li>
</ul>
<p>loader çš„å‡ ç§ä½¿ç”¨æ–¹å¼ï¼š</p>
<ul>
<li>
<p>import &lsquo;<strong>style-loader!css-loader!</strong>../css/creatediv.css&rsquo; ï¼ˆå†…è”å¼ï¼Œä¸æ¨èï¼Œåªæ­£å¯¹è¿™ä¸ªä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨æŒ‡å®šçš„ loaderï¼‰</p>
</li>
<li>
<p>CLI æ–¹å¼ï¼ˆä¸æ¨èï¼‰</p>
<p>package.json:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack --module-bind &#39;css=style-loader!css-loader&#39;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>webpack é…ç½®æ–‡ä»¶ä¸­å†™ loader</p>
<p>å¯¹åº”è§„åˆ™çš„ loader æ˜¯ä»å³å‘å·¦æ‰§è¡Œçš„ï¼Œæœ€å³ä¾§çš„ loader æ¥æ”¶åˆ°æ˜¯å¯¹åº”ç±»å‹çš„æ–‡ä»¶çš„æºç ï¼Œæœ€å·¦ä¾§çš„ loader ä¸€å®šä¼šè¿”å›ä¸€ä¸ª js æ¨¡å—ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;style-loader&#34;</span><span class="p">,</span> <span class="s2">&#34;css-loader&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">context</span><span class="o">:</span> <span class="nx">process</span><span class="p">.</span><span class="nx">cwd</span><span class="p">(),</span> <span class="c1">// å±æ€§å€¼å°±æ˜¯é¡¹ç›®æ‰“åŒ…çš„ä¸Šä¸‹æ–‡ï¼ˆé¡¹ç›®æ‰“åŒ…çš„ç›¸å¯¹è·¯å¾„ï¼‰ï¼Œå°±æ˜¯é¡¹ç›®çš„ç›®å½•è·¯å¾„ï¼Œè¯¥é…ç½®é¡¹å‡ ä¹ä¸ä¼šå»æ”¹ï¼Œç”¨é»˜è®¤å€¼å°±è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>å¦‚æœæœ‰åŒç±»å‹çš„æ–‡ä»¶ï¼Œå¹¶ä¸”æƒ³é’ˆå¯¹ä¸åŒæƒ…å†µæ‰§è¡Œä¸åŒçš„ loaderï¼Œå¯ä»¥ä½¿ç”¨ Webpack çš„ <code>oneOf</code> é…ç½®ã€‚<code>oneOf</code> æ˜¯ Webpack 4 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­çš„ä¸€ä¸ªåŠŸèƒ½ï¼Œç”¨æ¥æé«˜æ€§èƒ½ï¼Œç¡®ä¿æ¯ä¸ªæ–‡ä»¶åªç»è¿‡å…¶ä¸­ä¸€ä¸ª loader å¤„ç†ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">oneOf</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">resourceQuery</span><span class="o">:</span> <span class="sr">/babel/</span><span class="p">,</span> <span class="c1">// é’ˆå¯¹ URL ä¸­åŒ…å« ?babel çš„èµ„æºï¼Œä½¿ç”¨ babel-loader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span> <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">]</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;babel-like-loader&#34;</span><span class="p">,</span> <span class="c1">// å…¶ä»–æƒ…å†µä¸‹ä½¿ç”¨è‡ªå®šä¹‰çš„ babel-like-loader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">options</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="oneof">oneOf
</h3><p><code>oneOf</code> æ˜¯ç”¨æ¥ä¼˜åŒ–æ¨¡å—è§„åˆ™åŒ¹é…çš„ä¸€ä¸ªå…³é”®å­—ã€‚å®ƒå…è®¸ä½ å®šä¹‰ä¸€ç»„è§„åˆ™ï¼Œä½† <strong>æ¯ä¸ªæ–‡ä»¶åªä¼šåŒ¹é…å…¶ä¸­ä¸€ä¸ªè§„åˆ™</strong>ï¼Œè€Œä¸ä¼šç»§ç»­åŒ¹é…åç»­è§„åˆ™ã€‚è¿™ç§æœºåˆ¶å¯ä»¥æå‡æ„å»ºæ•ˆç‡ï¼Œé¿å…æ–‡ä»¶è¢«å¤šä¸ªè§„åˆ™é‡å¤å¤„ç†ã€‚</p>
<h4 id="oneof-1"><strong><code>oneOf</code> çš„å·¥ä½œæ–¹å¼</strong>
</h4><ul>
<li><code>oneOf</code> æ˜¯ <code>module.rules</code> ä¸­çš„ä¸€ä¸ªå±æ€§ï¼Œå€¼æ˜¯ä¸€ä¸ªè§„åˆ™æ•°ç»„ã€‚</li>
<li>Webpack ä¼šæŒ‰é¡ºåºéå†æ•°ç»„ä¸­çš„è§„åˆ™ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™åå°±åœæ­¢ç»§ç»­åŒ¹é…ã€‚</li>
<li>å¦‚æœæ²¡æœ‰åŒ¹é…ä»»ä½•è§„åˆ™ï¼ŒWebpack ä¼šæŠ›å‡ºé”™è¯¯ï¼Œé™¤éæä¾›äº†é»˜è®¤çš„å¤„ç†æ–¹å¼ã€‚</li>
</ul>
<p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªå…¸å‹çš„ Webpack é…ç½®ï¼Œä½¿ç”¨ <code>oneOf</code> ä¼˜åŒ–è§„åˆ™åŒ¹é…ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">oneOf</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;style-loader&#34;</span><span class="p">,</span> <span class="s2">&#34;css-loader&#34;</span><span class="p">],</span> <span class="c1">// å¤„ç† CSS æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.scss$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;style-loader&#34;</span><span class="p">,</span> <span class="s2">&#34;css-loader&#34;</span><span class="p">,</span> <span class="s2">&#34;sass-loader&#34;</span><span class="p">],</span> <span class="c1">// å¤„ç† SCSS æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpe?g|gif)$/i</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;asset/resource&#34;</span><span class="p">,</span> <span class="c1">// å¤„ç†å›¾ç‰‡æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨è¿™ä¸ªé…ç½®ä¸­ï¼š</p>
<ul>
<li>å¦‚æœæ–‡ä»¶æ˜¯ <code>.css</code>ï¼Œä¼šåº”ç”¨ <code>css-loader</code> å’Œ <code>style-loader</code>ã€‚</li>
<li>å¦‚æœæ–‡ä»¶æ˜¯ <code>.scss</code>ï¼Œä¼šåº”ç”¨ <code>sass-loader</code>ã€‚</li>
<li>å¦‚æœæ–‡ä»¶æ˜¯å›¾ç‰‡æ ¼å¼ï¼ˆ<code>.png</code>, <code>.jpg</code>, <code>.gif</code>ï¼‰ï¼Œä¼šä½¿ç”¨ <code>asset/resource</code>ã€‚</li>
</ul>
<p><code>oneOf</code> ç¡®ä¿æ¯ä¸ªæ–‡ä»¶ <strong>åªåŒ¹é…ç¬¬ä¸€ä¸ªç¬¦åˆæ¡ä»¶çš„è§„åˆ™</strong>ï¼Œåç»­è§„åˆ™ä¸å†å¤„ç†è¯¥æ–‡ä»¶ã€‚</p>
<h4 id="oneof-2"><strong><code>oneOf</code> çš„ä¼˜ç‚¹</strong>
</h4><ol>
<li><strong>æ€§èƒ½ä¼˜åŒ–ï¼š</strong>
<ul>
<li>é¿å…æ–‡ä»¶è¢«å¤šä¸ªè§„åˆ™é‡å¤åŒ¹é…ã€‚</li>
<li>Webpack åœ¨æ‰¾åˆ°åŒ¹é…è§„åˆ™ååœæ­¢ç»§ç»­åŒ¹é…ï¼Œå‡å°‘ä¸å¿…è¦çš„å¼€é”€ã€‚</li>
</ul>
</li>
<li><strong>æ˜ç¡®çš„è§„åˆ™ä¼˜å…ˆçº§ï¼š</strong>
<ul>
<li>é€šè¿‡è§„åˆ™çš„é¡ºåºï¼Œæ§åˆ¶ä¸åŒè§„åˆ™çš„ä¼˜å…ˆçº§ã€‚</li>
</ul>
</li>
<li><strong>æ›´æ¸…æ™°çš„é…ç½®ç»“æ„ï¼š</strong>
<ul>
<li>å°†ç›¸å…³çš„è§„åˆ™å½’çº³åˆ°ä¸€èµ·ï¼Œé…ç½®æ›´å…·å¯è¯»æ€§ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h4 id="oneof-3"><strong><code>oneOf</code> çš„æ³¨æ„äº‹é¡¹</strong>
</h4><ol>
<li>
<p><strong>é¡ºåºå¾ˆé‡è¦ï¼š</strong></p>
<ul>
<li><code>oneOf</code> ä¸­çš„è§„åˆ™æŒ‰é¡ºåºåŒ¹é…ï¼Œå…ˆå®šä¹‰çš„è§„åˆ™ä¼˜å…ˆçº§é«˜ã€‚</li>
<li>å¦‚æœè§„åˆ™é¡ºåºä¸åˆç†ï¼Œå¯èƒ½ä¼šå¯¼è‡´é¢„æœŸå¤–çš„è¡Œä¸ºã€‚</li>
</ul>
</li>
<li>
<p><strong>é»˜è®¤è§„åˆ™ï¼š</strong></p>
<ul>
<li>å¦‚æœæ²¡æœ‰ä»»ä½•è§„åˆ™åŒ¹é…ï¼ŒWebpack ä¼šæŠ›å‡ºé”™è¯¯ã€‚</li>
<li>å¯ä»¥åœ¨ <code>oneOf</code> ä¸­æ·»åŠ ä¸€ä¸ªé»˜è®¤è§„åˆ™ï¼Œä¾‹å¦‚ <code>file-loader</code> æˆ– <code>asset/resource</code>ï¼Œä»¥ç¡®ä¿æ‰€æœ‰æ–‡ä»¶éƒ½æœ‰å¤„ç†æ–¹å¼ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">oneOf</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å‰é¢çš„è§„åˆ™...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// é»˜è®¤è§„åˆ™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;asset/resource&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>ä¸å…¶ä»–é…ç½®çš„å…¼å®¹æ€§ï¼š</strong></p>
<ul>
<li><code>oneOf</code> é€‚ç”¨äºéœ€è¦æ˜ç¡®ä¼˜å…ˆçº§çš„åœºæ™¯ï¼Œä½†æŸäº›åœºæ™¯ï¼ˆå¦‚ <code>include</code> å’Œ <code>exclude</code> é…ç½®ï¼‰å¯èƒ½éœ€è¦é¢å¤–æ³¨æ„è§„åˆ™çš„é€‚é…æ€§ã€‚</li>
</ul>
</li>
</ol>
<h2 id="plugin">plugin
</h2><p>æ’ä»¶å¯ä»¥ç”¨äºæ‰§è¡ŒèŒƒå›´æ›´å¹¿çš„ä»»åŠ¡ã€‚åŒ…æ‹¬ï¼šæ‰“åŒ…ä¼˜åŒ–ï¼Œèµ„æºç®¡ç†ï¼Œæ³¨å…¥ç¯å¢ƒå˜é‡</p>
<ul>
<li>
<p>clean-webpack-plugin</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">CleanWebpackPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;clean-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">CleanWebpackPlugin</span><span class="p">()];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç°åœ¨å¯ä»¥åœ¨ webpack çš„ output é…ç½®é¡¹ä¸­ç¼–å†™ä¸€ä¸ªå­—æ®µ cleanï¼šboolean å®ç° clean-webpack-plugin æ’ä»¶çš„èƒ½åŠ›ã€‚</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;main.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>html-webpack-plugin</p>
<p>html-webpack-plugin æ’ä»¶åœ¨è°ƒç”¨æ—¶å¦‚æœä¸ä¼ é€’æ¨¡æ¿å‚æ•°ï¼Œåˆ™è¯¥åŒ…çš„å†…éƒ¨æœ‰ä¸€ä¸ªé»˜è®¤çš„ ejs æ¨¡æ¿å¯ä¾›ä½¿ç”¨&mdash;-default_index.ejs</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&lt;!DOCTYPE html&gt;
</span></span><span class="line"><span class="cl">&lt;html&gt;
</span></span><span class="line"><span class="cl">  &lt;head&gt;
</span></span><span class="line"><span class="cl">    &lt;meta charset=&#34;utf-8&#34;&gt;
</span></span><span class="line"><span class="cl">    &lt;title&gt;&lt;%= htmlWebpackPlugin.options.title %&gt;&lt;/title&gt;
</span></span><span class="line"><span class="cl">  &lt;/head&gt;
</span></span><span class="line"><span class="cl">  &lt;body&gt;
</span></span><span class="line"><span class="cl">  &lt;/body&gt;
</span></span><span class="line"><span class="cl">&lt;/html&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;æ¨¡æ¿htmlæ–‡ä»¶è·¯å¾„path&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;index.html&#34;</span><span class="p">,</span> <span class="c1">//æ‰“åŒ…åç”Ÿæˆçš„htmlæ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">minify</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">removeAttributeQuotes</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//ç§»é™¤htmlæ–‡ä»¶ä¸­çš„åŒå¼•å·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">collapseWhitespace</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//å‹ç¼©htmlä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">removeComments</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hash</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//åœ¨å¼•å…¥æ‰“åŒ…åçš„jsæ–‡ä»¶æ—¶ï¼Œç»™å®ƒåœ¨scriptæ ‡ç­¾ä¸­srcæ–‡ä»¶åçš„åé¢åŠ ä¸Šhashå€¼ï¼Œè€Œä¸æ˜¯æ‰“åŒ…åçš„jsæ–‡ä»¶æœ‰hashå€¼ &lt;script type=text/javascript src=boundle.js?fd7b1ef895541b8c9717&gt;&lt;/script&gt;ï¼Œè§£å†³æµè§ˆå™¨ç¼“å­˜çš„é—®é¢˜ï¼Œå¯ä»¥ä¸ç”¨è¯¥æ–¹æ³•è€Œç»™jsæ‰“åŒ…æ–‡ä»¶åŠ hashå€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">//chunks:[]  æ²¡æœ‰è¯¥å­—æ®µæ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨å¤šå…¥å£æ—¶ï¼Œç”Ÿæˆçš„å¤šä¸ªchunkéƒ½ä¼šè¢«å¼•å…¥åˆ°ä¸Šé¢çš„templateå­—æ®µå¼•å…¥æŒ‡å®šçš„htmlæ¨¡æ¿æ–‡ä»¶çš„æœ€åé¢ï¼ŒåŒæ—¶å¼•å…¥çš„é¡ºåºæ˜¯ä»¥entryå­—æ®µä¸­å„ä¸ªå…¥å£æ¨¡å—çš„å¾ªåºä¸ºå‡†ï¼Œæ‰€ä»¥å¦‚æœæ¨¡å—æ‰“åŒ…åçš„ç»“æœå­˜åœ¨ä¾èµ–å…³ç³»çš„è¯ï¼Œå¿…é¡»ä¿è¯å®ƒä»¬çš„é¡ºåºæ­£ç¡®ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;login&#34;</span><span class="p">,</span> <span class="s2">&#34;index&#34;</span><span class="p">],</span> <span class="c1">//è¡¨ç¤ºåªå³ä½¿æœ‰å¾ˆå¤šæ‰“åŒ…å…¥å£æ¨¡å—ï¼Œéƒ½åªåœ¨æ‰“åŒ…åhtmlæ¨¡æ¿çš„ä¸­å¼•å…¥loginå’Œindexä¸¤ä¸ªchunkï¼Œä¸”é¡ºåºä»¥entryæ—¶å‡ºç°çš„é¡ºåºå¼•å…¥ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nx">chunksSortMode</span><span class="o">:</span> <span class="s2">&#34;manual&#34;</span><span class="p">,</span> <span class="c1">//è¡¨ç¤ºé‡‡ç”¨chunksä¸­çš„é¡ºåºå¼•å…¥è€Œä¸ç”¨entryä¸­çš„å¼•å…¥é¡ºåº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// webpack.config.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">index</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./src/index.js&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">index1</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./src/index1.js&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">index2</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./src/index2.js&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">...</span>
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="p">...</span>
</span></span><span class="line"><span class="cl">        <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;index&#39;</span><span class="p">,</span><span class="s1">&#39;index2&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>chunks é€‰é¡¹çš„ä½œç”¨ä¸»è¦æ˜¯é’ˆå¯¹å¤šå…¥å£(entry)æ–‡ä»¶ã€‚å½“æœ‰å¤šä¸ªå…¥å£æ–‡ä»¶çš„æ—¶å€™ï¼Œå¯¹åº”å°±ä¼šç”Ÿæˆå¤šä¸ªç¼–è¯‘åçš„ js æ–‡ä»¶ã€‚é‚£ä¹ˆ chunks é€‰é¡¹å°±å¯ä»¥å†³å®šæ˜¯å¦éƒ½ä½¿ç”¨è¿™äº›ç”Ÿæˆçš„ js æ–‡ä»¶ã€‚chunks é»˜è®¤ä¼šåœ¨ç”Ÿæˆçš„ html æ–‡ä»¶ä¸­å¼•ç”¨æ‰€æœ‰çš„ js æ–‡ä»¶ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥æŒ‡å®šå¼•å…¥å“ªäº›ç‰¹å®šçš„æ–‡ä»¶ã€‚</p>
<p>æ‰§è¡Œ webpack å‘½ä»¤ä¹‹åï¼Œä¼šçœ‹åˆ°ç”Ÿæˆçš„ index.html æ–‡ä»¶ä¸­ï¼Œåªå¼•ç”¨äº† index.js å’Œ index2.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span> <span class="na">src</span><span class="o">=</span><span class="s">index.js</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">type</span><span class="o">=</span><span class="s">text/javascript</span> <span class="na">src</span><span class="o">=</span><span class="s">index2.js</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>chunksSortMode è¿™ä¸ªé€‰é¡¹å†³å®šäº† script æ ‡ç­¾çš„å¼•ç”¨é¡ºåºã€‚é»˜è®¤æœ‰å››ä¸ªé€‰é¡¹ï¼Œ&rsquo;none&rsquo;, &lsquo;auto&rsquo;, &lsquo;dependency&rsquo;, &lsquo;{function}&rsquo;ã€‚</p>
<ul>
<li>&lsquo;dependency&rsquo; æŒ‰ç…§ä¸åŒæ–‡ä»¶çš„ä¾èµ–å…³ç³»æ¥æ’åºã€‚</li>
<li>&lsquo;auto&rsquo; é»˜è®¤å€¼ï¼Œæ’ä»¶çš„å†…ç½®çš„æ’åºæ–¹å¼</li>
<li>&rsquo;none&rsquo; æ— åº</li>
<li>{function} æä¾›ä¸€ä¸ªå‡½æ•°</li>
</ul>
</li>
<li>
<p>copy-webpack-plugin</p>
<p>ç”¨äºå°†æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ä»æºç›®å½•å¤åˆ¶åˆ°æ„å»ºç›®å½•ã€‚å®ƒå¯ä»¥ç”¨äºå¤åˆ¶ä»»ä½•ç±»å‹çš„æ–‡ä»¶ï¼ŒåŒ…æ‹¬ JavaScript æ–‡ä»¶ã€‚copy-webpack-plugin æœ¬èº«å¹¶ä¸ä¼šè‡ªåŠ¨å°†å¤åˆ¶çš„ JavaScript æ–‡ä»¶æ’å…¥åˆ°æ‰“åŒ…åçš„ HTML æ–‡ä»¶ä¸­ã€‚å®ƒçš„ä¸»è¦åŠŸèƒ½æ˜¯å¤åˆ¶æ–‡ä»¶ï¼Œè€Œä¸æ¶‰åŠ HTML æ–‡ä»¶çš„ä¿®æ”¹æˆ–å¤„ç†ã€‚æ‰€ä»¥åœ¨æºç ä¸­ä½¿ç”¨æ—¶ï¼Œä¸€å®šè¦æ³¨æ„æºç ä¸­å¼•ç”¨çš„ç›¸å¯¹è·¯å¾„å’Œæ‰“åŒ…åæ–‡ä»¶é—´çš„ç›¸å¯¹è·¯å¾„å¿…é¡»ç»Ÿä¸€ï¼Œä¸ç„¶æ— æ³•æ‰¾åˆ°å¯¹åº”çš„èµ„æºæ–‡ä»¶ã€‚</p>
<p><strong>æ³¨æ„ï¼Œè¯¥æ’ä»¶åªæ˜¯å°†æŒ‡å®šç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·è´ä¸€ä»½åˆ°æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶å¤¹ä¸­ï¼Œä½†æ˜¯å¹¶ä¸å°†æ‹·è´åçš„æ–‡ä»¶è‡ªåŠ¨å¼•å…¥åˆ°æ‰“åŒ…ç”Ÿæˆçš„ html ä¸­</strong>ã€‚</p>
<p><a class="link" href="https://www.webpackjs.com/plugins/copy-webpack-plugin#root"  target="_blank" rel="noopener"
    >æ–‡æ¡£</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">CopyWebpackPlugin</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copy-webpack-plugin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">CopyWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">patterns</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">from</span><span class="o">:</span><span class="s1">&#39;src/public&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">to</span><span class="o">:</span> <span class="s1">&#39;public&#39;</span>  <span class="c1">// å°†src/publicç›®å½•ä¸‹çš„æ–‡ä»¶å¤åˆ¶åˆ°æ„å»ºç›®å½•çš„publicç›®å½•ä¸‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">globOptions</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">ignore</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">                        <span class="s2">&#34;**/index.html&#34;</span><span class="p">,</span>   <span class="c1">// æ’é™¤publicä¸‹çš„index.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                        <span class="s2">&#34;**/.DS_Store&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="p">...</span>
</span></span><span class="line"><span class="cl">                    <span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>ä¸‹å›¾æ˜¯æºç ä¸­ï¼Œç›´æ¥ä»¥ç›¸å¯¹è·¯å¾„å¼•ç”¨å›¾ç‰‡èµ„æºçš„æƒ…å†µï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20231215095204895.png"
	width="1049"
	height="646"
	srcset="/blogs/post/webpack/images/image-20231215095204895_hu_db88c4b087110352.png 480w, /blogs/post/webpack/images/image-20231215095204895_hu_199121267f01379.png 1024w"
	loading="lazy"
	
		alt="image-20231215095204895"
	
	
		class="gallery-image" 
		data-flex-grow="162"
		data-flex-basis="389px"
	
></p>
<p>ä¸‹å›¾æ˜¯æ‰“åŒ…åç”Ÿæˆæ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„çš„æƒ…å†µï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20231215095243255.png"
	width="1507"
	height="894"
	srcset="/blogs/post/webpack/images/image-20231215095243255_hu_9ce4bd1649bd8529.png 480w, /blogs/post/webpack/images/image-20231215095243255_hu_4600f7105e4498fc.png 1024w"
	loading="lazy"
	
		alt="image-20231215095243255"
	
	
		class="gallery-image" 
		data-flex-grow="168"
		data-flex-basis="404px"
	
></p>
<p>å¯ä»¥çœ‹å‡ºä»–ä»¬å¿…é¡»ä¿æŒä¸€è‡´æ‰å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</p>
<p>å¦‚æœå°†æ’ä»¶çš„é…ç½®æ”¹ä¸ºä¸‹é¢è¿™æ ·ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">CopyWebpackPlugin</span>  <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;copy-webpack-plugin&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">CopyWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">patterns</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">from</span><span class="o">:</span><span class="s1">&#39;src/public&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// to: &#39;public&#39;  å–æ¶ˆè¡Œä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">globOptions</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">ignore</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;**/index.html&#34;</span><span class="p">,</span>   <span class="c1">// æ’é™¤publicä¸‹çš„index.html
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="s2">&#34;**/.DS_Store&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="p">...</span>
</span></span><span class="line"><span class="cl">          <span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…ç»“æœå¦‚ä¸‹ï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20231215095528253.png"
	width="437"
	height="507"
	srcset="/blogs/post/webpack/images/image-20231215095528253_hu_6e3bb0d8a8bcd173.png 480w, /blogs/post/webpack/images/image-20231215095528253_hu_ae0552b039110924.png 1024w"
	loading="lazy"
	
		alt="image-20231215095528253"
	
	
		class="gallery-image" 
		data-flex-grow="86"
		data-flex-basis="206px"
	
></p>
<p>ç›¸å¯¹ä½ç½®å‘ç”Ÿæ”¹å˜ï¼Œåˆ™ä½¿ç”¨æ‰“åŒ…åçš„æ–‡ä»¶å‘å¸ƒä¸Šçº¿çš„è¯ï¼Œåˆ™æ‰¾ä¸åˆ°å¯¹åº”çš„å›¾ç‰‡èµ„æºã€‚</p>
<h2 id="æ¨¡å¼mode">æ¨¡å¼(mode)
</h2><ul>
<li>
<p>å¼€å‘æ„å»ºç»“æœç”¨äºæœ¬åœ°å¼€å‘è°ƒè¯•ï¼Œä¸è¿›è¡Œä»£ç å‹ç¼©ï¼Œæ‰“å° debug ä¿¡æ¯ï¼Œéœ€è¦ sourcemap æ–‡ä»¶ï¼Œçƒ­æ›´æ–°</p>
</li>
<li>
<p>ç”Ÿäº§æ„å»ºç”Ÿæˆæ‰“åŒ…æ–‡ä»¶ç›´æ¥åº”ç”¨äºçº¿ä¸Šçš„ï¼Œå³ä»£ç éƒ½æ˜¯å‹ç¼©åï¼Œè¿è¡Œæ—¶ä¸æ‰“å° debug ä¿¡æ¯ï¼Œä¸åŒ…æ‹¬ sourcemapï¼Œå¯èƒ½éœ€è¦åˆ†ç¦» CSS æˆå•ç‹¬çš„æ–‡ä»¶ï¼Œä»¥ä¾¿å¤šä¸ªé¡µé¢å…±äº«åŒä¸€ä¸ª CSS æ–‡ä»¶</p>
</li>
<li>
<p>webpack 4.x å¼•å…¥çš„ <a class="link" href="https://webpack.docschina.org/configuration/mode/"  target="_blank" rel="noopener"
    >mode</a></p>
</li>
<li>
<p>å½“æŒ‡å®šä½¿ç”¨ production mode æ—¶ï¼Œé»˜è®¤ä¼šå¯ç”¨å„ç§æ€§èƒ½ä¼˜åŒ–çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬æ„å»ºç»“æœä¼˜åŒ–ä»¥åŠ webpack è¿è¡Œæ€§èƒ½ä¼˜åŒ–</p>
</li>
<li>
<p>å¦‚æœæ˜¯ development mode çš„è¯ï¼Œåˆ™ä¼šå¼€å¯ debug å·¥å…·ï¼Œè¿è¡Œæ—¶æ‰“å°è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯ï¼Œä»¥åŠæ›´åŠ å¿«é€Ÿçš„å¢é‡ç¼–è¯‘æ„å»º</p>
</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">é€‰é¡¹</th>
          <th style="text-align: left">æè¿°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">development</td>
          <td style="text-align: left">ä¼šå°† process.env.NODE_ENV çš„å€¼è®¾ä¸º developmentã€‚å¯ç”¨ NamedChunksPlugin å’Œ NamedModulesPlugin</td>
      </tr>
      <tr>
          <td style="text-align: left">production</td>
          <td style="text-align: left">ä¼šå°† process.env.NODE_ENV çš„å€¼è®¾ä¸º productionã€‚å¯ç”¨ FlagDependencyUsagePlugin, FlagIncludedChunksPlugin, ModuleConcatenationPlugin, NoEmitOnErrorsPlugin, OccurrenceOrderPlugin, SideEffectsFlagPlugin å’Œ UglifyJsPlugin</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="kr">export</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span> <span class="c1">// ç­‰äºå¼€å¯ä¸‹é¢çš„è¿™äº›é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="s2">&#34;eval&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cache</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">performace</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hints</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pathinfo</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">moduleIds</span><span class="o">:</span> <span class="s2">&#34;named&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">chunkIds</span><span class="o">:</span> <span class="s2">&#34;named&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mangleExports</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">nodeEnv</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">flagIncludedOrder</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">concatenateModules</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">hidePathInfo</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">minSize</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">maxAsyncRequests</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">maxInitialRequests</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">emitOnErrors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">checkWasmTypes</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">removeAvailableModules</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;process.env.NODE_ENV&#34;</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="s2">&#34;development&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="kr">export</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;production&#34;</span><span class="p">,</span> <span class="c1">// ç­‰äºå¼€å¯ä¸‹é¢çš„è¿™äº›é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cache</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">performace</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hints</span><span class="o">:</span> <span class="s2">&#34;warning&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pathinfo</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">moduleIds</span><span class="o">:</span> <span class="s2">&#34;deterministic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">chunkIds</span><span class="o">:</span> <span class="s2">&#34;deterministic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mangleExports</span><span class="o">:</span> <span class="s2">&#34;deterministic&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">nodeEnv</span><span class="o">:</span> <span class="s2">&#34;production&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">flagIncludedOrder</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">concatenateModules</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">hidePathInfo</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">minSize</span><span class="o">:</span> <span class="mi">10000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">maxAsyncRequests</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">maxInitialRequests</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">emitOnErrors</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">checkWasmTypes</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">removeAvailableModules</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;process.env.NODE_ENV&#34;</span><span class="o">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="s2">&#34;production&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">TerserPlugin</span><span class="p">(</span><span class="cm">/*...*/</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="åŒºåˆ†ç¯å¢ƒ">åŒºåˆ†ç¯å¢ƒ
</h2><p>è¯»å–å˜é‡çš„ä¸¤ä¸ªåœ°æ–¹ï¼š</p>
<ul>
<li>
<p>webpack é…ç½®æ–‡ä»¶è¢«è¯»å–æ—¶æ‰€åœ¨çš„ node ç¯å¢ƒï¼Œè¯¥ç¯å¢ƒçš„å…¨å±€å¯¹è±¡ä¸Šæœ‰ process è¿›ç¨‹å¯¹è±¡</p>
</li>
<li>
<p>é¡¹ç›®çš„æºç æ–‡ä»¶å®é™…è¿è¡Œæ‰€åœ¨çš„æµè§ˆå™¨ç¯å¢ƒä¸­ï¼Œæµè§ˆå™¨å…¨å±€å¯¹è±¡ä¸Šæ²¡æœ‰ process è¿›ç¨‹å¯¹è±¡ï¼Œè®¿é—®åˆ™æŠ¥é”™</p>
</li>
</ul>
<ol>
<li><strong><code>--mode</code>ç”¨æ¥é—´æ¥è®¾ç½®æ¨¡å—å†…ï¼ˆæºä»£ç ä¸­ï¼‰çš„<code>process.env.NODE_ENV</code></strong></li>
</ol>
<ul>
<li>å¯ä»¥åœ¨æ¨¡å—å†…(<strong>é¡¹ç›®æºæ–‡ä»¶ä»£ç ä¸­ï¼Œä¸åŒ…æ‹¬ webpack é…ç½®æ–‡ä»¶</strong>)é€šè¿‡<code>process.env.NODE_ENV</code>è·å–è¯¥<code>process.env.NODE_ENV</code>å¯¹åº”çš„å­—ç¬¦ä¸²å€¼ï¼ˆdevelopment æˆ–è€… productionï¼‰å¹¶è¿›è¡Œæ›¿æ¢ï¼Œè¿™æ˜¯åœ¨<strong>ç¼–è¯‘é˜¶æ®µ</strong>åšçš„<strong>æ›¿æ¢å·¥ä½œ</strong>ï¼Œå®ƒå’Œ webpack é…ç½®æ–‡ä»¶ä¸­é€šè¿‡è¿›ç¨‹å¯¹è±¡ï¼ˆprocessï¼‰ä¸­çš„ç¯å¢ƒå˜é‡å¯¹è±¡(env) ä¸Šçš„ NODE_ENV æ˜¯ä¸¤ä¸ªå®Œå…¨ä¸åŒçš„æ¦‚å¿µ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;script&#34;</span><span class="err">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span><span class="s2">&#34;webpack --mode=development&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…·ä½“è¿‡ç¨‹ï¼š<code>webpack --mode=development</code> =&gt; è®¾ç½® webpack.config.js æ–‡ä»¶ä¸­ mode çš„å€¼ä¸º development =&gt; mode ä¸ºå¼€å‘æ¨¡å¼ï¼ˆdevelopment ï¼‰ä¸‹æ—¶ï¼Œwebpack å†…éƒ¨é€šè¿‡ webpack.definePlugin æ’ä»¶è®¾ç½®å­—ç¬¦ä¸² process.env.NODE_ENV åœ¨é¡¹ç›®æºç ä¸­çš„ä»£è¡¨çš„å®é™…å€¼ä¸º developmentï¼Œ <strong>åœ¨ç¼–è¯‘é˜¶æ®µï¼Œå½“è§£æåˆ°é¡¹ç›®æºç ä¸­æœ‰ç”¨åˆ°å˜é‡ï¼šprocess.env.NODE_ENV æ—¶ï¼Œç›´æ¥å°†å®ƒæ›¿æ¢ä¸ºå­—ç¬¦ä¸²ï¼ˆdevelopmentï¼‰</strong>ï¼Œprocess.env.NODE_ENV å­—ç¬¦ä¸²é™¤å¤–ã€‚ webpack &ndash;mode=production ä¹Ÿæ˜¯ä¸€æ ·çš„åŸç†ã€‚</p>
<p>å…¶ä¸­é€šè¿‡å‘½ä»¤è¡Œçš„&ndash;mode å’Œé…ç½®æ–‡ä»¶ä¸­çš„ mode å–æŒ‡å®šç¯å¢ƒï¼Œéƒ½æ˜¯ä¸€ä¸ªåŸç†ï¼Œå¦‚æœä¸¤è€…åŒæ—¶å­˜åœ¨ï¼Œåˆ™å‘½ä»¤è¡Œ&ndash;mode çš„ä¼˜å…ˆçº§æ›´é«˜ã€‚</p>
<ol start="2">
<li><strong><code>--env</code>ç”¨æ¥è®¾ç½® webpack é…ç½®æ–‡ä»¶çš„å‡½æ•°å‚æ•°</strong></li>
</ol>
<ul>
<li>æ— æ³•åœ¨æ¨¡å—å†…é€šè¿‡<code>process.env.NODE_ENV</code>è®¿é—®</li>
<li>å¯ä»¥åœ¨ webpack é…ç½®æ–‡ä»¶ä¸­é€šè¿‡é…ç½®æ–‡ä»¶å¯¼å‡ºçš„<strong>å‡½æ•°</strong>è·å–å½“å‰ç¯å¢ƒå˜é‡</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;script&#34;</span><span class="err">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span><span class="s2">&#34;webpack --env=development&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;webpack&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;html-webpack-plugin&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">)</span>   <span class="c1">// å€¼ä¸ºundefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">env</span><span class="p">,</span> <span class="nx">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">env</span><span class="p">)</span>  <span class="c1">// development:true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">argv</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;production&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry</span><span class="o">:</span><span class="s1">&#39;./src/index.js&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;./dist&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;[name].js&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;style-loader&#39;</span><span class="p">,</span> <span class="s1">&#39;css-loader&#39;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;./public/index.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;index.html&#39;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">FIRTS_VAR</span><span class="o">:</span> <span class="s2">&#34;&#39;wuyibo&#39;&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong><code>--env</code> ç”¨æ¥è®¾ç½®ä¼ ç»™ webpack é…ç½®æ–‡ä»¶å¯¼å‡ºçš„å‡½æ•°çš„å‚æ•°</strong>ï¼Œå¹¶ä¸ç›´æ¥åœ¨é¡¹ç›®çš„æ¨¡å—æ–‡ä»¶ä¸­ç”Ÿæ•ˆã€‚</p>
<p>åœ¨ script è„šæœ¬ä¸­ä½¿ç”¨ &ndash;env=development çš„æ•ˆæœæ˜¯ä¸º webpack é…ç½®æ–‡ä»¶é»˜è®¤å¯¼å‡ºçš„æ˜¯å‡½æ•°æ—¶ï¼Œå¯ä»¥åœ¨å‡½æ•°çš„å‚æ•°ä¸­è·å–åˆ°è¯¥å‘½ä»¤è¡Œä¸­è®¾ç½®çš„å‚æ•°ã€‚ä¾‹å¦‚ script è„šæœ¬ä¸­ï¼š<code>&quot;build&quot;: &quot;webpack --env=development&quot;</code> é‚£ä¹ˆä¸‹é¢ä»£ç ä¸­çš„ env å°±æ˜¯ï¼š<code>{ WEBPACK_BUNDLE: true, WEBPACK_BUILD: true, development: true }</code>ã€‚argv çš„ç»“æ„åˆ™æ˜¯ï¼š<code>{ env: { WEBPACK_BUNDLE: true, WEBPACK_BUILD: true, development: true } }</code>ï¼Œä½†æ˜¯å› ä¸º mode é»˜è®¤æ²¡æœ‰è®¾ç½®æ—¶ä½¿ç”¨çš„æ˜¯ production æ¨¡å¼ï¼Œæ‰€ä»¥æ‰“åŒ…å‡ºæ¥çš„æºä»£ç ä¸­çš„ process.env.NODE_ENV å˜é‡çš„å–å€¼ä»æ—§æ˜¯ production å­—ç¬¦ä¸²ã€‚</p>
<ol start="3">
<li><strong><code>cross-env</code>ç”¨æ¥è®¾ç½® node ç¯å¢ƒçš„<code>process.env.NODE_ENV</code></strong></li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">&#34;scripts&#34;: {
</span></span><span class="line"><span class="cl">  &#34;build&#34;: &#34;cross-env NODE_ENV=development webpack&#34;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>&ndash;env=development åªæ˜¯åœ¨æ‰§è¡Œè„šæœ¬æ—¶ï¼Œç»™<strong>å‡½æ•°ç±»å‹</strong>çš„ webpack é…ç½®ä¼ å…¥å‚æ•°ã€‚å¦‚æœåœ¨ webpack é…ç½®æ–‡ä»¶ä¸­è®¿é—® process.env.NODE_ENV çš„è¯ï¼Œæ˜¯æ²¡æœ‰å€¼çš„ï¼Œä¸º undefinedã€‚å¦‚æœæƒ³ä¿®æ”¹ webpack é…ç½®æ–‡ä»¶ä¸­è®¿é—®çš„å˜é‡çš„å€¼ï¼Œå¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è®¾ç½® webpack é…ç½®æ–‡ä»¶è¿è¡Œçš„ç¯å¢ƒçš„ç¯å¢ƒå˜é‡ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;scripts&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;set NODE_ENV=development webpack&#34;</span><span class="p">,</span>  <span class="c1">// windowsä¸‹çš„å†™æ³•ã€‚webpack é…ç½®æ–‡ä»¶ä¸­è®¿é—® process.env.NODE_ENV ï¼Œåˆ™å®ƒçš„å€¼å°±ä¸ºdevelopment
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;cross-env NODE_ENV=development webpack&#34;</span>  <span class="c1">// è§£å†³æ“ä½œç³»ç»Ÿå±‚é¢çš„å‘½ä»¤å…¼å®¹æ€§åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">}</span><span class="err">,</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack é…ç½®æ–‡ä»¶ä¸­è¯»å–çš„æ˜¯ node é…ç½®çš„ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥é€šè¿‡ cross-env key=value æ¥è®¾ç½®ã€‚ ç„¶ååœ¨ webpack é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¿é—®åˆ°è®¾ç½®çš„ç¯å¢ƒå˜é‡ï¼Œç„¶åå†ç”¨è¿™ä¸ªç¯å¢ƒå˜é‡ä½œä¸º webpack.DefinePlugin æ’ä»¶é…ç½®é¡¹ä¸­çš„å€¼ï¼Œä»è€Œæ¥æ”¹å˜é¡¹ç›®æ¨¡å—å†…çš„å˜é‡çš„å€¼æˆ–è€…æ‰“åŒ…æ–¹å¼ã€‚</p>
<p>cross-env è®¾ç½®çš„ç¯å¢ƒå˜é‡åœ¨é¡¹ç›®çš„æ¨¡å—æ–‡ä»¶ä¸­æ˜¯æ— æ³•è®¿é—®åˆ°çš„ã€‚</p>
<p>ä¾‹å­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="s2">&#34;scripts&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;cross-env NODE_ENV=production FIRST_ENV=one webpack&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ webpack é…ç½®æ–‡ä»¶ä¸­å¯ä»¥è®¿é—®åˆ°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">console.log(process.env.NODE_ENV);  // production
</span></span><span class="line"><span class="cl">console.log(process.env.FIRST_ENV);   // one
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨é¡¹ç›®ä¸­çš„æ–‡ä»¶ index.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">);</span> <span class="c1">// production,æ˜¯ç”±modeä¸ºproductionæ¨¡å¼ä¸‹çš„DefinePluginæ’ä»¶è®¾ç½®çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">FIRST_ENV</span><span class="p">);</span> <span class="c1">//  process.env.FIRST_ENVåˆ™ç›´æ¥åœ¨æ‰“åŒ…åæ–‡ä»¶ä¸­å­˜åœ¨ï¼Œè¿è¡Œæ—¶æŠ¥é”™
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>vueï¼Œreact è„šæ‰‹æ¶é¡¹ç›®ä¸­å¯ä»¥é€šè¿‡.env æ ¼å¼çš„æ–‡ä»¶å‘ node ç¯å¢ƒä¸­è®¾ç½®å˜é‡ã€‚å€ŸåŠ©çš„æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹åº“ï¼šdotenv-expandã€‚</strong></p>
<ol start="4">
<li><strong><code>DefinePlugin</code>ç”¨æ¥è®¾ç½®æ¨¡å—å†…(æºç ä¸­)çš„å…¨å±€å˜é‡</strong></li>
</ol>
<ul>
<li>è®¾ç½®æ‰€æœ‰æ¨¡å—éƒ½èƒ½è¯»å–åˆ°çš„å€¼</li>
<li>å¯ä»¥åœ¨ä»»æ„æ¨¡å—å†…é€šè¿‡ <code>process.env.xxx</code>æˆ–è€…å…¶ä»–<strong>ä»»æ„å­—æ®µ</strong>è¡¨ç¤ºè‡ªå·±è®¾ç½®å¥½çš„å€¼</li>
<li>æ— æ³•åœ¨<code>nodeç¯å¢ƒ</code>(webpack é…ç½®æ–‡ä»¶ä¸­)ä¸‹è·å–å½“å‰çš„å˜é‡</li>
<li>æ³¨æ„åœ¨å€¼ä¸ºå­—ç¬¦ä¸²æ˜¯éœ€è¦ç”¨å¼•å·åŒ…è£¹ä»£å¼•å·çš„å­—ç¬¦ä¸²</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">   <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;process.env.NODE_ENV&#39;</span><span class="o">:</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">NODE_ENV</span><span class="p">)</span><span class="err">ï¼Œ</span>
</span></span><span class="line"><span class="cl">       <span class="s1">&#39;back_end_url&#39;</span><span class="o">:</span><span class="s1">&#39;&#34;http://xxxx.xxx/xxx&#34;&#39;</span>
</span></span><span class="line"><span class="cl">   <span class="p">})</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é€šè¿‡æ’ä»¶ DefinePlugin è®¾ç½®çš„ key å¯ä»¥ç›´æ¥åœ¨æ•´ä¸ªé¡¹ç›®çš„æºç ä¸­ç›´è®¿é—®ã€‚æ¯”å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">env</span><span class="p">,</span> <span class="nx">argv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;production&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./public/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">      <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">FIRTS_VAR</span><span class="o">:</span> <span class="s2">&#34;&#39;wuyibo&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æºç  index.js ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">FIRTS_VAR</span><span class="p">);</span> <span class="c1">// åœ¨æ‰“åŒ…ç¼–è¯‘åçš„æ–‡ä»¶ä¸­ç›´æ¥å°±ç”¨  wuyibo å­—ç¬¦ä¸²è¿›è¡Œçš„æ›¿æ¢
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ vue é¡¹ç›®ä¸­çš„ index.html æ–‡ä»¶ä¸­æœ‰: <code>&lt;% BASE_URL %&gt; favicon.ico</code> ,å…¶ä¸­ BASE_URL æ˜¯è¦å–å…¨å±€ä¸‹çš„è¯¥å˜é‡å¯¹åº”çš„å€¼ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">DefinePlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">DefinePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">BASE_URL</span><span class="o">:</span> <span class="s2">&#34;&#39;./&#39;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>webpack çš„é…ç½®æ–‡ä»¶çš„æ¨¡å—å¯¼å‡ºå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªé…ç½®å¯¹è±¡ã€‚å…¶ä¸­å‡½æ•°å¯ä»¥æ¥å—å‘½ä»¤è¡Œä¼ é€’çš„å‚æ•°ã€‚</strong></p>
<h3 id="windows">Windows
</h3><h4 id="cmd">CMD
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
</span></span><span class="line"><span class="cl">set
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰
</span></span><span class="line"><span class="cl">set NODE_ENV
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># è®¾ç½®å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰
</span></span><span class="line"><span class="cl">set NODE_ENV=production
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># åˆ é™¤å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰
</span></span><span class="line"><span class="cl">set NODE_ENV=
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœ <code>NODE_ENV</code> æ²¡æœ‰è®¾ç½®ï¼Œåˆ™é€šè¿‡ <code>set NODE_ENV</code> å‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œä¼šæç¤º <code>ç¯å¢ƒå˜é‡ NODE_ENV æ²¡æœ‰å®šä¹‰</code>ã€‚</p>
<p>å½“è®¾ç½®å®Œ <code>NODE_ENV</code>ï¼ˆå‡è®¾è®¾ç½®å€¼ä¸º <code>production</code>ï¼‰ï¼Œå†é€šè¿‡ <code>set NODE_ENV</code> å‘½ä»¤æŸ¥çœ‹æ—¶ï¼Œä¼šè¿”å› <code>NODE_ENV=production</code>ã€‚</p>
<h4 id="powershell">Powershell
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
</span></span><span class="line"><span class="cl">ls env:
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰
</span></span><span class="line"><span class="cl">$env:NODE_ENV
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># è®¾ç½®å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰
</span></span><span class="line"><span class="cl">$env:NODE_ENV=&#34;production&#34;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># åˆ é™¤å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰
</span></span><span class="line"><span class="cl">del env:NODE_ENV
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ Powershell å‘½ä»¤é¢æ¿çš„æ“ä½œä¸­ï¼Œè‹¥ <code>NODE_ENV</code> æ²¡æœ‰è®¾ç½®ï¼Œåˆ™é€šè¿‡ <code>set NODE_ENV</code> å‘½ä»¤æŸ¥çœ‹å®ƒæ—¶ï¼Œæ²¡æœ‰ä»»ä½•æç¤ºã€‚</p>
<p>å½“è®¾ç½®å®Œ <code>NODE_ENV</code>ï¼ˆå‡è®¾è®¾ç½®å€¼ä¸º <code>production</code>ï¼‰ï¼Œå†é€šè¿‡ <code>set NODE_ENV</code> å‘½ä»¤æŸ¥çœ‹å®ƒæ—¶ï¼Œä¼šè¿”å› <code>production</code>ã€‚</p>
<p><strong>æ³¨æ„ç‚¹</strong></p>
<p>ä¸Šé¢çš„ç¯å¢ƒè®¾ç½®åªæ˜¯ä¸´æ—¶çš„ï¼Œå³åªé’ˆå¯¹å½“å‰è¿è¡Œçª—å£çš„ç¯å¢ƒæœ‰æ•ˆã€‚å½“ CLI è¿è¡Œçª—å£å…³é—­ä»¥åï¼Œç›¸å…³è®¾ç½®éƒ½ä¼šä¸¢å¤±ã€‚</p>
<p>å¦å¤–ï¼Œè™½ç„¶é€šè¿‡ CMD å’Œ Powershell éƒ½èƒ½ä¿®æ”¹ç¯å¢ƒå˜é‡ï¼Œä½†å®ƒä»¬ä¹‹é—´è®¾ç½®çš„ç¯å¢ƒå˜é‡å¹¶ä¸ä¼šç›¸äº’å½±å“ï¼Œå³ä½ åœ¨ CMD å¯ä»¥è®¾ç½® <code>NODE_ENV</code> ä¸º <code>production</code>ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥åœ¨ Powershell ä¸­è®¾ç½® <code>NODE_ENV</code> ä¸º <code>development</code>ï¼Œè¿™ä¹Ÿå°è¯äº†ä¸Šé¢çš„æè¿°ï¼Œè®¾ç½®åªé’ˆå¯¹å½“å‰è¿è¡Œçª—å£æœ‰æ•ˆ ã€‚</p>
<p>å¦‚æœå¸Œæœ›è®¾ç½®ä¸€ç›´ç”Ÿæ•ˆï¼ˆå³ æœ¬åœ°è®¾ç½®ï¼‰ï¼Œå¯é€šè¿‡ <code>æ§åˆ¶é¢æ¿ -&gt; ç³»ç»Ÿå’Œå®‰å…¨ -&gt; ç³»ç»Ÿ -&gt; é«˜çº§ç³»ç»Ÿè®¾ç½® -&gt; é«˜çº§ -&gt; ç¯å¢ƒå˜é‡</code> è¿™æ ·è¿›è¡Œè®¾ç½®ï¼ˆWindows10ã€å¯èƒ½éœ€è¦é‡å¯ï¼‰ã€‚</p>
<h3 id="mac">Mac
</h3><p>å› ä¸ºåªé›†æˆä¸€ç§å‘½ä»¤è¡Œç»ˆç«¯ï¼Œå®ƒè®¾ç½® Nodejs ç¯å¢ƒå˜é‡çš„è¯­æ³•å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">env</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">echo</span> <span class="o">$</span><span class="n">NODE_ENV</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">NODE_ENV</span><span class="o">=</span><span class="n">production</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ é™¤å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">unset</span> <span class="n">NODE_ENV</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨é…ç½®å®Œ Nodejs ç¯å¢ƒå˜é‡åï¼Œä½ å°±å¯ä»¥ç»§ç»­è¿è¡Œé¡¹ç›®ä¸­çš„æ‰“åŒ…å‘½ä»¤äº†ã€‚</p>
<h3 id="lunix">Lunix
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡</span>
</span></span><span class="line"><span class="cl"><span class="n">env</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># æŸ¥çœ‹å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">echo</span> <span class="o">$</span><span class="n">NODE_ENV</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># è®¾ç½®å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="k">export</span> <span class="n">NODE_ENV</span><span class="o">=</span><span class="n">production</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># åˆ é™¤å•ä¸ªç¯å¢ƒå˜é‡ï¼ˆä»¥ NODE_ENV ä¸ºä¾‹ï¼‰</span>
</span></span><span class="line"><span class="cl"><span class="n">unset</span> <span class="n">NODE_ENV</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨å‘½ä»¤è¡Œæ“ä½œä¸­ï¼Œè‹¥ <code>NODE_ENV</code> æ²¡æœ‰è®¾ç½®ï¼Œåˆ™é€šè¿‡ <code>echo $NODE_ENV</code> å‘½ä»¤æŸ¥çœ‹å®ƒæ—¶ï¼Œæ²¡æœ‰ä»»ä½•æç¤ºã€‚</p>
<p>å½“è®¾ç½®å®Œ <code>NODE_ENV</code>ï¼ˆå‡è®¾è®¾ç½®å€¼ä¸º <code>production</code>ï¼‰ï¼Œå†é€šè¿‡ <code>set NODE_ENV</code> å‘½ä»¤æŸ¥çœ‹å®ƒæ—¶ï¼Œä¼šè¿”å› <code>production</code>ã€‚</p>
<p>ä½†æ˜¯ï¼Œé‡‡ç”¨ å‘½ä»¤è¡Œï¼ˆCLIï¼‰è®¾ç½® çš„æ–¹å¼æ¥ä¿®æ”¹ Nodejs ç¯å¢ƒå˜é‡æœ‰ä¸€ä¸ªä¸å¥½åœ°æ–¹ã€‚å³æ¯æ¬¡åœ¨è¿è¡Œæ‰“åŒ…å‘½ä»¤å‰ï¼Œéƒ½è¦å…ˆé€šè¿‡ <code>set NODE_ENV=xx</code> æˆ–è€… <code>export NODE_ENV=xx</code> ç­‰ç±»ä¼¼çš„å‘½ä»¤æ¥è®¾ç½®æˆ–è€…åˆ‡æ¢ç¯å¢ƒå˜é‡ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯é‡å¼€äº†å‘½ä»¤çª—å£ï¼Œæˆ–è€…åˆ‡æ¢æ‰“åŒ…ç¯å¢ƒçš„æƒ…å†µä¸‹ï¼‰ã€‚</p>
<p>ç¬¬äºŒç§åšæ³•ï¼Œå³é…ç½® package.jsonã€‚</p>
<h2 id="é…ç½®-packagejson">é…ç½® package.json
</h2><p>åœ¨é¡¹ç›®é…ç½®æ–‡ä»¶ package.json ä¸­ï¼Œæ ¹æ®ä¸åŒçš„æ‰“åŒ…å‘½ä»¤å»è®¾ç½®ç›¸åº”çš„ Nodejs ç¯å¢ƒå˜é‡ï¼Œæ˜¯ä¸€ç§éå¸¸ä¸»æµçš„åšæ³•ã€‚å…¶å®æœ¬è´¨ä¸Šæ¥è¯´ï¼Œåªæ˜¯å°†åœ¨å‘½ä»¤è¡Œé¢æ¿è®¾ç½®ç¯å¢ƒå˜é‡çš„å‘½ä»¤è¯­å¥æ”¾åˆ°äº† <code>package.json</code> æ–‡ä»¶ä¸­ï¼ŒæŠŠ è®¾ç½®ç¯å¢ƒå˜é‡ å’Œ æ‰“åŒ… ä¸¤ä¸ªå‘½ä»¤åˆå¹¶è¿è¡Œè€Œå·²ã€‚</p>
<p>è¿™ç§æ–¹å¼ï¼Œå°±æ˜¯å°† <code>NODE_ENV</code> æ³¨å…¥åˆ° <code>process.env</code> å¯¹è±¡ã€‚ä¸åŒç¯å¢ƒä¸‹ï¼Œè®¾ç½®å¦‚ä¸‹ï¼š</p>
<h3 id="windows-ç³»ç»Ÿ">Windows ç³»ç»Ÿ
</h3><p>åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œæ— è®ºä½ æ˜¯ä½¿ç”¨ CMD (å‘½ä»¤æç¤ºç¬¦) è¿˜æ˜¯ Powershell å‘½ä»¤è¡Œå·¥å…·ï¼Œä½ éƒ½å¯ä»¥åœ¨ <code>package.json</code> è¿™æ ·é…ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// package.json
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">  &#34;scripts&#34;: {
</span></span><span class="line"><span class="cl">    &#34;build&#34;: &#34;set NODE_ENV=production&amp;&amp; npm run clean &amp;&amp; webpack&#34;,
</span></span><span class="line"><span class="cl">    &#34;clean&#34;: &#34;rimraf ./build &amp;&amp; mkdirp build&#34;,
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>é…ç½®å®Œåï¼ˆ<code>mkdirp</code> æ˜¯ä¸€ä¸ªç”Ÿæˆæ–‡ä»¶å¤¹çš„ç¬¬ä¸‰æ–¹åŒ…ï¼‰ï¼Œä½ åªéœ€è¦åœ¨å‘½ä»¤è¡Œé¢æ¿è¿è¡Œ <code>npm run build</code> å³å¯å®Œæˆæ‰“åŒ…ã€‚</p>
<p><strong>æ³¨æ„ç‚¹</strong></p>
<p>åœ¨ Windows ç³»ç»Ÿä¸­ï¼Œä½ å¿…é¡»ç§»é™¤ç¯å¢ƒå˜é‡å‘½ä»¤ä¸ <code>&amp;&amp;</code> ç¬¦å·ä¹‹é—´çš„ç©ºç™½ã€‚å¦è€…ï¼Œé…ç½®çš„å‘½ä»¤ä¸èƒ½ç”Ÿæ•ˆï¼</p>
<h3 id="mac-ç³»ç»Ÿ">Mac ç³»ç»Ÿ
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="o">//</span> <span class="n">package</span><span class="o">.</span><span class="n">json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;scripts&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;export NODE_ENV=production &amp;&amp; npm run clean &amp;&amp; webpack&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;clean&#34;</span><span class="p">:</span> <span class="s2">&#34;rimraf ./build &amp;&amp; mkdirp build&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸Šé¢æè¿°å¯ä»¥çœ‹åˆ°ï¼Œä¸è®ºæ˜¯ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œè¿˜æ˜¯ä¸åŒçš„å‘½ä»¤è¡Œç»ˆç«¯ï¼Œè™½ç„¶ç›®çš„éƒ½æ˜¯è®¾ç½® Nodejs ç¯å¢ƒå˜é‡ï¼Œä½†å®ƒä»¬çš„è¯­æ³•éƒ½ä¸å°½ç›¸åŒã€‚è¿™å°±å¸¦æ¥ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>åœ¨ Windows å¼€å‘éƒ¨ç½²çš„é¡¹ç›®ï¼Œå¯èƒ½åœ¨ Mac ç³»ç»Ÿæ— æ³•æ­£å¸¸æ‰“åŒ…</li>
<li>åœ¨è·¨å¹³å°å¼€å‘çš„é¡¹ç›®ä¸Šï¼Œä½ è¿˜å¾—è®°ä½æ¯ä¸ªå‘½ä»¤è¡Œç»ˆç«¯æ‰€ä½¿ç”¨çš„è¯­æ³•ï¼Œä¹Ÿéº»çƒ¦</li>
</ul>
<p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œæœ‰äººå¼€å‘äº† <code>cross-env</code>ã€‚</p>
<h3 id="è·¨å¹³å°---cross-env">è·¨å¹³å° - cross-env
</h3><p><a class="link" href="https://www.npmjs.com/package/cross-env"  target="_blank" rel="noopener"
    >cross-env</a> æ˜¯ä¸€ä¸ªè·¨å¹³å°è®¾ç½®ç¯å¢ƒå˜é‡çš„ç¬¬ä¸‰æ–¹åŒ…ï¼Œå®ƒå¯ä»¥è®©ä½ åªé…ç½®ä¸€è¡Œå‘½ä»¤ï¼Œå°±èƒ½è½»æ¾åœ°åœ¨å¤šä¸ªå¹³å°è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p>
<p>é¦–å…ˆï¼Œå®‰è£…å®ƒï¼ˆç”±äºå¤šä¸ªé¡¹ç›®åœ¨ç”¨ï¼Œæ‰€ä»¥å°±å…¨å±€å®‰è£…äº†ï¼‰ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npm install -g cross-env
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç„¶åï¼Œåœ¨ <code>package.json</code> æ–‡ä»¶ä¸­è¿›è¡Œè®¾ç½®ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">// package.json
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  ...
</span></span><span class="line"><span class="cl">  &#34;scripts&#34;: {
</span></span><span class="line"><span class="cl">    &#34;build&#34;: &#34;npm run clean &amp;&amp; cross-env NODE_ENV=production webpack&#34;,
</span></span><span class="line"><span class="cl">    &#34;clean&#34;: &#34;rimraf ./build &amp;&amp; mkdirp build&#34;,
</span></span><span class="line"><span class="cl">  }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼Œä¸ç®¡ç”µè„‘æ˜¯ Windows ç³»ç»Ÿè¿˜æ˜¯ Mac ç³»ç»Ÿ ï¼Œä¸ç®¡ç”¨çš„ Powershell è¿˜æ˜¯ Gitï¼Œä½ éƒ½å¯ä»¥æ­£å¸¸è®¾ç½® Nodejs ç¯å¢ƒå˜é‡äº†ã€‚æ³¨æ„ï¼Œ<code>cross-env NODE_ENV=production &amp;&amp; npm run clean &amp;&amp; webpack</code> æ­¤ç±»çš„è®¾ç½®ä¸èƒ½ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚åŸå› æ˜¯ <code>&amp;&amp;</code> ç¬¦å·æŠŠå‘½ä»¤è¯­å¥åˆ†ç¦»æˆäº†å¤šä¸ªï¼Œæ¯ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œçš„ç¯å¢ƒéƒ½æ˜¯éš”ç¦»çš„ï¼Œè€Œ <code>cross-env</code> æ— æ³•ä½œç”¨äºå…¶ä»–ç¯å¢ƒçš„å‘½ä»¤ã€‚</p>
<h2 id="browserlist">Browserlist
</h2><p>åœ¨ä¸åŒçš„å‰ç«¯å·¥å…·ä¹‹é—´å…±ç”¨ç›®æ ‡æµè§ˆå™¨å’Œ node ç‰ˆæœ¬çš„é…ç½®æ–‡ä»¶ã€‚å®ƒä¸»è¦è¢«ä»¥ä¸‹å·¥å…·ä½¿ç”¨(è®¸å¤šçš„ webpack æ’ä»¶ä¼šä¾èµ–å®ƒ)ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Autoprefixer
</span></span><span class="line"><span class="cl">Babel
</span></span><span class="line"><span class="cl">post-preset-env
</span></span><span class="line"><span class="cl">eslint-plugin-compat
</span></span><span class="line"><span class="cl">stylelint-unsupported-browser-features
</span></span><span class="line"><span class="cl">postcss-normalize
</span></span></code></pre></td></tr></table>
</div>
</div><p>Browserlist å¯ä»¥ç¼–å†™çš„å­—æ®µï¼š</p>
<ul>
<li>defaults : Browserslist çš„é»˜è®¤æµè§ˆå™¨ (&gt; 0.5%,last 2 versions, Firefox ESR, not dead)ã€‚</li>
<li>5%:é€šè¿‡å…¨çƒä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯é€‰æ‹©çš„æµè§ˆå™¨ç‰ˆæœ¬ã€‚ &gt;=ï¼Œ&lt;å’Œ&lt;=å·¥ä½œè¿‡
<ul>
<li>5% in Us:ä½¿ç”¨ç¾å›½ä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ã€‚å®ƒæ¥å—ä¸¤ä¸ªå­—æ¯çš„å›½å®¶/åœ°åŒºä»£ç ã€‚</li>
<li>&gt;5%in alt-As:ä½¿ç”¨äºšæ´²åœ°åŒºä½¿ç”¨æƒ…å†µç»Ÿè®¡ä¿¡æ¯ï¼Œæœ‰å…³æ‰€æœ‰åŒºåŸŸä»£ç çš„åˆ—è¡¨ï¼Œè¯·å‚è§ aniuse-lite/data/reqions</li>
<li>&gt;5%in my stats:ä½¿ç”¨è‡ªå®šä¹‰ç”¨æ³•æ•°æ®</li>
<li>&gt;5% in browserslist-config-mycompany stats :ä½¿ç”¨ æ¥è‡ªçš„è‡ªå®šä¹‰ä½¿ç”¨æƒ…å†µæ•°æ® browserslist-onfig-mycompany/browserslist-stats,json.</li>
<li>cover 99.5%:æä¾›è¦†ç›–ç‡çš„æœ€å—æ¬¢è¿çš„æµè§ˆå™¨</li>
<li>cover 99.5%in us:ä¸ä¸Šè¿°ç›¸åŒï¼Œä½†å›½å®¶/åœ°åŒºä»£ç ç”±ä¸¤ä¸ªå­—æ¯ç»„æˆ</li>
<li>cover 99.5%in my stats:ä½¿ç”¨è‡ªå®šä¹‰ç”¨æ³•æ•°æ®</li>
</ul>
</li>
<li>dead:24 ä¸ªæœˆå†…æ²¡æœ‰å®˜æ–¹æ”¯æŒæˆ–æ›´æ–°çš„æµè§ˆå™¨ï¼Œç°åœ¨æ˜¯ E 10 Mob 11 BlackBerry 10Blackery7ï¼ŒSamsung 4 å’Œ OperaMobile 12.1.</li>
<li>last 2versions:æ¯ä¸ªæµè§ˆå™¨çš„æœ€å 2 ä¸ªç‰ˆæœ¬ã€‚
<ul>
<li>last 2 Chrome versions:æœ€è¿‘ 2 ä¸ªç‰ˆæœ¬çš„ Chrome æµè§ˆå™¨</li>
<li>last2 major versions æˆ– last 2 ios major versions:æœ€è¿‘ 2 ä¸ªä¸»è¦ç‰ˆæœ¬çš„æ‰€æœ‰æ¬¡è¦/è¡¥ä¸ç‰ˆæœ¬</li>
</ul>
</li>
<li>not ie&lt;= 8:æ’é™¤å…ˆå‰æŸ¥è¯¢é€‰æ‹©çš„æµè§ˆå™¨ã€‚</li>
<li>browserslist config:åœ¨ Browserslist é…ç½®ä¸­å®šä¹‰çš„æµè§ˆå™¨ã€‚åœ¨å·®å¼‚æœåŠ¡ä¸­å¾ˆæœ‰ç”¨ï¼Œå¯ç”¨äºä¿®æ”¹ç”¨æˆ·çš„é…ç½®ã€‚</li>
</ul>
<p>å¯ä»¥ç¼–å†™ç±»ä¼¼äºè¿™æ ·çš„é…ç½®:</p>
<blockquote>
<p>&gt; 1% last 2 versions not dead</p></blockquote>
<p>ä¹‹åè¿™äº›å·¥å…·ä¼šæ ¹æ®é…ç½®æ¥è·å–ç›¸å…³çš„æµè§ˆå™¨ä¿¡æ¯ï¼Œä»¥æ–¹ä¾¿å†³å®šæ˜¯å¦éœ€è¦è¿›è¡Œå…¼å®¹æ€§çš„æ”¯æŒ:</p>
<ul>
<li>æ¡ä»¶æŸ¥è¯¢ä½¿ç”¨çš„æ˜¯ caniuse-lite çš„å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·çš„æ•°æ®æ¥è‡ªäº caniuse çš„ç½‘ç«™ä¸Š;</li>
</ul>
<p>ç›´æ¥ä½¿ç”¨ browserslist å‘½ä»¤è¡Œå·¥å…·æŸ¥è¯¢æ ¹æ®æ¡ä»¶åŒ¹é…åˆ°çš„æµè§ˆå™¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">npx browserslist &#34;&gt;1%, last 2 version, not dead&#34;
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blogs/post/webpack/images/image-20220828190451254.png"
	width="877"
	height="638"
	srcset="/blogs/post/webpack/images/image-20220828190451254_hu_7ea9212c0663e781.png 480w, /blogs/post/webpack/images/image-20220828190451254_hu_d90b0d0f404741c3.png 1024w"
	loading="lazy"
	
		alt="image-20220828190451254"
	
	
		class="gallery-image" 
		data-flex-grow="137"
		data-flex-basis="329px"
	
></p>
<p>Browserlist å¯ä»¥ç¼–å†™çš„ä½ç½®ï¼š</p>
<ul>
<li>
<p>åœ¨ package.json ä¸­çš„é…ç½®</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;browserslist&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;last 1 version&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&gt; 1%&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;maintained node versions&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;not dead&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="err">æˆ–è€…</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="s2">&#34;browserslist&#34;</span><span class="err">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;production&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;&gt; 1%&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;ie 10&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;development&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;last 1 chrome version&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;last 1 firefox version&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>å•ç‹¬çš„ä¸€ä¸ªé…ç½®æ–‡ä»¶.browserslistrc æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æ³¨é‡Šæ˜¯è¿™æ ·å†™çš„ï¼Œä»¥#å·å¼€å¤´
</span></span><span class="line"><span class="cl">&gt; 1%  #ä»£è¡¨å…¨çƒè¶…è¿‡1%ä½¿ç”¨çš„æµè§ˆå™¨
</span></span><span class="line"><span class="cl">last 1 version #æœ€åçš„ä¸€ä¸ªç‰ˆæœ¬
</span></span><span class="line"><span class="cl">maintained node versions #æ‰€æœ‰è¿˜è¢« node åŸºé‡‘ä¼šç»´æŠ¤çš„ node ç‰ˆæœ¬
</span></span><span class="line"><span class="cl">not dead
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">æˆ–è€…
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[production staging]
</span></span><span class="line"><span class="cl">&gt; 1%
</span></span><span class="line"><span class="cl">last 2 version
</span></span><span class="line"><span class="cl">not dead
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">[development]
</span></span><span class="line"><span class="cl">last 1 chrome version
</span></span><span class="line"><span class="cl">last 1 firefox version
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">ä¸é…ç½®é»˜è®¤ä¸ºï¼š**&gt; 0.5%, last 2 versions, Firefox ESR, not dead**
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h2 id="webpack-dev-server">webpack-dev-server
</h2><div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">ç±»åˆ«</th>
          <th style="text-align: left">é…ç½®åç§°</th>
          <th style="text-align: left">æè¿°</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">output</td>
          <td style="text-align: left">path</td>
          <td style="text-align: left">æŒ‡å®šæ‰“åŒ…ç”Ÿæˆçš„è¾“å‡ºåˆ°ç¡¬ç›˜ä¸Šçš„ç›®å½•</td>
      </tr>
      <tr>
          <td style="text-align: left">output</td>
          <td style="text-align: left">publicPath</td>
          <td style="text-align: left">è¡¨ç¤ºçš„æ˜¯æ‰“åŒ…ç”Ÿæˆçš„ index.html æ–‡ä»¶é‡Œé¢å¼•ç”¨èµ„æºçš„å‰ç¼€ï¼ŒåŒæ—¶åŠ¨æ€å¼•å…¥çš„å…¶ä»–è„šæœ¬ä¹Ÿæ˜¯åŸºäºè¿™ä¸ªè·¯å¾„å»è¯·æ±‚çš„</td>
      </tr>
      <tr>
          <td style="text-align: left">devServer</td>
          <td style="text-align: left">static</td>
          <td style="text-align: left">ç”¨äºé…ç½®æä¾›é¢å¤–é™æ€æ–‡ä»¶å†…å®¹çš„ç›®å½•</td>
      </tr>
  </tbody>
</table></div>
<p>å†…éƒ¨ä¾èµ–çš„æ˜¯ express æ¡†æ¶ã€‚onBeforeSetupMiddleware åœ¨ webpack-dev-server é™æ€èµ„æºä¸­é—´ä»¶å¤„ç†ä¹‹å‰ï¼Œå¯ä»¥ç”¨äºæ‹¦æˆªéƒ¨åˆ†è¯·æ±‚è¿”å›ç‰¹å®šå†…å®¹ï¼Œæˆ–è€…å®ç°ç®€å•çš„æ•°æ® mockã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">static</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;public&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">port</span><span class="o">:</span> <span class="mi">8080</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">open</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compress</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// å¯åŠ¨gzipå‹ç¼©
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">hot</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// å¯åŠ¨æ¨¡å—çƒ­æ›´æ–°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">watchFiles</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;path&#34;</span><span class="p">],</span> <span class="c1">// ä¸å†™å°±ç›‘æ§æ‰€æœ‰æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">historyApiFallback</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// å‚æ•°ç”¨äºè®¾ç½®æ˜¯å¦å¯ç”¨ HTML5 å†å²è®°å½• APIï¼Œç”¨äºå¤„ç†å•é¡µåº”ç”¨çš„è·¯ç”±é—®é¢˜ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“ä½¿ç”¨æµè§ˆå™¨çš„å‰è¿›/åé€€æŒ‰é’®æ—¶ï¼ŒdevServer ä¼šå°è¯•æ ¹æ® URL è·¯å¾„æŸ¥æ‰¾å¯¹åº”çš„é™æ€èµ„æºï¼Œå¦‚æœæ‰¾ä¸åˆ°å°±è¿”å› 404ã€‚å¦‚æœå¯ç”¨äº† historyApiFallbackï¼Œåˆ™ä¼šå°†è¿™äº›è¯·æ±‚é‡å®šå‘åˆ° index.htmlï¼Œç„¶åäº¤ç»™å‰ç«¯è·¯ç”±æ¥å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">proxy</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/api&#34;</span><span class="o">:</span> <span class="s2">&#34;http://localhost:3000&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;/api2&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">target</span><span class="o">:</span> <span class="s2">&#34;http://localhost:3001&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">pathRewrite</span><span class="o">:</span> <span class="p">{</span> <span class="s2">&#34;^/api2&#34;</span><span class="o">:</span> <span class="s2">&#34;&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// webpack-dev-server å†…éƒ¨å°±æ˜¯ä¸€ä¸ªexpressæœåŠ¡å™¨ï¼ŒdevServerå°±æ˜¯expressæ‰§è¡Œè¿”å›å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">onBeforeSetupMiddleware</span><span class="p">(</span><span class="nx">devServer</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// express()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// ç®€å•æ¨¡æ‹Ÿä¸€ä¸ªåç«¯æ¥å£
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">devServer</span><span class="p">.</span><span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;/api/users&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">res</span><span class="p">.</span><span class="nx">json</span><span class="p">([{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">1</span> <span class="p">},</span> <span class="p">{</span> <span class="nx">id</span><span class="o">:</span> <span class="mi">2</span> <span class="p">}]);</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä½¿ç”¨ webpack-dev-server æ—¶ï¼Œå†…éƒ¨ä¼šä½¿ç”¨ webpack çš„é…ç½®æ–‡ä»¶æ¨¡æ‹Ÿæ‰“åŒ…ï¼Œå¹¶å°†æ‰“åŒ…åç”Ÿæˆæ–‡ä»¶çš„æ–‡ä»¶æ ¹ç›®å½•å’Œ static å­—æ®µæŒ‡å®šçš„æ–‡ä»¶å¤¹åˆå¹¶åï¼Œä½œä¸º web æœåŠ¡å™¨çš„æ ¹ç›®å½•ï¼ˆ/ï¼‰ï¼Œå½“è®¿é—®è¯¥åœ°å€æ—¶ï¼Œé»˜è®¤è®¿é—®çš„å°±æ˜¯æ ¹ç›®å½•ä¸‹çš„ index.html æ–‡ä»¶ã€‚è€Œ devServer é…ç½®é¡¹æŒ‡å®šçš„ç›®å½•ä¸­çš„æ–‡ä»¶ä¹Ÿä¼šç›´æ¥æ”¾åœ¨æœ¬åœ°æœåŠ¡å™¨çš„æ ¹ç›®å½•ä¸‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="s2">&#34;http://www.baidu.com&#34;</span><span class="p">;</span> <span class="c1">// è¿™ä¸ªå°±æ˜¯outputä¸­publicPathé…ç½®é¡¹è®¾ç½®çš„å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">,</span> <span class="nx">promises</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">installedChunkData</span> <span class="o">=</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">promises</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">installedChunkData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">p</span> <span class="o">+</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">u</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">l</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="css-loader-é…ç½®">css-loader é…ç½®
</h2><p>css-loaderï¼šå¤„ç† CSS ä¸­çš„ <code>url</code> ä¸ <code>@import</code>ï¼Œå¹¶å°†å…¶è§†ä¸ºæ¨¡å—å¼•å…¥ï¼Œæ­¤å¤„æ˜¯é€šè¿‡ postcss æ¥è§£æå¤„ç†ã€‚<code>css-loader</code> çš„åŸç†å°±æ˜¯å€ŸåŠ© postcssï¼Œç”¨ <code>postcss-value-parser</code> è§£æ CSS ä¸º ASTï¼Œå¹¶å°† CSS ä¸­çš„ <code>url()</code> ä¸ <code>@import</code> è§£æä¸ºæ¨¡å—ã€‚</p>
<p>å°† CSS æ–‡ä»¶ä¸­çš„æ ·å¼ä»£ç è½¬æ¢æˆ JavaScript å¯¹è±¡ï¼Œå¹¶ä»¥ commonjs å†™æ³•å¯¼å‡ºï¼Œä»¥ä¾¿äºå…¶ä»– Loader æˆ–æ’ä»¶è¿›è¡Œå¤„ç†ã€‚</p>
<p>style-loaderï¼šä½¿ç”¨ DOM API åŠ è½½ CSS èµ„æºï¼Œä½¿å¾— CSS éœ€è¦åœ¨ JS èµ„æºåŠ è½½å®Œåé€šè¿‡æ‰§è¡Œ js åŠ¨æ€åˆ›å»º style æ ‡ç­¾ï¼Œå®¹æ˜“å‡ºç°é¡µé¢æŠ–åŠ¨ï¼Œæ€§èƒ½ä½ä¸”å¯¹äº SSR ä¸å‹å¥½ã€‚ç”±äºæ€§èƒ½éœ€è¦ï¼Œåœ¨çº¿ä¸Šé€šå¸¸éœ€è¦å•ç‹¬åŠ è½½ CSS èµ„æºï¼Œè¿™è¦æ±‚æ‰“åŒ…å™¨èƒ½å¤Ÿå°† CSS æ‰“åŒ…ï¼Œæ­¤æ—¶éœ€è¦å€ŸåŠ©äº <a class="link" href="https://github.com/webpack-contrib/mini-css-extract-plugin"  target="_blank" rel="noopener"
    >mini-css-extract-plugin(opens in a new tab)</a> å°† CSS å•ç‹¬æŠ½ç¦»å‡ºæ¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span><span class="sr">/\.css$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;style-loader&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span><span class="o">:</span><span class="s1">&#39;css-loader&#39;</span><span class="p">,</span>  <span class="c1">//ä¼šè¯»å–æºCSSæ–‡ä»¶ï¼Œå¹¶ä¸”è‡ªåŠ¨å¯ä»¥è¯†åˆ«é‡Œé¢importè¯­å¥å¹¶æŠŠå¯¹åº”CSSå†…å®¹åˆå¹¶è¿‡æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">options</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">url</span><span class="o">:</span> <span class="kr">boolean</span><span class="p">,</span>   <span class="c1">// æ¯”å¦‚èƒŒæ™¯å›¾ä¸­çš„urlèƒ½å¦è¢«è¯†åˆ«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="kr">import</span><span class="o">:</span><span class="kr">boolean</span><span class="p">,</span> <span class="c1">// æ˜¯å¦å…è®¸cssä¸­ä½¿ç”¨@import cssè¯­æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">modules</span><span class="o">:</span><span class="kr">boolean</span><span class="p">,</span>  <span class="c1">// æ˜¯å¦å¼€å¯cssæ¨¡å—åŒ–   import style from &#39;./index.css&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="nx">source</span><span class="o">-</span><span class="nx">map</span><span class="o">:</span><span class="kr">boolean</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">importLoaders</span><span class="o">:</span><span class="kr">boolean</span> <span class="o">|</span> <span class="nx">number</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">esModules</span><span class="o">:</span><span class="kr">boolean</span>  <span class="c1">// import style from &#39;./index.css&#39;   style.defalut.xxx  é»˜è®¤ä¸ºtrue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>importLoaders:boolean | number, // importloaders Allows to enables/disables or setups number of loaders applied before CSS loader for @import at-rules</p></blockquote>
<p>css-loader åœ¨ css æ–‡ä»¶ä¸­é»˜è®¤æ”¯æŒ <strong>~ ç¬¦å·</strong>è¡¨ç¤º node_modules æ–‡ä»¶è·¯å¾„ï¼Œä¸éœ€è¦ç”¨æˆ·å»é…ç½®ã€‚</p>
<ul>
<li>@æ˜¯ webpack è®¾ç½®çš„è·¯å¾„åˆ«åï¼Œåœ¨ webpack é…ç½®æ–‡ä»¶ä¸­è®¾ç½®ä»¥åï¼Œä¹Ÿå¯ä»¥åœ¨ css ä¸­ä½¿ç”¨</li>
<li>Starting with version 4.0.0, absolute paths are parsed based on the server root</li>
<li>To import assets from a node modules path (include resolve.modules) and for alias, prefix it with a ~</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">resolve</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">alias</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="err">&#34;@</span><span class="s1">&#39;:path.resolve(&#39;</span><span class="nx">src</span><span class="err">&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="nt">bg</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">width</span><span class="p">:</span><span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">height</span><span class="p">:</span><span class="mi">100</span><span class="kt">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">images/kf.jpg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="sx">@/images/kf.jpg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-image</span><span class="p">:;</span> <span class="err">url(~module/images/a.jpg)</span><span class="p">;</span>  <span class="err">//</span> <span class="err">å–node_modules/module/images/a.jpg</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸èƒ½åœ¨ js æ–‡ä»¶ä¸­ä¸é…ç½®å°±ä½¿ç”¨â€œ~â€ï¼Œæ¯”å¦‚ä¸èƒ½ï¼šimport img from &lsquo;~module/images/a.jpg&rsquo;</p>
<p>node-sass sass-loaderï¼›sassï¼šè€ç‰ˆåç¼€ï¼›scssï¼šæ–°ç‰ˆæœ¬åç¼€</p>
<p>node-sass è´Ÿè´£å°† scss æˆ–è€… sass ç¼–è¯‘ä¸º cssï¼ŒåŸå§‹çš„ sass åŒ…ä½¿ç”¨ ruby å†™çš„ï¼Œæœ¬åœ°å®‰è£…çš„è¯éœ€è¦ç¼–è¯‘ï¼Œnode-sass æ˜¯ node å†™çš„ï¼Œæ¯”è¾ƒå¥½å®‰è£…æ‰§è¡Œã€‚</p>
<h2 id="webpack-dev-middleware">webpack-dev-middleware
</h2><p><a class="link" href="https://www.npmjs.com/package/"  target="_blank" rel="noopener"
    >webpack-dev-middleware</a>å°±æ˜¯åœ¨ Express ä¸­æä¾› <code>webpack-dev-server</code> é™æ€æœåŠ¡èƒ½åŠ›çš„ä¸€ä¸ªä¸­é—´ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install webpack-dev-middleware --save-dev
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">express</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;express&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpackDevMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack-dev-middleware&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpackOptions</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./webpack.config&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">express</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">(</span><span class="nx">webpackOptions</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">webpackDevMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">,</span> <span class="p">{}));</span>
</span></span><span class="line"><span class="cl"><span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="mi">3000</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>webpack-dev-server çš„å¥½å¤„æ˜¯ç›¸å¯¹ç®€å•ï¼Œç›´æ¥å®‰è£…ä¾èµ–åæ‰§è¡Œå‘½ä»¤å³å¯</li>
<li>è€Œä½¿ç”¨<code>webpack-dev-middleware</code>çš„å¥½å¤„æ˜¯å¯ä»¥åœ¨æ—¢æœ‰çš„ Express ä»£ç åŸºç¡€ä¸Šå¿«é€Ÿæ·»åŠ  webpack-dev-server çš„åŠŸèƒ½ï¼ŒåŒæ—¶åˆ©ç”¨ Express æ¥æ ¹æ®éœ€è¦æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œå¦‚ mock æœåŠ¡ã€ä»£ç† API è¯·æ±‚ç­‰</li>
</ul>
<h2 id="css-å…¼å®¹æ€§">CSS å…¼å®¹æ€§
</h2><p>PostCSS æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å…·ï¼Œå¯ä»¥è„±ç¦» webpack å•ç‹¬ä½¿ç”¨ï¼ˆpostcss-cli åœ¨å‘½ä»¤è¡Œå•ç‹¬ä½¿ç”¨ postcss æ—¶éœ€è¦å®‰è£…è¯¥æ’ä»¶ï¼‰ã€‚å¯ä»¥é€šè¿‡ JavaScript æ¥è½¬æ¢ css æ ·å¼ï¼Œcss çš„è½¬æ¢å’Œé€‚é…ï¼Œè‡ªåŠ¨æ·»åŠ æµè§ˆå™¨å‚å•†å‰ç¼€ï¼Œcss æ ·å¼é‡ç½®ï¼Œcss å•ä½è½¬æ¢ã€‚</p>
<ul>
<li><code>PostCSS</code> å°† CSS è§£ææˆ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰ï¼Œç„¶åä½¿ç”¨æ’ä»¶å¯¹ AST è¿›è¡Œå¤„ç†ï¼Œæœ€åå°†å¤„ç†åçš„ AST è½¬æ¢ä¸º CSS ä»£ç </li>
<li><a class="link" href="https://github.com/postcss/autoprefixer"  target="_blank" rel="noopener"
    >autoprefixer</a> æ˜¯ PostCSS çš„ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒå¯ä»¥æ ¹æ®æŒ‡å®šçš„æµè§ˆå™¨ç‰ˆæœ¬è‡ªåŠ¨æ·»åŠ æ‰€éœ€çš„æµè§ˆå™¨å‰ç¼€ã€‚é€šè¿‡ä½¿ç”¨ autoprefixerï¼Œæˆ‘ä»¬å¯ä»¥é¿å…æ‰‹åŠ¨æ·»åŠ æµè§ˆå™¨å‰ç¼€çš„éº»çƒ¦ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç¡®ä¿é¡¹ç›®åœ¨å„ä¸ªæµè§ˆå™¨ä¸­æ­£ç¡®åœ°æ˜¾ç¤º</li>
<li><a class="link" href="https://github.com/csstools/postcss-preset-env"  target="_blank" rel="noopener"
    >postcss-preset-env</a> æ˜¯ PostCSS çš„ä¸€ä¸ªæ’ä»¶é›†åˆï¼Œå®ƒå¯ä»¥ä½¿ç”¨æœªæ¥çš„ CSS è¯­æ³•ï¼Œè€Œä¸éœ€è¦ç­‰å¾…æµè§ˆå™¨æ”¯æŒã€‚postcss-preset-env åŒ…å«äº†ä¸€äº›å¸¸ç”¨çš„ CSS é¢„å¤„ç†å™¨çš„è¯­æ³•ï¼Œå¦‚ Sass å’Œ Lessï¼Œä»¥åŠä¸€äº›æœªæ¥çš„ CSS è¯­æ³•ï¼Œå¦‚ CSS Gridã€CSS Variables ç­‰</li>
<li><a class="link" href="https://github.com/shellscape/postcss-less"  target="_blank" rel="noopener"
    >postcss-less</a> æ˜¯ PostCSS çš„ä¸€ä¸ªæ’ä»¶ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ Less é¢„å¤„ç†å™¨çš„è¯­æ³•ï¼Œä»è€Œå¯ä»¥æ›´æ–¹ä¾¿åœ°ç¼–å†™ CSS ä»£ç ã€‚é€šè¿‡ä½¿ç”¨ postcss-lessï¼Œå¯ä»¥åœ¨ Webpack æ„å»ºé¡¹ç›®æ—¶è‡ªåŠ¨å°† Less ä»£ç è½¬æ¢ä¸ºæ ‡å‡†çš„ CSS ä»£ç </li>
</ul>
<p>è¿˜éœ€è¦ç»“åˆ Browserlist çš„ç‰ˆæœ¬å…¼å®¹é…ç½®æ–‡ä»¶æ¥ä½¿ç”¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i postcss-loader postcss-preset-env -D
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><a class="link" href="https://github.com/webpack-contrib/postcss-loader"  target="_blank" rel="noopener"
    >postcss-loader</a>å¯ä»¥ä½¿ç”¨ PostCSS å¤„ç† CSS</li>
<li><a class="link" href="https://github.com/csstools/postcss-preset-env"  target="_blank" rel="noopener"
    >postcss-preset-env</a>æŠŠç°ä»£çš„ CSS è½¬æ¢æˆå¤§å¤šæ•°æµè§ˆå™¨èƒ½ç†è§£çš„æ’ä»¶é›†åˆ</li>
<li>PostCSS Preset Env å·²ç»åŒ…å«äº†<code>autoprefixer</code>å’Œ<code>browserlists</code>é€‰é¡¹</li>
</ul>
<p>postcss é…ç½®æ–‡ä»¶ï¼š</p>
<p>postcss.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">postcssPresetEnv</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;postcss-preset-env&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="o">=</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span><span class="p">[</span><span class="nx">postcssPresetEnv</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">browsers</span><span class="o">:</span> <span class="s1">&#39;last 5 version&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">})]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// require(&#34;autoperfixer&#34;)  or
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// require(&#34;postcss-preset-env&#34;) or
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s2">&#34;postcss-preset-env&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">test</span><span class="o">:</span><span class="sr">/\.css/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span><span class="nx">loader</span><span class="o">:</span><span class="s1">&#39;style-loader&#39;</span><span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s1">&#39;css-loader&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">loader</span><span class="o">:</span><span class="s1">&#39;postcss-loader&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">options</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">postcssOptions</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="c1">// require(&#34;autoprefixer&#34;),//è¿™ä¸ªæ’ä»¶å¯ä»¥ä¸å†å†™äº†ï¼Œå› ä¸ºpostcss-preset-envä¸­å†…ç½®ä½¿ç”¨äº†autoprefixer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;postcss-preset-env&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//or
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="c1">// require(&#39;pluginName&#39;)(ä¼ å‚)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="p">]</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// plugins:[&#34;postcss-preset-env&#34;]   è¿™æ˜¯å¦ä¸€ç§å†™æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>    <span class="c1">//postcss-loaderå†…éƒ¨ä¼šè°ƒç”¨optionsé…ç½®ä¸­æŒ‡å®šçš„postcssæ’ä»¶å¯¹æ ·å¼æ–‡ä»¶åŠ å…¼å®¹æ€§å‰ç¼€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="èµ„æºæ¨¡å—">èµ„æºæ¨¡å—
</h2><ul>
<li><a class="link" href="https://webpack.js.org/configuration/module/#rule"  target="_blank" rel="noopener"
    >Rule.type</a></li>
<li><a class="link" href="https://webpack.js.org/guides/asset-modules/"  target="_blank" rel="noopener"
    >asset-modules</a></li>
</ul>
<p>type çš„å››ç§ç±»å‹ï¼š</p>
<ol>
<li>asset/resource ç”Ÿæˆå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URLï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>asset/resource</code>ç±»å‹çš„åŠ è½½å™¨ä¼šç”Ÿæˆå¸¦æœ‰<code>[hash][ext][query]</code>åç¼€çš„æ–‡ä»¶åã€‚å¦‚æœéœ€è¦è‡ªå®šä¹‰æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡è®¾ç½®<code>output.assetModuleFilename</code>å±æ€§è¿›è¡Œæ§åˆ¶</li>
<li>asset/source å¯¼å‡ºèµ„äº§çš„æºä»£ç </li>
<li>asset/inline å¯¼å‡ºèµ„äº§çš„æ•°æ® URI</li>
<li>asset ä¼šè‡ªåŠ¨é€‰æ‹©å¯¼å‡ºæ•°æ® URI è¿˜æ˜¯ç”Ÿæˆå•ç‹¬çš„æ–‡ä»¶,å¯ä»¥è®¾ç½®æ–‡ä»¶å¤§å°é™åˆ¶æ¥å®ç°</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">output</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span><span class="s1">&#39;js/bundle.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="s2">&#34;./build&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">assetModuleFilename</span><span class="o">:</span><span class="s2">&#34;img/[name].[hash:6][ext]&#34;</span>     <span class="c1">//è¿™ä¼šæ˜¯ä¸‹é¢å›¾ç‰‡èµ„æºæ‰“åŒ…åå­˜æ”¾äº†ç›®å½•,æ‰€æœ‰é€šè¿‡ assetModuleæ‰“åŒ…çš„æ–‡ä»¶éƒ½æ”¾åœ¨è®¾ç½®çš„å€¼çš„ç›®å½•ä¸‹ï¼Œå½“ç„¶åé¢å¯ä»¥é’ˆå¯¹æ¯ä¸ªloaderè¿›è¡Œä¸åŒçš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span><span class="sr">/\.(jpg|png|svg|gif|jpeg)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">   	<span class="nx">type</span><span class="o">:</span><span class="s2">&#34;asset/resource&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p>èµ„æºæ¨¡å—æ˜¯ä¸€ç§æ¨¡å—ç±»å‹ï¼Œå®ƒå…è®¸ä½¿ç”¨èµ„æºæ–‡ä»¶ï¼ˆå­—ä½“ï¼Œå›¾æ ‡ç­‰ï¼‰è€Œæ— éœ€é…ç½®é¢å¤– loader</p>
</li>
<li>
<p><code>raw-loader</code> =&gt; <code>asset/source</code> å¯¼å‡ºèµ„æºçš„æºä»£ç </p>
</li>
<li>
<p><code>file-loader</code> =&gt; <code>asset/resource</code> å‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶å¹¶å¯¼å‡º URL</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">output</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span><span class="s1">&#39;bundle.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="s2">&#34;./build&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span><span class="sr">/\.(jpg|png|svg|gif|jpeg)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span><span class="s2">&#34;asset/resource&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">generator</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span><span class="s2">&#34;img/[name].[hash:6][ext]&#34;</span>   <span class="c1">//imgä¼šæ˜¯å›¾ç‰‡èµ„æºæ‰“åŒ…åå­˜æ”¾äº†ç›®å½•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><code>url-loader</code> =&gt; <code>asset/inline</code> å¯¼å‡ºä¸€ä¸ªèµ„æºçš„ base64</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">output</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span><span class="s1">&#39;bundle.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="o">:</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="s2">&#34;./build&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">test</span><span class="o">:</span><span class="sr">/\.(jpg|png|svg|gif|jpeg)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">type</span><span class="o">:</span><span class="s2">&#34;asset/inline&#34;</span>  <span class="c1">// ä¸è¦é…ç½®æ–‡ä»¶æ‰“åŒ…è·¯å¾„ï¼Œå› ä¸ºæ²¡æœ‰è¾“å‡ºæ–‡ä»¶ï¼Œéƒ½åœ¨jsä¸­ä»¥base64è¡¨ç¤ºäº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>asset åœ¨å¯¼å‡ºä¸€ä¸ª data URI å’Œå‘é€ä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶ä¹‹é—´è‡ªåŠ¨é€‰æ‹©ã€‚ä¹‹å‰é€šè¿‡ä½¿ç”¨ <code>url-loader</code>ï¼Œå¹¶ä¸”é…ç½®èµ„æºä½“ç§¯é™åˆ¶å®ç°</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">output</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span><span class="s1">&#39;bundle.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="o">:</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="s2">&#34;./build&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">test</span><span class="o">:</span><span class="sr">/\.(jpg|png|svg|gif|jpeg)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">type</span><span class="o">:</span><span class="s2">&#34;asset&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">generator</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span><span class="s2">&#34;img/[name].[hash:6][ext]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parser</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">dataUrlCondition</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">maxSize</span><span class="o">:</span> <span class="mi">10</span> <span class="o">*</span><span class="mi">1024</span>   <span class="c1">// å°äºè¯¥ä½“ç§¯ï¼ˆ10kbï¼‰åˆ™æ‰“åŒ…ä¸ºbase64
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span><span class="sr">/\.(ttf|eot|woff|woff2)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span><span class="s1">&#39;asset/resource&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">generator</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">filename</span><span class="o">:</span><span class="s2">&#34;font/[name].[ext]&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="query">query
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">assetModuleFilename:&#39;assets/[hash][ext][query]&#39;
</span></span></code></pre></td></tr></table>
</div>
</div><p>query è¡¨ç¤ºæŸ¥è¯¢å‚æ•°ï¼Œæ¯”å¦‚åœ¨æºç ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">png</span> <span class="nx">from</span> <span class="s2">&#34;./assets/images/logo.png?time=2022-8-21&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é‚£ä¹ˆæ‰“åŒ…åç”Ÿæˆçš„ï¼Œåœ¨å¼•å…¥è¿™ä¸ªæ–‡ä»¶çš„æ—¶å€™ä¼šåœ¨ url åœ°å€çš„ query ä¸­åŠ ä¸Šä¸Šé¢è®¾ç½®çš„å€¼ã€‚</p>
<p>é¡¹ç›®ä¸­ä½¿ç”¨å›¾ç‰‡ï¼š</p>
<ul>
<li>
<p>css ä¸­ background-image</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-css" data-lang="css"><span class="line"><span class="cl"><span class="p">#</span><span class="nn">box</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">background-image</span><span class="p">:</span> <span class="nb">url</span><span class="p">(</span><span class="s2">&#34;../asset/images/xx/xxx.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>img æ ‡ç­¾çš„ src å±æ€§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">imgEl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">imgEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./src/asset/images/xx/xx.jpg&#34;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span> <span class="c1">//  file-loader 5ç‰ˆæœ¬ä¸­çš„ç‰¹ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">imgSrc</span> <span class="nx">from</span> <span class="s2">&#34;./src/asset/images/xx/xx.jpg&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">imgEl</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">imgEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">imgSrc</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<p>æœ‰æ—¶ç»è¿‡ webpack æ‰“åŒ…åçš„æ–‡ä»¶å¸Œæœ›ä¿ç•™æºæ–‡ä»¶çš„åå­—å†å¤–åŠ ä¸€äº›ç‰¹åˆ«çš„æ ‡è¯†ç¬¦è¿›è¡Œè¡¨ç¤ºã€‚è¿™æ—¶å€™å¯ä»¥å€ŸåŠ© webpack ä¸­å ä½ç¬¦æ¥å®ç°ã€‚å¸¸ç”¨çš„å ä½ç¬¦ï¼š</p>
<ul>
<li>
<p>[ext] æ–‡ä»¶æ‰©å±•å</p>
</li>
<li>
<p>[name] åŸæ–‡ä»¶å</p>
</li>
<li>
<p>[hash] æœ¬åœ°æ‰“åŒ…çš„ hash å€¼</p>
</li>
<li>
<p>[contentHash] è¯¥æ–‡ä»¶å†…å®¹å¯¹åº”çš„ hash å€¼</p>
</li>
<li>
<p>[hash:length] æŒ‡å®šé•¿åº¦çš„ hash å€¼</p>
</li>
<li>
<p>[path] æ–‡ä»¶ç›¸å¯¹äº webpack é…ç½®æ–‡ä»¶çš„è·¯å¾„</p>
</li>
</ul>
<p>ç°åœ¨æ— æ³•ç›´æ¥åœ¨ webpack5 ä¸­ä½¿ç”¨ file-loaderï¼Œurl-loader æ¥æ‰“åŒ… CSS æ–‡ä»¶ä¸­çš„å›¾ç‰‡äº†ï¼Œè€Œéœ€è¦æ”¹åŠ¨ï¼š</p>
<p>å…·ä½“å‚è€ƒæ–‡ç« https://blog.csdn.net/w184167377/article/details/118930758</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(jpe?g|png|svg|gif)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;url-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;[name]-[hash:6].[ext]&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">esModule</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">limit</span><span class="o">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">1024</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;javascript/auto&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å›¾ç‰‡å‹ç¼©">å›¾ç‰‡å‹ç¼©
</h3><ul>
<li>image-webpack-loader å¯ä»¥åœ¨ Webpack æ‰“åŒ…è¿‡ç¨‹ä¸­å¯¹å›¾ç‰‡è¿›è¡Œä¼˜åŒ–å’Œå‹ç¼©ï¼Œä»è€Œå‡å°å›¾ç‰‡æ–‡ä»¶çš„å¤§å°ï¼Œæé«˜é¡µé¢åŠ è½½é€Ÿåº¦å’Œå“åº”é€Ÿåº¦</li>
<li>è¿™ä¸ªåº“ç›´æ¥å®‰è£…çš„è¯ï¼Œæ¯”è¾ƒéš¾å®‰è£…æˆåŠŸï¼Œå› ä¸ºé‡Œé¢ä¾èµ–äº†ä¸€äº›äºŒè¿›åˆ¶æ–‡ä»¶éœ€è¦ç¼–è¯‘ï¼Œç½‘ç»œç¯å¢ƒä¸å¥½çš„è¯ï¼Œå°±éš¾å®‰è£…ä¸Š</li>
<li>å®ƒçš„åº•å±‚ä¾èµ–äº imagemin å’Œä¸€ç³»åˆ—çš„å›¾åƒä¼˜åŒ–å·¥å…·ï¼ŒåŒ…æ‹¬ mozjpegã€optipngã€pngquantã€svgoã€gifsicle å’Œ webp ç­‰ï¼Œå¯ä»¥è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„ä¼˜åŒ–å·¥å…·å¯¹å›¾ç‰‡è¿›è¡Œå¤„ç†
<ul>
<li>optipngï¼šç”¨äºå‹ç¼© PNG å›¾ç‰‡çš„é…ç½®é¡¹</li>
<li>pngquantï¼šåŒæ ·ç”¨äºå‹ç¼© PNG å›¾ç‰‡çš„é…ç½®é¡¹ï¼Œå¯ä»¥è®¾ç½®å›¾ç‰‡è´¨é‡å’Œå‹ç¼©é€Ÿåº¦</li>
<li>svgoï¼šç”¨äºå‹ç¼© SVG å›¾ç‰‡çš„é…ç½®é¡¹ï¼ŒåŒ…å«å¤šä¸ªæ’ä»¶</li>
<li>gifsicleï¼šç”¨äºå‹ç¼© Gif å›¾ç‰‡çš„é…ç½®é¡¹</li>
<li>webpï¼šç”¨äºå°† JPG/PNG å›¾ç‰‡å‹ç¼©å¹¶è½¬æ¢ä¸º WebP å›¾ç‰‡æ ¼å¼çš„é…ç½®é¡¹</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">   {
</span></span><span class="line"><span class="cl">        test: /\.(png)$/,
</span></span><span class="line"><span class="cl">        type: &#39;asset/resource&#39;
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.(jpg)$/,
</span></span><span class="line"><span class="cl">        type: &#34;asset/inline&#34;
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.(bmp)$/,
</span></span><span class="line"><span class="cl">        type: &#34;asset&#34;,
</span></span><span class="line"><span class="cl">        parser: {
</span></span><span class="line"><span class="cl">          dataUrlCondition: {
</span></span><span class="line"><span class="cl">            maxSize: 1024
</span></span><span class="line"><span class="cl">          }
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.svg$/i,
</span></span><span class="line"><span class="cl">       type: &#34;asset/source&#34;
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl"><span class="gi">+     {
</span></span></span><span class="line"><span class="cl"><span class="gi">+       // åŒ¹é…æ–‡ä»¶çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œè¿™é‡Œè¡¨ç¤ºåŒ¹é…JPGã€PNGã€GIFå’ŒSVGæ ¼å¼çš„å›¾ç‰‡æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="gi">+       test: /\.(jpe?g|png|gif|svg)$/i,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>	     type:&#39;xxxx&#39;  // ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œè®¾ç½®
</span></span><span class="line"><span class="cl"><span class="gi">+       use: [
</span></span></span><span class="line"><span class="cl"><span class="gi">+         {
</span></span></span><span class="line"><span class="cl"><span class="gi">+            // ä½¿ç”¨image-webpack-loaderå¯¹å›¾ç‰‡è¿›è¡Œä¼˜åŒ–å’Œå‹ç¼©
</span></span></span><span class="line"><span class="cl"><span class="gi">+           loader: &#39;image-webpack-loader&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+           options: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+             // æ˜¯å¦ç¦ç”¨å›¾ç‰‡ä¼˜åŒ–å’Œå‹ç¼©
</span></span></span><span class="line"><span class="cl"><span class="gi">+             disable: process.env.NODE_ENV === &#39;development&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+             mozjpeg: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+               progressive: true, // æ˜¯å¦å¼€å¯æ¸è¿›å¼JPEGï¼Œå¯ä»¥æœ‰æ•ˆæå‡JPEGå›¾ç‰‡åŠ è½½é€Ÿåº¦
</span></span></span><span class="line"><span class="cl"><span class="gi">+               quality: 65 // å‹ç¼©JPEGå›¾ç‰‡çš„è´¨é‡ï¼Œå–å€¼èŒƒå›´ä¸º0åˆ°100ï¼Œå€¼è¶Šå¤§è´¨é‡è¶Šå¥½ä½†æ–‡ä»¶è¶Šå¤§
</span></span></span><span class="line"><span class="cl"><span class="gi">+             },
</span></span></span><span class="line"><span class="cl"><span class="gi">+             optipng: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+               enabled: true // æ˜¯å¦å¼€å¯PNGå›¾ç‰‡çš„ä¼˜åŒ–ï¼Œå¯ä»¥æœ‰æ•ˆæå‡PNGå›¾ç‰‡åŠ è½½é€Ÿåº¦
</span></span></span><span class="line"><span class="cl"><span class="gi">+             },
</span></span></span><span class="line"><span class="cl"><span class="gi">+             pngquant: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+               // å‹ç¼©PNGå›¾ç‰‡çš„è´¨é‡èŒƒå›´ï¼Œå–å€¼èŒƒå›´ä¸º0åˆ°1ï¼Œå€¼è¶Šå¤§è´¨é‡è¶Šå¥½ä½†æ–‡ä»¶è¶Šå¤§
</span></span></span><span class="line"><span class="cl"><span class="gi">+               // ç¬¬ä¸€ä¸ªæ•°å­—è¡¨ç¤ºå‹ç¼©è´¨é‡çš„ä¸‹é™ï¼Œç¬¬äºŒä¸ªæ•°å­—è¡¨ç¤ºå‹ç¼©è´¨é‡çš„ä¸Šé™
</span></span></span><span class="line"><span class="cl"><span class="gi">+               quality: [0.65, 0.9],
</span></span></span><span class="line"><span class="cl"><span class="gi">+               speed: 4 // å‹ç¼©PNGå›¾ç‰‡çš„é€Ÿåº¦ï¼Œå–å€¼èŒƒå›´ä¸º1åˆ°10ï¼Œå€¼è¶Šå¤§é€Ÿåº¦è¶Šå¿«ä½†è´¨é‡è¶Šä½
</span></span></span><span class="line"><span class="cl"><span class="gi">+             },
</span></span></span><span class="line"><span class="cl"><span class="gi">+             svgo: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+               plugins: [ // å‹ç¼©SVGå›¾ç‰‡çš„æ’ä»¶åˆ—è¡¨ï¼Œè¿™é‡ŒåŒ…å«removeViewBoxå’ŒcleanupIDsä¸¤ä¸ªæ’ä»¶
</span></span></span><span class="line"><span class="cl"><span class="gi">+                 { //ç”¨äºåˆ é™¤SVGå›¾ç‰‡ä¸­çš„viewBoxå±æ€§
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   //viewBoxå±æ€§æ˜¯ç”¨æ¥æŒ‡å®šSVGè§†å£èŒƒå›´çš„ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªçŸ©å½¢æ¡†çš„åæ ‡å’Œå®½é«˜
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   removeViewBox: false
</span></span></span><span class="line"><span class="cl"><span class="gi">+                 },
</span></span></span><span class="line"><span class="cl"><span class="gi">+                 { //ç”¨äºåˆ é™¤SVGå›¾ç‰‡ä¸­çš„æ— ç”¨IDå±æ€§
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   cleanupIDs: true
</span></span></span><span class="line"><span class="cl"><span class="gi">+                 }
</span></span></span><span class="line"><span class="cl"><span class="gi">+               ]
</span></span></span><span class="line"><span class="cl"><span class="gi">+             },
</span></span></span><span class="line"><span class="cl"><span class="gi">+             gifsicle: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+               interlaced: true // æ˜¯å¦å¼€å¯GIFå›¾ç‰‡çš„éš”è¡Œæ‰«æ,å¯ä»¥æœ‰æ•ˆæå‡GIFå›¾ç‰‡åŠ è½½é€Ÿåº¦
</span></span></span><span class="line"><span class="cl"><span class="gi">+             }
</span></span></span><span class="line"><span class="cl"><span class="gi">+           }
</span></span></span><span class="line"><span class="cl"><span class="gi">+         }
</span></span></span><span class="line"><span class="cl"><span class="gi">+       ]
</span></span></span><span class="line"><span class="cl"><span class="gi">+     }
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å›¾ç‰‡å“åº”å¼">å›¾ç‰‡å“åº”å¼
</h3><ul>
<li>å“åº”å¼å›¾ç‰‡æ˜¯æŒ‡èƒ½å¤Ÿæ ¹æ®è®¾å¤‡å±å¹•å¤§å°å’Œåˆ†è¾¨ç‡ç­‰å› ç´ åŠ¨æ€è°ƒæ•´æ˜¾ç¤ºå¤§å°å’Œæ¸…æ™°åº¦çš„å›¾ç‰‡</li>
<li>åœ¨ä¸åŒè®¾å¤‡ä¸Šæ˜¾ç¤ºåŒä¸€å¼ å›¾ç‰‡æ—¶ï¼Œå“åº”å¼å›¾ç‰‡å¯ä»¥è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜çš„å›¾ç‰‡ç‰ˆæœ¬ï¼Œä»è€Œä¿è¯å›¾ç‰‡æ˜¾ç¤ºæ•ˆæœçš„ä¸€è‡´æ€§å’Œä¼˜åŒ–ç½‘ç«™æ€§èƒ½</li>
<li>responsive-loader æ˜¯ä¸€ä¸ª webpack çš„ loaderï¼Œç”¨äºå®ç°å“åº”å¼å›¾ç‰‡çš„åŠŸèƒ½ã€‚å®ƒå¯ä»¥æ ¹æ®è®¾å¤‡å±å¹•å¤§å°å’Œåƒç´ å¯†åº¦ç­‰å› ç´ è‡ªåŠ¨è°ƒæ•´å›¾ç‰‡å¤§å°å’Œæ¸…æ™°åº¦ï¼Œä»è€Œæé«˜ç½‘ç«™çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½
<ul>
<li>sizesï¼šç”¨äºæŒ‡å®šä¸åŒå°ºå¯¸çš„å›¾ç‰‡å¤§å°ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æŒ‡å®šäº† 4 ä¸ªä¸åŒçš„å›¾ç‰‡å¤§å°ï¼Œåˆ†åˆ«æ˜¯ 300pxã€600pxã€1200px å’Œ 2000pxã€‚å½“åŠ è½½å›¾ç‰‡æ—¶ï¼Œresponsive-loader ä¼šæ ¹æ®è®¾å¤‡çš„å±å¹•å¤§å°å’Œåƒç´ å¯†åº¦ç­‰å› ç´ è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å›¾ç‰‡å¤§å°</li>
<li>adapterï¼šç”¨äºæŒ‡å®šå›¾ç‰‡å¤„ç†åº“ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† sharp åº“ï¼Œå®ƒæ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å›¾ç‰‡å¤„ç†åº“ï¼Œå¯ä»¥ç”¨æ¥è‡ªåŠ¨è°ƒæ•´å›¾ç‰‡å¤§å°å’Œæ¸…æ™°åº¦</li>
</ul>
</li>
<li>srcset å’Œ sizes æ˜¯ HTML ä¸­ img æ ‡ç­¾çš„ä¸¤ä¸ªå±æ€§ï¼Œç”¨äºå®ç°å“åº”å¼å›¾ç‰‡çš„åŠŸèƒ½ï¼Œå¯ä»¥æ ¹æ®è®¾å¤‡å±å¹•å¤§å°å’Œåƒç´ å¯†åº¦ç­‰å› ç´ è‡ªåŠ¨é€‰æ‹©æœ€åˆé€‚çš„å›¾ç‰‡ç‰ˆæœ¬å’Œæ˜¾ç¤ºå¤§å°ï¼Œä»è€Œæé«˜ç½‘ç«™çš„ç”¨æˆ·ä½“éªŒå’Œæ€§èƒ½</li>
<li>srcset å±æ€§ç”¨äºæŒ‡å®šä¸åŒå°ºå¯¸å’Œæ¸…æ™°åº¦çš„å›¾ç‰‡ç‰ˆæœ¬ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„å›¾ç‰‡åˆ—è¡¨ï¼Œæ¯ä¸ªå›¾ç‰‡å…ƒç´ åŒ…å«äº†å›¾ç‰‡ URL å’Œå¯¹åº”çš„å®½åº¦æˆ–åƒç´ å¯†åº¦ç­‰ä¿¡æ¯</li>
<li>sizes å±æ€§ç”¨äºæŒ‡å®šå›¾ç‰‡åœ¨ä¸åŒå±å¹•å°ºå¯¸ä¸‹çš„æ˜¾ç¤ºå¤§å°ï¼Œå®ƒçš„å€¼æ˜¯ä¸€ä¸ªä»¥é€—å·åˆ†éš”çš„å°ºå¯¸åˆ—è¡¨ï¼Œæ¯ä¸ªå°ºå¯¸å…ƒç´ åŒ…å«äº†åª’ä½“æŸ¥è¯¢å’Œå¯¹åº”çš„å°ºå¯¸ä¿¡æ¯</li>
<li>æµè§ˆå™¨åŠ è½½è¿™ä¸ª img æ ‡ç­¾æ—¶ï¼Œå®ƒä¼šæ ¹æ®è®¾å¤‡çš„å±å¹•å¤§å°å’Œåƒç´ å¯†åº¦ç­‰å› ç´ ï¼Œé€‰æ‹©æœ€åˆé€‚çš„å›¾ç‰‡ç‰ˆæœ¬ï¼Œå¹¶æ ¹æ® sizes å±æ€§æŒ‡å®šçš„å°ºå¯¸å¤§å°è¿›è¡Œæ˜¾ç¤º</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm i responsive-loader sharp --save
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl"><span class="gi">+     {
</span></span></span><span class="line"><span class="cl"><span class="gi">+                test: /\.(jpe?g|png)$/i,
</span></span></span><span class="line"><span class="cl"><span class="gi">+               //oneOfæ˜¯ä¸€ä¸ªä¼˜åŒ–é€‰é¡¹ï¼Œç”¨äºæé«˜æ‰“åŒ…çš„é€Ÿåº¦
</span></span></span><span class="line"><span class="cl"><span class="gi">+               oneOf:[
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   {
</span></span></span><span class="line"><span class="cl"><span class="gi">+                       //resourceQueryæ˜¯ä¸€ä¸ªç”¨äºåŒ¹é…è¯·æ±‚èµ„æºçš„URLä¸­æŸ¥è¯¢å­—ç¬¦ä¸­
</span></span></span><span class="line"><span class="cl"><span class="gi">+                       resourceQuery:/sizes/,
</span></span></span><span class="line"><span class="cl"><span class="gi">+                       use:[
</span></span></span><span class="line"><span class="cl"><span class="gi">+                           {
</span></span></span><span class="line"><span class="cl"><span class="gi">+                            loader:&#39;responsive-loader&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+                            options:{
</span></span></span><span class="line"><span class="cl"><span class="gi">+                               // sizes:[300,600,1024],
</span></span></span><span class="line"><span class="cl"><span class="gi">+                               adapter:require(&#39;responsive-loader/sharp&#39;)
</span></span></span><span class="line"><span class="cl"><span class="gi">+                            }
</span></span></span><span class="line"><span class="cl"><span class="gi">+                           }
</span></span></span><span class="line"><span class="cl"><span class="gi">+                        ]
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   },
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   {
</span></span></span><span class="line"><span class="cl"><span class="gi">+                       type: &#39;asset/resource&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   }
</span></span></span><span class="line"><span class="cl"><span class="gi">+               ]
</span></span></span><span class="line"><span class="cl"><span class="gi">+           }
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>æºç ä¸­ä½¿ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">responsiveImg</span> <span class="nx">from</span> <span class="s2">&#34;./images/bg.png?sizes[]=300,sizes[]=600,sizes[]=1024&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">responsiveImg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">image</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">image</span><span class="p">.</span><span class="nx">srcset</span> <span class="o">=</span> <span class="nx">responsiveImg</span><span class="p">.</span><span class="nx">srcSet</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">image</span><span class="p">.</span><span class="nx">sizes</span> <span class="o">=</span> <span class="sb">`(min-width: 1024) 1024px,100vw`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">image</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“å°çš„ responsiveImg å˜é‡çš„å€¼</p>
<p><img src="/blogs/post/webpack/images/image-20241226180902970.png"
	width="1333"
	height="193"
	srcset="/blogs/post/webpack/images/image-20241226180902970_hu_17eabaf660ef9f7a.png 480w, /blogs/post/webpack/images/image-20241226180902970_hu_17a64dc610ae7eb2.png 1024w"
	loading="lazy"
	
		alt="image-20241226180902970"
	
	
		class="gallery-image" 
		data-flex-grow="690"
		data-flex-basis="1657px"
	
></p>
<h2 id="js-å…¼å®¹æ€§å¤„ç†">JS å…¼å®¹æ€§å¤„ç†
</h2><ul>
<li>Babel é»˜è®¤åªè½¬æ¢æ–°çš„ ES è¯­æ³•ï¼Œæ¯”å¦‚ç®­å¤´å‡½æ•°</li>
</ul>
<p>è®© babel èƒ½è½¬æ¢å…¶ä»–æ–°è¯­æ³•éœ€è¦å€ŸåŠ©åŒ…æˆ–è€… babel æ’ä»¶</p>
<ul>
<li><a class="link" href="https://www.npmjs.com/package/babel-loader"  target="_blank" rel="noopener"
    >babel-loader</a>ä½¿ç”¨ Babel å’Œ webpack è½¬è¯‘ JavaScript æ–‡ä»¶ï¼Œç”¨æ¥è¯»å–åŠ è½½é¡¹ç›®æºç ä¸­çš„ js æ–‡ä»¶</li>
<li><a class="link" href="https://www.npmjs.com/package/@babel/core"  target="_blank" rel="noopener"
    >@babel/core</a>Babel ç¼–è¯‘çš„æ ¸å¿ƒåŒ…,babel-loader è¯»å–çš„æºç ä¼ ç»™@babel/coreï¼Œç”±@babel/core å°†æºç è½¬ä¸º AST è¯­æ³•æ ‘ï¼Œä½†æ˜¯å®ƒä¸çŸ¥é“æ€ä¹ˆè½¬ä¸ºä»£ç ï¼Œå®ƒéœ€è¦å°†ä¸åŒçš„ ast éƒ¨åˆ†è½¬å‘ç»™ä¸åŒæ’ä»¶æˆ–è€…é¢„è®¾å–å¤„ç†</li>
<li><a class="link" href="https://www.babeljs.cn/docs/babel-preset-env"  target="_blank" rel="noopener"
    >@babel/preset-env</a> æ˜¯ Babel çš„ä¸€ä¸ªé¢„è®¾ï¼Œç”¨äºè‡ªåŠ¨æ£€æµ‹ç›®æ ‡ç¯å¢ƒå¹¶æ ¹æ®éœ€è¦è½¬æ¢ JavaScript ä»£ç </li>
<li><a class="link" href="https://www.npmjs.com/package/@babel/preset-react"  target="_blank" rel="noopener"
    >@babel/preset-react</a> React æ’ä»¶çš„ Babel é¢„è®¾</li>
<li><code>@babel/preset-typescript</code> æ˜¯ Babel çš„ä¸€ä¸ªè§„åˆ™é›†ï¼Œç”¨äºå°† TypeScript ä»£ç è½¬è¯‘ä¸º JavaScript ä»£ç </li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-plugin-proposal-decorators"  target="_blank" rel="noopener"
    >@babel/plugin-proposal-decorators</a> æŠŠç±»å’Œå¯¹è±¡è£…é¥°å™¨ç¼–è¯‘æˆ ES5</li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-plugin-proposal-class-properties"  target="_blank" rel="noopener"
    >@babel/plugin-proposal-class-properties</a> è½¬æ¢é™æ€ç±»å±æ€§ä»¥åŠä½¿ç”¨å±æ€§åˆå§‹å€¼åŒ–è¯­æ³•å£°æ˜çš„å±æ€§</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i babel-loader @babel/core @babel/preset-env @babel/preset-react  -D
</span></span><span class="line"><span class="cl">npm i @babel/plugin-proposal-decorators @babel/plugin-proposal-class-properties @babel/plugin-proposal-private-property-in-object  @babel/plugin-proposal-private-methods -D
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">  module: {
</span></span><span class="line"><span class="cl">    rules: [
</span></span><span class="line"><span class="cl"><span class="gi">+      {
</span></span></span><span class="line"><span class="cl"><span class="gi">+        test: /\.jsx?$/,
</span></span></span><span class="line"><span class="cl"><span class="gi">+        use: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+          loader: &#39;babel-loader&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+          options: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+            presets: [&#34;@babel/preset-env&#34;, &#39;@babel/preset-react&#39;],
</span></span></span><span class="line"><span class="cl"><span class="gi">+            plugins: [
</span></span></span><span class="line"><span class="cl"><span class="gi">+              [&#34;@babel/plugin-proposal-decorators&#34;, { legacy: true }],
</span></span></span><span class="line"><span class="cl"><span class="gi">+              [&#34;@babel/plugin-proposal-private-property-in-object&#34;, { &#34;loose&#34;: true }],
</span></span></span><span class="line"><span class="cl"><span class="gi">+              [&#34;@babel/plugin-proposal-private-methods&#34;, { &#34;loose&#34;: true }],
</span></span></span><span class="line"><span class="cl"><span class="gi">+              [&#34;@babel/plugin-proposal-class-properties&#34;, { loose: true }],
</span></span></span><span class="line"><span class="cl"><span class="gi">+            ],
</span></span></span><span class="line"><span class="cl"><span class="gi">+          },
</span></span></span><span class="line"><span class="cl"><span class="gi">+        },
</span></span></span><span class="line"><span class="cl"><span class="gi">+      },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>      ]
</span></span><span class="line"><span class="cl">  }
</span></span></code></pre></td></tr></table>
</div>
</div><p>è£…é¥°å™¨çš„å†™æ³•ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">readonly</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">descriptor</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">descriptor</span><span class="p">.</span><span class="nx">writable</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Person</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">@</span><span class="nx">readonly</span> <span class="nx">PI</span> <span class="o">=</span><span class="mf">3.14</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">person</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Person</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="nx">person</span><span class="p">.</span><span class="nx">PI</span> <span class="o">=</span> <span class="mf">3.15</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">)</span>  <span class="c1">// PIè¿˜æ˜¯3.14
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">decode</span><span class="p">(</span><span class="nx">target</span><span class="p">,</span><span class="nx">key</span><span class="p">,</span><span class="nx">descriptor</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// å†™æ³•ä¸€ï¼š  legacyï¼ˆä¼ å¥‡ï¼‰:true è¡¨ç¤ºè€çš„è§„åˆ™,å¯ä»¥è¿™ä¹ˆå†™
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="err">@</span><span class="nx">decode</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Person</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å†™æ³•äºŒï¼ˆæ–°å†™æ³•ï¼‰ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="err">@</span><span class="nx">decode</span> <span class="nx">Person</span> <span class="p">{}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>looseï¼štrue è¡¨ç¤ºå¯ä»¥ä»¥ obj.xxx çš„æ–¹å¼ç»™å¯¹è±¡æ·»åŠ å±æ€§ï¼Œä¸º false çš„è¯è¡¨ç¤º babel æœ€åä»¥ object.defineProperty çš„æ–¹å¼ç»™å¯¹è±¡æ·»åŠ å±æ€§ã€‚</p>
<h3 id="babel-polyfill">babel-polyfill
</h3><ul>
<li>Babel é»˜è®¤åªè½¬æ¢æ–°çš„ Javascript è¯­æ³•ï¼Œè€Œä¸è½¬æ¢æ–°çš„ APIï¼Œæ¯”å¦‚
<ul>
<li>Iterator, Generator, Set, Maps, Proxy, Reflect,Symbol,Promise ç­‰å…¨å±€å¯¹è±¡</li>
<li>åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼Œæ¯”å¦‚è¯´ ES6 åœ¨ Array å¯¹è±¡ä¸Šæ–°å¢äº†<code>Array.find</code>æ–¹æ³•ï¼ŒBabel å°±ä¸ä¼šè½¬ç è¿™ä¸ªæ–¹æ³•</li>
</ul>
</li>
<li>å¦‚æœæƒ³è®©è¿™ä¸ªæ–¹æ³•è¿è¡Œï¼Œå¿…é¡»ä½¿ç”¨ <code>babel-polyfill</code>æ¥è½¬æ¢ç­‰</li>
<li>Babel 7.4 ä¹‹åä¸å†æ¨èä½¿ç”¨@babel/polyfill</li>
<li>babel v7 æ¨èä½¿ç”¨@babel/preset-env ä»£æ›¿ä»¥å¾€çš„è¯¸å¤š polyfill æ–¹æ¡ˆ</li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-preset-env"  target="_blank" rel="noopener"
    >babel-preset-env</a></li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-polyfill"  target="_blank" rel="noopener"
    >babel-polyfill</a></li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-runtime"  target="_blank" rel="noopener"
    >babel-runtime</a></li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-plugin-transform-runtime"  target="_blank" rel="noopener"
    >babel-plugin-transform-runtime</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm i @babel/polyfill
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>babel-polyfill</code> å®ƒæ˜¯é€šè¿‡å‘å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„<code>prototype</code>ä¸Šæ·»åŠ æ–¹æ³•æ¥å®ç°çš„ã€‚æ¯”å¦‚è¿è¡Œç¯å¢ƒä¸­ä¸æ”¯æŒ<code>Array.prototype.find</code>æ–¹æ³•ï¼Œå¼•å…¥<code>polyfill</code>, æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨<code>ES6</code>æ–¹æ³•æ¥ç¼–å†™äº†ï¼Œä½†æ˜¯ç¼ºç‚¹å°±æ˜¯ä¼šé€ æˆå…¨å±€ç©ºé—´æ±¡æŸ“</li>
<li><a class="link" href="https://www.npmjs.com/package/@babel/preset-env"  target="_blank" rel="noopener"
    >@babel/preset-env</a>ä¸ºæ¯ä¸€ä¸ªç¯å¢ƒçš„é¢„è®¾</li>
<li><code>@babel/preset-env</code>é»˜è®¤åªæ”¯æŒè¯­æ³•è½¬åŒ–ï¼Œéœ€è¦å¼€å¯<code>useBuiltIns</code>é…ç½®æ‰èƒ½è½¬åŒ– API å’Œå®ä¾‹æ–¹æ³•</li>
<li><code>useBuiltIns</code>å¯é€‰å€¼åŒ…æ‹¬ï¼š&ldquo;usage&rdquo; | &ldquo;entry&rdquo; | false, é»˜è®¤ä¸º falseï¼Œè¡¨ç¤ºä¸å¯¹<code>polyfills</code> å¤„ç†ï¼Œè¿™ä¸ªé…ç½®æ˜¯å¼•å…¥ polyfills çš„å…³é”®</li>
<li><code>useBuiltIns: false</code> æ­¤æ—¶ä¸å¯¹ <code>polyfill</code> åšæ“ä½œã€‚å¦‚æœé¡¹ç›®ä¸­æ‰‹åŠ¨å¼•å…¥äº† <code>@babel/polyfill</code>ï¼Œåˆ™æ— è§†é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå…¨é‡å¼•å…¥æ‰€æœ‰çš„ <code>polyfill</code>ï¼Œæ— è§†éœ€è¦å…¼å®¹çš„æµè§ˆå™¨æ¡ä»¶ï¼Œæ‰“åŒ…ä½“ç§¯å¤§</li>
</ul>
<h4 id="usebuiltins-false">useBuiltIns: false
</h4><p>src/index.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@babel/polyfill&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">find</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">item</span> <span class="o">===</span> <span class="mi">2</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#39;path&#39;);
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">    mode: &#39;development&#39;,
</span></span><span class="line"><span class="cl">    devtool: false,
</span></span><span class="line"><span class="cl">    entry: &#39;./src/index.js&#39;,
</span></span><span class="line"><span class="cl">    output: {
</span></span><span class="line"><span class="cl">        path: path.resolve(__dirname, &#39;dist&#39;),
</span></span><span class="line"><span class="cl">        filename: &#39;main.js&#39;
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    module: {
</span></span><span class="line"><span class="cl">        rules: [
</span></span><span class="line"><span class="cl">            {
</span></span><span class="line"><span class="cl">                test: /\.js?$/,
</span></span><span class="line"><span class="cl">                exclude: /node_modules/,
</span></span><span class="line"><span class="cl">                use: {
</span></span><span class="line"><span class="cl">                    loader: &#39;babel-loader&#39;,
</span></span><span class="line"><span class="cl">                    options: {
</span></span><span class="line"><span class="cl">                        sourceType: &#34;unambiguous&#34;,
</span></span><span class="line"><span class="cl"><span class="gi">+                       presets: [[&#34;@babel/preset-env&#34;, { useBuiltIns: false }]]
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>                    }
</span></span><span class="line"><span class="cl">                }
</span></span><span class="line"><span class="cl">            }
</span></span><span class="line"><span class="cl">        ]
</span></span><span class="line"><span class="cl">    },
</span></span><span class="line"><span class="cl">    plugins: []
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="usebuiltins"><strong>useBuiltIns: &ldquo;entry&rdquo;</strong>
</h4><ul>
<li>
<p>åœ¨é¡¹ç›®å…¥å£å¼•å…¥ä¸€æ¬¡ï¼ˆå¤šæ¬¡å¼•å…¥ä¼šæŠ¥é”™ï¼‰</p>
</li>
<li>
<p>&ldquo;useBuiltIns&rdquo;: &ldquo;entry&rdquo; æ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œå¼•å…¥æµè§ˆå™¨ä¸å…¼å®¹çš„ polyfillã€‚éœ€è¦åœ¨å…¥å£æ–‡ä»¶æ‰‹åŠ¨æ·»åŠ  <code>import '@babel/polyfill'</code>ï¼Œä¼šè‡ªåŠ¨æ ¹æ® browserslist æ›¿æ¢æˆæµè§ˆå™¨ä¸å…¼å®¹çš„æ‰€æœ‰ polyfillï¼Œä¸ç®¡è‡ªå·±ç¼–å†™çš„æºä»£ç ä¸­æ˜¯å¦éœ€è¦å…¼å®¹å“ªäº› APIï¼Œéƒ½æ ¹æ®æ¡ä»¶ç»Ÿä¸€æ‰“åŒ…åˆ°æºç ä¸­</p>
</li>
<li>
<p>è¿™é‡Œéœ€è¦æŒ‡å®š core-js çš„ç‰ˆæœ¬,<code>corejs</code>é»˜è®¤æ˜¯ 2</p>
</li>
<li>
<p>å¦‚æœé…ç½® <code>corejs: 3</code>, åˆ™<code>import '@babel/polyfill'</code> éœ€è¦æ”¹æˆ <code>import 'core-js/stable';import 'regenerator-runtime/runtime';</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm install --save core-js@2    npm install --save core-js@3
</span></span></code></pre></td></tr></table>
</div>
</div><p>core-js@2</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;@babel/polyfill&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">find</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">item</span> <span class="o">===</span> <span class="mi">2</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>core-js@3</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;core-js/stable&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;regenerator-runtime/runtime&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">sum</span> <span class="o">=</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">promise</span> <span class="o">=</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">].</span><span class="nx">find</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">item</span> <span class="o">===</span> <span class="mi">2</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="webpackconfigjs">webpack.config.js
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">test: /\.js?$/,
</span></span><span class="line"><span class="cl">exclude: /node_modules/,
</span></span><span class="line"><span class="cl">use: {
</span></span><span class="line"><span class="cl">    loader: &#39;babel-loader&#39;,
</span></span><span class="line"><span class="cl">    options: {
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<ul>
<li>
<pre><code>    presets: [[&quot;@babel/preset-env&quot;, { useBuiltIns: 'entry', corejs: { version: 3 } }]]
  }
</code></pre>
<p>}
}</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="usebuiltins-usage-">**&ldquo;useBuiltIns&rdquo;: &ldquo;usage&rdquo; **
</h4><ul>
<li>&ldquo;useBuiltIns&rdquo;: &ldquo;usage&rdquo; <code>usage</code> ä¼šæ ¹æ®é…ç½®çš„æµè§ˆå™¨å…¼å®¹ï¼Œä»¥åŠä½ ä»£ç ä¸­ç”¨åˆ°çš„ API æ¥è¿›è¡Œ polyfillï¼Œå®ç°äº†æŒ‰éœ€æ·»åŠ </li>
<li>å½“è®¾ç½®ä¸º usage æ—¶ï¼Œpolyfill ä¼šè‡ªåŠ¨æŒ‰éœ€æ·»åŠ ï¼Œä¸å†éœ€è¦æ‰‹å·¥å¼•å…¥<code>@babel/polyfill</code></li>
</ul>
<h3 id="babel-runtime">babel-runtime
</h3><ul>
<li>ä¸ºäº†è§£å†³ babel-folyfill å…¨å±€ç©ºé—´æ±¡æŸ“çš„é—®é¢˜ï¼Œæä¾›äº†å•ç‹¬çš„åŒ…<a class="link" href="https://babeljs.io/docs/en/babel-runtime"  target="_blank" rel="noopener"
    >babel-runtime</a>ç”¨ä»¥æä¾›ç¼–è¯‘æ¨¡å—çš„å·¥å…·å‡½æ•°</li>
<li>ç®€å•è¯´ <code>babel-runtime</code> æ›´åƒæ˜¯ä¸€ç§æŒ‰éœ€åŠ è½½çš„å®ç°ï¼Œæ¯”å¦‚ä½ å“ªé‡Œéœ€è¦ä½¿ç”¨ <code>Promise</code>ï¼Œåªè¦åœ¨è¿™ä¸ªæ–‡ä»¶å¤´éƒ¨<code>import Promise from 'babel-runtime/core-js/promise'</code>å°±è¡Œäº†</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm i babel-runtime --save-dev
</span></span></code></pre></td></tr></table>
</div>
</div><p>src/index.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nb">Promise</span> <span class="nx">from</span> <span class="s2">&#34;babel-runtime/core-js/promise&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="babel-plugin-transform-runtime">babel-plugin-transform-runtime
</h3><ul>
<li>@babel/plugin-transform-runtime æ’ä»¶æ˜¯ä¸ºäº†è§£å†³
<ul>
<li>å¤šä¸ªæ–‡ä»¶é‡å¤å¼•ç”¨ ç›¸åŒ helpers(å¸®åŠ©å‡½æ•°)=&gt;æå–è¿è¡Œæ—¶</li>
<li>æ–° API æ–¹æ³•å…¨å±€æ±¡æŸ“ -&gt; å±€éƒ¨å¼•å…¥</li>
</ul>
</li>
<li>å¯ç”¨æ’ä»¶<code>babel-plugin-transform-runtime</code>åï¼ŒBabel å°±ä¼šä½¿ç”¨<code>babel-runtime</code>ä¸‹çš„å·¥å…·å‡½æ•°</li>
<li><code>babel-plugin-transform-runtime</code>æ’ä»¶èƒ½å¤Ÿå°†è¿™äº›å·¥å…·å‡½æ•°çš„ä»£ç è½¬æ¢æˆ<code>require</code>è¯­å¥ï¼ŒæŒ‡å‘ä¸ºå¯¹<code>babel-runtime</code>çš„å¼•ç”¨</li>
<li>babel-plugin-transform-runtime å°±æ˜¯å¯ä»¥åœ¨æˆ‘ä»¬ä½¿ç”¨æ–° API æ—¶è‡ªåŠ¨ importbabel-runtime é‡Œé¢çš„ polyfill
<ul>
<li>å½“ä½¿ç”¨ <code>async/await</code> æ—¶ï¼Œè‡ªåŠ¨å¼•å…¥ <code>babel-runtime/regenerator</code></li>
<li>å½“ä½¿ç”¨ ES6 çš„é™æ€äº‹ä»¶æˆ–å†…ç½®å¯¹è±¡æ—¶ï¼Œè‡ªåŠ¨å¼•å…¥ <code>babel-runtime/core-js</code></li>
<li>ç§»é™¤å†…è”<code>babel helpers</code>å¹¶æ›¿æ¢ä½¿ç”¨<code>babel-runtime/helpers</code> æ¥æ›¿æ¢</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">npm i @babel/plugin-transform-runtime @babel/runtime-corejs3 --save-dev
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js?$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">loader</span><span class="o">:</span> <span class="s1">&#39;babel-loader&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">sourceType</span><span class="o">:</span> <span class="s2">&#34;unambiguous&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nx">presets</span><span class="o">:</span> <span class="p">[[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">useBuiltIns</span><span class="o">:</span> <span class="s1">&#39;usage&#39;</span><span class="p">,</span> <span class="nx">corejs</span><span class="o">:</span> <span class="p">{</span> <span class="nx">version</span><span class="o">:</span> <span class="mi">3</span> <span class="p">}</span> <span class="p">}]],</span>
</span></span><span class="line"><span class="cl">            <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="p">[</span>
</span></span><span class="line"><span class="cl">                    <span class="s2">&#34;@babel/plugin-transform-runtime&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                    <span class="p">{</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">corejs</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">helpers</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                        <span class="nx">regenerator</span><span class="o">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">                    <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"> <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æˆ‘ä»¬ä½¿ç”¨ ES6 çš„é™æ€äº‹ä»¶æˆ–å†…ç½®å¯¹è±¡æ—¶è‡ªåŠ¨å¼•å…¥ babel-runtime/core-js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//var _Promise = __webpack_require__(&#34;./node_modules/@babel/runtime-corejs3/core-js-stable/promise.js&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">p</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">p</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="helpers-true">helpers: true
</h4><ul>
<li>ç§»é™¤å†…è” babel helpers å¹¶æ›¿æ¢ä½¿ç”¨<code>babel-runtime/helpers</code> æ¥æ›¿æ¢</li>
<li>é¿å…å†…è”çš„ helper ä»£ç åœ¨å¤šä¸ªæ–‡ä»¶é‡å¤å‡ºç°</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">A</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">B</span> <span class="kr">extends</span> <span class="nx">A</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="k">new</span> <span class="nx">B</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="regenerator-true">regenerator: true
</h4><ul>
<li>æ˜¯å¦å¼€å¯<code>generator</code>å‡½æ•°è½¬æ¢æˆä½¿ç”¨<code>regenerator runtime</code>æ¥é¿å…æ±¡æŸ“å…¨å±€åŸŸ</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//var _regeneratorRuntime = __webpack_require__(/*! @babel/runtime-corejs3/regenerator */ &#34;./node_modules/@babel/runtime-corejs3/regenerator/index.js&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span><span class="o">*</span> <span class="nx">gen</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">gen</span><span class="p">());</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="æœ€ä½³å®è·µ">æœ€ä½³å®è·µ
</h4><ul>
<li>@babel/preset-env å’Œ plugin-transform-runtime äºŒè€…éƒ½å¯ä»¥è®¾ç½®ä½¿ç”¨ corejs æ¥å¤„ç† polyfill</li>
</ul>
<h4 id="é¡¹ç›®å¼€å‘">é¡¹ç›®å¼€å‘
</h4><ul>
<li>
<p>useBuiltIns ä½¿ç”¨ usage</p>
</li>
<li>
<p>plugin-transform-runtime åªä½¿ç”¨å…¶ç§»é™¤å†…è”å¤ç”¨çš„è¾…åŠ©å‡½æ•°çš„ç‰¹æ€§ï¼Œå‡å°æ‰“åŒ…ä½“ç§¯</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;presets&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;useBuiltIns&#34;</span><span class="p">:</span> <span class="s2">&#34;usage&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;corejs&#34;</span><span class="p">:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;@babel/plugin-transform-runtime&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;corejs&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;helpers&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;regenerator&#34;</span><span class="p">:</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
<h4 id="ç±»åº“å¼€å‘">ç±»åº“å¼€å‘
</h4><ul>
<li>ç±»åº“å¼€å‘å°½é‡ä¸ä½¿ç”¨æ±¡æŸ“å…¨å±€ç¯å¢ƒçš„<code>polyfill</code>ï¼Œå› æ­¤<code>@babel/preset-env</code>åªå‘æŒ¥è¯­æ³•è½¬æ¢çš„åŠŸèƒ½</li>
<li>polyfill ç”±<code>@babel/plugin-transform-runtime</code>æ¥å¤„ç†ï¼Œæ¨èä½¿ç”¨ core-js@3</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;presets&#34;</span><span class="p">:</span> <span class="p">[[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">]],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;plugins&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;@babel/plugin-transform-runtime&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;corejs&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="mi">3</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="polyfill-service">polyfill-service
</h4><ul>
<li><a class="link" href="https://polyfill.io/v3/"  target="_blank" rel="noopener"
    >polyfill.io</a>è‡ªåŠ¨åŒ–çš„ JavaScript Polyfill æœåŠ¡</li>
<li><a class="link" href="https://polyfill.io/v3/"  target="_blank" rel="noopener"
    >polyfill.io</a>é€šè¿‡åˆ†æè¯·æ±‚å¤´ä¿¡æ¯ä¸­çš„ UserAgent å®ç°è‡ªåŠ¨åŠ è½½æµè§ˆå™¨æ‰€éœ€çš„ polyfills</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://polyfill.io/v3/polyfill.min.js&#34;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ts">TS
</h2><p>åœ¨ Webpack ä¸­ï¼Œ<code>ts-loader</code> å’Œ <code>babel-loader</code> éƒ½å¯ä»¥ç”¨æ¥å°† TypeScript è½¬æ¢ä¸º JavaScriptï¼Œä½†å®ƒä»¬çš„è®¾è®¡ç›®æ ‡å’Œå·¥ä½œæ–¹å¼ä¸åŒï¼Œå› æ­¤åœ¨å®é™…ä½¿ç”¨ä¸­ä¼šæœ‰æ‰€åŒºåˆ«ã€‚</p>
<ul>
<li><code>ts-loader</code> æ˜¯ Webpack ä¸­çš„ä¸€ä¸ªåŠ è½½å™¨ï¼Œç”¨äºå°† TypeScript ä»£ç è½¬æ¢æˆ JavaScript ä»£ç ã€‚å®ƒæ˜¯åŸºäº typescript ç¼–è¯‘å™¨å®ç°çš„ï¼Œæ”¯æŒæ‰€æœ‰ TypeScript çš„è¯­æ³•å’Œç‰¹æ€§ï¼Œå¯ä»¥å¸®åŠ©å¼€å‘è€…åœ¨ Webpack ä¸­ä½¿ç”¨ TypeScript è¿›è¡Œå¼€å‘</li>
<li>ç›´æ¥ä½¿ç”¨ TypeScript ç¼–è¯‘å™¨ (<code>tsc</code>) è¿›è¡Œç¼–è¯‘ã€‚</li>
<li>å®Œå…¨éµå¾ª <code>tsconfig.json</code> çš„é…ç½®ï¼Œä¾‹å¦‚æ¨¡å—è§£æã€ç±»å‹æ£€æŸ¥ç­‰ã€‚</li>
<li>å†…ç½®ç±»å‹æ£€æŸ¥åŠŸèƒ½ï¼Œèƒ½åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å‘ç°ç±»å‹é”™è¯¯ã€‚</li>
<li>å¯èƒ½ä¼šå¯¼è‡´æ„å»ºé€Ÿåº¦å˜æ…¢ï¼Œå°¤å…¶æ˜¯åœ¨å¤§é¡¹ç›®ä¸­ã€‚</li>
<li>å®Œå…¨æ”¯æŒ TypeScript çš„æ‰€æœ‰åŠŸèƒ½å’Œç‰¹æ€§ã€‚</li>
<li>å¦‚æœé¡¹ç›®ä¾èµ– TypeScript çš„é«˜çº§ç‰¹æ€§ï¼ˆå¦‚è·¯å¾„æ˜ å°„ã€å£°æ˜æ–‡ä»¶ç”Ÿæˆç­‰ï¼‰ï¼Œ<code>ts-loader</code> æ›´åˆé€‚ã€‚</li>
</ul>
<p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#39;path&#39;);
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl"><span class="gi">+ entry: &#39;./src/index.ts&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  module: {
</span></span><span class="line"><span class="cl">    rules: [
</span></span><span class="line"><span class="cl"><span class="gi">+     {
</span></span></span><span class="line"><span class="cl"><span class="gi">+       test: /\.ts$/,
</span></span></span><span class="line"><span class="cl"><span class="gi">+       use: &#39;ts-loader&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+       exclude: /node_modules/
</span></span></span><span class="line"><span class="cl"><span class="gi">+     },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    ]
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>
<p><code>@babel/preset-typescript</code> æ˜¯ Babel çš„ä¸€ä¸ªé¢„è®¾ï¼Œç”¨äºå°† TypeScript ä»£ç è½¬æ¢ä¸º JavaScript ä»£ç </p>
</li>
<li>
<p>ä½¿ç”¨ Babel è¿›è¡Œè½¬è¯‘ï¼Œéœ€è¦å€ŸåŠ© <code>@babel/preset-typescript</code> æ¥æ”¯æŒ TypeScript è¯­æ³•ã€‚</p>
</li>
<li>
<p>Babel åªè´Ÿè´£è¯­æ³•è½¬æ¢ï¼Œä¸è¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œéœ€è¦é¢å¤–è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥å·¥å…·ï¼ˆä¾‹å¦‚ <code>tsc --noEmit</code> æˆ– <code>fork-ts-checker-webpack-plugin</code>ï¼‰æ¥æ•æ‰ç±»å‹é”™è¯¯ã€‚</p>
</li>
<li>
<p>é€‚åˆæ›´é«˜æ•ˆçš„è½¬è¯‘æµç¨‹ï¼Œå°¤å…¶æ˜¯åœ¨å¤§å‹é¡¹ç›®ä¸­ã€‚</p>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.ts$/,
</span></span><span class="line"><span class="cl">        use:
</span></span><span class="line"><span class="cl"><span class="gi">+       [
</span></span></span><span class="line"><span class="cl"><span class="gi">+         {
</span></span></span><span class="line"><span class="cl"><span class="gi">+           loader: &#39;babel-loader&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+           options: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+             presets: [&#39;@babel/preset-typescript&#39;]
</span></span></span><span class="line"><span class="cl"><span class="gi">+           }
</span></span></span><span class="line"><span class="cl"><span class="gi">+         }
</span></span></span><span class="line"><span class="cl"><span class="gi">+       ],
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>        exclude: /node_modules/
</span></span><span class="line"><span class="cl">      },
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="é€‰æ‹©">é€‰æ‹©
</h3><ul>
<li><strong>åªç”¨ TypeScript çš„é¡¹ç›®ï¼š</strong>
<ul>
<li>æ¨èä½¿ç”¨ <code>ts-loader</code>ï¼Œå› ä¸ºå®ƒå®Œå…¨éµå¾ª TypeScript çš„é…ç½®ï¼Œä¸”æ›´é€‚åˆå¤„ç† TypeScript ä¸“å±ç‰¹æ€§ã€‚</li>
</ul>
</li>
<li><strong>TypeScript + Babel çš„é¡¹ç›®ï¼š</strong>
<ul>
<li>æ¨èä½¿ç”¨ <code>babel-loader</code>ï¼Œå¹¶ç»“åˆ Babel çš„ç”Ÿæ€ã€‚å¦‚æœéœ€è¦ç±»å‹æ£€æŸ¥ï¼Œå¯ä»¥æ­é… <code>fork-ts-checker-webpack-plugin</code> æˆ–å•ç‹¬è¿è¡Œ <code>tsc</code>ã€‚</li>
</ul>
</li>
<li><strong>å¤§å‹é¡¹ç›®ï¼š</strong>
<ul>
<li>å¦‚æœæ„å»ºæ€§èƒ½æ˜¯å…³é”®å› ç´ ï¼Œå¯ä»¥é€‰æ‹© <code>babel-loader</code> è¿›è¡Œå¿«é€Ÿè¯­æ³•è½¬è¯‘ï¼ŒåŒæ—¶ä½¿ç”¨ç‹¬ç«‹çš„ç±»å‹æ£€æŸ¥æµç¨‹ï¼ˆå¦‚ <code>tsc --noEmit</code>ï¼‰ã€‚</li>
</ul>
</li>
</ul>
<h3 id="æœ€ä½³å®è·µ-1">æœ€ä½³å®è·µ
</h3><p>å¦‚æœéœ€è¦åœ¨é¡¹ç›®ä¸­ç»“åˆä¸¤è€…çš„ä¼˜åŠ¿ï¼Œå¯ä»¥è¿™æ ·é…ç½®ï¼š</p>
<ol>
<li>ä½¿ç”¨ <code>babel-loader</code> è½¬è¯‘ TypeScript ä»£ç ã€‚</li>
<li>ä½¿ç”¨ <code>fork-ts-checker-webpack-plugin</code> æˆ– <code>tsc --noEmit</code> è¿›è¡Œç±»å‹æ£€æŸ¥ã€‚</li>
</ol>
<p>ä¾‹å¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ForkTsCheckerWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fork-ts-checker-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.tsx?$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">ForkTsCheckerWebpackPlugin</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;.tsx&#34;</span><span class="p">,</span> <span class="s2">&#34;.ts&#34;</span><span class="p">,</span> <span class="s2">&#34;.js&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·æ—¢èƒ½äº«å— Babel çš„é«˜æ€§èƒ½å’Œç”Ÿæ€ï¼Œåˆèƒ½ç¡®ä¿ TypeScript çš„ç±»å‹å®‰å…¨ã€‚</p>
<h2 id="eslint">eslint
</h2><ul>
<li>ESLint æ˜¯ JavaScript ä»£ç æ£€æŸ¥å·¥å…·ï¼Œåœ¨ç¼–å†™ä»£ç æ—¶è‡ªåŠ¨æ£€æŸ¥ä»£ç é£æ ¼(è¿™ä¸ªä¸€èˆ¬äº¤ç»™ prettier å»åš)å’Œè¯­æ³•é”™è¯¯ã€‚ä¸ºäº†æ»¡è¶³ä¸åŒå›¢é˜Ÿå’Œé¡¹ç›®çš„ä»£ç è§„èŒƒéœ€æ±‚ï¼ŒESLint ç”Ÿæ€ä¸­å‡ºç°äº†è®¸å¤šåŸºäºä¸åŒä»£ç è§„èŒƒçš„è§„åˆ™é›†åˆå’Œæ’ä»¶</li>
<li><code>eslint-config-airbnb</code> æ˜¯ Airbnb æä¾›çš„ä»£ç é£æ ¼è§„åˆ™é›†ã€‚å®ƒçš„ä¼˜ç‚¹åœ¨äºæä¾›äº†ä¸€å¥—å®Œæ•´çš„ã€å¯è‡ªå®šä¹‰çš„ä»£ç è§„èŒƒï¼Œæ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç¼–å†™å…·æœ‰ä¸€è‡´æ€§å’Œå¯è¯»æ€§çš„ä»£ç </li>
<li><code>eslint-config-standard</code>éµå¾ª Standard.js ä»£ç é£æ ¼è§„èŒƒï¼Œæä¾›äº†æœ€ä¾¿æ·çš„ç»Ÿä¸€ä»£ç é£æ ¼çš„æ–¹å¼ã€‚ä½¿ç”¨è¯¥è§„åˆ™é›†å¯ä»¥é¿å…å› ä»£ç é£æ ¼ä¸ä¸€è‡´è€Œå¼•èµ·çš„é”™è¯¯å’Œæ··ä¹±</li>
<li><code>eslint-plugin-vue</code>å’Œ<code>eslint-plugin-react</code>æ’ä»¶æ¥å®ç°å¯¹ SFC æ–‡ä»¶å’Œ React ä»£ç é£æ ¼çš„æ£€æŸ¥</li>
<li>é’ˆå¯¹ TypeScript ä»£ç çš„æ£€æŸ¥ï¼Œå¯ä»¥ä½¿ç”¨<code>@typescript-eslint/eslint-plugin</code>æ’ä»¶æ¥æ£€æŸ¥ä»£ç é£æ ¼å’Œè¯­æ³•é”™è¯¯</li>
<li><code>eslint-plugin-sonarjs</code>æ’ä»¶ï¼Œè¯¥æ’ä»¶åŸºäº<code>Sonar</code>æä¾›äº†ä»£ç è´¨é‡æ£€æŸ¥å·¥å…·ï¼Œæä¾›åœˆå¤æ‚åº¦ã€ä»£ç é‡å¤ç‡ç­‰æ£€æµ‹åŠŸèƒ½</li>
</ul>
<h3 id="æ—§ç‰ˆé…ç½®">æ—§ç‰ˆé…ç½®
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install eslint eslint-loader babel-eslint --D
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">module: {
</span></span><span class="line"><span class="cl">    rules: [
</span></span><span class="line"><span class="cl"><span class="gi">+      {
</span></span></span><span class="line"><span class="cl"><span class="gi">+        test: /\.jsx?$/,
</span></span></span><span class="line"><span class="cl"><span class="gi">+        loader: &#39;eslint-loader&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+        enforce: &#39;pre&#39;,   //   å€¼ï¼šä¸å†™  preå‰ç½®  poståç½® ç¡®å®šé’ˆå¯¹åŒä¸€ä¸ªæ–‡ä»¶çš„è§„åˆ™åŒ¹é…çš„ä¼˜å…ˆçº§
</span></span></span><span class="line"><span class="cl"><span class="gi">+        options: { fix: true },
</span></span></span><span class="line"><span class="cl"><span class="gi">+        exclude: /node_modules/,
</span></span></span><span class="line"><span class="cl"><span class="gi">+      }, // å…ˆæ£€æŸ¥ä»£ç é£æ ¼ï¼Œåœ¨è¿›è¡Œç¼–è¯‘
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>.eslintrc.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">root</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ä¸ºtrueè¯´æ˜è¯¥æ–‡ä»¶æ˜¯æ ¹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è¢«å…¶ä»–é…ç½®æ–‡ä»¶ç»§æ‰¿è§„åˆ™ï¼Œä¸ºtrueæ˜¯å°±ä¸èƒ½å†å†™extendsç»§æ‰¿å­—æ®µäº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">parser</span><span class="o">:</span> <span class="s2">&#34;babel-eslint&#34;</span><span class="p">,</span> <span class="c1">// ä»£ç ä¸­æœ‰es6ä»¥åçš„å†™æ³•ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯èƒ½ä¸è®¤è¯†ï¼Œéœ€è¦ä½¿ç”¨babel-eslintè¯†åˆ«æ–°è¯­æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//æŒ‡å®šè§£æå™¨é€‰é¡¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">parserOptions</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sourceType</span><span class="o">:</span> <span class="s2">&#34;module&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ecmaVersion</span><span class="o">:</span> <span class="mi">2015</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//æŒ‡å®šè„šæœ¬çš„è¿è¡Œç¯å¢ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">env</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">browser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">node</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å¯ç”¨çš„è§„åˆ™åŠå…¶å„è‡ªçš„é”™è¯¯çº§åˆ«
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">indent</span><span class="o">:</span> <span class="s2">&#34;off&#34;</span><span class="p">,</span> <span class="c1">//ç¼©è¿›é£æ ¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">quotes</span><span class="o">:</span> <span class="s2">&#34;off&#34;</span><span class="p">,</span> <span class="c1">//å¼•å·ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="s2">&#34;no-console&#34;</span><span class="o">:</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="c1">//ç¦æ­¢ä½¿ç”¨console
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm i eslint-config-airbnb eslint-loader eslint eslint-plugin-import eslint-plugin-react eslint-plugin-react-hooks eslint-plugin-jsx-a11y -D
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// åˆ é™¤rootæ–‡ä»¶ï¼ŒåŒæ—¶ç»§æ‰¿airbnb
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">parser</span><span class="o">:</span> <span class="s2">&#34;babel-eslint&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="kr">extends</span><span class="o">:</span> <span class="s2">&#34;airbnb&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">semi</span><span class="o">:</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;no-console&#34;</span><span class="o">:</span> <span class="s2">&#34;off&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;linebreak-style&#34;</span><span class="o">:</span> <span class="s2">&#34;off&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;eol-last&#34;</span><span class="o">:</span> <span class="s2">&#34;off&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//&#34;indent&#34;:[&#34;error&#34;,2]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">env</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">browser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">node</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–°ç‰ˆé…ç½®">æ–°ç‰ˆé…ç½®
</h3><p>npm install eslint -D</p>
<p>npx eslint. &ndash;init é—®ç­”å¼é€‰æ‹©ç”Ÿäº§.eslintrc.js æ–‡ä»¶ï¼ŒåŒæ—¶ä¼šå®‰è£…ä¸€äº›é…ç½®é¢„è®¾å’Œæ’ä»¶ã€‚</p>
<p>ä»¥å‰é€šè¿‡é…ç½® loader å®ç°åœ¨ç¼–è¯‘é˜¶æ®µå¯¹æºä»£ç è§„èŒƒçš„æ ¡éªŒå¹¶åœ¨ä¸è§„èŒƒçš„æƒ…å†µä¸‹æŠ¥é”™ã€‚</p>
<p>ç°åœ¨åˆ™æ”¹ä¸ºæ’ä»¶çš„å½¢å¼ã€‚åŒæ—¶åŸæ¥çš„è§£æå™¨ babel-eslint å·²ç»åœæ­¢ç»´æŠ¤äº†ï¼Œç°åœ¨ä½¿ç”¨@babel/eslint-parserã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// webpack.config.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">ESLintPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;eslint-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nx">ESLintPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fix</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>.eslintrc.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">env</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">browser</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">es2021</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">node</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parser</span><span class="o">:</span> <span class="s2">&#34;@babel/eslint-parser&#34;</span><span class="p">,</span> <span class="c1">// ä¸ç”¨è¿™ä¸ªè§£æå™¨åˆ™æ˜¯ç”¨eslinté»˜è®¤çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">extends</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;plugin:react/recommended&#34;</span><span class="p">,</span> <span class="s2">&#34;airbnb&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">overrides</span><span class="o">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">parserOptions</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ecmaVersion</span><span class="o">:</span> <span class="s2">&#34;latest&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sourceType</span><span class="o">:</span> <span class="s2">&#34;module&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;react&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rules</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;no-unused-vars&#34;</span><span class="o">:</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;no-undef&#34;</span><span class="o">:</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="map-é¡¹ç›®é…ç½®">MAP é¡¹ç›®é…ç½®
</h2><p>åœ¨ Webpack ä¸­ï¼Œå½“é¡¹ç›®æœ‰å¤šä¸ªæ¨¡æ¿ HTML æ–‡ä»¶ä¸”æ¯ä¸ªæ¨¡æ¿ HTML éƒ½å¯¹åº”ä¸€ä¸ªå…¥å£æ¨¡å—æ—¶ï¼Œéœ€è¦ä½¿ç”¨å¤šå…¥å£é…ç½®æ¥æ„å»ºã€‚ä»¥ä¸‹æ˜¯å…¸å‹çš„ Webpack é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼Œé€‚ç”¨äºè¿™æ ·çš„åœºæ™¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">entries</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">index</span><span class="o">:</span> <span class="s2">&#34;./src/index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">about</span><span class="o">:</span> <span class="s2">&#34;./src/about.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">contact</span><span class="o">:</span> <span class="s2">&#34;./src/contact.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="nx">entries</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;dist&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name].bundle.js&#34;</span><span class="p">,</span> <span class="c1">// è¾“å‡ºçš„æ–‡ä»¶åå¯¹åº”å…¥å£åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// æ¸…ç†æ—§æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.css$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;style-loader&#34;</span><span class="p">,</span> <span class="s2">&#34;css-loader&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.(png|jpg|jpeg|gif|svg)$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;asset/resource&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">entries</span><span class="p">).</span><span class="nx">map</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">entryName</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">          <span class="nx">filename</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">entryName</span><span class="si">}</span><span class="sb">.html`</span><span class="p">,</span> <span class="c1">// ç”Ÿæˆçš„ HTML æ–‡ä»¶å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">template</span><span class="o">:</span> <span class="sb">`./src/templates/</span><span class="si">${</span><span class="nx">entryName</span><span class="si">}</span><span class="sb">.html`</span><span class="p">,</span> <span class="c1">// æ¨¡æ¿è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="nx">entryName</span><span class="p">],</span> <span class="c1">// æŒ‡å®šå…¥å£æ–‡ä»¶    chunks ç”¨äºæŒ‡å®šå½“å‰æ¨¡æ¿ä½¿ç”¨çš„å…¥å£æ¨¡å—ï¼Œé˜²æ­¢åŠ è½½ä¸ç›¸å…³çš„ JS æ–‡ä»¶ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span> <span class="c1">// æå–å…¬å…±æ¨¡å—   é…ç½® optimization.splitChunks æå–å…¬å…±æ¨¡å—ï¼ˆå¦‚ç¬¬ä¸‰æ–¹åº“ï¼‰ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devServer</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">static</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;dist&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">open</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">port</span><span class="o">:</span> <span class="mi">8080</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">project/
</span></span><span class="line"><span class="cl">â”œâ”€â”€ src/
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ index.js
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ about.js
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ contact.js
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ templates/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ index.html
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ about.html
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ contact.html
</span></span><span class="line"><span class="cl">â”‚   â”œâ”€â”€ styles/
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ index.css
</span></span><span class="line"><span class="cl">â”‚   â”‚   â”œâ”€â”€ about.css
</span></span><span class="line"><span class="cl">â”‚   â”‚   â””â”€â”€ contact.css
</span></span><span class="line"><span class="cl">â”œâ”€â”€ dist/
</span></span><span class="line"><span class="cl">â”œâ”€â”€ webpack.config.js
</span></span><span class="line"><span class="cl">â”œâ”€â”€ package.json
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>HtmlWebpackPlugin</code> æ’ä»¶ä¸­çš„ <code>chunks</code> é€‰é¡¹çš„ä½œç”¨æ˜¯æŒ‡å®šå½“å‰ç”Ÿæˆçš„ HTML æ–‡ä»¶ä¸­éœ€è¦å¼•å…¥çš„ JavaScript æ¨¡å—ï¼ˆå³ Webpack ä¸­çš„å…¥å£æ–‡ä»¶ï¼‰ã€‚å®ƒæä¾›äº†ç²¾ç¡®çš„æ§åˆ¶ï¼Œç¡®ä¿åªåŒ…å«ä¸å½“å‰ HTML æ–‡ä»¶ç›¸å…³çš„è„šæœ¬ï¼Œä»è€Œé¿å…åŠ è½½å¤šä½™çš„æ–‡ä»¶ã€‚</p>
<hr>
<h3 id="chunks"><strong><code>chunks</code> é€‰é¡¹çš„ä¸»è¦åŠŸèƒ½</strong>
</h3><ol>
<li><strong>æŒ‡å®šå¼•å…¥çš„è„šæœ¬</strong>:
<ul>
<li>å½“é¡¹ç›®ä½¿ç”¨å¤šå…¥å£é…ç½®æ—¶ï¼Œæ¯ä¸ªå…¥å£æ–‡ä»¶å¯èƒ½ä¼šç”Ÿæˆä¸åŒçš„ JavaScript æ–‡ä»¶ã€‚é€šè¿‡ <code>chunks</code> æŒ‡å®šå…³è”çš„å…¥å£æ–‡ä»¶ï¼Œå¯ä»¥ç¡®ä¿ HTML æ–‡ä»¶åªå¼•å…¥ç›¸å…³çš„ JS æ–‡ä»¶ã€‚</li>
</ul>
</li>
<li><strong>ä¼˜åŒ–åŠ è½½æ€§èƒ½</strong>:
<ul>
<li>é€šè¿‡åªåŠ è½½æ‰€éœ€çš„æ¨¡å—ï¼Œå‡å°‘ä¸å¿…è¦çš„è„šæœ¬åŠ è½½ï¼Œæå‡é¡µé¢æ€§èƒ½ã€‚</li>
</ul>
</li>
<li><strong>é¿å…å†²çª</strong>:
<ul>
<li>å½“æ¯ä¸ªé¡µé¢ä½¿ç”¨ä¸åŒçš„æ¨¡å—æ—¶ï¼Œé¿å…å¼•å…¥é”™è¯¯æˆ–ä¸éœ€è¦çš„ä»£ç å¯¼è‡´çš„å†²çªæˆ–é”™è¯¯ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h3 id="chunks-1"><strong><code>chunks</code> çš„ä½¿ç”¨åœºæ™¯</strong>
</h3><h4 id="1-å¤šå…¥å£é…ç½®">1. å¤šå…¥å£é…ç½®
</h4><p>åœ¨å¤šé¡µé¢åº”ç”¨ä¸­ï¼Œä¸åŒçš„ HTML æ–‡ä»¶å¯¹åº”ä¸åŒçš„å…¥å£æ¨¡å—ã€‚ä¾‹å¦‚ï¼š</p>
<ul>
<li><code>index.html</code> å¯¹åº” <code>index.js</code></li>
<li><code>about.html</code> å¯¹åº” <code>about.js</code></li>
<li><code>contact.html</code> å¯¹åº” <code>contact.js</code></li>
</ul>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">index</span><span class="o">:</span> <span class="s2">&#34;./src/index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">about</span><span class="o">:</span> <span class="s2">&#34;./src/about.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">contact</span><span class="o">:</span> <span class="s2">&#34;./src/contact.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/templates/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;index&#34;</span><span class="p">],</span> <span class="c1">// ä»…å¼•å…¥ index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;about.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/templates/about.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;about&#34;</span><span class="p">],</span> <span class="c1">// ä»…å¼•å…¥ about.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;contact.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/templates/contact.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;contact&#34;</span><span class="p">],</span> <span class="c1">// ä»…å¼•å…¥ contact.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-å¼•å…¥å¤šä¸ªå…¥å£æ–‡ä»¶">2. å¼•å…¥å¤šä¸ªå…¥å£æ–‡ä»¶
</h4><p>æœ‰æ—¶ä¸€ä¸ªé¡µé¢éœ€è¦å¼•å…¥å¤šä¸ªå…¥å£æ–‡ä»¶ï¼Œå¯ä»¥åœ¨ <code>chunks</code> ä¸­åŒæ—¶æŒ‡å®šï¼š</p>
<p><strong>é…ç½®ç¤ºä¾‹</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;dashboard.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/templates/dashboard.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;index&#34;</span><span class="p">,</span> <span class="s2">&#34;about&#34;</span><span class="p">],</span> <span class="c1">// åŒæ—¶å¼•å…¥ index.js å’Œ about.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="ä¸ä½¿ç”¨"><strong>ä¸ä½¿ç”¨ <code>chunks</code> ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</strong>
</h3><p>å¦‚æœä¸è®¾ç½® <code>chunks</code>ï¼Œ<code>HtmlWebpackPlugin</code> ä¼šé»˜è®¤å¼•å…¥æ‰€æœ‰çš„å…¥å£æ¨¡å—ï¼ˆå³ <code>entry</code> ä¸­çš„æ‰€æœ‰æ–‡ä»¶ï¼‰ã€‚è¿™å¯èƒ½å¯¼è‡´ä»¥ä¸‹é—®é¢˜ï¼š</p>
<ol>
<li>åŠ è½½å¤šä½™è„šæœ¬:
<ul>
<li>æ‰€æœ‰çš„å…¥å£æ–‡ä»¶éƒ½ä¼šè¢«åŠ è½½ï¼Œå¯èƒ½åŒ…å«ä¸ç›¸å…³çš„ä»£ç ï¼Œæµªè´¹èµ„æºã€‚</li>
</ul>
</li>
<li>æ½œåœ¨çš„å†²çª:
<ul>
<li>ä¸åŒé¡µé¢çš„è„šæœ¬å¯èƒ½ç›¸äº’å½±å“ï¼ˆå¦‚å…¨å±€å˜é‡å†²çªï¼‰ã€‚</li>
</ul>
</li>
</ol>
<hr>
<h3 id="å¯¹æ¯”"><strong>å¯¹æ¯” <code>chunks</code> å’Œ <code>excludeChunks</code></strong>
</h3><ul>
<li><strong><code>chunks</code></strong>: æŒ‡å®šè¦åŒ…å«çš„å…¥å£æ¨¡å—ã€‚</li>
<li><strong><code>excludeChunks</code></strong>: æŒ‡å®šè¦æ’é™¤çš„å…¥å£æ¨¡å—ã€‚</li>
</ul>
<p><strong>ç¤ºä¾‹</strong>:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// åªå¼•å…¥æŒ‡å®šæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;index&#34;</span><span class="p">],</span> <span class="c1">// ä»…å¼•å…¥ index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ’é™¤æŒ‡å®šæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">excludeChunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;about&#34;</span><span class="p">,</span> <span class="s2">&#34;contact&#34;</span><span class="p">],</span> <span class="c1">// æ’é™¤ about.js å’Œ contact.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><hr>
<h3 id="æ€»ç»“">æ€»ç»“
</h3><p><code>chunks</code> çš„ä½œç”¨æ˜¯ä¸ºæ¯ä¸ªç”Ÿæˆçš„ HTML æ–‡ä»¶ç²¾ç¡®æŒ‡å®šéœ€è¦åŠ è½½çš„å…¥å£æ¨¡å—ï¼Œé¿å…å¼•å…¥ä¸å¿…è¦çš„è„šæœ¬æ–‡ä»¶ï¼Œæå‡åŠ è½½æ€§èƒ½å’Œä»£ç ç®¡ç†æ•ˆç‡ã€‚åˆç†ä½¿ç”¨ <code>chunks</code> å¯ä»¥ç¡®ä¿ Webpack é…ç½®æ›´çµæ´»ã€æ›´é«˜æ•ˆã€‚</p>
<h2 id="webpack-åŸç†é¢„å¤‡çŸ¥è¯†">webpack åŸç†é¢„å¤‡çŸ¥è¯†
</h2><ul>
<li><code>Symbol.toStringTag</code> æ˜¯ä¸€ä¸ªå†…ç½® symbolï¼Œå®ƒé€šå¸¸ä½œä¸ºå¯¹è±¡çš„å±æ€§ä½¿ç”¨ï¼Œå¯¹åº”çš„å±æ€§å€¼åº”è¯¥ä¸ºå­—ç¬¦ä¸²ç±»å‹ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²ç”¨æ¥è¡¨ç¤ºè¯¥å¯¹è±¡çš„è‡ªå®šä¹‰ç±»å‹æ ‡ç­¾</li>
<li>é€šå¸¸åªæœ‰å†…ç½®çš„ <code>Object.prototype.toString()</code> æ–¹æ³•ä¼šå»è¯»å–è¿™ä¸ªæ ‡ç­¾å¹¶æŠŠå®ƒåŒ…å«åœ¨è‡ªå·±çš„è¿”å›å€¼é‡Œã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&#34;foo&#34;</span><span class="p">));</span> <span class="c1">// &#34;[object String]&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]));</span> <span class="c1">// &#34;[object Array]&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="mi">3</span><span class="p">));</span> <span class="c1">// &#34;[object Number]&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">true</span><span class="p">));</span> <span class="c1">// &#34;[object Boolean]&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">undefined</span><span class="p">));</span> <span class="c1">// &#34;[object Undefined]&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="kc">null</span><span class="p">));</span> <span class="c1">// &#34;[object Null]&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">myExports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">myExports</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;Module&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">toString</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">myExports</span><span class="p">));</span> <span class="c1">//[object Module]   è‡ªå®šä¹‰æŸä¸ªæ•°æ®çš„æ ‡è¯†
</span></span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;path&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;html-webpack-plugin&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s1">&#39;development&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s1">&#39;./src/index.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s1">&#39;dist&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;main.js&#39;</span><span class="err">ï¼Œ</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clean</span><span class="o">:</span><span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s1">&#39;./src/index.html&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s1">&#39;index.html&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¥å£æ–‡ä»¶ index.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./title.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>title.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;title&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åç”Ÿæˆæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// moduleså­˜æ”¾é¡¹ç›®ä¸­é™¤äº†å…¥å£æ¨¡å—ä¹‹å¤–ä¾èµ–çš„æ‰€æœ‰æ¨¡å—ï¼ˆä¾èµ–å…³ç³»å›¾çš„ç”Ÿæˆç»“æœï¼‰ï¼Œ keyï¼ˆæ¨¡å—idï¼‰æ˜¯æ¨¡å—å¯¹äºé¡¹ç›®çš„æ‰€åœ¨æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œå€¼æ˜¯å‡½æ•°ï¼Œå‡½æ•°ä½“å†…å®¹ç”±æ¨¡å—æ–‡ä»¶çš„å†…å®¹ç»„æˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¸ç®¡æºç ä¸­æ˜¯æ¨¡å—è·¯å¾„ï¼Œç›¸å¯¹æˆ–ç»å¯¹è·¯å¾„ï¼Œæœ€åéƒ½è½¬ä¸ºç›¸å¯¹äºé¡¹ç›®æ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="s1">&#39;./src/title.js&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s1">&#39;title&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ç¼“å­˜å·²ç»è¢«å¼•å…¥è¿‡çš„æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// requireæ–¹æ³•ï¼Œç›¸å½“äºwebpackåœ¨æµè§ˆå™¨ç«¯å®ç°ä¸€ä¸ªrequireçš„polyfullçš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">].</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">id</span><span class="o">:</span> <span class="nx">moduleId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaded</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span><span class="nx">z</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">exports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./src/title.js&#39;</span><span class="p">);</span>   <span class="c1">// å¯ä»¥çœ‹å‡ºæ•´ä¸ªä»£ç æ˜¯åŒæ­¥æ‰§è¡Œçš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“ index.js ä¸­å¼•å…¥ä¸¤ä¸ªä¾èµ–æ–‡ä»¶ test1.js å’Œ test2.js æ—¶çš„æ‰“åŒ…ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackModules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;./src/test/test1.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">unusedWebpackExports</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nmd</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="p">.</span><span class="kr">export</span> <span class="o">=</span> <span class="s2">&#34;test1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;./src/test/test2.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">unusedWebpackExports</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nmd</span><span class="p">(</span><span class="nx">module</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="p">.</span><span class="kr">export</span> <span class="o">=</span> <span class="s2">&#34;test2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackModuleCache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">webpackRequire</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">webpackModuleCache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">webpackModuleCache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">id</span><span class="o">:</span> <span class="nx">moduleId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaded</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackModules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="p">.</span><span class="nx">loaded</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nmd</span> <span class="o">=</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="p">.</span><span class="nx">paths</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">module</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span> <span class="nx">module</span><span class="p">.</span><span class="nx">children</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackExports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">test1</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">(</span><span class="s2">&#34;./src/test/test1.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">test2</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">(</span><span class="s2">&#34;./src/test/test2.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">test1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">test2</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ webpack ä¸­æœ‰ä¸¤ç§æ¨¡å—åŒ–è§„èŒƒï¼Œcommonjs å’Œ esmoduleï¼Œä»–ä»¬ä¹‹é—´å¯ä»¥ç›¸ä¼šè½¬æ¢å’Œæ··ç”¨ã€‚å¹¶ä¸”åœ¨ webpack æ‰“åŒ…åéƒ½ç»Ÿä¸€ä½¿ç”¨ commonJS æ¨¡å—è§„èŒƒã€‚</p>
<h3 id="commonjs-åŠ è½½-commonjs">common.js åŠ è½½ common.js
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./title&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">exports</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;title_name&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="s2">&#34;title_age&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰“åŒ…ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å®šä¹‰äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå°†æ¯ä¸€ä¸ªåŠ è½½çš„æ¨¡å—ä»¥åŠæ¨¡å—å¯¹åº”çš„ä»£ç ï¼Œæ·»åŠ åˆ°è¯¥å‡½æ•°å†…éƒ¨ï¼Œç„¶åè¯¥å‡½æ•°ä½œä¸ºå€¼ï¼Œè€Œæ¨¡å—çš„è·¯å¾„å¯¹åº”keyã€‚ åœ¨commonjsä¸­å¹¶æ²¡æœ‰å°†å…¥å£æ–‡ä»¶åŠ å…¥åˆ°__webpack_modules__å¯¹è±¡å†…éƒ¨ä½œä¸ºä¸€ä¸ªå±æ€§ã€‚è€Œåœ¨ES6çš„ä¸­æ˜¯åšäº†ã€‚å¯ä»¥çœ‹ä¸‹é¢çš„ES6æ‰“åŒ…æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="s2">&#34;./src/title.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">exports</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;title_name&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="s2">&#34;title_age&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// ä¸€æ—¦æ•´ä¸ªé¡¹ç›®ä¸­æœ‰ä¸€ä¸ªæ–‡ä»¶å¼•å…¥äº†ä¸€ä¸ªæ¨¡å—åï¼Œåç»­è¯¥é¡¹ç›®ä¸­çš„å…¶ä»–æ–‡ä»¶å†å¼•å…¥ç›¸åŒçš„æ–‡ä»¶ï¼Œåˆ™å®é™…ä¸Šéƒ½æ˜¯åŒä¸€ä¸ªå¯¼å‡ºã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">exports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./src/title.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="commonjs-åŠ è½½-es6-modules">common.js åŠ è½½ ES6 modules
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./title&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="k">default</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="s1">&#39;title_name&#39;</span><span class="p">;</span> <span class="c1">// é»˜è®¤å¯¼å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="s1">&#39;title_age&#39;</span><span class="p">;</span> <span class="c1">// å‘½åå¯¼å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰“åŒ…ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ¨¡å—å®šä¹‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;./src/title.js&#39;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// es moduleè½¬commonjs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">_DEFAULT_EXPORT__</span> <span class="o">=</span> <span class="s1">&#39;title_name&#39;</span><span class="p">;</span>  <span class="c1">// æ³¨æ„è¿™é‡Œæ˜¯constå®šä¹‰çš„å˜é‡ï¼Œæ‰€ä»¥åœ¨å¯¼å…¥è¯¥æ¨¡å—çš„æ–‡ä»¶ä¸­æ˜¯æ— æ³•ä¿®æ”¹è¯¥å˜é‡çš„å€¼çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="s1">&#39;title_age&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">require</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">exports</span><span class="p">);</span> <span class="c1">// rå‡½æ•°ç”¨äºæ ‡è¯†exportsæ˜¯ä¸€ä¸ªes moduleçš„å¯¼å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">      <span class="nx">require</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">_DEFAULT_EXPORT__</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">age</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">age</span> <span class="c1">// ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºesmoduleçš„å¯¼å‡ºï¼Œå¯¼å‡ºçš„æ˜¯å˜é‡æœ¬èº«ï¼Œè¿™ä¸åŒäºcommonjså¯¼å‡ºçš„æ˜¯å€¼æˆ–è€…å¯¹è±¡å¼•ç”¨ï¼Œè€Œä¸”åœ¨å®šä¹‰æ—¶ï¼Œå¹¶æ²¡æœ‰æä¾›å¯¹åº”å±æ€§çš„setteræ–¹æ³•ï¼Œæ‰€ä»¥å¯¼å…¥è¯¥æ¨¡å—çš„å…¶ä»–æ¨¡å—æ˜¯æ— æ³•ä¿®æ”¹è¯¥å¯¼å‡ºå˜é‡çš„å€¼çš„ã€‚ è€Œä¸”è¯¥æ¨¡å—ä¸­åœ¨åç»­ä¿®æ”¹äº†è¯¥å˜é‡å¯¹åº”çš„å€¼åï¼Œå…¶ä»–æ¨¡å—å†æ¬¡è®¿é—®å¯¼å‡ºçš„å˜é‡æ—¶ï¼Œä¼šæ˜¯æœ€æ–°çš„å€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">exports</span><span class="o">:</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç»™å¯¹è±¡å®šä¹‰å±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">require</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span> <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">get</span><span class="o">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span>   <span class="c1">// åªå®šä¹‰äº†getter
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// rå‡½æ•°ç”¨äºæ ‡è¯†exportsæ˜¯ä¸€ä¸ªes moduleçš„å¯¼å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">require</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å®¿ä¸»ç¯å¢ƒæ”¯æŒsymbolæ•°æ®ç±»å‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">Symbol</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s1">&#39;Module&#39;</span> <span class="p">});</span> <span class="c1">// [object Module]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å®¿ä¸»ç¯å¢ƒä¸æ”¯æŒsymbolæ•°æ®ç±»å‹æ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s1">&#39;__esModule&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span> <span class="c1">// exports.__esModule = trueï¼Œé€šè¿‡è¯¥å±æ€§å°±èƒ½çŸ¥é“è¯¥æ¨¡å—æ–‡ä»¶æ˜¯é‡‡ç”¨çš„commonJSæ¨¡å—è¿˜æ˜¯esModuleæ¨¡å—è§„èŒƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./src/title.js&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// titleé»˜è®¤æ˜¯å¼•å…¥çš„é‚£ä¸ªæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="k">default</span><span class="p">);</span> <span class="c1">// es6ä¸­é»˜è®¤å¯¼å‡ºåœ¨commonjsä¸­æ˜¯é€šè¿‡defaultå±æ€§è·å–çš„ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">})();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="es6-modules-åŠ è½½-es6-modules">ES6 modules åŠ è½½ ES6 modules
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//  index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">name</span><span class="p">,</span> <span class="p">{</span> <span class="nx">age</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;./title&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="s2">&#34;title_name&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="kr">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="s2">&#34;title_age&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰“åŒ…ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;./src/title.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">require</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">_DEFAULT_EXPORT__</span> <span class="o">=</span> <span class="s2">&#34;title_name&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">age</span> <span class="o">=</span> <span class="s2">&#34;title_age&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">age</span> <span class="o">=</span> <span class="s2">&#34;new&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">require</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">default</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">_DEFAULT_EXPORT__</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">age</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">age</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get</span><span class="o">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">Symbol</span> <span class="o">!==</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;Module&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&#34;__esModule&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">exports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">_title_0__</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./src/title.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_title_0__</span><span class="p">[</span><span class="s2">&#34;default&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_title_0__</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="es6-modules-åŠ è½½-commonjs">ES6 modules åŠ è½½ common.js
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">name</span><span class="p">,</span> <span class="p">{</span> <span class="nx">age</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;./title&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// è¿™é‡Œçš„é»˜è®¤å¯¼å…¥å®é™…ä¸Šå°±æ˜¯è¢«å¯¼å…¥çš„commonjsæ¨¡å—çš„module.exportså¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;title_name&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span><span class="o">:</span> <span class="s2">&#34;title_age&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ‰“åŒ…ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./src/title.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;title_name&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">age</span><span class="o">:</span> <span class="s2">&#34;title_age&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">n</span> <span class="o">=</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">getter</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="nx">module</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">__esModule</span> <span class="o">?</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">module</span><span class="p">[</span><span class="s2">&#34;default&#34;</span><span class="p">]</span> <span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">module</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">require</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">getter</span><span class="p">,</span> <span class="p">{</span> <span class="nx">a</span><span class="o">:</span> <span class="nx">getter</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//ç»™getteræ·»åŠ ä¸€ä¸ªaå±æ€§ï¼Œaçš„å€¼å°±æ˜¯getterçš„è¿”å›å€¼ getter.a
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">return</span> <span class="nx">getter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">get</span><span class="o">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;Module&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&#34;__esModule&#34;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">exports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//åªè¦æ‰“åŒ…å‰çš„æ¨¡å—æ˜¯ä¸€ä¸ªes module,é‚£ä¹ˆå°±ä¼šè°ƒç”¨require.ræ–¹æ³•è¿›è¡Œæ ‡è¯†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">require</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">_title_0__</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./src/title.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">_title_0___default</span> <span class="o">=</span> <span class="nx">require</span><span class="p">.</span><span class="nx">n</span><span class="p">(</span><span class="nx">_title_0__</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_title_0___default</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_title_0__</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">})();</span>
</span></span><span class="line"><span class="cl"><span class="p">})();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ a æ¨¡å—ä¸­ä½¿ç”¨ commonjs çš„ require è¯­æ³•åŠ è½½ b æ¨¡å—ï¼Œb æ¨¡å—ä½¿ç”¨ ES Module è¿›è¡Œé»˜è®¤å¯¼å‡ºå’Œå‘½åå¯¼å‡ºï¼Œåˆ™åœ¨ a æ¨¡å—ä¸­å¾—åˆ°çš„æ˜¯ b æ¨¡å—å¯¹åº”çš„æ¨¡å—å¯¹è±¡ï¼Œå…¶ä¸­åŒ…å«å‘½åå¯¼å‡ºå’Œ default é»˜è®¤å¯¼å‡ºå±æ€§ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js:
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./title&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span> <span class="c1">// titleæ˜¯title.jsæ¨¡å—å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="s2">&#34;title_name&#34;</span><span class="p">;</span> <span class="c1">// é»˜è®¤å¯¼å‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kr">const</span> <span class="nx">age</span> <span class="o">=</span> <span class="s2">&#34;title_age&#34;</span><span class="p">;</span> <span class="c1">// å‘½åå¯¼å‡º
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blogs/post/webpack/images/image-20220522184522377.png"
	width="689"
	height="208"
	srcset="/blogs/post/webpack/images/image-20220522184522377_hu_2a4cf46de15e3b3a.png 480w, /blogs/post/webpack/images/image-20220522184522377_hu_aa1fb1f2eb23bb70.png 1024w"
	loading="lazy"
	
		alt="image-20220522184522377"
	
	
		class="gallery-image" 
		data-flex-grow="331"
		data-flex-basis="795px"
	
></p>
<p>é¢è¯•ï¼šcommonjs å’Œ es Module å¯¼å‡ºçš„åŒºåˆ«ï¼Ÿ</p>
<ul>
<li>commonjs æ˜¯åœ¨å¯¼å…¥æ¨¡å—ä¸­æ˜¯å€¼å’Œå¼•ç”¨</li>
<li>es module æ˜¯åœ¨å¯¼å…¥æ¨¡å—ä¸­æ˜¯å¯¹å¯¼å‡ºæ¨¡å—å¯¼å‡ºå¯¹è±¡æˆ–è€…å€¼çš„å†…å­˜å¼•ç”¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">title</span><span class="p">,</span> <span class="p">{</span> <span class="nx">age</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;./title.js&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">age</span><span class="p">);</span> <span class="c1">// æ‰“å° 20
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./title.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span> <span class="c1">// æ‰“å° 10
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">.</span><span class="nx">obj</span><span class="p">.</span><span class="nx">name</span><span class="p">);</span> <span class="c1">// 456
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">age</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="mi">123</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">obj</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">age</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">obj</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="mi">456</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼‚æ­¥åŠ è½½">å¼‚æ­¥åŠ è½½
</h2><p>æ‡’åŠ è½½å’Œä»£ç åˆ†å‰²ï¼ŒåŸç”Ÿçš„ä»£ç åˆ†å‰²ç‚¹ï¼Œå¯ä»¥åˆ†å‰²æ¨¡å—ä¸ºä¸€ä¸ªä¸ªå•ç‹¬çš„æ–‡ä»¶ä¸€ä¸ªä¸ªåŠ è½½ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// index.js  importè¿”å›çš„ç»“æœæ˜¯ä¸€ä¸ªpromiseå®ä¾‹ï¼Œè¿”å›çš„ç»“æœä¸ç®¡æºæ–‡ä»¶æ˜¯commonjsè¿˜æ˜¯esmoduleï¼Œéƒ½åŒ…è£…ä¸ºesmodule
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span><span class="p">(</span><span class="cm">/* webpackChunkName: &#34;hello&#34; */</span> <span class="s2">&#34;./hello.js&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="k">default</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// hello.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">export</span> <span class="k">default</span> <span class="s2">&#34;hello&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åï¼Œç”¨æˆ·è®¿é—®æ‰“åŒ…åçš„ html æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶å¼•å…¥äº†æ•´ä¸ªé¡¹ç›®çš„å¯åŠ¨ js æ–‡ä»¶ï¼ˆbuild.js æˆ–è€… main.jsï¼‰,ä¸ä¼šåŠ è½½æ‹†åŒ…åæ²¡æœ‰ç”¨åˆ°çš„ js æ–‡ä»¶ã€‚å½“åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œå¯åŠ¨ js æ–‡ä»¶æ—¶ï¼Œè¯¥æ–‡ä»¶ä¼šå°†ç”¨åˆ°çš„ js æ–‡ä»¶é€šè¿‡åˆ›å»º script æ ‡ç­¾çš„å½¢å¼å»åŠ è½½æ‹†åŒ…çš„ js æ–‡ä»¶ï¼Œè¯·æ±‚å›æ¥çš„ js æ–‡ä»¶ä¸€è§£ææ‰§è¡Œå°±ä¼šè§¦å‘å·²ç»åœ¨å‰ç«¯è¢«å®šä¹‰å¥½çš„æ–¹æ³•â€”â€”webpackJsonpCallbackï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå°†è¯·æ±‚å›æ¥ js çš„æ–‡ä»¶ä¾æ¬¡å†…å®¹æŒ‚è½½åˆ° modulesï¼ŒåŒæ—¶æ‰§è¡Œç›¸åº”æ–‡ä»¶ä¹‹å‰å‡†å¤‡çš„ promise çš„ resolve æ–¹æ³•ã€‚å½“æ‰€æœ‰æ–‡ä»¶éƒ½åŠ è½½å®Œæˆä¸” promise çš„ resolve æ–¹æ³•éƒ½æˆåŠŸè°ƒç”¨åï¼Œå°†è§¦å‘ Promise.allï¼Œç„¶ååœ¨ promise.all çš„ then æ–¹æ³•ä¸­ä¾æ¬¡è§¦å‘ require æ–¹æ³•ï¼ŒåŠ è½½å¹¶æ‰§è¡Œå·²ç»æŒ‚è½½åˆ° modules ä¸Šçš„è¯·æ±‚å›æ¥çš„ js æ–‡ä»¶å†…å®¹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">debugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{};</span> <span class="c1">// æ¨¡å—å®šä¹‰å­˜æ”¾åœ¨è¿™ä¸ªå¯¹è±¡ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">require</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get</span><span class="o">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">Symbol</span> <span class="o">!==</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;Module&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&#34;__esModule&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">webpackJsonpCallback</span><span class="p">([</span><span class="nx">chunkIds</span><span class="p">,</span> <span class="nx">moreModules</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">resolves</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">chunkIds</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">chunkId</span> <span class="o">=</span> <span class="nx">chunkIds</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resolves</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">][</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">moduleId</span> <span class="k">in</span> <span class="nx">moreModules</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">moreModules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//ä¾æ¬¡å–å‡ºpromiseçš„resolveæ–¹æ³•ï¼Œè®©å®ƒå¯¹åº”çš„promiseå˜æˆæˆåŠŸæ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">while</span> <span class="p">(</span><span class="nx">resolves</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resolves</span><span class="p">.</span><span class="nx">shift</span><span class="p">()();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//å·²ç»å®‰è£…è¿‡çš„ï¼Œæˆ–è€…è¯´å·²ç»åŠ è½½å¥½çš„ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1">//keyæ˜¯ä»£ç å—çš„åå­—ï¼Œå€¼æ˜¯ä»£ç å—çš„çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1">//mainå°±æ˜¯é»˜è®¤ä»£ç å—çš„åç§° 0è¡¨ç¤ºå·²ç»åŠ è½½å®Œæˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">var</span> <span class="nx">installedChunks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">main</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å½“ä¸€ä¸ªä»£ç å—å®ƒçš„å€¼æ˜¯ä¸€ä¸ªæ•°ç»„çš„æ—¶å€™è¡¨ç¤ºæ­¤ä»£ç å—å¯¹åº”çš„JSæ–‡ä»¶æ­£åœ¨åŠ è½½ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//&#39;src_hello_js&#39;:[resolve,reject,promise]=&gt;0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span> <span class="c1">// è¿™ä¸ªå€¼å–çš„æ˜¯webpackæ–‡ä»¶ä¸­outputé…ç½®é¡¹ä¸­çš„publicPathçš„å€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">require</span><span class="p">.</span><span class="nx">u</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">chunkId</span> <span class="o">+</span> <span class="s2">&#34;.js&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;script&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//jsonp é€šè¿‡JSONPçš„æ–¹å¼åŠ è½½chunkIdå¯¹åº”çš„JSæ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªpromiseæ”¾åˆ°promisesæ•°ç»„é‡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">require</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">,</span> <span class="nx">promises</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">installedChunkData</span> <span class="o">=</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">installedChunkData</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">promise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">installedChunkData</span> <span class="o">=</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">installedChunkData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//installedChunkData=[resolve,reject,promise]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">promises</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">promise</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">require</span><span class="p">.</span><span class="nx">p</span> <span class="o">+</span> <span class="nx">require</span><span class="p">.</span><span class="nx">u</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">l</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">promises</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">j</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">,</span> <span class="nx">promises</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span><span class="nx">promises</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">chunkLoadingGlobal</span> <span class="o">=</span> <span class="p">(</span><span class="nb">window</span><span class="p">[</span><span class="s2">&#34;webpackChunk_2_bundle&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">chunkLoadingGlobal</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="nx">webpackJsonpCallback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">require</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">&#34;src_hello_js&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">require</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">require</span><span class="p">,</span> <span class="s2">&#34;./src/hello.js&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="k">default</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//ä»£ç å—å…¶å®å°±æ¨¡å—çš„é›†åˆ
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><strong>src_hello_js.js</strong>ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="s2">&#34;webpackChunk_2_bundle&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="nx">self</span><span class="p">[</span><span class="s2">&#34;webpackChunk_2_bundle&#34;</span><span class="p">]</span> <span class="o">||</span> <span class="p">[]).</span><span class="nx">push</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s2">&#34;src_hello_js&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;./src/hello.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">require</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">exports</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">require</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">_DEFAULT_EXPORT__</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">_DEFAULT_EXPORT__</span> <span class="o">=</span> <span class="s2">&#34;hello&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">]);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»£ç å—ï¼šwebpack ä¸­æ¯ä¸ªå…¥å£éƒ½ä¼šå¯¹åº”ä¸€ä¸ªä»£ç å—ï¼Œä»£ç å—åˆæ˜¯è®¸å¤šæ¨¡å—çš„é›†åˆã€‚ä½†æ˜¯ä»£ç å—åˆä¸å±€é™äºä»¥å…¥å£ entry æ¥ä½œä¸ºåŒºåˆ†æ¡ä»¶ã€‚ äº‹å®ä¸Šæ¯ä¸ª entry å’Œå¼‚æ­¥åŠ è½½çš„æ¨¡å—éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªä»£ç å—ï¼Œè¯¥ä»£ç å—ç”±è¯¥å…¥å£æ–‡ä»¶åŠå®ƒçš„ç›´æ¥å’Œé—´æ¥ä¾èµ–çš„æ¨¡å—æ‰€ç»„æˆã€‚ï¼ˆchunkï¼‰ æ¯ä¸ª chunk éƒ½ä¼šæœ‰ä¸€ä¸ª idã€‚ id å¯èƒ½æ˜¯ entry å…¥å£ä¸­è®¾ç½®çš„åå­—ï¼Œä¹Ÿèƒ½æ˜¯é»˜è®¤ç”Ÿäº§çš„åå­—ã€‚</p>
<p>æ‡’åŠ è½½ä¸€å®šæ„å‘³ç€ä»£ç åˆ†å‰²ã€‚</p>
<h2 id="ast">AST
</h2><ul>
<li>æŠ½è±¡è¯­æ³•æ ‘ï¼ˆAbstract Syntax Treeï¼ŒASTï¼‰æ˜¯æºä»£ç ç»“æ„çš„ä¸€ç§æŠ½è±¡è¡¨ç¤º</li>
<li>å®ƒä»¥æ ‘çŠ¶çš„å½¢å¼è¡¨ç°ç¼–ç¨‹è¯­è¨€çš„ä»£ç ç»“æ„ï¼Œæ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹éƒ½è¡¨ç¤ºæºä»£ç ä¸­çš„ä¸€ç§ç»“æ„</li>
<li>åŸç†éƒ½æ˜¯é€šè¿‡<code>JavaScript Parser</code>æŠŠä»£ç è½¬åŒ–ä¸ºä¸€é¢—æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œè¿™é¢—æ ‘å®šä¹‰äº†ä»£ç çš„ç»“æ„ï¼Œé€šè¿‡æ“ä½œè¿™é¢—æ ‘ï¼Œå¯ä»¥ç²¾å‡†çš„å®šä½åˆ°å£°æ˜è¯­å¥ã€èµ‹å€¼è¯­å¥ã€è¿ç®—è¯­å¥ç­‰ï¼Œå®ç°å¯¹ä»£ç çš„åˆ†æã€ä¼˜åŒ–ã€å˜æ›´ç­‰æ“ä½œ</li>
</ul>
<h3 id="ç”¨é€”">ç”¨é€”
</h3><ul>
<li>ä»£ç è¯­æ³•ã€é£æ ¼æ£€æŸ¥ï¼Œä»£ç çš„æ ¼å¼åŒ–ã€é«˜äº®ã€é”™è¯¯æç¤ºã€è‡ªåŠ¨è¡¥å…¨ç­‰</li>
<li>ä¼˜åŒ–å˜æ›´ä»£ç ï¼Œæ”¹å˜ä»£ç ç»“æ„ä½¿è¾¾åˆ°æƒ³è¦çš„ç»“æ„</li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/ast.jpg"
	
	
	
	loading="lazy"
	
		alt="ast"
	
	
></p>
<p>ç¬¬ä¸€æ­¥ï¼šè¯æ³•è§£æï¼Œæ‹†æˆæœ€å°è¯æ³•å•å…ƒï¼Œä¸€ä¸ªä¸ªåˆ†è¯ï¼ˆtokenï¼‰éƒ½æœ‰è‡ªå·±çš„å«ä¹‰ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šè¯­æ³•åˆ†æï¼Œç”Ÿæˆ astï¼Œç¨‹åºç”±ä¸€è¡Œè¡Œä»£ç ç»„æˆï¼Œæ¯è¡Œä»£ç éƒ½æ˜¯ body ä¸­çš„æŸä¸ªå…ƒç´ ï¼Œbody æœ¬èº«æ˜¯æ•°ç»„æ ¼å¼ï¼Œæ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªç±»å‹ï¼ˆå¦‚ï¼šå˜é‡å£°æ˜ï¼‰æ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><code>JavaScript Parser</code>æ˜¯æŠŠ JavaScript æºç è½¬åŒ–ä¸ºæŠ½è±¡è¯­æ³•æ ‘çš„è§£æå™¨</p>
<p>åœ¨ JavaScript ç¤¾åŒºä¸­ï¼Œæœ‰å‡ ä¸ªå¸¸ç”¨çš„ JavaScript è§£æå™¨ï¼ˆParserï¼‰ã€‚ä»¥ä¸‹æ˜¯å…¶ä¸­ä¸€äº›å¸¸è§çš„ JavaScript è§£æå™¨ï¼š</p>
<ol>
<li>Acorn: ä¸€ä¸ªè½»é‡ã€å¿«é€Ÿçš„ JavaScript è§£æå™¨ï¼Œå®Œå…¨ç”± js ä»£ç å®ç°ï¼Œå®ƒä»¥å¯æ‰©å±•çš„æ–¹å¼è§£æ JavaScript ä»£ç ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚Acorn è¢«å¹¿æ³›ç”¨äºå„ç§å·¥å…·å’Œé¡¹ç›®ä¸­ï¼ˆwebpackã€rollup ä¸­ï¼‰ã€‚</li>
<li>Esprima: Esprima å¯ä»¥å°† JavaScript ä»£ç è§£æä¸ºæ ‡å‡†çš„ ECMAScript 5.1 è¯­æ³•æ ‘ã€‚Esprima ä¹Ÿæ”¯æŒæ‰©å±•ï¼Œå¯ä»¥é€šè¿‡æ’ä»¶æœºåˆ¶å®ç°å¯¹ ECMAScript 6+ çš„è§£æã€‚</li>
<li>Babel Parser: Babel Parserï¼ˆä»¥å‰ç§°ä¸º Babylonï¼‰æ˜¯ Babel é¡¹ç›®ä¸­ä½¿ç”¨çš„ JavaScript è§£æå™¨ã€‚å®ƒæ”¯æŒè§£ææœ€æ–°çš„ ECMAScript è§„èŒƒï¼Œå¹¶ä¸”ä¸ Babel çš„è½¬æ¢å·¥å…·é“¾ç´§å¯†é›†æˆã€‚</li>
<li>Shift Parser: Shift Parser æ˜¯ä¸€ä¸ªå¯æ‰©å±•çš„ ECMAScript è§£æå™¨æ¡†æ¶ï¼Œå®ƒæä¾›äº†ä¸€ç»„ API å’Œå·¥å…·ï¼Œç”¨äºæ„å»ºè‡ªå®šä¹‰çš„ JavaScript è§£æå™¨ã€‚Shift Parser çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªé€šç”¨çš„è§£æå™¨æ¡†æ¶ï¼Œé€‚ç”¨äºå„ç§ ECMAScript ç‰ˆæœ¬å’Œè¯­è¨€æ‰©å±•ã€‚</li>
</ol>
<h3 id="ast-èŠ‚ç‚¹">AST èŠ‚ç‚¹
</h3><ul>
<li><a class="link" href="https://github.com/estree/estree"  target="_blank" rel="noopener"
    >estree</a>è§„èŒƒ</li>
<li><a class="link" href="https://github.com/babel/babel/blob/main/packages/babel-parser/ast/spec.md"  target="_blank" rel="noopener"
    >spec.md</a></li>
<li><a class="link" href="https://astexplorer.net/"  target="_blank" rel="noopener"
    >astexplorer</a></li>
<li>AST èŠ‚ç‚¹ï¼ˆnodeï¼‰
<ul>
<li>File æ–‡ä»¶</li>
<li>Program ç¨‹åº</li>
<li>Literal å­—é¢é‡ï¼Œä»£è¡¨ä¸€ä¸ªå€¼ï¼Œ NumericLiteralï¼ˆæ•°å­—ï¼‰ StringLiteralï¼ˆå­—ç¬¦ä¸²ï¼‰ BooleanLiteralï¼ˆå¸ƒå°”ï¼‰</li>
<li>Identifier æ ‡è¯†ç¬¦ï¼Œä»£è¡¨ä¸€ä¸ªå˜é‡</li>
<li>Statement è¯­å¥</li>
<li>Declaration å£°æ˜è¯­å¥</li>
<li>Expression è¡¨è¾¾å¼</li>
<li>Class ç±»</li>
<li>VariableDeclaration å˜é‡å£°æ˜ï¼Œä¸€ä¸ª VariableDeclaration ä¸­å¯èƒ½å­˜åœ¨å¤šä¸ª VariableDeclaratorï¼Œä¸€è¡Œå£°æ˜å¤šä¸ªå˜é‡</li>
<li>VariableDeclarator</li>
<li>FunctionDeclarationï¼Œå‡½æ•°å£°æ˜</li>
<li>BlockStatementï¼Œå—çº§è¯­å¥</li>
</ul>
</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">ast</span> <span class="o">=</span> <span class="s2">&#34;test&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ js ä»£ç ä½¿ç”¨ acorn è§£æå™¨ç”Ÿæˆçš„ ast å†…å®¹å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;Program&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;start&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;end&#34;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;body&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;VariableDeclaration&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;start&#34;</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;end&#34;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;declarations&#34;</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;VariableDeclarator&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;start&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;end&#34;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;id&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;Identifier&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;start&#34;</span><span class="o">:</span> <span class="mi">4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;end&#34;</span><span class="o">:</span> <span class="mi">7</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;name&#34;</span><span class="o">:</span> <span class="s2">&#34;ast&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;init&#34;</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;type&#34;</span><span class="o">:</span> <span class="s2">&#34;Literal&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;start&#34;</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;end&#34;</span><span class="o">:</span> <span class="mi">16</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;value&#34;</span><span class="o">:</span> <span class="s2">&#34;test&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;raw&#34;</span><span class="o">:</span> <span class="s2">&#34;&#39;test&#39;&#34;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;kind&#34;</span><span class="o">:</span> <span class="s2">&#34;var&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;sourceType&#34;</span><span class="o">:</span> <span class="s2">&#34;module&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="éå†è¯­æ³•æ ‘">éå†è¯­æ³•æ ‘
</h3><p>AST<strong>æ˜¯æ·±åº¦ä¼˜å…ˆéå†</strong></p>
<p>é€‰ç”¨ esprima è§£æå™¨åŠå…¶é…å¥—å·¥å…·ã€‚</p>
<p>å®ƒä»¬æä¾›äº†å¯¹ Esprima è§£æå™¨çš„è¡¥å……å’Œæ‰©å±•åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¸ Esprima è§£æå™¨ç›¸å…³çš„å¸¸è§å·¥å…·åº“ï¼š</p>
<ol>
<li>Escodegen: Escodegen æ˜¯ä¸€ä¸ª JavaScript ä»£ç ç”Ÿæˆå™¨ï¼Œå®ƒä½¿ç”¨ esprima è§£æå™¨ç”Ÿæˆçš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ï¼Œå°†å…¶è½¬æ¢å›ç­‰æ•ˆçš„ JavaScript ä»£ç ã€‚Escodegen å…è®¸ä½ æ ¹æ®éœ€è¦è‡ªå®šä¹‰ç”Ÿæˆçš„ä»£ç çš„æ ¼å¼å’Œé£æ ¼ã€‚</li>
<li>Esquery: Esquery æ˜¯ä¸€ä¸ªç”¨äºåœ¨ JavaScript AST ä¸­æ‰§è¡Œ CSS é£æ ¼æŸ¥è¯¢çš„åº“ã€‚å®ƒå…è®¸ä½ ä½¿ç”¨é€‰æ‹©å™¨è¯­æ³•ä» JavaScript AST ä¸­é€‰æ‹©å’Œæå–ç‰¹å®šçš„èŠ‚ç‚¹ã€‚Esquery å¯ä»¥ä¸ Esprima è§£æå™¨ä¸€èµ·ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨ AST ä¸Šæ‰§è¡Œé«˜çº§çš„æŸ¥è¯¢æ“ä½œã€‚</li>
<li>Esprima-walk: Esprima-walk æ˜¯ä¸€ä¸ªç”¨äºéå†å’Œè®¿é—® JavaScript AST çš„å·¥å…·åº“ã€‚å®ƒæä¾›äº†ä¸€ç»„ç®€å•çš„ APIï¼Œä½¿ä½ èƒ½å¤Ÿè½»æ¾åœ°è®¿é—® AST ä¸­çš„èŠ‚ç‚¹ï¼Œå¹¶æ‰§è¡Œè‡ªå®šä¹‰çš„æ“ä½œæˆ–åˆ†æã€‚</li>
<li>Estraverse: Estraverse æ˜¯ä¸€ä¸ª JavaScript AST éå†å™¨ï¼Œå®ƒæä¾›äº†å¯¹ AST çš„æ·±åº¦ä¼˜å…ˆéå†åŠŸèƒ½ã€‚å®ƒå…è®¸ä½ åœ¨éå† AST æ—¶æ‰§è¡Œè‡ªå®šä¹‰çš„å›è°ƒå‡½æ•°ï¼Œå¹¶å¯¹èŠ‚ç‚¹è¿›è¡Œä¿®æ”¹æˆ–åˆ†æã€‚</li>
<li>Eslevels: Eslevels æ˜¯ä¸€ä¸ªç”¨äºé™æ€åˆ†æå’Œæå– JavaScript ä»£ç ä¸­å£°æ˜çš„å˜é‡å’Œå‡½æ•°çš„åº“ã€‚å®ƒä½¿ç”¨ Esprima è§£æå™¨è§£æ JavaScript ä»£ç ï¼Œå¹¶ç”Ÿæˆä¸€ç»„å£°æ˜èŠ‚ç‚¹ï¼Œä½¿ä½ èƒ½å¤Ÿåˆ†æä»£ç ä¸­çš„å˜é‡ä½œç”¨åŸŸå’Œä¾èµ–å…³ç³»ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install esprima estraverse escodegen -S
</span></span></code></pre></td></tr></table>
</div>
</div><p>esprimaï¼šæŠŠ JS æºä»£ç è½¬æˆ AST è¯­æ³•æ ‘</p>
<p>estraverseï¼šéå†è¯­æ³•æ ‘ï¼Œä¿®æ”¹æ ‘ä¸Šçš„èŠ‚ç‚¹</p>
<p>escodegenï¼šæŠŠ AST è¯­æ³•æ ‘é‡æ–°è½¬æ¢æˆä»£ç </p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">esprima</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;esprima&#34;</span><span class="p">);</span> <span class="c1">//æŠŠJSæºä»£ç è½¬æˆASTè¯­æ³•æ ‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">estraverse</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;estraverse&#34;</span><span class="p">);</span> <span class="c1">///éå†è¯­æ³•æ ‘,é€šè¿‡æ’ä»¶ä¿®æ”¹æ ‘ä¸Šçš„èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">escodegen</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;escodegen&#34;</span><span class="p">);</span> <span class="c1">//æŠŠASTè¯­æ³•æ ‘é‡æ–°è½¬æ¢æˆä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">code</span> <span class="o">=</span> <span class="sb">`function ast(){}`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">ast</span> <span class="o">=</span> <span class="nx">esprima</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">indent</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">padding</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="s2">&#34; &#34;</span><span class="p">.</span><span class="nx">repeat</span><span class="p">(</span><span class="nx">indent</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// æ·±åº¦ä¼˜å…ˆéå†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">estraverse</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">enter</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">padding</span><span class="p">()</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">&#34;è¿›å…¥&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&#34;FunctionDeclaration&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;newAst&#34;</span><span class="p">;</span> <span class="c1">// ä¿®æ”¹å‡½æ•°åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">indent</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">leave</span><span class="p">(</span><span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">indent</span> <span class="o">-=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">padding</span><span class="p">()</span> <span class="o">+</span> <span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">&#34;ç¦»å¼€&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">escodegen</span><span class="p">.</span><span class="nx">generate</span><span class="p">(</span><span class="nx">ast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">// é‡æ–°ç”Ÿæˆä»£ç 
</span></span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">Programè¿›å…¥
</span></span><span class="line"><span class="cl">  FunctionDeclarationè¿›å…¥
</span></span><span class="line"><span class="cl">    Identifierè¿›å…¥
</span></span><span class="line"><span class="cl">    Identifierç¦»å¼€
</span></span><span class="line"><span class="cl">    BlockStatementè¿›å…¥
</span></span><span class="line"><span class="cl">    BlockStatementç¦»å¼€
</span></span><span class="line"><span class="cl">  FunctionDeclarationç¦»å¼€
</span></span><span class="line"><span class="cl">Programç¦»å¼€
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Program&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;body&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;FunctionDeclaration&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;Identifier&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;ast&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;params&#34;</span><span class="p">:</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;body&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;BlockStatement&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&#34;body&#34;</span><span class="p">:</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;generator&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;expression&#34;</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;async&#34;</span><span class="p">:</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;sourceType&#34;</span><span class="p">:</span> <span class="s2">&#34;module&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Babel Parser å’Œ Esprima æ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ JavaScript è§£æå™¨ï¼Œå®ƒä»¬å…·æœ‰ç›¸ä¼¼çš„ç›®æ ‡ï¼Œå³è§£æ JavaScript ä»£ç å¹¶ç”Ÿæˆç›¸åº”çš„æŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰ã€‚å°½ç®¡å®ƒä»¬æœ‰ç›¸ä¼¼çš„åŠŸèƒ½ï¼Œä½†å®ƒä»¬æ˜¯ç”±ä¸åŒçš„å›¢é˜Ÿå¼€å‘å’Œç»´æŠ¤çš„ï¼Œå¹¶ä¸”æœ‰ä¸€äº›åŒºåˆ«ã€‚</p>
<p>ä¸‹é¢æ˜¯ Babel Parser å’Œ Esprima ä¹‹é—´çš„ä¸€äº›å…³ç³»å’ŒåŒºåˆ«ï¼š</p>
<ol>
<li>ä»£ç åŸºç¡€ï¼šBabel Parser æ˜¯ Babel é¡¹ç›®ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒæ˜¯ä½œä¸º Babel çš„é»˜è®¤è§£æå™¨è€Œå¼€å‘çš„ã€‚å®ƒçš„ä»£ç åŸºç¡€æ˜¯åŸºäº Babylon é¡¹ç›®ï¼Œè¯¥é¡¹ç›®åœ¨åæ¥æ”¹åä¸º Babel Parserã€‚è€Œ Esprima æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„é¡¹ç›®ï¼Œç”±ç‹¬ç«‹çš„å›¢é˜Ÿè¿›è¡Œå¼€å‘å’Œç»´æŠ¤ã€‚</li>
<li>ECMAScript ç‰ˆæœ¬æ”¯æŒï¼šBabel Parser çš„è®¾è®¡ç›®æ ‡æ˜¯æ”¯æŒæœ€æ–°çš„ ECMAScript è¯­æ³•å’ŒåŠŸèƒ½ï¼ŒåŒ…æ‹¬ ECMAScript 2015+ çš„ç‰¹æ€§ï¼Œä»¥åŠå°šæœªè¢«ä¸»æµæµè§ˆå™¨å®Œå…¨æ”¯æŒçš„ææ¡ˆã€‚Esprima åˆ™ä¸»è¦æ”¯æŒ ECMAScript 5.1 çš„è¯­æ³•ï¼Œè™½ç„¶å®ƒä¹Ÿå¯ä»¥é€šè¿‡æ’ä»¶è¿›è¡Œæ‰©å±•ä»¥æ”¯æŒ ECMAScript 6+ çš„ç‰¹æ€§ã€‚</li>
<li>æ’ä»¶ç”Ÿæ€ç³»ç»Ÿï¼šBabel Parser é…åˆ Babel çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿä½¿ç”¨ï¼Œè¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ·»åŠ å’Œä½¿ç”¨å„ç§è½¬æ¢å’Œæ’ä»¶æ¥ä¿®æ”¹æˆ–è½¬æ¢ JavaScript ä»£ç ã€‚Esprima æœ¬èº«å¹¶æ²¡æœ‰æä¾›ç±»ä¼¼çš„æ’ä»¶ç³»ç»Ÿï¼Œä½†å¯ä»¥ä¸å…¶ä»–å·¥å…·åº“ç»“åˆä½¿ç”¨ï¼Œå®ç°ç±»ä¼¼çš„åŠŸèƒ½ã€‚</li>
</ol>
<h2 id="babel">Babel
</h2><p>å·¥ä½œè¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p>Parse(è§£æ) å°†æºä»£ç è½¬æ¢æˆæŠ½è±¡è¯­æ³•æ ‘ï¼Œæ ‘ä¸Šæœ‰å¾ˆå¤šçš„<a class="link" href="https://github.com/estree/estree"  target="_blank" rel="noopener"
    >estree èŠ‚ç‚¹</a></p>
</li>
<li>
<p>Transform(è½¬æ¢) å¯¹æŠ½è±¡è¯­æ³•æ ‘è¿›è¡Œè½¬æ¢</p>
</li>
<li>
<p>Generate(ä»£ç ç”Ÿæˆ) å°†ä¸Šä¸€æ­¥ç»è¿‡è½¬æ¢è¿‡çš„æŠ½è±¡è¯­æ³•æ ‘ç”Ÿæˆæ–°çš„ä»£ç </p>
</li>
</ul>
<img src="http://img.zhufengpeixun.com/ast-compiler-flow.jpg" alt="ast-compiler-flow.jpg" style="zoom:200%;" />
<h3 id="babel-æ’ä»¶">babel æ’ä»¶
</h3><ul>
<li>
<p><a class="link" href="https://github.com/babel/babel/tree/master/packages/@babel/parser"  target="_blank" rel="noopener"
    >@babel/parser</a> å¯ä»¥æŠŠæºç è½¬æ¢æˆ AST</p>
</li>
<li>
<p><a class="link" href="https://www.npmjs.com/package/babel-traverse"  target="_blank" rel="noopener"
    >@babel/traverse</a>ç”¨äºå¯¹ AST çš„éå†ï¼Œç»´æŠ¤äº†æ•´æ£µæ ‘çš„çŠ¶æ€ï¼Œå¹¶ä¸”è´Ÿè´£æ›¿æ¢ã€ç§»é™¤å’Œæ·»åŠ èŠ‚ç‚¹</p>
</li>
<li>
<p><a class="link" href="https://github.com/babel/babel/tree/master/packages/@babel/generate"  target="_blank" rel="noopener"
    >@babel/generate</a> å¯ä»¥æŠŠ AST ç”Ÿæˆæºç ï¼ŒåŒæ—¶ç”Ÿæˆ sourcemap</p>
</li>
<li>
<p><a class="link" href="https://github.com/babel/babel/tree/master/packages/babel-types"  target="_blank" rel="noopener"
    >@babel/types</a> ç”¨äº AST èŠ‚ç‚¹çš„å·¥å…·åº“, å®ƒåŒ…å«äº†æ„é€ èŠ‚ç‚¹ã€éªŒè¯èŠ‚ç‚¹ç±»å‹ä»¥åŠå˜æ¢ AST èŠ‚ç‚¹çš„æ–¹æ³•ï¼Œå¸®åŠ©ä¿®æ”¹è¯­æ³•æ ‘</p>
</li>
<li>
<p><a class="link" href="https://www.npmjs.com/package/@babel/template"  target="_blank" rel="noopener"
    >@babel/template</a>å¯ä»¥ç®€åŒ– AST çš„åˆ›å»ºé€»è¾‘ï¼Œå¿«é€Ÿåˆ›å»ºç»“ç‚¹</p>
</li>
<li>
<p><a class="link" href="https://www.npmjs.com/package/@babel/code-frame"  target="_blank" rel="noopener"
    >@babel/code-frame</a>å¯ä»¥æ‰“å°ä»£ç ä½ç½®</p>
</li>
<li>
<p><a class="link" href="https://www.npmjs.com/package/@babel/core"  target="_blank" rel="noopener"
    >@babel/core</a> Babel çš„ç¼–è¯‘å™¨ï¼Œæ ¸å¿ƒ API éƒ½åœ¨è¿™é‡Œé¢ï¼Œæ¯”å¦‚å¸¸è§çš„ transformã€parseï¼Œå¹¶å®ç°äº†æ’ä»¶åŠŸèƒ½ï¼Œåœ¨ Babel è½¬æ¢è¿‡ç¨‹ä¸­ï¼Œ<code>@babel/parser</code> è¢« <code>@babel/core</code> ä½¿ç”¨ï¼Œç”¨äºè§£æè¾“å…¥çš„ JavaScript ä»£ç ã€‚<code>@babel/parser</code> å°†ä»£ç è§£æä¸º ASTï¼Œå¹¶å°† AST ä¼ é€’ç»™ <code>@babel/core</code>ï¼Œåè€…åœ¨ AST ä¸Šåº”ç”¨å„ç§ Babel æ’ä»¶å’Œè½¬æ¢è§„åˆ™ï¼Œæ‰§è¡Œä»£ç è½¬æ¢æ“ä½œã€‚å› æ­¤ï¼Œ<code>@babel/parser</code> æ˜¯ <code>@babel/core</code> çš„ä¸€ä¸ªé‡è¦ä¾èµ–æ¨¡å—ï¼Œç”¨äºæä¾›ä»£ç è§£æçš„åŠŸèƒ½ã€‚</p>
</li>
<li>
<p><a class="link" href="https://www.npmjs.com/package/babylon"  target="_blank" rel="noopener"
    >babylon</a> Babel çš„è§£æå™¨ï¼Œä»¥å‰çš„ babel parser,æ˜¯åŸºäº acorn æ‰©å±•è€Œæ¥ï¼Œæ‰©å±•äº†å¾ˆå¤šè¯­æ³•,å¯ä»¥æ”¯æŒ es2020ã€jsxã€typescript ç­‰è¯­æ³•</p>
</li>
<li>
<p><a class="link" href="https://babeljs.io/docs/en/next/babel-types.html"  target="_blank" rel="noopener"
    >babel-types-api</a></p>
</li>
<li>
<p><a class="link" href="https://github.com/brigand/babel-plugin-handbook/blob/master/translations/zh-Hans/README.md#asts"  target="_blank" rel="noopener"
    >Babel æ’ä»¶æ‰‹å†Œ</a></p>
</li>
<li>
<p><a class="link" href="https://babeljs.io/en/repl.html"  target="_blank" rel="noopener"
    >babeljs.io</a> babel å¯è§†åŒ–ç¼–è¯‘å™¨</p>
</li>
<li>
<p><a class="link" href="https://babeljs.io/docs/en/babel-types"  target="_blank" rel="noopener"
    >babel-types</a></p>
</li>
<li>
<p><a class="link" href="https://github.com/babel/babel/blob/main/packages/babel-types/src/ast-types/generated/index.ts#L2489-L2535"  target="_blank" rel="noopener"
    >ç±»å‹åˆ«å</a></p>
</li>
<li>
<p><a class="link" href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types"  target="_blank" rel="noopener"
    >DefinitelyTyped</a></p>
</li>
</ul>
<h2 id="ast-çš„å‰ç½®çŸ¥è¯†">AST çš„å‰ç½®çŸ¥è¯†
</h2><h3 id="è®¿é—®å™¨æ¨¡å¼">è®¿é—®å™¨æ¨¡å¼
</h3><ul>
<li>è®¿é—®è€…æ¨¡å¼ Visitor å¯¹äºæŸä¸ªå¯¹è±¡æˆ–è€…ä¸€ç»„å¯¹è±¡ï¼Œä¸åŒçš„è®¿é—®è€…ï¼Œäº§ç”Ÿçš„ç»“æœä¸åŒï¼Œæ‰§è¡Œæ“ä½œä¹Ÿä¸åŒ</li>
<li><strong>Visitor çš„å¯¹è±¡ä¸­å®šä¹‰äº†ç”¨äº AST ä¸­è·å–å…·ä½“èŠ‚ç‚¹çš„æ–¹æ³•</strong></li>
<li><strong>Visitor ä¸ŠæŒ‚è½½ä»¥èŠ‚ç‚¹çš„ <code>type</code> å‘½åçš„æ–¹æ³•ï¼Œå½“éå† AST çš„æ—¶å€™ï¼Œå¦‚æœåŒ¹é…ä¸Š typeï¼Œå°±ä¼šæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•</strong></li>
<li><strong>è¯´ç™½äº† Visitor å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡å¯ä»¥æä¾›è®¸å¤šä¸åŒçš„æ–¹æ³•ï¼ˆè¿™äº›æ–¹æ³•çš„åå­—å°±æ˜¯ AST ä¸­ä¸åŒèŠ‚ç‚¹çš„åå­—ï¼‰ï¼Œä¾›ç»™ä¸åŒçš„è®¿é—®è€…è°ƒç”¨ä¸åŒçš„æ–¹æ³•</strong></li>
<li>æ’ä»¶å°±æ˜¯ä¸€ä¸ªè®¿é—®å™¨å¯¹è±¡ï¼Œæ¯ä¸ªæ’ä»¶åªå…³æ³¨ä¸€ä¸ª AST ä¸­ä¸åŒçš„èŠ‚ç‚¹ç±»å‹ï¼Œå¹¶å¯¹è¿™äº›å…³æ³¨çš„èŠ‚ç‚¹è¿›è¡Œæ“ä½œ</li>
</ul>
<p>javascript ä¸­çš„å¦ä¸€ç§è®¿é—®å™¨æ¨¡å¼ä»£ç ä¾‹å­ï¼š</p>
<p>è®¿é—®å™¨æ¨¡å¼ï¼ˆAccessor Patternï¼‰é€šè¿‡å®šä¹‰è®¿é—®å™¨æ–¹æ³•æ¥<strong>å°è£…å¯¹å¯¹è±¡å±æ€§çš„è®¿é—®å’Œä¿®æ”¹æ“ä½œ</strong>ã€‚è®¿é—®å™¨æ¨¡å¼æä¾›äº†ä¸€ç§é—´æ¥è®¿é—®å¯¹è±¡å±æ€§çš„æ–¹å¼ï¼Œä»¥ä¾¿åœ¨è®¿é—®å’Œä¿®æ”¹å±æ€§æ—¶å¯ä»¥æ‰§è¡Œé¢å¤–çš„é€»è¾‘æˆ–è¿›è¡ŒéªŒè¯ã€‚</p>
<p>åœ¨è®¿é—®å™¨æ¨¡å¼ä¸­ï¼Œæœ‰ä¸¤ç§ç±»å‹çš„è®¿é—®å™¨æ–¹æ³•ï¼š</p>
<ol>
<li>Getterï¼ˆè·å–å™¨ï¼‰ï¼šGetter æ–¹æ³•ç”¨äºè·å–å¯¹è±¡å±æ€§çš„å€¼ã€‚å®ƒé€šè¿‡å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è®¿é—®å¯¹è±¡å±æ€§ï¼Œå¹¶åœ¨è®¿é—®æ—¶æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ã€‚Getter æ–¹æ³•é€šå¸¸ä»¥<code>get</code>å…³é”®å­—ä¸ºå‰ç¼€ï¼Œåé¢è·Ÿç€å±æ€§åï¼Œä¾‹å¦‚<code>get propertyName()</code>ã€‚</li>
<li>Setterï¼ˆè®¾ç½®å™¨ï¼‰ï¼šSetter æ–¹æ³•ç”¨äºè®¾ç½®å¯¹è±¡å±æ€§çš„å€¼ã€‚å®ƒé€šè¿‡å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥ä¿®æ”¹å¯¹è±¡å±æ€§ï¼Œå¹¶åœ¨ä¿®æ”¹æ—¶æ‰§è¡Œç‰¹å®šçš„é€»è¾‘ã€‚Setter æ–¹æ³•é€šå¸¸ä»¥<code>set</code>å…³é”®å­—ä¸ºå‰ç¼€ï¼Œåé¢è·Ÿç€å±æ€§åï¼Œä¾‹å¦‚<code>set propertyName(value)</code>ã€‚</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">person</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">firstName</span><span class="o">:</span> <span class="s2">&#34;John&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">lastName</span><span class="o">:</span> <span class="s2">&#34;Doe&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">get</span> <span class="nx">fullName</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">+</span> <span class="s2">&#34; &#34;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">set</span> <span class="nx">fullName</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">value</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">firstName</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">lastName</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">fullName</span><span class="p">);</span> <span class="c1">// è¾“å‡º: &#34;John Doe&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="nx">person</span><span class="p">.</span><span class="nx">fullName</span> <span class="o">=</span> <span class="s2">&#34;Jane Smith&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">firstName</span><span class="p">);</span> <span class="c1">// è¾“å‡º: &#34;Jane&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">person</span><span class="p">.</span><span class="nx">lastName</span><span class="p">);</span> <span class="c1">// è¾“å‡º: &#34;Smith&#34;
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="path">path
</h3><p>è¯­æ³•æ ‘ä¸Šçš„æ¯ä¸ªèŠ‚ç‚¹ä¼šå¯¹åº”ä¸€ä¸ªè·¯å¾„ï¼ˆpath å’Œ node ä¸€ä¸€å¯¹åº”ï¼‰ã€‚<a class="link" href="https://github.com/babel/babel/blob/main/packages/babel-traverse/src/path/index.ts"  target="_blank" rel="noopener"
    >path</a></p>
<p>è·¯å¾„å¯¹è±¡ä¸Šçš„å±æ€§æˆ–è€…æ–¹æ³•ï¼š</p>
<ul>
<li>node å½“å‰ AST èŠ‚ç‚¹</li>
<li>parent çˆ¶ AST èŠ‚ç‚¹</li>
<li>parentPath çˆ¶ AST èŠ‚ç‚¹çš„è·¯å¾„</li>
<li>scope ä½œç”¨åŸŸ</li>
<li>get(key) è·å–æŸä¸ªå±æ€§çš„ path</li>
<li>set(key, node) è®¾ç½®æŸä¸ªå±æ€§</li>
<li>is ç±»å‹(opts) åˆ¤æ–­å½“å‰èŠ‚ç‚¹æ˜¯å¦æ˜¯æŸä¸ªç±»å‹</li>
<li>find(callback) ä»å½“å‰èŠ‚ç‚¹ä¸€ç›´å‘ä¸Šæ‰¾åˆ°æ ¹èŠ‚ç‚¹(åŒ…æ‹¬è‡ªå·±)</li>
<li>findParent(callback)ä»å½“å‰èŠ‚ç‚¹ä¸€ç›´å‘ä¸Šæ‰¾åˆ°æ ¹èŠ‚ç‚¹(ä¸åŒ…æ‹¬è‡ªå·±)</li>
<li>insertBefore(nodes) åœ¨ä¹‹å‰æ’å…¥èŠ‚ç‚¹</li>
<li>insertAfter(nodes) åœ¨ä¹‹åæ’å…¥èŠ‚ç‚¹</li>
<li>replaceWith(replacement) ç”¨æŸä¸ªèŠ‚ç‚¹æ›¿æ¢å½“å‰èŠ‚ç‚¹</li>
<li>replaceWithMultiple(nodes) ç”¨å¤šä¸ªèŠ‚ç‚¹æ›¿æ¢å½“å‰èŠ‚ç‚¹</li>
<li>replaceWithSourceString(replacement) æŠŠæºä»£ç è½¬æˆ AST èŠ‚ç‚¹å†æ›¿æ¢å½“å‰èŠ‚ç‚¹</li>
<li>remove() åˆ é™¤å½“å‰èŠ‚ç‚¹</li>
<li>traverse(visitor, state) <strong>éå†å½“å‰èŠ‚ç‚¹çš„å­èŠ‚ç‚¹,ç¬¬ 1 ä¸ªå‚æ•°æ˜¯èŠ‚ç‚¹ï¼Œç¬¬ 2 ä¸ªå‚æ•°æ˜¯ç”¨æ¥ä¼ é€’æ•°æ®çš„çŠ¶æ€</strong></li>
<li>skip() è·³è¿‡å½“å‰èŠ‚ç‚¹å­èŠ‚ç‚¹çš„éå†</li>
<li>stop() ç»“æŸæ‰€æœ‰çš„éå†</li>
</ul>
<p>æ¯ä¸ªè·¯å¾„å¯¹åº”ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<h3 id="scope">scope
</h3><p><a class="link" href="https://github.com/babel/babel/blob/main/packages/babel-traverse/src/scope/index.ts"  target="_blank" rel="noopener"
    >scope</a>å¯¹è±¡ä¸Šçš„å±æ€§æˆ–è€…æ–¹æ³•ï¼š</p>
<ul>
<li>scope.bindings å½“å‰ä½œç”¨åŸŸå†…å£°æ˜çš„æ‰€æœ‰å˜é‡</li>
<li>scope.path ç”Ÿæˆä½œç”¨åŸŸçš„èŠ‚ç‚¹å¯¹åº”çš„è·¯å¾„</li>
<li>scope.references æ‰€æœ‰çš„å˜é‡å¼•ç”¨çš„è·¯å¾„</li>
<li>getAllBindings() è·å–ä»å½“å‰ä½œç”¨åŸŸä¸€ç›´åˆ°æ ¹ä½œç”¨åŸŸçš„é›†åˆ</li>
<li>getBinding(name) ä»å½“å‰ä½œç”¨åŸŸåˆ°æ ¹ä½œç”¨åŸŸæŸ¥æ‰¾å˜é‡</li>
<li>getOwnBinding(name) åœ¨å½“å‰ä½œç”¨åŸŸæŸ¥æ‰¾å˜é‡</li>
<li>parentHasBinding(name, noGlobals) ä»å½“å‰çˆ¶ä½œç”¨åŸŸåˆ°æ ¹ä½œç”¨åŸŸæŸ¥æ‰¾å˜é‡</li>
<li>removeBinding(name) åˆ é™¤å˜é‡</li>
<li>hasBinding(name, noGlobals) åˆ¤æ–­æ˜¯å¦åŒ…å«å˜é‡</li>
<li>moveBindingTo(name, scope) æŠŠå½“å‰ä½œç”¨åŸŸçš„å˜é‡ç§»åŠ¨åˆ°å…¶å®ƒä½œç”¨åŸŸä¸­</li>
<li>generateUid(name) ç”Ÿæˆä½œç”¨åŸŸä¸­çš„å”¯ä¸€å˜é‡å,å¦‚æœå˜é‡åè¢«å ç”¨å°±åœ¨å‰é¢åŠ ä¸‹åˆ’çº¿</li>
</ul>
<h3 id="è½¬æ¢ç®­å¤´å‡½æ•°æ’ä»¶">è½¬æ¢ç®­å¤´å‡½æ•°æ’ä»¶
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/types&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">arrowFunctionPlugin</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/plugin-transform-arrow-functions&#34;</span><span class="p">).</span><span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">arrowFunctionPlugin2</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// visitorå±æ€§æ˜¯å›ºå®šçš„ï¼Œbabelå†…éƒ¨å°±æ˜¯å†™æ­»å–çš„è¿™ä¸ªå±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¿™ä¸ªçš„æ–¹æ³•åå­—å°±æ˜¯æŠ½è±¡è¯­æ³•æ ‘ä¸­å„ç§èŠ‚ç‚¹å¯¹åº”çš„ç±»å‹type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">ArrowFunctionExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">node</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="s2">&#34;FunctionExpression&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">body</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//åˆ¤æ–­bodyèŠ‚ç‚¹æ˜¯ä¸æ˜¯BlockStatement  (a,b)=&gt;a + b;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">types</span><span class="p">.</span><span class="nx">isBlockStatement</span><span class="p">(</span><span class="nx">body</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//å¿«é€Ÿæ–¹ä¾¿çš„æ„å»ºèŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">node</span><span class="p">.</span><span class="nx">body</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">blockStatement</span><span class="p">([</span><span class="nx">types</span><span class="p">.</span><span class="nx">returnStatement</span><span class="p">(</span><span class="nx">body</span><span class="p">)]);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// å¤„ç†thiséœ€è¦æå‡çš„é—®é¢˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">hoistFunctionEnvironment</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hoistFunctionEnvironment</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//1.çœ‹çœ‹å½“å‰èŠ‚ç‚¹é‡Œæœ‰æ²¡æœ‰ä½¿ç”¨åˆ°this
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">thisPaths</span> <span class="o">=</span> <span class="nx">getThisPaths</span><span class="p">(</span><span class="nx">path</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">thisPaths</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å¯ä»¥ç”¨æ¥ç”Ÿæˆ_thiså˜é‡çš„è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">thisEnv</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">findParent</span><span class="p">((</span><span class="nx">parent</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//å¦‚æœæ˜¯å‡½æ•°ï¼Œä½†æ˜¯ä¸æ˜¯ç®­å¤´å‡½æ•°çš„è¯å°±è¿”å›true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//return types.isFunctionDeclaration(parent)|| parent.isProgram();;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nx">parent</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">()</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">parent</span><span class="p">.</span><span class="nx">isArrowFunctionExpress</span><span class="p">())</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">        <span class="nx">parent</span><span class="p">.</span><span class="nx">isProgram</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">thisBindings</span> <span class="o">=</span> <span class="s2">&#34;_this&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å¦‚æœæ­¤è·¯å¾„å¯¹åº”çš„ä½œç”¨åŸŸä¸­æ²¡_thisè¿™ä¸ªå˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">thisEnv</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">hasBinding</span><span class="p">(</span><span class="nx">thisBindings</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//å‘å®ƒå¯¹åº”çš„ä½œç”¨åŸŸé‡Œæ·»åŠ ä¸€ä¸ªå˜é‡ ï¼Œå˜é‡å_this,å˜é‡çš„å€¼this
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">thisIdentifier</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="nx">thisBindings</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">thisEnv</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">id</span><span class="o">:</span> <span class="nx">thisIdentifier</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">init</span><span class="o">:</span> <span class="nx">types</span><span class="p">.</span><span class="nx">thisExpression</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">thisPaths</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">thisPath</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">thisPath</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">thisIdentifier</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">getThisPaths</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">thisPaths</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//éå†æ­¤è·¯å¾„æ‰€æœ‰çš„å­è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">path</span><span class="p">.</span><span class="nx">traverse</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ThisExpression</span><span class="p">(</span><span class="nx">thisPath</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">thisPaths</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">thisPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">thisPaths</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//è¿™æ˜¯JSæºä»£ç ï¼Œç”¨å­—ç¬¦ä¸²è¡¨ç¤º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">sourceCode</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">const sum = (a,b)=&gt;{
</span></span></span><span class="line"><span class="cl"><span class="sb">  const minis = (a,b)=&gt;{
</span></span></span><span class="line"><span class="cl"><span class="sb">    console.log(this);
</span></span></span><span class="line"><span class="cl"><span class="sb">    return a-b;
</span></span></span><span class="line"><span class="cl"><span class="sb">  }
</span></span></span><span class="line"><span class="cl"><span class="sb">  return a+b;
</span></span></span><span class="line"><span class="cl"><span class="sb">}
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">core</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">sourceCode</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">arrowFunctionPlugin2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">var _this = this;
</span></span></span><span class="line"><span class="cl"><span class="cm">const sum = function (a,b){
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(_this);
</span></span></span><span class="line"><span class="cl"><span class="cm">  return a+b;
</span></span></span><span class="line"><span class="cl"><span class="cm">}
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ—¥å¿—æ’ä»¶">æ—¥å¿—æ’ä»¶
</h3><p><code>state.file.opts.filename</code> è¡¨ç¤ºå½“å‰æ­£åœ¨å¤„ç†çš„æ–‡ä»¶çš„è·¯å¾„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/types&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">pathLib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//stateä»£è¡¨çŠ¶æ€ï¼Œç”¨åœ¨åœ¨æ’ä»¶å¤„ç†çš„è¿‡ç¨‹ä¼ é€’ä¸€äº›å€¼æˆ–è€…å˜é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">consolePlugin</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">state</span><span class="p">.</span><span class="nx">age</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isMemberExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&#34;console&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="p">[</span><span class="s2">&#34;log&#34;</span><span class="p">,</span> <span class="s2">&#34;info&#34;</span><span class="p">,</span> <span class="s2">&#34;warn&#34;</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="s2">&#34;debug&#34;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">name</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//è·å–è¿™ä¸ªconsole.logèŠ‚ç‚¹æ‰€åœ¨çš„è¡Œå’Œåˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kr">const</span> <span class="p">{</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">column</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">loc</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">pathLib</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="nx">__dirname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">state</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">opts</span><span class="p">.</span><span class="nx">filename</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">node</span><span class="p">.</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="nx">types</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">filename</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">line</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">column</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">FunctionExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">age</span><span class="p">);</span> <span class="c1">// 100
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å®ç°ä¸€ä¸ªæ—¥å¿—æ’ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">sourceCode</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">  console.log(&#39;hello&#39;);
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">core</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">sourceCode</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;main.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">consolePlugin</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¦å®ç°åœ¨æ¯ä¸ª console.log è¯­å¥ä¸­æ·»åŠ æ‰“å°æ–‡ä»¶ã€è¡Œæ•°å’Œåˆ—æ•°çš„ä¿¡æ¯ï¼Œå¯ä»¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„ Babel æ’ä»¶ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹æ’ä»¶ï¼Œå¯å®ç°è¯¥åŠŸèƒ½ï¼š</p>
<p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ªåä¸º <code>.babelrc</code> çš„æ–‡ä»¶ï¼Œé…ç½® Babel çš„è½¬æ¢è§„åˆ™å’Œæ’ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">{
</span></span><span class="line"><span class="cl">  &#34;presets&#34;: [&#34;@babel/preset-env&#34;],
</span></span><span class="line"><span class="cl">  &#34;plugins&#34;: [&#34;console-log-info&#34;]  // éœ€è¦å‘å¸ƒè¿™ä¸ªåŒ…
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>æˆ–è€…åœ¨ webpack é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">consolePlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/consolePlugin.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/.jsx?$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="nx">consolePlugin</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// è¿™ä¸ªæ’ä»¶å¯ä»¥ç›´æ¥åœ¨webpackä¸­çš„babel-loaderä¸­é…ç½®å³å¯ä½¿ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">pathLib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">({</span> <span class="nx">types</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isMemberExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&#34;console&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">[</span><span class="s2">&#34;log&#34;</span><span class="p">,</span> <span class="s2">&#34;info&#34;</span><span class="p">,</span> <span class="s2">&#34;warn&#34;</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="s2">&#34;debug&#34;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">name</span>
</span></span><span class="line"><span class="cl">              <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//è·å–è¿™ä¸ªconsole.logèŠ‚ç‚¹æ‰€åœ¨çš„è¡Œå’Œåˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="kr">const</span> <span class="p">{</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">column</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">loc</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">pathLib</span><span class="p">.</span><span class="nx">relative</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">__dirname</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">state</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">opts</span><span class="p">.</span><span class="nx">filename</span>
</span></span><span class="line"><span class="cl">              <span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="nx">node</span><span class="p">.</span><span class="nx">arguments</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">types</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">filename</span><span class="si">}</span><span class="sb"> </span><span class="si">${</span><span class="nx">line</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">column</span><span class="si">}</span><span class="sb">`</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“å°è¡¨ç¤ºï¼š</p>
<img src="images\image-20230824171919123.png" alt="image-20230824171919123" style="zoom:200%;" />
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">pathLib</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">({</span> <span class="nx">types</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isMemberExpression</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&#34;console&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="p">[</span><span class="s2">&#34;log&#34;</span><span class="p">,</span> <span class="s2">&#34;info&#34;</span><span class="p">,</span> <span class="s2">&#34;warn&#34;</span><span class="p">,</span> <span class="s2">&#34;error&#34;</span><span class="p">,</span> <span class="s2">&#34;debug&#34;</span><span class="p">].</span><span class="nx">includes</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">property</span><span class="p">.</span><span class="nx">name</span>
</span></span><span class="line"><span class="cl">              <span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="nx">fileInfo</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">opts</span><span class="p">.</span><span class="nx">filename</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="nx">fileName</span> <span class="o">=</span> <span class="nx">fileInfo</span><span class="p">[</span><span class="nx">fileInfo</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="p">{</span> <span class="nx">line</span><span class="p">,</span> <span class="nx">column</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">loc</span><span class="p">.</span><span class="nx">start</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="nx">logStatement</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="sb">`[</span><span class="si">${</span><span class="nx">fileName</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">line</span><span class="si">}</span><span class="sb">:</span><span class="si">${</span><span class="nx">column</span><span class="si">}</span><span class="sb">]`</span>
</span></span><span class="line"><span class="cl">              <span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">arguments</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="nx">args</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">logStatement</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">              <span class="nx">path</span><span class="p">.</span><span class="nx">replaceWith</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                <span class="nx">types</span><span class="p">.</span><span class="nx">callExpression</span><span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">identifier</span><span class="p">(</span><span class="s2">&#34;console.log&#34;</span><span class="p">),</span> <span class="nx">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“å°è¡¨ç¤ºï¼š</p>
<img src="images\image-20230824172327152.png" alt="image-20230824172327152" style="zoom:200%;" />
<h3 id="æ•°æ®åŸ‹ç‚¹">æ•°æ®åŸ‹ç‚¹
</h3><p>å½“è°ƒç”¨æ–¹æ³•æ—¶ï¼Œå‘æœåŠ¡å™¨å‘é€ä¸€ä¸ªè¯·æ±‚ï¼Œé€šçŸ¥æœåŠ¡å™¨ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">autoTrackerPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./auto-tracker-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">sourceCode</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">	function sum(a, b){
</span></span></span><span class="line"><span class="cl"><span class="sb">		return a + b
</span></span></span><span class="line"><span class="cl"><span class="sb">	};
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	const multiply = function(a, b){
</span></span></span><span class="line"><span class="cl"><span class="sb">		return a * b 
</span></span></span><span class="line"><span class="cl"><span class="sb">	};
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	const minus = (a, b)=&gt;a + b;
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	class Calculator{
</span></span></span><span class="line"><span class="cl"><span class="sb">		divide(a, b){
</span></span></span><span class="line"><span class="cl"><span class="sb">			return a/b
</span></span></span><span class="line"><span class="cl"><span class="sb">		}
</span></span></span><span class="line"><span class="cl"><span class="sb">	}
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">core</span><span class="p">.</span><span class="nx">transform</span><span class="p">(</span><span class="nx">sourceCode</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="nx">autoTrackerPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;logger&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">whiteList</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;sum&#34;</span><span class="p">],</span> <span class="c1">// é’ˆå¯¹å«è¿™ä¸ªå‡½æ•°çš„åçš„å‡½æ•°æ·»åŠ æ•°æ®åŸ‹ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ•°æ®åŸ‹ç‚¹ä¸­çš„ babel æ’ä»¶åœ¨è¿™é‡Œå¯¼å‡ºçš„æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ã€‚</p>
<p>auto-tracker-plugin.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/types&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/template&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">importModule</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/helper-module-imports&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * babelæ’ä»¶å¯ä»¥å†™ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œä¹Ÿå¯ä»¥å†™ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œå†™ä¸ºå‡½æ•°æ˜¯ï¼Œå¯ä»¥è°ƒç”¨å‡½æ•°å¹¶ä¼ å‚
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å®ç°æ­¤æ’ä»¶éœ€è¦äºŒæ­¥
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1.åˆ¤æ–­æ˜¯å¦æºä»£ç é‡Œå·²ç»å¼•å…¥äº†loggeræ¨¡å—ï¼Œå¦‚æœå¼•å…¥äº†ç›´æ¥ç”¨ï¼Œå¦‚æœæ²¡æœ‰å¼•å…¥è¦æ‰‹å·¥å¼•å…¥
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2.æ‰¾åˆ°ä»£ç ä¸­æ‰€æœ‰çš„å‡½æ•°ï¼Œå‘é‡Œé¢æ’ä»¶è°ƒç”¨loggeræ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">autoTrackerPlugin</span> <span class="o">=</span> <span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Program</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">enter</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="kd">let</span> <span class="nx">loggerId</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">path</span><span class="p">.</span><span class="nx">traverse</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">ImportDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">//æ­¤æ–¹æ³•ä¼šè¿›å…¥å¤šæ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="kr">const</span> <span class="nx">importedModuleName</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;source&#34;</span><span class="p">).</span><span class="nx">node</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="k">if</span> <span class="p">(</span><span class="nx">importedModuleName</span> <span class="o">===</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kr">const</span> <span class="nx">specifierPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;specifiers.0&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">specifierPath</span><span class="p">.</span><span class="nx">isImportDefaultSpecifier</span><span class="p">()</span> <span class="o">||</span> <span class="c1">//é»˜è®¤å¯¼å…¥ import logger from &#39;logger&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="nx">specifierPath</span><span class="p">.</span><span class="nx">isImportSpecifier</span><span class="p">()</span> <span class="o">||</span> <span class="c1">//æ™®é€šå¯¼å…¥ import {logger} from &#39;logger&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="nx">specifierPath</span><span class="p">.</span><span class="nx">ImportNamespaceSpecifier</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">                <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="c1">//å‘½åç©ºé—´å¯¼å…¥  import * as logger from
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="nx">loggerId</span> <span class="o">=</span> <span class="nx">specifierPath</span><span class="p">.</span><span class="nx">node</span><span class="p">.</span><span class="nx">local</span><span class="p">.</span><span class="nx">name</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="p">}</span>
</span></span><span class="line"><span class="cl">                <span class="nx">path</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span> <span class="c1">//ä¸å†éå†äº†ï¼Œè·³è¿‡åç»­çš„æ‰€æœ‰çš„æŸ¥æ‰¾å’Œéå†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//å¦‚æœloggerIdåœ¨éå†å®Œäº†ä»¥åè¿˜æ˜¯undefinedã€‚è¯´æ˜æºç ä¸­æ²¡æœ‰ä¸»åŠ¨å¼•å…¥logger
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loggerId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//  import xx from &#39;logger&#39; , æ„å»ºä¸€ä¸ªæŠ½è±¡è¯­æ³•æ ‘èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">loggerId</span> <span class="o">=</span> <span class="nx">importModule</span><span class="p">.</span><span class="nx">addDefault</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">nameHint</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">generateUid</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">name</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//ç±»ä¼¼ejs æ¨¡æ¿å¼•æ“ è¿”å›çš„æ˜¯ä¸€ä¸ªè¯­æ³•æ ‘çš„èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">state</span><span class="p">.</span><span class="nx">loggerNode</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">statement</span><span class="p">(</span><span class="sb">`LOGGER();`</span><span class="p">)({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">LOGGER</span><span class="o">:</span> <span class="nx">loggerId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;FunctionDeclaration|FunctionExpression|ArrowFunctionExpression|ClassMethod&#34;</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">path</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">state</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç™½åå•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span> <span class="o">&amp;&amp;</span> <span class="nx">options</span><span class="p">.</span><span class="nx">whiteLists</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">id</span><span class="p">.</span><span class="nx">name</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">///å¦‚æœå®ƒçš„bodyå·²ç»æ˜¯ä¸€ä¸ªè¯­å¥å—äº†ï¼Œç›´æ¥åœ¨å—çš„å¼€å§‹æ·»åŠ æ–¹æ³•è°ƒç”¨å³å¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="nx">types</span><span class="p">.</span><span class="nx">isBlockStatement</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">loggerNode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">newNode</span> <span class="o">=</span> <span class="nx">types</span><span class="p">.</span><span class="nx">blockStatement</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">              <span class="nx">state</span><span class="p">.</span><span class="nx">loggerNode</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">types</span><span class="p">.</span><span class="nx">expressionStatement</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">body</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="p">]);</span>
</span></span><span class="line"><span class="cl">            <span class="nx">path</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;body&#34;</span><span class="p">).</span><span class="nx">replaceWith</span><span class="p">(</span><span class="nx">newNode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">autoTrackerPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è½¬åŒ–åçš„ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">sourceCode</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">	import logger from &#39;logger&#39;
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	function sum(a, b){
</span></span></span><span class="line"><span class="cl"><span class="sb">		logger()
</span></span></span><span class="line"><span class="cl"><span class="sb">		return a + b
</span></span></span><span class="line"><span class="cl"><span class="sb">	};
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	const multiply = function(a, b){
</span></span></span><span class="line"><span class="cl"><span class="sb">		logger()
</span></span></span><span class="line"><span class="cl"><span class="sb">		return a * b 
</span></span></span><span class="line"><span class="cl"><span class="sb">	};
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	const minus = (a, b)=&gt;{
</span></span></span><span class="line"><span class="cl"><span class="sb">		logger()
</span></span></span><span class="line"><span class="cl"><span class="sb">		return a + b
</span></span></span><span class="line"><span class="cl"><span class="sb">	};
</span></span></span><span class="line"><span class="cl"><span class="sb">	
</span></span></span><span class="line"><span class="cl"><span class="sb">	class Calculator{
</span></span></span><span class="line"><span class="cl"><span class="sb">		divide(a, b){
</span></span></span><span class="line"><span class="cl"><span class="sb">			logger()
</span></span></span><span class="line"><span class="cl"><span class="sb">			return a/b
</span></span></span><span class="line"><span class="cl"><span class="sb">		}
</span></span></span><span class="line"><span class="cl"><span class="sb">	}
</span></span></span><span class="line"><span class="cl"><span class="sb">`</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ¨¡æ‹Ÿ-eslint">æ¨¡æ‹Ÿ eslint
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">eslintPlugin</span><span class="p">({</span> <span class="nx">fix</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// éå†è¯­æ³•æ ‘ä¹‹å‰æ‰§è¡Œè¯¥preå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">pre</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">file</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s2">&#34;errors&#34;</span><span class="p">,</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">CallExpression</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">errors</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;errors&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span> <span class="o">&amp;&amp;</span> <span class="nx">node</span><span class="p">.</span><span class="nx">callee</span><span class="p">.</span><span class="nx">object</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s2">&#34;console&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">Error</span><span class="p">.</span><span class="nx">stackTraceLimit</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">// è®¾ç½®è°ƒç”¨æ ˆçš„é•¿åº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">errors</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="nx">path</span><span class="p">.</span><span class="nx">buildCodeFrameError</span><span class="p">(</span><span class="sb">`ä»£ç ä¸­ä¸èƒ½å‡ºç°console.logè¯­å¥`</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">            <span class="nb">Error</span>
</span></span><span class="line"><span class="cl">          <span class="p">);</span> <span class="c1">// æ„å»ºä»£ç é”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="nx">fix</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">path</span><span class="p">.</span><span class="nx">parentPath</span><span class="p">.</span><span class="nx">remove</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">post</span><span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">file</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&#34;errors&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">eslintPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä»£ç å‹ç¼©">ä»£ç å‹ç¼©
</h3><p>uglifyPlugin.js</p>
<p>å…¶ä¸­çš„ Scopable æ˜¯ç±»å‹åˆ«åï¼Œå…¶å®å°±æ˜¯ä¸€ç³»åˆ— ast èŠ‚ç‚¹åçš„ç»„åˆï¼Œç±»ä¼¼äº TS çš„è”åˆç±»å‹ã€‚</p>
<ul>
<li><a class="link" href="https://github.com/babel/babel/blob/main/packages/babel-types/src/ast-types/generated/index.ts#L2174-L2191"  target="_blank" rel="noopener"
    >ç±»å‹åˆ«å</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">uglifyPlugin</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">visitor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">Scopable</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Object</span><span class="p">.</span><span class="nx">entries</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">bindings</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(([</span><span class="nx">key</span><span class="p">,</span> <span class="nx">binding</span><span class="p">])</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//åœ¨å½“å‰çš„ä½œç”¨åŸŸä¸­ç”Ÿæˆä¸€ä¸ªä¸é‡å¤çš„å˜é‡å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="kr">const</span> <span class="nx">newName</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">generateUid</span><span class="p">(</span><span class="s2">&#34;t&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// age =&gt; ? name=ï¼Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">binding</span><span class="p">.</span><span class="nx">path</span><span class="p">.</span><span class="nx">scope</span><span class="p">.</span><span class="nx">rename</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">newName</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">uglifyPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æŒ‰éœ€åŠ è½½">æŒ‰éœ€åŠ è½½
</h3><p>ä»¥ lodash ä¸ºä¾‹å­ï¼Œbabel-plugin-importï¼Œä¸”è¿™ä¸ªåº“åªæ”¯æŒ antdï¼Œantd-mobileï¼Œlodashï¼Œmateria-uiã€‚</p>
<p>webapck.config.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s2">&#34;./src/index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&#34;dist&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;bundle.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;babel-plugin-import&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">libraryName</span><span class="o">:</span> <span class="s2">&#34;lodash&#34;</span><span class="p">,</span> <span class="c1">// æŸ¥çœ‹lodashçš„æ ¸å¿ƒåŒ…ï¼Œå¯ä»¥å‘ç°ï¼Œlodashä¸­æ¯ä¸ªåŠŸèƒ½å‡½æ•°éƒ½ç›´æ¥æ”¾åœ¨loadshæ–‡ä»¶å¤¹çš„æ ¹ç›®å½•ä¸­ï¼Œè€Œbabel-plugin-importæ’ä»¶é»˜è®¤æ˜¯å–ç›®æ ‡åº“ä¸‹é¢çš„libæ–‡ä»¶å¤¹ä¸­æ‰¾å¯¹åº”çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿˜éœ€è¦è®¾ç½®åº“çš„ç›®æ ‡æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                  <span class="nx">libraryDirectory</span><span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span> <span class="c1">// è¿™ä¸ªå€¼é»˜è®¤æ˜¯lib
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æŒ‰éœ€åŠ è½½çš„æœ¬è´¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="p">{</span> <span class="nx">flatten</span><span class="p">,</span> <span class="nx">concat</span> <span class="p">}</span> <span class="nx">from</span> <span class="s2">&#34;lodash&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è½¬ä¸ºä¸‹é¢çš„ä»£ç å½¢å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span> <span class="nx">flatten</span> <span class="nx">from</span> <span class="s2">&#34;lodash/flatten&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">concat</span> <span class="nx">from</span> <span class="s2">&#34;lodash/flatten&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blogs/post/webpack/images/image-20230430174616023.png"
	width="781"
	height="1130"
	srcset="/blogs/post/webpack/images/image-20230430174616023_hu_f1fbc86c9d11a86d.png 480w, /blogs/post/webpack/images/image-20230430174616023_hu_cf97697974463b1a.png 1024w"
	loading="lazy"
	
		alt="image-20230430174616023"
	
	
		class="gallery-image" 
		data-flex-grow="69"
		data-flex-basis="165px"
	
></p>
<p>è½¬ä¸ºï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230430174629719.png"
	width="769"
	height="685"
	srcset="/blogs/post/webpack/images/image-20230430174629719_hu_e8c6efe0d876d492.png 480w, /blogs/post/webpack/images/image-20230430174629719_hu_b035d0b841b11b8b.png 1024w"
	loading="lazy"
	
		alt="image-20230430174629719"
	
	
		class="gallery-image" 
		data-flex-grow="112"
		data-flex-basis="269px"
	
></p>
<p>ç¼–è¯‘é¡ºåºä¸ºé¦–å…ˆ<code>plugins</code>ä»å·¦å¾€å³,ç„¶å<code>presets</code>ä»å³å¾€å·¦ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//babelæ ¸å¿ƒæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">core</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//ç”¨æ¥ç”Ÿæˆæˆ–è€…åˆ¤æ–­èŠ‚ç‚¹çš„ASTè¯­æ³•æ ‘çš„èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">types</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/types&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">visitor</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ImportDeclaration</span><span class="p">(</span><span class="nx">path</span><span class="p">,</span> <span class="nx">state</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="p">{</span> <span class="nx">node</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">path</span><span class="p">;</span> <span class="c1">//è·å–èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span> <span class="nx">specifiers</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span> <span class="c1">//è·å–æ‰¹é‡å¯¼å…¥å£°æ˜æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span> <span class="nx">libraryName</span><span class="p">,</span> <span class="nx">libraryDirectory</span> <span class="o">=</span> <span class="s2">&#34;lib&#34;</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">opts</span><span class="p">;</span> <span class="c1">//è·å–é€‰é¡¹ä¸­çš„æ”¯æŒçš„åº“çš„åç§°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å¦‚æœè¯´æ­¤èŠ‚ç‚¹å¯¼å…¥çš„åŒ…åå’Œé…ç½®çš„æŒ‰éœ€åŠ è½½åŒ…åæ˜¯ä¸€æ ·çš„ï¼Œå¹¶ä¸”ä¸æ˜¯é»˜è®¤å¯¼å…¥çš„è¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">node</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span> <span class="o">===</span> <span class="nx">libraryName</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//å¹¶ä¸”å¯¼å…¥ä¸æ˜¯é»˜è®¤å¯¼å…¥æ‰ä¼šè¿›æ¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">!</span><span class="nx">types</span><span class="p">.</span><span class="nx">isImportDefaultSpecifier</span><span class="p">(</span><span class="nx">specifiers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//éå†æ‰¹é‡å¯¼å…¥å£°æ˜æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kr">const</span> <span class="nx">declarations</span> <span class="o">=</span> <span class="nx">specifiers</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">specifier</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//è¿”å›ä¸€ä¸ªimportDeclarationèŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">return</span> <span class="nx">types</span><span class="p">.</span><span class="nx">importDeclaration</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//å¯¼å…¥å£°æ˜importDefaultSpecifier flatten
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="p">[</span><span class="nx">types</span><span class="p">.</span><span class="nx">importDefaultSpecifier</span><span class="p">(</span><span class="nx">specifier</span><span class="p">.</span><span class="nx">local</span><span class="p">)],</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//å¯¼å…¥æ¨¡å—source lodash/flatten
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">types</span><span class="p">.</span><span class="nx">stringLiteral</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">            <span class="nx">libraryDirectory</span>
</span></span><span class="line"><span class="cl">              <span class="o">?</span> <span class="sb">`</span><span class="si">${</span><span class="nx">libraryName</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">libraryDirectory</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">specifier</span><span class="p">.</span><span class="nx">imported</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">              <span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">libraryName</span><span class="si">}</span><span class="sb">/</span><span class="si">${</span><span class="nx">specifier</span><span class="p">.</span><span class="nx">imported</span><span class="p">.</span><span class="nx">name</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl">          <span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="nx">path</span><span class="p">.</span><span class="nx">replaceWithMultiple</span><span class="p">(</span><span class="nx">declarations</span><span class="p">);</span> <span class="c1">//æ›¿æ¢å½“å‰èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">visitor</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ³¨æ„ï¼Œåœ¨ webpack é…ç½®æ–‡ä»¶ä¸­é…ç½®è¯¥æ’ä»¶åï¼Œä¼ ç»™æ’ä»¶çš„å‚æ•°çš„æ–¹å¼æ˜¯ä»¥ä¸‹è¿™ç§ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">options</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">[</span>
</span></span><span class="line"><span class="cl">        	<span class="s1">&#39;babel-plugin-import&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">libraryName</span><span class="o">:</span><span class="s1">&#39;lodash&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">libraryDirectory</span><span class="o">:</span><span class="s1">&#39;&#39;</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">]</span>
</span></span><span class="line"><span class="cl">      <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">},</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ç§æ–¹å¼ä¼ å‚æ—¶ï¼Œå¯¹åº”æ’ä»¶ä¸­è·å–è¿™äº›å‚æ•°çš„æ–¹å¼æ˜¯é€šè¿‡ä¸‹é¢è¿™ç§æ–¹å¼è·å–ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="k">const</span> <span class="p">{</span> <span class="n">libraryName</span><span class="p">,</span> <span class="n">libraryDirectory</span> <span class="o">=</span> <span class="s1">&#39;lib&#39;</span> <span class="p">}</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">opts</span><span class="p">;</span><span class="o">//</span><span class="err">è·å–é€‰é¡¹ä¸­çš„æ”¯æŒçš„åº“çš„åç§°</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨ webpack ä¸­ä½¿ç”¨è‡ªå·±ç¼–å†™çš„ bable æ’ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s2">&#34;./src/index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&#34;dist&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;bundle.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">loader</span><span class="o">:</span> <span class="s2">&#34;babel-loader&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">              <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;plugins/babel-plugin-import.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">libraryName</span><span class="o">:</span> <span class="s2">&#34;lodash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">libraryDirectory</span><span class="o">:</span> <span class="s2">&#34;&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">],</span>
</span></span><span class="line"><span class="cl">              <span class="p">[</span>
</span></span><span class="line"><span class="cl">                <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;plugins/babel-plugin-import.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">                <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">libraryName</span><span class="o">:</span> <span class="s2">&#34;antd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">],</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸Šé¢çš„ä»£ç ä¸­@babel/types ä¸¤ä¸ªä½œç”¨ï¼š</p>
<ol>
<li>åˆ¤æ–­æŸä¸ªèŠ‚ç‚¹æ˜¯ä¸æ˜¯æŸä¸ªç±»å‹</li>
<li>å¿«é€Ÿé€šè¿‡å·¥å‚æ–¹æ³•åˆ›å»ºèŠ‚ç‚¹å®ä¾‹</li>
</ol>
<p><a class="link" href="https://github.com/brigand/babel-plugin-handbook/blob/master/translations/zh-Hans/README.md#asts"  target="_blank" rel="noopener"
    >Babel æ’ä»¶æ‰‹å†Œ</a></p>
<p><strong>babel å‚è€ƒèµ„æ–™ï¼š</strong></p>
<ul>
<li><a class="link" href="https://github.com/brigand/babel-plugin-handbook/blob/master/translations/zh-Hans/README.md#asts"  target="_blank" rel="noopener"
    >Babel æ’ä»¶æ‰‹å†Œ</a></li>
<li><a class="link" href="https://github.com/babel/babel/tree/master/packages/babel-types"  target="_blank" rel="noopener"
    >babel-types</a></li>
<li><a class="link" href="https://astexplorer.net/"  target="_blank" rel="noopener"
    >ä¸åŒçš„ parser è§£æ js ä»£ç åå¾—åˆ°çš„ AST</a></li>
<li><a class="link" href="http://resources.jointjs.com/demos/javascript-ast"  target="_blank" rel="noopener"
    >åœ¨çº¿å¯è§†åŒ–çš„çœ‹åˆ° AST</a></li>
<li><a class="link" href="https://zhuanlan.zhihu.com/p/28143410"  target="_blank" rel="noopener"
    >babel ä»å…¥é—¨åˆ°å…¥é—¨çš„çŸ¥è¯†å½’çº³</a></li>
<li><a class="link" href="https://octman.com/blog/2016-08-27-babel-notes/"  target="_blank" rel="noopener"
    >Babel å†…éƒ¨åŸç†åˆ†æ</a></li>
<li><a class="link" href="https://github.com/chikara-chan/babel-plugin-react-scope-binding"  target="_blank" rel="noopener"
    >babel-plugin-react-scope-binding</a></li>
<li><a class="link" href="https://www.npmjs.com/package/babel-plugin-transform-runtime"  target="_blank" rel="noopener"
    >transform-runtime</a> Babel é»˜è®¤åªè½¬æ¢æ–°çš„ JavaScript è¯­æ³•ï¼Œè€Œä¸è½¬æ¢æ–°çš„ APIã€‚ä¾‹å¦‚ï¼ŒIteratorã€Generatorã€Setã€Mapsã€Proxyã€Reflectã€Symbolã€Promise ç­‰å…¨å±€å¯¹è±¡ï¼Œä»¥åŠä¸€äº›å®šä¹‰åœ¨å…¨å±€å¯¹è±¡ä¸Šçš„æ–¹æ³•ï¼ˆæ¯”å¦‚ Object.assignï¼‰éƒ½ä¸ä¼šè½¬è¯‘,å¯ç”¨æ’ä»¶ <code>babel-plugin-transform-runtime</code> åï¼ŒBabel å°±ä¼šä½¿ç”¨ babel-runtime ä¸‹çš„å·¥å…·å‡½æ•°</li>
<li><a class="link" href="https://github.com/babel/babylon/blob/master/ast/spec.md"  target="_blank" rel="noopener"
    >ast-spec</a></li>
<li><a class="link" href="https://github.com/jamiebuilds/babel-handbook/blob/master/translations/zh-Hans/README.md"  target="_blank" rel="noopener"
    >babel-handbook</a></li>
</ul>
<p>æ‰©å±•ï¼šä½¿ç”¨ babel ä¸­çš„ types åº“å’Œ template åº“åˆ›å»º ast èŠ‚ç‚¹çš„å·®åˆ«ã€‚</p>
<p>å½“æœ‰ä¸€ä¸ªéå¸¸å¤æ‚æˆ–è€…æºç éå¸¸å¤šçš„ä¸€ä¸ªä»£ç æ®µéœ€è¦åˆ›å»ºï¼Œé‚£ä¹ˆ types åº“åªèƒ½ä¸€ä¸ªä¸ªä¸€å±‚å±‚çš„åˆ›å»ºç„¶åå†ä¸€ä¸ªä¸ªä¸€å±‚å±‚çš„ç»„åˆã€‚ è€Œ template åº“å¯ä»¥åŸºäºæºä»£ç å­—ç¬¦ä¸²å¿«é€Ÿåˆ›å»ºå…¶å¯¹åº”çš„æŠ½è±¡è¯­æ³•æ ‘ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">template</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/template&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">astNode</span> <span class="o">=</span> <span class="nx">template</span><span class="p">.</span><span class="nx">statement</span><span class="p">(</span><span class="s2">&#34;xxx&#34;</span><span class="p">)({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">xxx</span><span class="o">:</span> <span class="sb">`æºç éƒ¨åˆ†`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="webpack-å·¥ä½œæµ">webpack å·¥ä½œæµ
</h2><h3 id="è°ƒè¯•-webpack">è°ƒè¯• webpack
</h3><p><strong>æ–¹å¼ä¸€ï¼š</strong></p>
<p>package.json ä¸­</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;script&#34;</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;build&#34;</span><span class="p">:</span> <span class="s2">&#34;webpack&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å½“æ‰§è¡Œè¿™ä¸ªè„šæœ¬å‘½ä»¤æ—¶ï¼Œæ‰¾åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ node_modules ç›®å½•ä¸‹çš„.bin ç›®å½•ä¸‹çš„ webpack.cmdï¼Œè¯¥æ–‡ä»¶ä¸­æ‰§è¡Œçš„æ˜¯ node_modules ç›®å½•ä¸‹çš„ webpack/bin/webpack.js æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä¸­ä¼šå»è°ƒç”¨ webpack-cli ç›®å½•ä¸­çš„ bin ç›®å½•ä¸­çš„ cli.js æ–‡ä»¶ã€‚æ‰€ä»¥å¯ä»¥ç›´æ¥è°ƒè¯• cli æ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">node</span> <span class="o">--</span><span class="nx">inspect</span><span class="o">-</span><span class="nx">brk</span> <span class="p">.</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">webpack</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">webpack</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">node</span> <span class="o">--</span><span class="nx">inspect</span><span class="o">-</span><span class="nx">brk</span> <span class="p">.</span><span class="o">/</span><span class="nx">node_modules</span><span class="o">/</span><span class="nx">webpack</span><span class="o">-</span><span class="nx">cli</span><span class="o">/</span><span class="nx">bin</span><span class="o">/</span><span class="nx">cli</span><span class="p">.</span><span class="nx">js</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ç„¶åæ‰“å¼€ Chrome æµè§ˆå™¨æ§åˆ¶å°è°ƒè¯•</p></blockquote>
<img src="images\image-20230213214843358.png" alt="image-20230213214843358" style="zoom:50%;" />
<p><strong>æ–¹å¼äºŒï¼š</strong></p>
<p>åœ¨ vscode ä¸­é€šè¿‡è°ƒè¯•æ–‡ä»¶è¿›è¡Œ webpack æºç è°ƒè¯•ã€‚</p>
<ul>
<li>æ‰“å¼€å·¥ç¨‹ç›®å½•ï¼Œç‚¹å‡»è°ƒè¯•æŒ‰é’®ï¼Œå†ç‚¹å‡»å°é½¿è½®çš„é…ç½®æŒ‰é’®ç³»ç»Ÿå°±ä¼šç”Ÿæˆ <code>launch.json</code> é…ç½®æ–‡ä»¶</li>
<li>ä¿®æ”¹å¥½äº†ä»¥åç›´æ¥ç‚¹å‡» F5 å°±å¯ä»¥å¯åŠ¨è°ƒè¯•</li>
</ul>
<p>.vscode\launch.json</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;version&#34;</span><span class="p">:</span> <span class="s2">&#34;0.2.0&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;configurations&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;node&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;request&#34;</span><span class="p">:</span> <span class="s2">&#34;launch&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;name&#34;</span><span class="p">:</span> <span class="s2">&#34;debug webpack&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;skipFiles&#34;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&#34;&lt;node_internals&gt;/**&#34;</span><span class="p">],</span> <span class="c1">// è·³è¿‡nodeæ ¸å¿ƒæ¨¡å—ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nt">&#34;cwd&#34;</span><span class="p">:</span> <span class="s2">&#34;${workspaceFolder}&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&#34;program&#34;</span><span class="p">:</span> <span class="s2">&#34;${workspaceFolder}/node_modules/webpack-cli/bin/cli.js&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>åœ¨ webpack-cli åŒ…ä¸­çš„ cli.js æ–‡ä»¶ä¸­æ·»åŠ æ–­ç‚¹åä¾¿å¯ä»¥å¼€å§‹è°ƒè¯•ã€‚</p></blockquote>
<p><strong>æ–¹å¼ä¸‰ï¼š</strong></p>
<p>vscode ä¸­å¯åŠ¨è¯¥æ–‡ä»¶è¿›è¡Œè°ƒè¯• debugger.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">webpackConfig</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./webpack.config&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">dubugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">(</span><span class="nx">webpackConfig</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//4.æ‰§è¡ŒCompilerå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">compiler</span><span class="p">.</span><span class="nx">run</span><span class="p">((</span><span class="nx">err</span><span class="p">,</span> <span class="nx">stats</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//statsä»£è¡¨ç»Ÿè®¡ç»“æœå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">stats</span><span class="p">.</span><span class="nx">toJson</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="nx">assets</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// å…¶å®å®ƒæ˜¯ä¸€ä¸ªä»£ç å—ï¼ˆchunkï¼‰åˆ°æ–‡ä»¶çš„å¯¹åº”å…³ç³»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">chunks</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ä»å…¥å£æ¨¡å—å‡ºå‘ï¼Œæ‰¾åˆ°æ­¤å…¥å£æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œæˆ–è€…ä¾èµ–çš„æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œåˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªä»£ç å—ï¼Œæ‡’åŠ è½½æ¨¡å—åŠå…¶ä¾èµ–ä¹Ÿæ˜¯ä¸€ä¸ªchunk
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">modules</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// æ‰“åŒ…çš„æ¨¡å—ï¼Œé¡¹ç›®æºç ä»“åº“ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªæ¨¡å—ï¼ˆjsæ–‡ä»¶ï¼Œjsxæ–‡ä»¶ï¼Œå›¾ç‰‡ï¼Œhtmlï¼Œcssç­‰ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åç”Ÿäº§æ–‡ä»¶éœ€è¦æ³¨æ„çš„åœ°æ–¹</p>
<p>index.js æºæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./title.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entry1&#34;</span><span class="p">,</span> <span class="nx">title</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>title.js æºæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./msg.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">msg</span><span class="p">,</span> <span class="s2">&#34;msg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;title&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>msg.js æºæ–‡ä»¶ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;msg&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>index.js æ˜¯é¡¹ç›®çš„å…¥å£æ–‡ä»¶ã€‚</p>
<p>æ‰“åŒ…åç”Ÿæˆçš„ç»“æœï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">modules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;./src/msg.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;msg&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;./src/title.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">msg</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./src/msg.js&#34;</span><span class="p">);</span> <span class="c1">// æºç ä¸­æ˜¯./msg.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;title&#34;</span> <span class="o">+</span> <span class="nx">msg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">require</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">cache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">require</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">exports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./src/title.js&#34;</span><span class="p">);</span> <span class="c1">// æºç ä¸­æ˜¯./title.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entry1&#34;</span><span class="p">,</span> <span class="nx">title</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æºæ–‡ä»¶çš„æºç ä¸­ï¼Œå¼•å…¥å…¶ä»–æ¨¡å—æ–‡ä»¶æ—¶ï¼Œä½¿ç”¨çš„éƒ½æ˜¯ä»è¯¥æ¨¡å—æ–‡ä»¶å‡ºå‘åˆ°ç›®æ ‡æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„ï¼Œ<strong>ä½†æ˜¯</strong>æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰æºç ä¸­çš„æ¨¡å—å¯¼å…¥è¯­å¥ä¸­çš„è·¯å¾„éƒ½å˜æˆäº†ä»¥é¡¹ç›®æ ¹ç›®å½•ä¸ºç»Ÿä¸€å‡ºå‘ç‚¹çš„ç›¸å¯¹è·¯å¾„ã€‚</p>
<h3 id="loader-1">loader
</h3><p>webpack çš„ loder çš„æœ¬è´¨å°±æ˜¯ä¸€ä¸ª JavaScript å‡½æ•°ï¼Œç”¨äºè½¬æ¢æˆ–è€…ç¿»è¯‘ webpack ä¸èƒ½è¯†åˆ«çš„æ¨¡å—è½¬ä¸º js æˆ–è€… json æ¨¡å—ã€‚</p>
<p>webpack.config.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.xxx$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;loaders/loader1.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;loaders/loader2.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>loaders/loader1.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">loader1</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">source</span> <span class="o">+</span> <span class="s2">&#34;------&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">loader1</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>loaders/loader2.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">loader2</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// return source+&#39;++++&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="sb">`module.exports = </span><span class="si">${</span><span class="nx">source</span><span class="si">}</span><span class="sb">+++++++`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">loader2</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="tapable">tapable
</h3><ul>
<li>tapable æ˜¯ä¸€ä¸ªç±»ä¼¼äº Node.js ä¸­çš„ EventEmitter çš„åº“ï¼Œä½†æ›´ä¸“æ³¨äºè‡ªå®šä¹‰äº‹ä»¶çš„è§¦å‘å’Œå¤„ç†</li>
<li>webpack é€šè¿‡ tapable å°† å®ç° ä¸ æµç¨‹ è§£è€¦ï¼Œæ‰€æœ‰å…·ä½“å®ç°é€šè¿‡æ’ä»¶çš„å½¢å¼å­˜åœ¨</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">SyncHook</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">args</span> <span class="o">=</span> <span class="nx">args</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">argsLength</span> <span class="o">=</span> <span class="nx">args</span> <span class="o">?</span> <span class="nx">args</span><span class="p">.</span><span class="nx">length</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">taps</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">tap</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">taps</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">fn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">call</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">argsLength</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">taps</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">tap</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">tap</span><span class="p">(...</span><span class="nx">args</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SyncHook</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;some name&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;some name&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">Plugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;Plugin&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Plugin &#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">new</span> <span class="nx">Plugin</span><span class="p">().</span><span class="nx">apply</span><span class="p">();</span> <span class="c1">// æ’ä»¶æ³¨å†Œè‡ªå·±çš„é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">hook</span><span class="p">.</span><span class="nx">call</span><span class="p">();</span> <span class="c1">// ç¼–è¯‘æ‰“åŒ…è¿‡ç¨‹ä¸­è°ƒç”¨è‡ªå·±å·²ç»æ³¨å†Œçš„é€»è¾‘
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="plugin-1">plugin
</h3><p>åœ¨ webpack ä¸­ï¼Œæœ‰éå¸¸å¤šç±»ä¼¼ SyncHook è¿™ç§æ„é€ å‡½æ•°çš„<strong>å®ä¾‹å±æ€§å€¼</strong>ï¼Œå†™æ’ä»¶å°±æ˜¯åœ¨è¿™äº›å®ä¾‹å±æ€§å€¼çš„è®¢é˜…æ•°ç»„ä¸­æ·»åŠ ä¸€ç³»åˆ—çš„æ–¹æ³•ã€‚ç„¶ååœ¨ webpack å¼€å§‹æ‰“åŒ…ç¼–è¯‘ä¹‹ååœ¨å„ä¸ªé˜¶æ®µè°ƒç”¨è¿™äº›å®ä¾‹å±æ€§å€¼ä¸­è®¢é˜…å¥½çš„æ–¹æ³•ï¼Œå¹¶æ‰§è¡Œé€»è¾‘ã€‚</p>
<p>webpack æ’ä»¶çš„æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œæ’ä»¶æ˜¯ä¸€ä¸ªç±»ï¼Œéœ€è¦å®ä¾‹åŒ–ï¼Œå®ä¾‹åŒ–åçš„å€¼æœ‰ä¸€ä¸ªåŸå‹æ–¹æ³• applyã€‚</p>
<p><strong>æ’ä»¶ä¹‹é—´çš„ä¹¦å†™é¡ºåºå¹¶ä¸ä¼šå½±å“å„ä¸ªæ’ä»¶çš„æ‰§è¡Œé¡ºåºï¼Œä½†æ˜¯å¦‚æœä¸¤ä¸ªæ’ä»¶ç›‘å¬çš„æ˜¯ä¸€ä¸ª hookï¼Œé‚£ä¹ˆä¹¦å†™é¡ºåºå°±å’Œæ‰§è¡Œé¡ºåºæœ‰å…³äº†ã€‚</strong></p>
<p>æ’ä»¶çš„æŒ‚è½½æˆ–è€…è¯´ç›‘å¬æ˜¯åœ¨ webpack å¯åŠ¨ç¼–è¯‘å‰å…¨éƒ¨æŒ‚è½½çš„ã€‚å…·ä½“ç”±å“ªäº› hook å®ä¾‹å±æ€§å€¼ï¼Œå¯ä»¥åœ¨å®˜ç½‘ä¸­æŸ¥çœ‹ã€‚</p>
<p>plugins/run1-plugin.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">RunPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åœ¨æ­¤æ’ä»¶é‡Œå¯ä»¥ç›‘å¬runè¿™ä¸ªé’©å­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// compilerä¸Šé¢å°±æœ‰è®¸å¤šçš„hookç±»çš„å®ä¾‹ï¼Œæ¯”å¦‚run
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">run</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;RunPlugin&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;run1:å¼€å§‹ç¼–è¯‘&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">RunPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>plugins/run2-plugin.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">RunPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">run</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;RunPlugin&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;run2:å¼€å§‹ç¼–è¯‘&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">RunPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>plugins/done-plugin.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">DonePlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;DonePlugin&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;done:ç»“æŸç¼–è¯‘&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">DonePlugin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* let compiler = {
</span></span></span><span class="line"><span class="cl"><span class="cm">  hooks: {
</span></span></span><span class="line"><span class="cl"><span class="cm">    run:new Hook(),
</span></span></span><span class="line"><span class="cl"><span class="cm">    done:new Hook()
</span></span></span><span class="line"><span class="cl"><span class="cm">  }
</span></span></span><span class="line"><span class="cl"><span class="cm">} */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Run1Plugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/run1-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Run2Plugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/run2-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">DonePlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/done-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ’ä»¶çš„æŒ‚è½½æˆ–è€…è¯´ç›‘å¬æ˜¯åœ¨ç¼–è¯‘å¯åŠ¨å‰å…¨éƒ¨æŒ‚è½½çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">new</span> <span class="nx">Run1Plugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">Run2Plugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">DonePlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>babel å’Œ webpack çš„å…³ç³»æ˜¯ä»€ä¹ˆï¼Ÿ æ‰§è¡Œé¡ºåºæ˜¯ï¼Ÿ webpack åœ¨ç¼–è¯‘çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ° js æ–‡ä»¶ï¼Œä¼šè°ƒç”¨ babel-loader è¿›è¡Œæ–‡ä»¶å†…å®¹çš„è½¬æ¢ï¼Œåœ¨è½¬æ¢çš„æ—¶å€™ä¼šä½¿ç”¨ babel æ’ä»¶æ¥è½¬æ¢ã€‚</p>
<p>å½“å¤šä¸ª loader åŒ¹é…åˆ°åŒä¸€ä¸ªæ–‡ä»¶æ—¶ï¼ŒWebpack å°†æŒ‰ç…§é…ç½®ä¸­ loader è§„åˆ™çš„é¡ºåºä¾æ¬¡åº”ç”¨è¿™äº› loaderã€‚</p>
<p>åœ¨ä¸‹é…ç½®ç‰‡æ®µä¸­ï¼Œæœ‰ä¸¤ä¸ª loader éƒ½åŒ¹é…åˆ°äº† <code>.txt</code> æ–‡ä»¶ï¼Œå®ƒä»¬çš„é¡ºåºå¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.txt$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">loader1</span><span class="p">],</span> <span class="c1">// åœ¨æ²¡æœ‰ä¸»åŠ¨é…ç½®enforceå­—æ®µçš„æƒ…å†µä¸‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.txt$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">loader2</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ ¹æ®è¿™ä¸ªé…ç½®ï¼ŒWebpack å°†é¦–å…ˆåº”ç”¨ <code>loader1</code>ï¼Œç„¶åå†åº”ç”¨ <code>loader2</code>ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œå…ˆä½¿ç”¨ <code>loader1</code> å¤„ç† <code>.txt</code> æ–‡ä»¶ï¼Œç„¶åå°†å¤„ç†ç»“æœä¼ é€’ç»™ <code>loader2</code>ã€‚è¿™æ ·å¯ä»¥å½¢æˆä¸€ä¸ª loader é“¾ï¼Œæ¯ä¸ª loader éƒ½å¯ä»¥å¯¹æ–‡ä»¶è¿›è¡Œä¸€äº›ç‰¹å®šçš„å¤„ç†ã€‚</p>
<p>è¯·æ³¨æ„ï¼Œloader çš„å¤„ç†é¡ºåºå¯èƒ½ä¼šå¯¹æœ€ç»ˆçš„å¤„ç†ç»“æœäº§ç”Ÿå½±å“ï¼Œå› æ­¤åœ¨é…ç½® loader çš„é¡ºåºæ—¶ï¼Œéœ€è¦æ ¹æ®å®é™…éœ€æ±‚å’Œ loader çš„åŠŸèƒ½æ¥ç¡®å®šé¡ºåºã€‚</p>
<p>å¦‚æœå¸Œæœ› <code>loader2</code> å…ˆå¤„ç† <code>.txt</code> æ–‡ä»¶ï¼Œç„¶åå†ç”± <code>loader1</code> å¤„ç†å¤„ç†ç»“æœï¼Œåªéœ€è°ƒæ•´é…ç½®ä¸­ä¸¤ä¸ª loader çš„é¡ºåºå³å¯ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.txt$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">loader2</span><span class="p">],</span> <span class="c1">// åœ¨æ²¡æœ‰ä¸»åŠ¨é…ç½®enforceå­—æ®µçš„æƒ…å†µä¸‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.txt$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="nx">loader1</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ ·ï¼ŒWebpack å°†é¦–å…ˆåº”ç”¨ <code>loader2</code>ï¼Œç„¶åå†åº”ç”¨ <code>loader1</code>ã€‚</p>
<h3 id="webpack-ç¼–è¯‘æµç¨‹">webpack ç¼–è¯‘æµç¨‹
</h3><p>é…ç½®æ–‡ä»¶å‚è€ƒï¼š</p>
<p>webpack.config.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Run1Plugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/run1-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">Run2Plugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/run2-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">DonePlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./plugins/done-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cache</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;filesystem&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry1</span><span class="o">:</span> <span class="s2">&#34;./src/entry1.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry2</span><span class="o">:</span> <span class="s2">&#34;./src/entry2.js&#34;</span><span class="p">,</span> <span class="c1">// nameå°±æ˜¯æ­¤æ¨¡å—å±äºå“ªä¸ªæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;dist&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name].js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">resolve</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;.js&#34;</span><span class="p">,</span> <span class="s2">&#34;.jsx&#34;</span><span class="p">,</span> <span class="s2">&#34;.ts&#34;</span><span class="p">,</span> <span class="s2">&#34;.tsx&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//æœ€å·¦åˆ™çš„loaderéœ€è¦è¿”å›åˆæ³•çš„JS
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;loaders/loader2.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">          <span class="c1">//æœ€å³ä¾§çš„loaderæ‹¿åˆ°çš„æ˜¯æºä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;loaders/loader1.js&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ’ä»¶çš„æŒ‚è½½æˆ–è€…è¯´ç›‘å¬æ˜¯åœ¨ç¼–è¯‘å¯åŠ¨å‰å…¨éƒ¨æŒ‚è½½çš„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">new</span> <span class="nx">Run1Plugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">Run2Plugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">DonePlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol>
<li>
<p><strong>åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶å‚æ•°,å¾—å‡ºæœ€ç»ˆçš„é…ç½®å¯¹è±¡</strong></p>
</li>
<li>
<p><strong>ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„é…ç½®å¯¹è±¡åˆå§‹åŒ– <code>Compiler</code> å¯¹è±¡</strong></p>
</li>
<li>
<p><strong>åŠ è½½(æŒ‚è½½)æ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ’ä»¶æ˜¯åœ¨ç¼–è¯‘å¼€å§‹ä¹‹å‰å…¨éƒ¨æŒ‚è½½ï¼ˆè®¢é˜…ï¼‰å¥½çš„ï¼Œç­‰åˆ°åé¢ç¼–è¯‘è¿‡ç¨‹ä¸­è§¦å‘æ’ä»¶çš„ä¸­å„ç§è®¢é˜…å‡½æ•°</strong></p>
</li>
<li>
<p><strong>æ‰§è¡Œ Compiler å¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘ï¼Œå†…éƒ¨ä¼šåˆ›å»ºæ–°å»ºä¸€ä¸ª Compilation å®ä¾‹å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¯¥å®ä¾‹å¯¹è±¡çš„ build æ–¹æ³•å¼€å§‹æ‰“åŒ…æ„å»º</strong></p>
</li>
<li>
<p><strong>build æ–¹æ³•ä¸­ï¼Œæ ¹æ®é…ç½®ä¸­çš„<code>entry</code>æ‰¾å‡ºå…¥å£æ–‡ä»¶</strong></p>
</li>
<li>
<p><strong>ä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„<code>Loader</code>å¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼Œå¾—åˆ°å„ä¸ª loader å¤„ç†åçš„æ–‡ä»¶ä»£ç ï¼Œç„¶åé€šè¿‡ bable å»ç”Ÿæˆå¹¶è§£æè¯¥æ–‡ä»¶ï¼ˆASTï¼‰ä¸­çš„ä»£ç ï¼Œç›®çš„æ˜¯æ”¶é›†åˆ°è¯¥æ–‡ä»¶ä¾èµ–çš„å…¶ä»–ä¾èµ–æ–‡ä»¶æ¨¡å—ï¼Œå…±ç»™ä¸‹ä¸€æ­¥ä½¿ç”¨</strong></p>
</li>
<li>
<p><strong>åœ¨ç»“æŸæœ¬æ¨¡å—çš„ ast è¯­æ³•æ ‘åˆ†æåï¼Œå°†æ”¶é›†åˆ°çš„æœ¬æ¨¡å—ä¾èµ–çš„å…¶ä»–æ¨¡å—é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†</strong></p>
</li>
<li>
<p><strong>æ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ Chunk</strong></p>
</li>
<li>
<p><strong>å†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨</strong></p>
</li>
<li>
<p><strong>åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ</strong></p>
<pre><code>    åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼ŒWebpack ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¹¿æ’­å‡ºç‰¹å®šçš„äº‹ä»¶ï¼Œæ’ä»¶åœ¨ç›‘å¬åˆ°å¯¹åº”çš„äº‹ä»¶åä¼šæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œå¹¶ä¸”æ’ä»¶å¯ä»¥è°ƒç”¨ Webpack æä¾›çš„ API æ”¹å˜ Webpack çš„è¿è¡Œç»“æœã€‚

    dubugger.js:

    ```js
    const webpack = require(&quot;./webpack&quot;);
    const webpackConfig = require(&quot;./webpack.config&quot;);
    dubugger;
    const compiler = webpack(webpackConfig);
    //4.æ‰§è¡Œ`Compiler`å¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹æ‰§è¡Œç¼–è¯‘
    compiler.run((err, stats) =&gt; {
      if (err) {
        console.log(err);
      } else {
        //statsä»£è¡¨ç»Ÿè®¡ç»“æœå¯¹è±¡
        console.log(
          stats.toJson({
            files: true, //ä»£è¡¨æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶
            assets: true, //å…¶å®ƒæ˜¯ä¸€ä¸ªä»£ç å—åˆ°æ–‡ä»¶çš„å¯¹åº”å…³ç³»
            chunks: true, //ä»å…¥å£æ¨¡å—å‡ºå‘ï¼Œæ‰¾åˆ°æ­¤å…¥å£æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œæˆ–è€…ä¾èµ–çš„æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œåˆåœ¨ä¸€èµ·ç»„æˆä¸€ä¸ªä»£ç å—
            modules: true, //æ‰“åŒ…çš„æ¨¡å—
          })
        );
      }
    });
    ```

    webpack.js:

    ```js
    const Compiler = require(&quot;./Compiler&quot;);

    function webpack(options) {
      // 1.åˆå§‹åŒ–å‚æ•°ï¼šä»é…ç½®æ–‡ä»¶å’Œ Shell è¯­å¥ä¸­è¯»å–å¹¶åˆå¹¶å‚æ•°,å¾—å‡ºæœ€ç»ˆçš„é…ç½®å¯¹è±¡
      //argv[0]æ˜¯Nodeç¨‹åºçš„ç»å¯¹è·¯å¾„ argv[1] æ­£åœ¨è¿è¡Œçš„è„šæœ¬
      const argv = process.argv.slice(2); // çœŸæ­£éœ€è¦çš„shellå‚æ•°
      const shellOptions = argv.reduce((shellOptions, options) =&gt; {
        // options = '--mode=development'
        const [key, value] = options.split(&quot;=&quot;);
        shellOptions[key.slice(2)] = value;
        return shellOptions;
      }, {});

      const finalOptions = { ...options, ...shellOptions }; // è¿™é‡Œå°±ä½“ç°çš„shellä¸­è®¾ç½®å‚æ•°çš„æƒé‡æ›´é«˜çš„åŸå› 

      //2.ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– `Compiler` å¯¹è±¡ï¼Œå•ä¾‹çš„ï¼Œcompilerå®ä¾‹å¯¹è±¡ç®¡ç†ç€æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹
      const compiler = new Compiler(finalOptions);

      //3.åŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶  pluginsè¿™å°±æ˜¯æ’ä»¶ç±»çš„å®ä¾‹ç»„æˆçš„æ•°ç»„
      const { plugins } = finalOptions;
      for (let plugin of plugins) {
        plugin.apply(compiler);
      }
      return compiler;
    }

    module.exports = webpack;
    ```

    Compiler.js:

    ```js
    const { SyncHook } = require(&quot;tapable&quot;);
    const Compilation = require(&quot;./Compilation&quot;);
    const fs = require(&quot;fs&quot;);
    const path = require(&quot;path&quot;);

    // Compilerä»£è¡¨æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ï¼Œåœ¨ç¼–è¯‘ä¸€å¯åŠ¨æ—¶åˆ›å»ºï¼Œè´¯ç©¿æ•´ä¸ªç¼–è¯‘æ‰“åŒ…çš„ç”Ÿå‘½å‘¨æœŸä¸”æ˜¯å•ä¾‹çš„ï¼Œæ•´ä¸ªç¼–è¯‘æ‰“åŒ…è¿‡ç¨‹ä¸­å°±ä¸€ä¸ªå®ä¾‹ã€‚
    class Compiler {
      constructor(options) {
        this.options = options;
        this.hooks = {
          // Compiler å®ä¾‹ä¸Šæœ‰è®¸å¤šæ„é€ å‡½æ•°å®ä¾‹åŒ–åçš„é’©å­
          run: new SyncHook(), // åœ¨å¼€å§‹ç¼–è¯‘ä¹‹å‰è°ƒç”¨
          done: new SyncHook(), // åœ¨ç¼–è¯‘å®Œæˆæ—¶æ‰§è¡Œ
        };
      }

      run(callback) {
        this.hooks.run.call(); // åœ¨ç¼–è¯‘å¼€å§‹å‰è§¦å‘runé’©å­æ‰§è¡Œ

        // åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ä¼šæ”¶é›†æ‰€æœ‰ä¾èµ–çš„æ¨¡å—æˆ–è€…è¯´æ–‡ä»¶
        // statsæŒ‡çš„æ˜¯ç»Ÿè®¡ä¿¡æ¯ modules chunks  files=bundle assetsæŒ‡çš„æ˜¯æ–‡ä»¶åå’Œæ–‡ä»¶å†…å®¹çš„æ˜ å°„å…³ç³»
        const onCompiled = (err, stats, fileDependencies) =&gt; {
          console.log(&quot;stats&quot;, stats);
          console.log(&quot;fileDependencies&quot;, fileDependencies);
          //10.åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿ
          for (let filename in stats.assets) {
            let filePath = path.join(this.options.output.path, filename);
            fs.writeFileSync(filePath, stats.assets[filename], &quot;utf8&quot;);
          }
          callback(err, { toJson: () =&gt; stats });
          for (let fileDependency of fileDependencies) {
            //ç›‘å¬ä¾èµ–çš„æ–‡ä»¶å˜åŒ–ï¼Œå¦‚æœä¾èµ–çš„æ–‡ä»¶å˜åŒ–åä¼šå¼€å§‹ä¸€æ¬¡æ–°çš„ç¼–è¯‘
            fs.watch(fileDependency, () =&gt; this.compile(onCompiled));
          }
          this.hooks.done.call(); // åœ¨ç¼–è¯‘å®Œæˆæ—¶è§¦å‘doneé’©å­æ‰§è¡Œ
        };

        // è°ƒç”¨compileæ–¹æ³•è¿›è¡Œç¼–è¯‘
        this.compile(onCompiled);
      }

      // å¼€å¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘
      compile(callback) {
        // æ¯æ¬¡ç¼–è¯‘ éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Compilationå®ä¾‹
        let compilation = new Compilation(this.options, this);
        compilation.build(callback);
      }
    }

    module.exports = Compiler;
    ```

    Compilation.js:

    ```js
    const path = require(&quot;path&quot;);
    const fs = require(&quot;fs&quot;);
    const parser = require(&quot;@babel/parser&quot;);
    const types = require(&quot;@babel/types&quot;);
    const traverse = require(&quot;@babel/traverse&quot;).default;
    const generator = require(&quot;@babel/generator&quot;).default;

    const baseDir = normalizePath(process.cwd());
    function normalizePath(path) {
      return path.replace(/\\/g, &quot;/&quot;);
    }

    class Compilation {
      constructor(options, compiler) {
        this.options = options;
        this.compiler = compiler;
        this.modules = []; // è¿™é‡Œæ”¾ç½®æœ¬æ¬¡ç¼–è¯‘æ¶‰åŠçš„æ‰€æœ‰çš„æ¨¡å—
        this.chunks = []; // æœ¬æ¬¡ç¼–è¯‘æ‰€ç»„è£…å‡ºçš„ä»£ç å—
        this.assets = {}; // keyæ˜¯æ–‡ä»¶å,å€¼æ˜¯æ–‡ä»¶å†…å®¹
        this.files = []; // ä»£è¡¨æœ¬æ¬¡æ‰“åŒ…å‡ºæ¥çš„æ–‡ä»¶
        this.fileDependencies = new Set(); // æœ¬æ¬¡ç¼–è¯‘ä¾èµ–çš„æ–‡ä»¶æˆ–è€…è¯´æ¨¡å—
        // è¿™ä¸ªå¯¹è±¡ä¸Šä¹Ÿæœ‰å¾ˆå¤šçš„hook
      }

      build(callback) {
        // 5.æ ¹æ®é…ç½®ä¸­çš„entryæ‰¾å‡ºå…¥å£æ–‡ä»¶
        let entry = {};
        if (typeof this.options.entry === &quot;string&quot;) {
          entry.main = this.options.entry;
        } else {
          entry = this.options.entry;
        }

        for (let entryName in entry) {
          //   const baseDir = normalizePath(process.cwd());
          let entryFilePath = path.posix.join(baseDir, entry[entryName]); // å°†entryä¸­çš„ç›¸å¯¹åœ°å€è½¬ä¸ºä»ç£ç›˜æ ¹è·¯å¾„å‡ºå‘çš„ç»å¯¹åœ°å€

          this.fileDepxendencies.add(entryFilePath);
          // 6.ä»å…¥å£æ–‡ä»¶å‡ºå‘,è°ƒç”¨æ‰€æœ‰é…ç½®çš„Loaderå¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘
          let entryModule = this.buildModule(entryName, entryFilePath);
          // this.modules.push(entryModule);
          // 8.æ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œ  Chunk
          let chunk = {
            name: entryName,
            entryModule,
            modules: this.modules.filter((module) =&gt;
              module.names.includes(entryName)
            ),
          };
          this.chunks.push(chunk);
        }

        //9.å†æŠŠæ¯ä¸ª Chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨
        this.chunks.forEach((chunk) =&gt; {
          const filename = this.options.output.filename.replace(
            &quot;[name]&quot;,
            chunk.name
          );
          this.files.push(filename);
          this.assets[filename] = getSource(chunk);
        });

        callback(
          null,
          {
            modules: this.modules,
            chunks: this.chunks,
            assets: this.assets,
            files: this.files,
          },
          this.fileDependencies
        );
      }
      /**
       * ç¼–è¯‘æ¨¡å—
       * @param {*} name æ¨¡å—æ‰€å±çš„ä»£ç å—(chunk)çš„åç§°ï¼Œä¹Ÿå°±æ˜¯entryé…ç½®é¡¹çš„key entry1 entry2
       * @param {*} modulePath æ¨¡å—çš„è·¯å¾„ï¼Œç»å¯¹è·¯å¾„
       */
      buildModule(name, modulePath) {
        //1.è¯»å–æ–‡ä»¶çš„å†…å®¹
        let sourceCode = fs.readFileSync(modulePath, &quot;utf8&quot;); // åŒæ­¥è¯»å–æ–‡ä»¶å†…å®¹
        let { rules = [] } = this.options.module;
        //æ ¹æ®è§„åˆ™æ‰¾åˆ°æ‰€æœ‰çš„åŒ¹é…çš„loader
        let loaders = [];
        rules.forEach((rule) =&gt; {
          // ä»è¿™æ®µä»£ç é€»è¾‘å¯ä»¥çœ‹å‡ºï¼Œé’ˆå¯¹æŸä¸ªç±»å‹çš„æ–‡ä»¶ä¼šéå†webpacké…ç½®æ–‡ä»¶ä¸­çš„æ‰€æœ‰ruleï¼Œå‘½ä¸­å…¶ä¸­ç¬¦åˆtestè§„åˆ™çš„æ–‡ä»¶ï¼Œç„¶åç”¨loaderè¿›è¡Œå¤„ç†ï¼Œå¦‚æœæœ‰å¤šä¸ªè§„åˆ™éƒ½èƒ½å‘½ä¸­åŒä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆéƒ½ä¼šå¯¹å‰é¢ruleå¤„ç†è¿‡çš„æ–‡ä»¶æºç è¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ã€‚
          if (modulePath.match(rule.test)) {
            loaders.push(...rule.use);
          }
        });
        //è°ƒç”¨æ‰€æœ‰é…ç½®çš„Loaderå¯¹æ¨¡å—è¿›è¡Œè½¬æ¢
        sourceCode = loaders.reduceRight((sourceCode, loader) =&gt; {
          return require(loader)(sourceCode);
        }, sourceCode);

        // 7.å†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç† ï¼Œ æ‰¾å‡ºæŸä¸ªæ¨¡å—æ–‡ä»¶ä¸­ä¾èµ–çš„å…¶ä»–æ¨¡å—åˆ™æ˜¯é€šè¿‡ASTæŸ¥æ‰¾è·å–
        // å£°æ˜å½“å‰æ¨¡å—çš„ID
        let moduleId = &quot;./&quot; + path.posix.relative(baseDir, modulePath); // relativeæ–¹æ³•è¿”å›ä¸€ä¸ªç›¸å¯¹çš„è·¯å¾„
        //åˆ›å»ºä¸€ä¸ªæ¨¡å—ï¼ŒIDå°±æ˜¯ç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼Œdependencieså°±æ˜¯æ­¤æ¨¡å—ä¾èµ–çš„æ¨¡å—
        //nameæ˜¯æ¨¡å—æ‰€å±çš„ä»£ç å—çš„åç§°, å¦‚æœä¸€ä¸ªæ¨¡å—å±äºå¤šä¸ªä»£ç å—ï¼Œé‚£ä¹ˆnameå°±æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ˆæ¯”å¦‚ä¸€ä¸ªæ¨¡å—è¢«å¤šä¸ªå…¥å£ä¸­çš„å…¶ä»–æ¨¡å—éƒ½å¼•ç”¨äº†ã€‚ï¼‰
        let module = { id: moduleId, dependencies: [], names: [name] };
        let ast = parser.parse(sourceCode, { sourceType: &quot;module&quot; });
        //Visitoræ˜¯babelæ’ä»¶ä¸­çš„æ¦‚å¿µï¼Œæ­¤å¤„æ²¡æœ‰
        traverse(ast, {
          CallExpression: ({ node }) =&gt; {
            if (node.callee.name === &quot;require&quot;) {
              let depModuleName = node.arguments[0].value; // &quot;./title&quot;
              let depModulePath;
              if (depModuleName.startsWith(&quot;.&quot;)) {
                //æš‚æ—¶å…ˆä¸è€ƒè™‘node_modulesé‡Œçš„æ¨¡å—ï¼Œå…ˆåªè€ƒè™‘ç›¸å¯¹è·¯å¾„
                const currentDir = path.posix.dirname(modulePath);
                //è¦æ‰¾å½“å‰æ¨¡å—æ‰€æœ‰åœ¨çš„ç›®å½•ä¸‹é¢çš„ç›¸å¯¹è·¯å¾„
                depModulePath = path.posix.join(currentDir, depModuleName);
                //æ­¤ç»å¯¹è·¯å¾„å¯èƒ½æ²¡æœ‰åç»­ï¼Œéœ€è¦å°è¯•æ·»åŠ åç¼€
                const extensions = this.options.resolve.extensions;
                depModulePath = tryExtensions(depModulePath, extensions);
              } else {
                //å¦‚æœä¸æ˜¯ä»¥.å¼€å¤´çš„è¯ï¼Œå°±æ˜¯ç¬¬ä¸‰æ–¹æ¨¡å—
                depModulePath = require.resolve(depModuleName);
              }
              this.fileDependencies.add(depModulePath);
              //è·å–ä¾èµ–çš„æ¨¡å—çš„ID,ä¿®æ”¹è¯­æ³•æ ‘ï¼ŒæŠŠä¾èµ–çš„æ¨¡å—åæ¢æˆæ¨¡å—ID
              let depModuleId =
                &quot;./&quot; + path.posix.relative(baseDir, depModulePath);
              node.arguments[0] = types.stringLiteral(depModuleId);
              //æŠŠä¾èµ–çš„æ¨¡å—IDå’Œä¾èµ–çš„æ¨¡å—è·¯å¾„æ”¾ç½®åˆ°å½“å‰æ¨¡å—çš„ä¾èµ–æ•°ç»„ä¸­
              module.dependencies.push({
                depModuleId,
                depModulePath,
              });
            }
          },
        });
        //ä½¿ç”¨æ”¹é€ åçš„astè¯­æ³•è¦åœ°é‡æ–°ç”Ÿæˆæ–°çš„æºä»£ç 
        let { code } = generator(ast);
        module._source = code;

        // é€’å½’å½“å‰æ¨¡å—ä¾èµ–çš„å…¶ä»–æ¨¡å—
        module.dependencies.forEach(({ depModuleId, depModulePath }) =&gt; {
          //åˆ¤æ–­æ­¤ä¾èµ–çš„æ¨¡å—æ˜¯å¦å·²ç»æ‰“åŒ…è¿‡äº†æˆ–è€…è¯´ç¼–è¯‘è¿‡äº†
          let existModule = this.modules.find(
            (module) =&gt; module.id === depModuleId
          );
          if (existModule) {
            existModule.names.push(name);
          } else {
            let depModule = this.buildModule(name, depModulePath); // è¿™é‡Œçš„nameä½¿ç”¨çš„æ˜¯ç¬¬ä¸€æ¬¡ä¼ å…¥çš„é‚£ä¸ªå€¼ï¼Œå¦‚entry1å’Œentry2
            this.modules.push(depModule);
          }
        });
        return module;
      }
    }

    function tryExtensions(modulePath, extensions) {
      if (fs.existsSync(modulePath)) {
        return modulePath;
      }
      for (let i = 0; i &lt; extensions.length; i++) {
        let filePath = modulePath + extensions[i];
        if (fs.existsSync(filePath)) {
          return filePath;
        }
      }
      throw new Error(`æ‰¾ä¸åˆ°${modulePath}`);
    }

    function getSource(chunk) {
      return `
      (() =&gt; {
        var modules = {
          ${chunk.modules
            .map(
              (module) =&gt; `

&quot;${module.id}&quot;: (module, exports, require) =&gt; {
${module.\_source}
}
`           )
    .join(&quot;,&quot;)}
};
var cache = {};
function require(moduleId) {
  var cachedModule = cache[moduleId];
  if (cachedModule !== undefined) {
    return cachedModule.exports;
  }
  var module = cache[moduleId] = {
    exports: {}
  };
  modules[moduleId](module, module.exports, require);
  return module.exports;
}
var exports = {};
(() =&gt; {
  ${chunk.entryModule._source}
})();
</code></pre>
<p>})();
`;
}
module.exports = Compilation;</p>
<pre><code>```

```
</code></pre>
</li>
</ol>
<p>compiler å’Œ compilation æ¦‚å¿µè¾¨æï¼š</p>
<p><code>compiler</code>å®ä¾‹å¯¹è±¡ä¸ŠæŒ‚è½½ç€ webpack ç¯å¢ƒæ‰€æœ‰çš„é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ loaderï¼Œpluginsï¼Œentry ç­‰ç­‰ï¼Œ<code>compiler</code>å®ä¾‹å¯¹è±¡æ˜¯åœ¨å¯åŠ¨ webpack çš„æ—¶å€™å®ä¾‹åŒ–å¥½çš„ï¼Œå®ƒæ˜¯å…¨å±€å”¯ä¸€çš„ï¼Œå¯ä»¥ç†è§£ä¸º webpack å®ä¾‹</p>
<p><code>Compiler</code> æ¨¡å—æ˜¯ webpack çš„ä¸»è¦å¼•æ“ï¼Œå®ƒé€šè¿‡ <a class="link" href="https://www.webpackjs.com/api/cli"  target="_blank" rel="noopener"
    >CLI</a> æˆ–è€… <a class="link" href="https://www.webpackjs.com/api/node"  target="_blank" rel="noopener"
    >Node API</a> ä¼ é€’çš„æ‰€æœ‰é€‰é¡¹åˆ›å»ºå‡ºä¸€ä¸ª Compiler å®ä¾‹ã€‚ å®ƒæ‰©å±•ï¼ˆextendsï¼‰è‡ª <code>Tapable</code> ç±»ï¼Œ<strong>ç”¨æ¥æ³¨å†Œå’Œè°ƒç”¨æ’ä»¶</strong>ã€‚ å¤§å¤šæ•°é¢å‘ç”¨æˆ·çš„æ’ä»¶ä¼šé¦–å…ˆåœ¨ <code>Compiler</code> ä¸Šæ³¨å†Œã€‚</p>
<p>compilation å¯¹è±¡ä»£è¡¨äº†ä¸€æ¬¡èµ„æºç‰ˆæœ¬çš„æ„å»ºã€‚å®ƒåŒ…å«äº†å½“å‰çš„æ¨¡å—èµ„æº(modules)ã€ç¼–è¯‘ç”Ÿæˆèµ„æº(asset)ã€å˜åŒ–çš„æ–‡ä»¶(files)ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯(fileDependencies)ç­‰ã€‚å½“ webpack ä»¥å¼€å‘æ¨¡å¼è¿è¡Œæ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªä¾èµ–æ–‡ä»¶å‘ç”Ÿå˜åŒ–å˜åŒ–ï¼Œä¸€æ¬¡æ–°çš„ compilation å°†è¢«åˆ›å»ºã€‚compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šäº‹ä»¶å›è°ƒä¾›æ’ä»¶åšæ‰©å±•ã€‚é€šè¿‡ compilation ä¹Ÿå¯ä»¥è¯»å–åˆ° compiler å¯¹è±¡ã€‚</p>
<p><code>Compilation</code> æ¨¡å—ä¼šè¢« <code>Compiler</code> ç”¨æ¥åˆ›å»ºæ–°çš„ compilation å¯¹è±¡ï¼ˆæˆ–æ–°çš„ build å¯¹è±¡ï¼‰ã€‚ <code>compilation</code> å®ä¾‹èƒ½å¤Ÿè®¿é—®æ‰€æœ‰çš„æ¨¡å—å’Œå®ƒä»¬çš„ä¾èµ–ï¼ˆå¤§éƒ¨åˆ†æ˜¯å¾ªç¯ä¾èµ–ï¼‰ã€‚ å®ƒä¼šå¯¹åº”ç”¨ç¨‹åºçš„ä¾èµ–å›¾ä¸­æ‰€æœ‰æ¨¡å—ï¼Œ è¿›è¡Œå­—é¢ä¸Šçš„ç¼–è¯‘(literal compilation)ã€‚ åœ¨ç¼–è¯‘é˜¶æ®µï¼Œæ¨¡å—ä¼šè¢«åŠ è½½(load)ã€å°å­˜(seal)ã€ä¼˜åŒ–(optimize)ã€ åˆ†å—(chunk)ã€å“ˆå¸Œ(hash)å’Œé‡æ–°åˆ›å»º(restore)ã€‚</p>
<p><code>Compilation</code> ç±»æ‰©å±•(extend)è‡ª <code>Tapable</code>ï¼Œå¹¶æä¾›äº†ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸé’©å­ã€‚ å¯ä»¥æŒ‰ç…§ compiler é’©å­çš„ç›¸åŒæ–¹å¼æ¥è°ƒç”¨ tapã€‚</p>
<p>æ‰©å±•ï¼š</p>
<blockquote>
<p>tapable æ˜¯ webpack çš„ä¸€ä¸ªæ ¸å¿ƒå·¥å…·ï¼Œå®ƒæš´éœ²äº† tapã€tapAsyncã€tapPromise æ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥è§¦å‘ compiler é’©å­ï¼Œä½¿å¾—æ’ä»¶å¯ä»¥ç›‘å¬ webpack åœ¨è¿è¡Œè¿‡ç¨‹ä¸­å¹¿æ’­çš„äº‹ä»¶ï¼Œç„¶åé€šè¿‡ compiler å¯¹è±¡å»æ“ä½œ webpackã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•æ³¨å…¥è‡ªå®šä¹‰çš„æ„å»ºæ­¥éª¤ï¼Œè¿™äº›æ­¥éª¤å°†åœ¨æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸åŒæ—¶æœºè§¦å‘ã€‚</p>
<p>deps çš„å˜åŒ–ä¼šå¯¼è‡´æ•´ä¸ªä¾èµ–é“¾è·¯ä¸Šçš„å†…å®¹éƒ½é‡æ–°ç¼–è¯‘è¿˜æ˜¯åªç¼–è¯‘å˜åŒ–éƒ¨åˆ†ï¼Ÿ</p>
<p>å¦‚æœæœ‰æ–‡ä»¶å˜åŒ–çš„è¯ï¼Œåœ¨ webpack5 ä»¥å‰ä¼šå…¨éƒ¨ä¼šé‡æ–°ç¼–è¯‘ï¼Œæ¯”è¾ƒæ…¢ï¼Œæ‰€ä»¥åœ¨ webpack5 ä»¥å‰å¯ä»¥ä½¿ç”¨ï¼šcache hardsource dllplugin ç­‰æ–¹æ³•æå‡æ‰“åŒ…æ„å»ºé€Ÿåº¦ï¼Œä½†æ˜¯ webpack5 ä»¥åï¼Œå†…ç½®è¿™äº›ç¼“å­˜æœºåˆ¶ã€‚</p></blockquote>
<h2 id="loader-2">loader
</h2><ul>
<li>loader æ˜¯ä¸€ä¸ªæ¨¡å—æ–‡ä»¶å¯¼å‡ºçš„å‡½æ•°ã€‚å®ƒæ¥æ”¶ä¸Šä¸€ä¸ª loader äº§ç”Ÿçš„ç»“æœæˆ–è€…èµ„æºæ–‡ä»¶(resource file)ä½œä¸ºå…¥å‚ã€‚ä¹Ÿå¯ä»¥ç”¨å¤šä¸ª loader å‡½æ•°ç»„æˆ loader chain</li>
<li>compiler éœ€è¦å¾—åˆ°æœ€åä¸€ä¸ª loader äº§ç”Ÿçš„å¤„ç†ç»“æœã€‚è¿™ä¸ªå¤„ç†ç»“æœåº”è¯¥æ˜¯ String æˆ–è€… Bufferï¼ˆè¢«è½¬æ¢ä¸ºä¸€ä¸ª stringï¼‰</li>
</ul>
<h3 id="loader-æ‰§è¡Œæ—¶æœº">loader æ‰§è¡Œæ—¶æœº
</h3><p><img src="http://img.zhufengpeixun.cn/webpackflowloader.jpg"
	
	
	
	loading="lazy"
	
		alt="webpackflowloader"
	
	
></p>
<h3 id="loader-åˆ†ç±»">loader åˆ†ç±»
</h3><p>loader æœ‰å››ç§æ‰§è¡Œæ—¶æœºåˆ†ç±»ï¼Œå®ƒä»¬çš„ç»„åˆæ˜¯æœ‰é¡ºåºçš„ã€‚</p>
<ul>
<li>post(åç½®)</li>
<li>inline(å†…è”)ï¼Œåªé’ˆå¯¹æŒ‡å®šçš„è®¾ç½®äº†å†…è” loader çš„æ¨¡å—æ–‡ä»¶èµ·ä½œç”¨</li>
<li>normal(æ­£å¸¸)</li>
<li>pre(å‰ç½®)</li>
</ul>
<p>ä¸€ä¸ª loader åœ¨è¢«å…·ä½“é…ç½®åˆ° webpack ä¹‹å‰ï¼Œæ˜¯æ²¡åŠæ³•åŒºåˆ†å®ƒæ˜¯åœ¨å…·ä½“çš„å“ªä¸ªæ—¶æœºè¢«è°ƒç”¨çš„ã€‚</p>
<p>å› ä¸º loader é…ç½®å¯ä»¥æ˜¯ç”±å¤šä¸ªé…ç½®æ–‡ä»¶åˆå¹¶è€Œæ¥ï¼Œä¸ºäº†ä¿è¯æ‰§è¡Œçš„æ—¶å€™æŒ‰æˆ‘ä»¬å¸Œæœ›çš„é¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥å¯ä»¥ç»™ loader åŒºåˆ†è°ƒç”¨æ—¶æœºã€‚</p>
<p>å¦‚ä½•è¡¨ç¤ºæŸä¸ª loader è¢«æ”¾ç½®åœ¨è¿™å››ç§æ‰§è¡Œæ—¶æœºä¸­çš„å“ªä¸€ç§ï¼Ÿ</p>
<ol>
<li>é€šè¿‡æ¯ä¸ª rule è§„åˆ™ä¸­ï¼Œè®¾ç½® enforce é…ç½®é¡¹çš„å€¼æ¥è§£å†³ï¼Œ<code>enforce:'pre'|'post'|'normal',</code>ä¸å†™é»˜è®¤ normal</li>
<li>æˆ–è€…é€šè¿‡ loader çš„å†…è”å†™æ³•å®ç°ï¼Œ<code>inline-loader1!inline-loader2!${entryFile}</code></li>
</ol>
<h3 id="loader-çš„å·¥ä½œ">loader çš„å·¥ä½œ
</h3><img src="images\image-20230219130529675.png" alt="image-20230219130529675" style="zoom:200%;" />
<p>loader çš„è°ƒç”¨æ˜¯ä¾èµ–<strong>loader-runner</strong>è¿™ä¸ªåº“è¿›è¡Œçš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">runLoaders</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;loader-runner&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span> <span class="c1">// webpack-dev-serverå¯å¼€å‘æœåŠ¡å™¨çš„æ—¶å€™ memory-fs
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">entryFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;src/index.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å¦‚ä½•é…ç½®è¡Œå†…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="sb">`inline-loader1!inline-loader2!</span><span class="si">${</span><span class="nx">entryFile</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">rules</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;normal-loader1&#34;</span><span class="p">,</span> <span class="s2">&#34;normal-loader2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enforce</span><span class="o">:</span> <span class="s2">&#34;post&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;post-loader1&#34;</span><span class="p">,</span> <span class="s2">&#34;post-loader2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enforce</span><span class="o">:</span> <span class="s2">&#34;pre&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;pre-loader1&#34;</span><span class="p">,</span> <span class="s2">&#34;pre-loader2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span> <span class="c1">// [inline-loader1,inline-loader2, xxx/xxx/xx/src/index.js]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span> <span class="c1">// å¼¹å‡ºæœ€åä¸€ä¸ªå…ƒç´  entryFile=src/index.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">inlineLoaders</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">;</span> <span class="c1">// [inline-loader1,inline-loader2]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">preLoaders</span> <span class="o">=</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">postLoaders</span> <span class="o">=</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">normalLoaders</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rules</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">rule</span> <span class="o">=</span> <span class="nx">rules</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">resource</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">enforce</span> <span class="o">===</span> <span class="s2">&#34;pre&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">preLoaders</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">rule</span><span class="p">.</span><span class="nx">use</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">enforce</span> <span class="o">===</span> <span class="s2">&#34;post&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">postLoaders</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">rule</span><span class="p">.</span><span class="nx">use</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">normalLoaders</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">rule</span><span class="p">.</span><span class="nx">use</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">loaders</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span><span class="nx">postLoaders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span><span class="nx">inlineLoaders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span><span class="nx">normalLoaders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">...</span><span class="nx">preLoaders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">resolveLoader</span> <span class="o">=</span> <span class="p">(</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;loaders-chain&#34;</span><span class="p">,</span> <span class="nx">loader</span><span class="p">);</span> <span class="c1">// loaders-chainæ˜¯è‡ªå·±åˆ›å»ºçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯è‡ªå·±å†™çš„loader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŠŠloaderæ•°ç»„ä»åç§°å˜æˆç»å¯¹è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">loaders</span> <span class="o">=</span> <span class="nx">loaders</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">resolveLoader</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">runLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resource</span><span class="p">,</span> <span class="c1">//ä½ è¦åŠ è½½çš„èµ„æº
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">loaders</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">context</span><span class="o">:</span> <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;zhufeng&#34;</span><span class="p">,</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">100</span> <span class="p">},</span> <span class="c1">//ä¿å­˜ä¸€äº›çŠ¶æ€å’Œå€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">readResource</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="c1">//è¿è¡Œé”™è¯¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span> <span class="c1">//è¿è¡Œçš„ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">result</span><span class="p">.</span><span class="nx">resourceBuffer</span> <span class="o">?</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resourceBuffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="s2">&#34;utf8&#34;</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span> <span class="c1">//è¯»åˆ°çš„åŸå§‹çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="å†…è”-loader-çš„ç‰¹æ®Šé…ç½®">å†…è” loader çš„ç‰¹æ®Šé…ç½®
</h3><ul>
<li><a class="link" href="https://webpack.js.org/concepts/loaders/#configuration"  target="_blank" rel="noopener"
    >loaders/#configuration</a></li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">ç¬¦å·</th>
          <th style="text-align: left">å˜é‡</th>
          <th style="text-align: left">å«ä¹‰</th>
          <th></th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><code>-!</code></td>
          <td style="text-align: left">noPreAutoLoaders</td>
          <td style="text-align: left">ä¸è¦å‰ç½®å’Œæ™®é€š loader</td>
          <td>Prefixing with -! will disable all configured preLoaders and loaders but not postLoaders</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>!</code></td>
          <td style="text-align: left">noAutoLoaders</td>
          <td style="text-align: left">ä¸è¦æ™®é€š loader</td>
          <td>Prefixing with ! will disable all configured normal loaders</td>
      </tr>
      <tr>
          <td style="text-align: left"><code>!!</code></td>
          <td style="text-align: left">noPrePostAutoLoaders</td>
          <td style="text-align: left">ä¸è¦å‰åç½®å’Œæ™®é€š loader,åªè¦å†…è” loader</td>
          <td>Prefixing with !! will disable all configured loaders (preLoaders, loaders, postLoaders)</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// loaderåˆ†ç±»è·Ÿloaderè‡ªå·±æ²¡æœ‰å…³ç³»ï¼Œè·Ÿä½¿ç”¨æ—¶å€™çš„é…ç½®æœ‰å…³ç³»
</span></span></span><span class="line"><span class="cl"><span class="c1">// eslint-loaderä¸­é…ç½®çš„pre  babel-loader=normal
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Auto=Normal
</span></span></span><span class="line"><span class="cl"><span class="cm"> * !  noAuto
</span></span></span><span class="line"><span class="cl"><span class="cm"> * -! noPreAuto
</span></span></span><span class="line"><span class="cl"><span class="cm"> * !! noPrePostAuto
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="sb">`!inline-loader1!inline-loader2!</span><span class="si">${</span><span class="nx">entryFile</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="sb">`-!inline-loader1!inline-loader2!</span><span class="si">${</span><span class="nx">entryFile</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="sb">`!!inline-loader1!inline-loader2!</span><span class="si">${</span><span class="nx">entryFile</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æºç å®ç°ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const { runLoaders } = require(&#34;./loader-runner&#34;);
</span></span><span class="line"><span class="cl">const path = require(&#34;path&#34;);
</span></span><span class="line"><span class="cl">const fs = require(&#34;fs&#34;);//webpack-dev-serverå¯å¼€å‘æœåŠ¡å™¨çš„æ—¶å€™ memory-fs
</span></span><span class="line"><span class="cl">const entryFile = path.resolve(__dirname, &#34;src/index.js&#34;);
</span></span><span class="line"><span class="cl">//å¦‚ä½•é…ç½®è¡Œå†…
</span></span><span class="line"><span class="cl">let request = `inline-loader1!inline-loader2!${entryFile}`;
</span></span><span class="line"><span class="cl">let rules = [
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    test: /\.js$/,
</span></span><span class="line"><span class="cl">    use: [&#34;normal-loader1&#34;, &#34;normal-loader2&#34;],
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    test: /\.js$/,
</span></span><span class="line"><span class="cl">    enforce: &#34;post&#34;,
</span></span><span class="line"><span class="cl">    use: [&#34;post-loader1&#34;, &#34;post-loader2&#34;],
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  {
</span></span><span class="line"><span class="cl">    test: /\.js$/,
</span></span><span class="line"><span class="cl">    enforce: &#34;pre&#34;,
</span></span><span class="line"><span class="cl">    use: [&#34;pre-loader1&#34;, &#34;pre-loader2&#34;],
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">];
</span></span><span class="line"><span class="cl"><span class="gi">+ let parts = request.replace(/^-?!+/,&#39;&#39;).split(&#39;!&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>let resource = parts.pop();//å¼¹å‡ºæœ€åä¸€ä¸ªå…ƒç´  entryFile=src/index.js
</span></span><span class="line"><span class="cl">let inlineLoaders = parts;//[inline-loader1,inline-loader2]
</span></span><span class="line"><span class="cl">let preLoaders = [],postLoaders=[],normalLoaders=[];
</span></span><span class="line"><span class="cl">for(let i=0;i&lt;rules.length;i++){
</span></span><span class="line"><span class="cl">    let rule = rules[i];
</span></span><span class="line"><span class="cl">    if(rule.test.test(resource)){
</span></span><span class="line"><span class="cl">        if(rule.enforce===&#39;pre&#39;){
</span></span><span class="line"><span class="cl">            preLoaders.push(...rule.use);
</span></span><span class="line"><span class="cl">        }else if(rule.enforce===&#39;post&#39;){
</span></span><span class="line"><span class="cl">            postLoaders.push(...rule.use);
</span></span><span class="line"><span class="cl">        }else{
</span></span><span class="line"><span class="cl">            normalLoaders.push(...rule.use);
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl"><span class="gi">+ let loaders = [];
</span></span></span><span class="line"><span class="cl"><span class="gi">+ if(request.startsWith(&#39;!!&#39;)){
</span></span></span><span class="line"><span class="cl"><span class="gi">+     loaders = [...inlineLoaders];
</span></span></span><span class="line"><span class="cl"><span class="gi">+     //noPreAutoLoaders
</span></span></span><span class="line"><span class="cl"><span class="gi">+ }else if(request.startsWith(&#39;-!&#39;)){
</span></span></span><span class="line"><span class="cl"><span class="gi">+     loaders = [...postLoaders,...inlineLoaders];
</span></span></span><span class="line"><span class="cl"><span class="gi">+ }else if(request.startsWith(&#39;!&#39;)){
</span></span></span><span class="line"><span class="cl"><span class="gi">+     //noAutoLoaders
</span></span></span><span class="line"><span class="cl"><span class="gi">+     loaders = [...postLoaders,...inlineLoaders,...preLoaders];
</span></span></span><span class="line"><span class="cl"><span class="gi">+ }else{
</span></span></span><span class="line"><span class="cl"><span class="gi">+     loaders = [...postLoaders,...inlineLoaders,...normalLoaders,...preLoaders];
</span></span></span><span class="line"><span class="cl"><span class="gi">+ }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl">let resolveLoader = loader=&gt;path.resolve(__dirname,&#39;loaders-chain&#39;,loader)
</span></span><span class="line"><span class="cl">//æŠŠloaderæ•°ç»„ä»åç§°å˜æˆç»å¯¹è·¯å¾„
</span></span><span class="line"><span class="cl">loaders= loaders.map(resolveLoader);
</span></span><span class="line"><span class="cl">runLoaders({
</span></span><span class="line"><span class="cl">    resource,//ä½ è¦åŠ è½½çš„èµ„æº
</span></span><span class="line"><span class="cl">    loaders,
</span></span><span class="line"><span class="cl">    context:{name:&#39;zhufeng&#39;,age:100},//ä¿å­˜ä¸€äº›çŠ¶æ€å’Œå€¼
</span></span><span class="line"><span class="cl">    readResource:fs.readFile.bind(this)
</span></span><span class="line"><span class="cl">},(err,result)=&gt;{
</span></span><span class="line"><span class="cl">    console.log(err);//è¿è¡Œé”™è¯¯
</span></span><span class="line"><span class="cl">    console.log(result);//è¿è¡Œçš„ç»“æœ
</span></span><span class="line"><span class="cl">    console.log(result.resourceBuffer?result.resourceBuffer.toString(&#39;utf8&#39;):null);//è¯»åˆ°çš„åŸå§‹çš„æ–‡ä»¶
</span></span><span class="line"><span class="cl">});
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="pitch">pitch
</h3><ul>
<li>
<p>æ¯”å¦‚ a!b!c!module, æ­£å¸¸è°ƒç”¨é¡ºåºåº”è¯¥æ˜¯ cã€bã€aï¼Œä½†æ˜¯çœŸæ­£è°ƒç”¨é¡ºåºæ˜¯ a(pitch)ã€b(pitch)ã€c(pitch)ã€cã€bã€aï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ª pitching loader è¿”å›äº†éç©ºå€¼å°±ç›¸å½“äºåœ¨å®ƒä»¥åŠå®ƒå³è¾¹çš„ loader å·²ç»æ‰§è¡Œå®Œæ¯•</p>
</li>
<li>
<p>æ¯”å¦‚ï¼Œå¦‚æœ b çš„ pitch è¿”å›äº†å­—ç¬¦ä¸²&quot;result b&quot;, æ¥ä¸‹æ¥åªæœ‰ a ä¼šè¢«ç³»ç»Ÿæ‰§è¡Œï¼Œä¸” a çš„ loader æ”¶åˆ°çš„å‚æ•°æ˜¯ result bï¼Œå¹¶ä¸”æºæ–‡ä»¶ä¹Ÿæ²¡æœ‰è¢«è¯»å–è¿‡</p>
</li>
<li>
<p>loader æ ¹æ®è¿”å›å€¼å¯ä»¥åˆ†ä¸ºä¸¤ç§ï¼Œä¸€ç§æ˜¯è¿”å› js ä»£ç ï¼ˆä¸€ä¸ª module çš„ä»£ç ï¼Œå«æœ‰ç±»ä¼¼ module.export è¯­å¥ï¼‰çš„ loaderï¼Œè¿˜æœ‰ä¸èƒ½ä½œä¸ºæœ€å·¦è¾¹ loader çš„å…¶ä»– loader</p>
</li>
<li>
<p>æœ‰æ—¶å€™æƒ³æŠŠä¸¤ä¸ªç¬¬ä¸€ç§ï¼ˆéƒ½è¿”å›ä¸€ä¸ªç¬¦åˆ commonjs è§„èŒƒçš„ JS ä»£ç çš„ loaderï¼‰ loader chain èµ·æ¥ï¼Œæ¯”å¦‚ style-loader!css-loader! é—®é¢˜æ˜¯ css-loader çš„è¿”å›å€¼æ˜¯ä¸€ä¸² js ä»£ç ï¼Œå¦‚æœæŒ‰æ­£å¸¸æ–¹å¼å†™ style-loader çš„å‚æ•°å°±æ˜¯ä¸€ä¸²ä»£ç ä¸²ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œå°±éœ€è¦åœ¨ style-loader é‡Œæ‰§è¡Œ require(css-loader!resources)</p>
</li>
</ul>
<p><strong>ä½¿ç”¨ pitch çš„æƒ…å†µ</strong>ï¼š</p>
<p>å®ç° loader çš„<code>pitch</code>æ–¹æ³•å¯ä»¥åœ¨ç‰¹å®šæƒ…å†µä¸‹æä¾›é¢å¤–çš„çµæ´»æ€§å’Œæ§åˆ¶ï¼Œè¿™å¯¹äºä¼˜åŒ–æ„å»ºè¿‡ç¨‹ã€æ¡ä»¶æ€§åœ°å¤„ç†æ¨¡å—ã€æˆ–åœ¨ç‰¹å®šçš„é¢„å¤„ç†æ­¥éª¤ä¸­éå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›éœ€è¦å®ç°<code>pitch</code>æ–¹æ³•çš„åœºæ™¯ï¼š</p>
<ol>
<li><strong>æ¡ä»¶æ€§è·³è¿‡åç»­çš„ loader</strong>ï¼šå¦‚æœä½ çš„ loader å¯ä»¥æ ¹æ®æŸäº›æ¡ä»¶ï¼ˆä¾‹å¦‚ï¼Œèµ„æºçš„è·¯å¾„ã€æŸ¥è¯¢å‚æ•°ã€æˆ–è€…é¡¹ç›®çš„é…ç½®ï¼‰å†³å®šä¸éœ€è¦æ‰§è¡Œåç»­çš„ loaderï¼Œä½ å¯ä»¥åœ¨<code>pitch</code>æ–¹æ³•ä¸­æ ¹æ®è¿™äº›æ¡ä»¶è¿”å›ä¸€ä¸ªç»“æœï¼Œä»è€Œè·³è¿‡åç»­çš„ loader å¤„ç†ã€‚</li>
<li><strong>é¿å…ä¸å¿…è¦çš„å¤„ç†</strong>ï¼šå½“ç¡®å®šæŸäº›èµ„æºä¸éœ€è¦ç»è¿‡å¤æ‚çš„è½¬æ¢æˆ–å¤„ç†æ—¶ï¼Œé€šè¿‡<code>pitch</code>æ–¹æ³•ç›´æ¥è¿”å›ç»“æœå¯ä»¥å‡å°‘ä¸å¿…è¦çš„è®¡ç®—å’Œå¤„ç†æ—¶é—´ï¼Œä¼˜åŒ–æ„å»ºæ€§èƒ½ã€‚</li>
<li><strong>èµ„æºæ›¿æ¢æˆ–ä»£ç†</strong>ï¼šåœ¨æŸäº›åœºæ™¯ä¸‹ï¼Œå¯èƒ½éœ€è¦åŸºäºå¼€å‘ç¯å¢ƒå’Œç”Ÿäº§ç¯å¢ƒæ¥æ›¿æ¢èµ„æºæˆ–è€…æä¾›èµ„æºçš„ä»£ç†ç‰ˆæœ¬ã€‚é€šè¿‡<code>pitch</code>æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ç¯å¢ƒæˆ–é…ç½®æ¡ä»¶åŠ¨æ€å†³å®šä½¿ç”¨å“ªä¸ªç‰ˆæœ¬çš„èµ„æºã€‚</li>
<li><strong>æå‰å¤„ç†å…±äº«æ•°æ®</strong>ï¼šå¦‚æœä½ çš„ loader éœ€è¦åœ¨å®é™…å¤„ç†èµ„æºä¹‹å‰é¢„å¤„ç†ä¸€äº›æ•°æ®ï¼Œæˆ–è€…éœ€è¦åœ¨ loader é“¾ä¸­çš„ä¸åŒ loader ä¹‹é—´å…±äº«æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<code>pitch</code>æ–¹æ³•çš„<code>data</code>å‚æ•°æ¥å®ç°ã€‚è¿™æ ·ï¼Œä½ å¯ä»¥åœ¨<code>pitch</code>é˜¶æ®µè®¡ç®—æˆ–å‡†å¤‡æ•°æ®ï¼Œå¹¶åœ¨å®é™…çš„ loader å¤„ç†å‡½æ•°ä¸­ä½¿ç”¨è¿™äº›æ•°æ®ã€‚</li>
<li><strong>æ’å…¥é¢å¤–çš„èµ„æºæˆ–ä»£ç ç‰‡æ®µ</strong>ï¼šåœ¨å¤„ç†æŸä¸ªèµ„æºä¹‹å‰ï¼Œå¦‚æœéœ€è¦å‘æ¨¡å—æ³¨å…¥é¢å¤–çš„ä»£ç ç‰‡æ®µæˆ–ä¾èµ–ï¼Œ<code>pitch</code>æ–¹æ³•æä¾›äº†ä¸€ä¸ªæœºä¼šæ¥å®ç°è¿™ä¸€ç‚¹ã€‚é€šè¿‡åœ¨<code>pitch</code>é˜¶æ®µåŠ¨æ€ä¿®æ”¹è¯·æ±‚æˆ–æ·»åŠ é¢å¤–çš„èµ„æºï¼Œå¯ä»¥çµæ´»åœ°æ§åˆ¶èµ„æºçš„å¤„ç†è¿‡ç¨‹ã€‚</li>
<li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå¯¹äºä¸€äº›é‡çš„å¤„ç†è¿‡ç¨‹ï¼Œå¦‚æœå¯ä»¥é€šè¿‡ç®€å•çš„æ£€æŸ¥æ¥é¢„å…ˆåˆ¤æ–­ç»“æœï¼Œé‚£ä¹ˆåœ¨<code>pitch</code>æ–¹æ³•ä¸­æå‰è¿”å›è¿™ä¸ªç»“æœå¯ä»¥é¿å…åç»­ä¸å¿…è¦çš„å¤„ç†ï¼Œä»è€Œè¾¾åˆ°æ€§èƒ½ä¼˜åŒ–çš„ç›®çš„ã€‚</li>
</ol>
<p>å®ç°<code>pitch</code>æ–¹æ³•ä¸æ€»æ˜¯å¿…è¦çš„ï¼Œåªæœ‰å½“ä½ éœ€è¦ä¸Šè¿°æåˆ°çš„é¢å¤–æ§åˆ¶æˆ–ä¼˜åŒ–æ—¶ï¼Œæ‰è€ƒè™‘æ·»åŠ ã€‚æ­£ç¡®ä½¿ç”¨<code>pitch</code>æ–¹æ³•å¯ä»¥è®©ä½ çš„ loader æ›´åŠ çµæ´»å’Œé«˜æ•ˆï¼Œä½†ä¹Ÿéœ€è¦è°¨æ…å¤„ç†ï¼Œä»¥é¿å…å¼•å…¥ä¸å¿…è¦çš„å¤æ‚æ€§æˆ–æ½œåœ¨çš„é—®é¢˜ã€‚</p>
<p>pitch ä¸ loader æœ¬èº«æ–¹æ³•çš„æ‰§è¡Œé¡ºåºå›¾</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-mysql" data-lang="mysql"><span class="line"><span class="cl"><span class="o">|-</span><span class="w"> </span><span class="n">a</span><span class="o">-</span><span class="n">loader</span><span class="w"> </span><span class="o">`</span><span class="n">pitch</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">|-</span><span class="w"> </span><span class="n">b</span><span class="o">-</span><span class="n">loader</span><span class="w"> </span><span class="o">`</span><span class="n">pitch</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">|-</span><span class="w"> </span><span class="n">c</span><span class="o">-</span><span class="n">loader</span><span class="w"> </span><span class="o">`</span><span class="n">pitch</span><span class="o">`</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="o">|-</span><span class="w"> </span><span class="n">requested</span><span class="w"> </span><span class="n">module</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">picked</span><span class="w"> </span><span class="n">up</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dependency</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">|-</span><span class="w"> </span><span class="n">c</span><span class="o">-</span><span class="n">loader</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">execution</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="o">|-</span><span class="w"> </span><span class="n">b</span><span class="o">-</span><span class="n">loader</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">execution</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="o">|-</span><span class="w"> </span><span class="n">a</span><span class="o">-</span><span class="n">loader</span><span class="w"> </span><span class="n">normal</span><span class="w"> </span><span class="n">execution</span><span class="w">
</span></span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blogs/post/webpack/images/image-20230219154119989.png"
	width="1836"
	height="600"
	srcset="/blogs/post/webpack/images/image-20230219154119989_hu_d2d1350c492d1d64.png 480w, /blogs/post/webpack/images/image-20230219154119989_hu_cad94fde51afe80b.png 1024w"
	loading="lazy"
	
		alt="image-20230219154119989"
	
	
		class="gallery-image" 
		data-flex-grow="306"
		data-flex-basis="734px"
	
></p>
<p><img src="/blogs/post/webpack/images/image-20230219154632771.png"
	width="1822"
	height="826"
	srcset="/blogs/post/webpack/images/image-20230219154632771_hu_1e70539b94a30f35.png 480w, /blogs/post/webpack/images/image-20230219154632771_hu_43eb659a40298886.png 1024w"
	loading="lazy"
	
		alt="image-20230219154632771"
	
	
		class="gallery-image" 
		data-flex-grow="220"
		data-flex-basis="529px"
	
></p>
<p>ä¸€æ—¦æœ‰æŸä¸ª loader æœ‰ pitchï¼Œå¹¶ä¸”è¢«æ‰§è¡Œåè¿”å›ä¸ä¸ºå‡å€¼ï¼Œåˆ™å¹¶ä¸ä¼šè¿›è¡Œæºæ–‡ä»¶çš„è¯»å–æ“ä½œã€‚</p>
<blockquote>
<p>åœ¨ Webpack ä¸­ï¼ŒLoader çš„<code>pitch</code>å‡½æ•°æ¥æ”¶å››ä¸ªå‚æ•°ã€‚è¿™äº›å‚æ•°åˆ†åˆ«æ˜¯ï¼š</p>
<ol>
<li><code>remainingRequest</code>ï¼šè¡¨ç¤ºå½“å‰æ¨¡å—çš„å‰©ä½™è¯·æ±‚è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†å½“å‰æ¨¡å—çš„ç›¸å¯¹è·¯å¾„ï¼Œä»¥åŠåœ¨å¤„ç†å½“å‰æ¨¡å—ä¹‹å‰è¿˜éœ€è¦åŠ è½½çš„å…¶ä»–æ¨¡å—çš„è¯·æ±‚è·¯å¾„ã€‚</li>
<li><code>previousRequest</code>ï¼šè¡¨ç¤ºå½“å‰æ¨¡å—çš„å‰ä¸€ä¸ªè¯·æ±‚è·¯å¾„ã€‚å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†å‰ä¸€ä¸ªå¤„ç†è¯¥æ¨¡å—çš„ Loader çš„è¯·æ±‚è·¯å¾„ã€‚</li>
<li><code>data</code>ï¼šä¸€ä¸ªå¯é€‰çš„å‚æ•°ï¼Œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºåœ¨ Loader ä¹‹é—´å…±äº«æ•°æ®ã€‚</li>
<li><code>context</code>ï¼šè¡¨ç¤º Loader çš„ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸å½“å‰æ¨¡å—ç›¸å…³çš„ä¸€äº›ä¿¡æ¯ï¼Œå¦‚å½“å‰æ¨¡å—çš„ç»å¯¹è·¯å¾„ã€è¯·æ±‚è·¯å¾„ç­‰ã€‚</li>
</ol>
<p>è¿™äº›å‚æ•°å¯ä»¥å¸®åŠ© Loader åœ¨å¤„ç†æ¨¡å—æ—¶è¿›è¡Œæ›´ç²¾ç»†çš„æ§åˆ¶å’Œå†³ç­–ã€‚é€šè¿‡åˆ†æå’Œæ“ä½œè¿™äº›å‚æ•°ï¼ŒLoader å¯ä»¥æ ¹æ®éœ€è¦ä¿®æ”¹æ¨¡å—è¯·æ±‚çš„é¡ºåºã€è·¯å¾„ç­‰ï¼Œä»¥æ»¡è¶³ç‰¹å®šçš„éœ€æ±‚ã€‚</p></blockquote>
<p>æ¯ä¸ª loader å‡½æ•°åœ¨ webpack å†…éƒ¨è¢«è°ƒç”¨çš„æ—¶å€™ï¼Œéƒ½ä¼šä¸ºè¯¥ loader å‡½æ•°ç»‘å®šä¸€ä¸ª thisï¼Œåˆè¢«ç§°ä¸º loader ä¸Šä¸‹æ–‡ï¼šhttps://www.webpackjs.com/api/loaders/#the-loader-context</p>
<p><strong>æ‰©å±•çŸ¥è¯†</strong></p>
<p>runSyncOrAsync æ—¢å¯ä»¥æ˜¯åŒæ­¥ä¹Ÿå¯ä»¥æ˜¯å¼‚æ­¥ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">sync</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">global</span><span class="p">.</span><span class="kr">async</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sync</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">callback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">callback</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸ªæ–¹æ³•æ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥ï¼Œå–å†³äºfnä¸­çš„ä»£ç é€»è¾‘
</span></span></span><span class="line"><span class="cl"><span class="c1">// åŒæ­¥çš„ä½¿ç”¨æ–¹å¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">normal</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// å‡½æ•°ä½“ä¸­ä¸èƒ½æœ‰è°ƒç”¨global.asyncçš„è¯­å¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//const callback= global.async();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;normal&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//setTimeout(callback,3000);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¼‚æ­¥çš„ä½¿ç”¨æ–¹å¼ï¼š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">normal</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">global</span><span class="p">.</span><span class="kr">async</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;normal&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(</span><span class="nx">callback</span><span class="p">,</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">callback</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;callback&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="babel-loader">babel-loader
</h3><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install @babel/core @babel/preset-env -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="err">test:/\.js$/,</span>
</span></span><span class="line"><span class="cl">  <span class="err">exclude:/node_modules/,</span>
</span></span><span class="line"><span class="cl">  <span class="err">resolveLoader:{</span>
</span></span><span class="line"><span class="cl">    <span class="err">alias:{</span>
</span></span><span class="line"><span class="cl">      <span class="err">&#39;bable-loader&#39;:path.resolve(__dirname,&#39;/loaders/babel-loader.js&#39;)</span>  <span class="c1">// æ–¹å¼äºŒï¼Œèµ·åˆ«åçš„æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="err">modules:</span><span class="p">[</span><span class="err">path.resolve(__dirname</span><span class="p">,</span><span class="err">&#39;loaders&#39;)</span><span class="p">,</span><span class="err">&#39;node_modules&#39;</span><span class="p">]</span>  <span class="c1">// æ–¹å¼ä¸‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="err">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="err">use:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="err">loader:path.resolve(__dirname,&#39;/loaders/babel-loader.js&#39;),</span>  <span class="c1">// æ–¹å¼ä¸€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="err">loader:&#39;babel-loader&#39;,</span>  <span class="c1">// æ–¹å¼äºŒå’Œæ–¹å¼ä¸‰å…¬ç”¨ï¼Œèµ·åˆ«åçš„æ–¹å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="err">options:{</span>
</span></span><span class="line"><span class="cl">      <span class="err">presets:[&#39;@babel/preset-env&#39;]</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="err">}</span>
</span></span><span class="line"><span class="cl"><span class="err">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="babel-loaderjs">babel-loader.js
</h3><ul>
<li><a class="link" href="https://github.com/babel/babel-loader/blob/master/src/index.js"  target="_blank" rel="noopener"
    >babel-loader</a></li>
<li><a class="link" href="https://babeljs.io/docs/en/next/babel-core.html"  target="_blank" rel="noopener"
    >@babel/core</a></li>
<li><a class="link" href="https://babeljs.io/docs/en/babel-plugin-transform-react-jsx/"  target="_blank" rel="noopener"
    >babel-plugin-transform-react-jsx</a></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">babel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">loader</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">inputAst</span><span class="p">,</span> <span class="nx">inputSourceMap</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// åœ¨loaderé‡Œï¼Œthisæ˜¯ä¸€ä¸ªç§°ä¸ºloaderContextçš„å¯¹è±¡ï¼Œä¸Šé¢æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥ä½¿ç”¨,å…¶ä¸­å°±åŒ…æ‹¬getOptions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// éœ€è¦æŠŠloaderçš„æ‰§è¡Œä»åŒæ­¥å˜æˆå¼‚æ­¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="kr">async</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOptions</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// æ£€æŸ¥æ˜¯å¦å­˜åœ¨ASTï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™ç›´æ¥ä½¿ç”¨ï¼Œå¦åˆ™å°†sourceä½œä¸ºè½¬è¯‘è¾“å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">inputAst</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ²¡æœ‰æä¾›ASTï¼Œå›é€€åˆ°ä½¿ç”¨sourceä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">let</span> <span class="nx">babelOptions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">ast</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sourceMaps</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">inputSourceMap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">babel</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">transformAsync</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="nx">babelOptions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">ast</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// åœ¨loaderæ‰§è¡Œå®Œæˆåæ‰è®©è°ƒç”¨callbackè¡¨ç¤ºæœ¬loaderå·²ç»å®Œæˆäº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">ast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç›´æ¥ä½¿ç”¨æä¾›çš„ASTè¿›è¡Œè½¬è¯‘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">let</span> <span class="nx">babelOptions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">ast</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">sourceMaps</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">inputSourceMap</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨transformFromAstAsyncç›´æ¥è½¬æ¢AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">babel</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">transformFromAstAsync</span><span class="p">(</span><span class="nx">inputAst</span><span class="p">,</span> <span class="nx">source</span><span class="p">,</span> <span class="nx">babelOptions</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">then</span><span class="p">(({</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">ast</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// åœ¨loaderæ‰§è¡Œå®Œæˆåæ‰è®©è°ƒç”¨callbackè¡¨ç¤ºæœ¬loaderå·²ç»å®Œæˆäº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">map</span><span class="p">,</span> <span class="nx">ast</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="k">catch</span><span class="p">((</span><span class="nx">err</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/*
</span></span></span><span class="line"><span class="cl"><span class="cm">åŒæ­¥è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="cm">function loader(source) {
</span></span></span><span class="line"><span class="cl"><span class="cm">  //åœ¨loaderé‡Œthiså…¶å®æ˜¯ä¸€ä¸ªç§°ä¸ºloaderContextçš„å¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="cm">  let options = this.getOptions();
</span></span></span><span class="line"><span class="cl"><span class="cm">  const { code} = babel.transformSync(source,options);  // transformSyncåŒæ­¥ç¼–è¯‘
</span></span></span><span class="line"><span class="cl"><span class="cm">  return code;
</span></span></span><span class="line"><span class="cl"><span class="cm">} */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * babel-loaderåªæ˜¯æä¾›ä¸€ä¸ªè½¬æ¢å‡½æ•°ï¼Œä½†æ˜¯å®ƒå¹¶ä¸çŸ¥é“è¦å¹²å•¥è¦è½¬å•¥
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @babel/core è´Ÿè´£æŠŠæºä»£ç è½¬æˆASTï¼Œç„¶åéå†ASTï¼Œç„¶åé‡æ–°ç”Ÿæˆæ–°çš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä½†æ˜¯å®ƒå¹¶ä¸çŸ¥é“å¦‚ä½•è½¬æ¢è¯­æ¢æ³•ï¼Œå®ƒå¹¶ä¸è®¤è¯†ç®­å¤´å‡½æ•°ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•è½¬æ¢
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @babel/transform-arrow-functions æ’ä»¶å…¶å®æ˜¯ä¸€ä¸ªè®¿é—®å™¨ï¼Œå®ƒçŸ¥é“å¦‚ä½•è½¬æ¢ASTè¯­æ³•æ ‘
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å› ä¸ºè¦è½¬æ¢çš„è¯­æ³•å¤ªå¤šï¼Œæ’ä»¶ä¹Ÿå¤ªå¤šã€‚æ‰€ä»¥å¯ä¸€å †æ’ä»¶æ‰“åŒ…å¤§ä¸€èµ·ï¼Œæˆä¸ºé¢„è®¾preset-env
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å¦‚æœåœ¨å¤šä¸ª loader ä¸­éƒ½ä½¿ç”¨äº†@babel/core æ¥è§£ææºä»£ç ï¼Œä¸ºäº†æ€§èƒ½è€ƒè™‘å¯ä»¥åœ¨å¤šä¸ª loader ä¹‹é—´ä¼ é€’ç¬¬ä¸€ä¸ª babel/core è§£ææºç åå¾—åˆ° ast å¯¹è±¡ï¼Œè€Œä¸å¿…åœ¨æ¯ä¸ª loader ä¸­éƒ½è°ƒç”¨ babel/core è½¬æ¢ä¸€éæºä»£ç ã€‚</p>
<p>loader å‡½æ•°æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼š<code>source</code>ï¼ˆæºä»£ç æ–‡æœ¬ï¼‰ï¼Œ<code>inputAst</code>ï¼ˆå‰ä¸€ä¸ª loader å¯èƒ½æä¾›çš„ ASTï¼‰ï¼Œå’Œ<code>inputSourceMap</code>ï¼ˆä¸Šä¸€ä¸ª loader æä¾›çš„ source mapï¼‰ã€‚</p>
<p>ä» webpack 5 å¼€å§‹ï¼Œ<code>this.getOptions</code> å¯ä»¥è·å–åˆ° loader ä¸Šä¸‹æ–‡å¯¹è±¡ã€‚å®ƒç”¨æ¥æ›¿ä»£æ¥è‡ª <a class="link" href="https://github.com/webpack/loader-utils#getoptions"  target="_blank" rel="noopener"
    >loader-utils</a> ä¸­çš„ <code>getOptions</code> æ–¹æ³•ã€‚</p>
<p>æ‰©å±•ï¼š</p>
<p>åœ¨ Webpack çš„ loader é“¾ä¸­ï¼Œå¦‚æœå¤šä¸ª loader éƒ½ä½¿ç”¨äº† Babel è¿›è¡Œä»£ç è½¬æ¢ï¼Œç†è®ºä¸Šå¯ä»¥é€šè¿‡å…±äº« Babel ç”Ÿæˆçš„ ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰æ¥æé«˜æ€§èƒ½ï¼Œé¿å…é‡å¤çš„è§£ææ­¥éª¤ã€‚<strong>Babel æœ¬èº«æ˜¯æ”¯æŒ AST çš„è¾“å…¥å’Œè¾“å‡ºçš„</strong>ï¼Œè¿™æ„å‘³ç€å‰ä¸€ä¸ª loader å¯ä»¥ç”Ÿæˆ ASTï¼Œè€Œåä¸€ä¸ª loader å¯ä»¥ç›´æ¥å¤ç”¨è¿™ä¸ª ASTï¼Œè€Œä¸å¿…é‡æ–°è§£æä»£ç ã€‚</p>
<p>ä¸è¿‡ï¼ŒWebpack æœ¬èº«å¹¶ä¸è‡ªåŠ¨å¤„ç† AST çš„ä¼ é€’ï¼Œ<strong>ä½ éœ€è¦æ‰‹åŠ¨å®ç° AST åœ¨ loader ä¹‹é—´çš„å…±äº«</strong>ã€‚éœ€è¦åœ¨æ¯ä¸ª loader ä¸­æ˜¾å¼åœ°å¤„ç† AST çš„è¾“å…¥å’Œè¾“å‡ºã€‚</p>
<p><strong>å¦‚ä½•å…±äº« Babel çš„ ASTï¼Ÿ</strong></p>
<ol>
<li>
<p><strong>å‰ä¸€ä¸ª loader è¾“å‡º AST</strong>ï¼š ä½¿ç”¨ Babel å¤„ç†æ—¶ï¼Œå¯ä»¥è®©ç¬¬ä¸€ä¸ª loader è¾“å‡º ASTï¼Œè€Œä¸æ˜¯æœ€ç»ˆçš„ä»£ç ã€‚</p>
</li>
<li>
<p><strong>åä¸€ä¸ª loader å¤ç”¨ AST</strong>ï¼š åç»­çš„ loader å¯ä»¥ç›´æ¥æ¥å— AST ä½œä¸ºè¾“å…¥ï¼Œè€Œä¸éœ€è¦å†æ¬¡è§£ææºç ã€‚</p>
</li>
</ol>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<p>å‡è®¾æœ‰ä¸¤ä¸ªä½¿ç”¨ Babel çš„ loaderï¼Œå¹¶å¸Œæœ›å®ƒä»¬å…±äº« ASTã€‚å¯ä»¥é€šè¿‡åœ¨ Webpack çš„ loader ä¸­ä¼ é€’ AST æ¥å®ç°ã€‚</p>
<ol>
<li>
<p>è‡ªå®šä¹‰ <code>babel-loader</code> æ¥è¾“å‡º AST</p>
<p>é¦–å…ˆï¼Œä¿®æ”¹ä¸€ä¸ªè‡ªå®šä¹‰çš„ Babel loaderï¼Œä½¿å…¶è¾“å‡º ASTï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// first-babel-loader.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">babel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOptions</span><span class="p">()</span> <span class="o">||</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è½¬æ¢ä»£ç ï¼Œå¹¶è¾“å‡º AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">babel</span><span class="p">.</span><span class="nx">transformSync</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ast</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ç”Ÿæˆ AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">code</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">// ä¸ç”Ÿæˆä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// é€šè¿‡ this.callback ä¼ é€’ AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">ast</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>åç»­ loader æ¥æ”¶ AST ä½œä¸ºè¾“å…¥</strong></p>
<p>ç„¶åï¼Œå®ç°ç¬¬äºŒä¸ª loaderï¼Œå®ƒæ¥æ”¶å¹¶å¤„ç† ASTï¼Œè€Œä¸æ˜¯æºç ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// second-babel-loader.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">babel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ ASTï¼Œå¦‚æœæœ‰ï¼Œç›´æ¥ä½¿ç”¨ AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">options</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getOptions</span><span class="p">()</span> <span class="o">||</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">ast</span> <span class="o">=</span> <span class="k">typeof</span> <span class="nx">source</span> <span class="o">===</span> <span class="s2">&#34;string&#34;</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">source</span><span class="p">;</span> <span class="c1">// åˆ¤æ–­ä¼ å…¥çš„æ˜¯å¦æ˜¯ AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">ast</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å¦‚æœæ²¡æœ‰ ASTï¼Œè§£ææºç ï¼ˆè¿™åº”è¯¥ä¸ä¼šå‘ç”Ÿï¼Œå› ä¸ºç¬¬ä¸€ä¸ª loader ä¼šä¼  ASTï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">babel</span><span class="p">.</span><span class="nx">transformSync</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="p">{</span> <span class="p">...</span><span class="nx">options</span><span class="p">,</span> <span class="nx">ast</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="nx">ast</span> <span class="o">=</span> <span class="nx">result</span><span class="p">.</span><span class="nx">ast</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// åœ¨æ­¤åŸºç¡€ä¸Šå¯¹ AST è¿›è¡ŒäºŒæ¬¡å¤„ç†ï¼Œç”Ÿæˆæœ€ç»ˆä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">babel</span><span class="p">.</span><span class="nx">transformFromAstSync</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="p">...</span><span class="nx">options</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">code</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">// ç”Ÿæˆä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è¿”å›æœ€ç»ˆçš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">code</span><span class="p">,</span> <span class="nx">result</span><span class="p">.</span><span class="nx">map</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p><strong>Webpack é…ç½®æ–‡ä»¶</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">rules</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">exclude</span><span class="o">:</span> <span class="sr">/node_modules/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">use</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;second-babel-loader.js&#34;</span><span class="p">),</span> <span class="c1">// ç¬¬äºŒä¸ª loader ä½¿ç”¨ AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">loader</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;first-babel-loader.js&#34;</span><span class="p">),</span> <span class="c1">// ç¬¬ä¸€ä¸ª loader ç”Ÿæˆ AST
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">options</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">          <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p><strong>å…³é”®ç‚¹ï¼š</strong></p>
<ul>
<li><strong>ç¬¬ä¸€ä¸ª loader (<code>first-babel-loader.js</code>)</strong> è´Ÿè´£è§£ææºç å¹¶ç”Ÿæˆ ASTï¼Œç„¶åå°† AST ä¼ é€’ç»™ä¸‹ä¸€ä¸ª loaderã€‚</li>
<li><strong>ç¬¬äºŒä¸ª loader (<code>second-babel-loader.js</code>)</strong> ç›´æ¥æ¥æ”¶ AST å¹¶åœ¨æ­¤åŸºç¡€ä¸Šè¿›è¡Œè¿›ä¸€æ­¥çš„è½¬æ¢ã€‚</li>
<li>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¤šä¸ª loader ä¹‹é—´å¯ä»¥å…±äº« ASTï¼Œé¿å…äº†æ¯ä¸ª loader é‡æ–°è§£ææºç çš„å¼€é”€ã€‚è¿™åœ¨éœ€è¦è¿›è¡Œå¤šæ¬¡è½¬æ¢çš„åœºæ™¯ä¸‹ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡æ€§èƒ½ã€‚</li>
</ul>
<h3 id="style-loader">style-loader
</h3><p>è¿™ä¸ªå‡½æ•°(pitch)åœ¨å¸¸è§„çš„ loader è½¬æ¢å‡½æ•°æ‰§è¡Œä¹‹å‰è¢«è°ƒç”¨ï¼Œæä¾›äº†ä¸€ä¸ªæœºä¼šæ¥å†³å®šæ˜¯å¦è·³è¿‡åç»­çš„ loader æˆ–è€…åœ¨æ²¡æœ‰å¤„ç†èµ„æºçš„æƒ…å†µä¸‹ç›´æ¥è¿”å›ç»“æœã€‚</p>
<p><code>pitch</code>å‡½æ•°æ¥æ”¶ä»¥ä¸‹å‚æ•°ï¼š</p>
<ol>
<li><strong>remainingRequest</strong>ï¼šä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰å‰©ä½™è¯·æ±‚çš„å­—ç¬¦ä¸²ã€‚è¿™äº›å‰©ä½™çš„è¯·æ±‚åŒ…æ‹¬äº† loader é“¾ä¸­ä½äºå½“å‰ loader åé¢çš„ loaderï¼Œä»¥åŠæœ€ç»ˆçš„èµ„æºè·¯å¾„ã€‚è¿™ä¸ªå­—ç¬¦ä¸²å¯ä»¥ç›´æ¥è¢« webpack ä½¿ç”¨ï¼Œä»¥ä¾¿åœ¨æŸäº›åœºæ™¯ä¸‹é‡æ–°å¯åŠ¨ loader å¤„ç†æµç¨‹ã€‚</li>
<li><strong>precedingRequest</strong>ï¼šä¸€ä¸ªåŒ…å«äº†æ‰€æœ‰å‰ç½®è¯·æ±‚çš„å­—ç¬¦ä¸²ã€‚è¿™äº›å‰ç½®è¯·æ±‚åŒ…æ‹¬äº† loader é“¾ä¸­ä½äºå½“å‰ loader å‰é¢çš„æ‰€æœ‰ loaderã€‚è¿™ä¸ªä¿¡æ¯å¯ä»¥ç”¨æ¥äº†è§£èµ„æºåœ¨åˆ°è¾¾å½“å‰ loader ä¹‹å‰å·²ç»ç»è¿‡äº†å“ªäº›å¤„ç†ã€‚</li>
<li><strong>data</strong>ï¼šä¸€ä¸ªå¯ä»¥åœ¨ pitch å’Œæ™®é€š loader è½¬æ¢å‡½æ•°ä¹‹é—´å…±äº«æ•°æ®çš„å¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡æ˜¯ç©ºçš„ï¼Œå¯ä»¥è¢«å½“å‰ loader çš„<code>pitch</code>å‡½æ•°å’Œä¸»ä½“ï¼ˆnormalï¼‰å‡½æ•°ä½¿ç”¨ï¼Œä»¥åœ¨ä¸¤è€…ä¹‹é—´å…±äº«ä¿¡æ¯ã€‚</li>
</ol>
<p>å‡½æ•°çš„è¿”å›å€¼æœ‰ç‰¹åˆ«çš„å«ä¹‰ï¼š</p>
<ul>
<li>å¦‚æœ<code>pitch</code>å‡½æ•°è¿”å›ä¸€ä¸ªå€¼ï¼ˆä¸æ˜¯<code>undefined</code>ï¼‰ï¼Œè¿™ä¸ªè¿”å›çš„ç»“æœä¼šè¢«ç”¨æ¥è·³è¿‡å‰©ä½™çš„ loader å¹¶ç›´æ¥å¤„ç†è¿™ä¸ªç»“æœï¼Œå°±åƒæ˜¯è¿™ä¸ªç»“æœå·²ç»é€šè¿‡äº†æ‰€æœ‰å‰©ä½™çš„ loader ä¸€æ ·ã€‚</li>
<li>å¦‚æœæ²¡æœ‰è¿”å›å€¼ï¼ˆæˆ–è€…è¿”å›<code>undefined</code>ï¼‰ï¼Œwebpack å°±ä¼šç»§ç»­æ‰§è¡Œå‰©ä½™çš„ loader é“¾ï¼Œæœ€åå¤„ç†èµ„æºã€‚</li>
</ul>
<p><code>pitch</code>å‡½æ•°çš„ä½¿ç”¨åœºæ™¯åŒ…æ‹¬ä½†ä¸é™äºï¼š</p>
<ul>
<li>æ ¹æ®ç‰¹å®šæ¡ä»¶æå‰ç»“æŸ loader å¤„ç†ã€‚</li>
<li>åœ¨èµ„æºè¢«å®é™…å¤„ç†ä¹‹å‰ï¼Œä¿®æ”¹æˆ–æ·»åŠ å¿…è¦çš„é¢„å¤„ç†æ­¥éª¤ã€‚</li>
<li>åœ¨ä¸åŒ loader ä¹‹é—´å…±äº«æ•°æ®ã€‚</li>
</ul>
<p>é€šè¿‡ä½¿ç”¨<code>pitch</code>å‡½æ•°ï¼Œå¯ä»¥åœ¨èµ„æºåŠ è½½å’Œè½¬æ¢è¿‡ç¨‹ä¸­æ·»åŠ æ›´å¤šçš„æ§åˆ¶é€»è¾‘ï¼Œä½¿å¾—èµ„æºçš„å¤„ç†æ›´åŠ çµæ´»å’Œé«˜æ•ˆã€‚</p>
<ul>
<li>previousRequest å‰é¢çš„ loader</li>
<li>currentRequest è‡ªå·±å’Œåé¢çš„ loader+èµ„æºè·¯å¾„</li>
<li>remainingRequest åé¢çš„ loader+èµ„æºè·¯å¾„</li>
<li>data: å’Œæ™®é€šçš„ loader å‡½æ•°çš„ç¬¬ä¸‰ä¸ªå‚æ•°ä¸€æ ·,è€Œä¸” loader æ‰§è¡Œçš„å…¨ç¨‹ç”¨çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡</li>
<li>æ³¨æ„<code>sourceMaps</code>æœ€åæœ‰ä¸ª<code>s</code></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//cssæ–‡æœ¬ä»£ç  export default
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">normalize</span><span class="p">(</span><span class="nx">path</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">path</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\\/g</span><span class="p">,</span> <span class="s2">&#34;/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">loader</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// pitchæ˜¯loaderçš„ä¸€ä¸ªæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">loader</span><span class="p">.</span><span class="nx">pitch</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">remainingRequest</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;remainingRequest&#34;</span><span class="p">,</span> <span class="nx">remainingRequest</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;context&#34;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">);</span> <span class="c1">//index.lessæ¨¡å—æ‰€åœ¨çš„ç›®å½• å¯ä»¥ç”¨ä½œè§£æå…¶ä»–æ¨¡å—æˆå‘˜çš„ä¸Šä¸‹æ–‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//1.è·å–å‰©ä¸‹çš„è¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//2.ç”¨!åˆ†å‰²å¾—åˆ°å„ä¸ªéƒ¨åˆ†çš„ç»å¯¹è·¯å¾„ï¼Œå‰é¢æ˜¯loaderè·¯å¾„ï¼Œåé¢æ˜¯æ–‡ä»¶è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//3.æŠŠè·¯å¾„ä»ç»å¯¹è·¯å¾„å˜æˆç›¸å¯¹äºæ ¹ç›®å½•çš„ç›¸å¯¹è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//è·¯å¾„çš„å‰é¢è¦åŠ ä¸Š!!,åªä½¿ç”¨è¡Œå†…loader,ä¸ä½¿ç”¨ruleé‡Œé¢é…ç½®çš„loader,ä¸ç„¶å°±ä¼šæ­»å¾ªç¯äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="cm">/*   
</span></span></span><span class="line"><span class="cl"><span class="cm">  	const request = &#34;!!&#34;+(remainingRequest.split(&#39;!&#39;).map(
</span></span></span><span class="line"><span class="cl"><span class="cm">    //è¿™ä¸ªè·¯å¾„å…¶å®å°±æ˜¯æ¨¡å—çš„ID
</span></span></span><span class="line"><span class="cl"><span class="cm">    requestAbsPath =&gt; (&#34;./&#34; + path.posix.relative(normalize(this.context), 							normalize(requestAbsPath)))).join(&#39;!&#39;));
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(&#39;request&#39;, request);
</span></span></span><span class="line"><span class="cl"><span class="cm">    */</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">request</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;!!&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">    <span class="nx">remainingRequest</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">request</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">utils</span><span class="p">.</span><span class="nx">contextify</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">context</span><span class="p">,</span> <span class="nx">request</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;request&#34;</span><span class="p">,</span> <span class="nx">request</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">script</span> <span class="o">=</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">     let styleCSS = require(</span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span><span class="si">}</span><span class="sb">);
</span></span></span><span class="line"><span class="cl"><span class="sb">     let style = document.createElement(&#39;style&#39;);
</span></span></span><span class="line"><span class="cl"><span class="sb">     style.innerHTML =styleCSS;
</span></span></span><span class="line"><span class="cl"><span class="sb">     document.head.appendChild(style);
</span></span></span><span class="line"><span class="cl"><span class="sb">   `</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">script</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1">//require(&#34;!!../loaders/less-loader.js!./index.less&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm">[
</span></span></span><span class="line"><span class="cl"><span class="cm">  C:\aproject\webpack202208\5.loader\loaders\less-loader.js,
</span></span></span><span class="line"><span class="cl"><span class="cm"> C:\aproject\webpack202208\5.loader\src\index.less
</span></span></span><span class="line"><span class="cl"><span class="cm">]
</span></span></span><span class="line"><span class="cl"><span class="cm">request=[
</span></span></span><span class="line"><span class="cl"><span class="cm"> ./loaders\less-loader.js,
</span></span></span><span class="line"><span class="cl"><span class="cm"> .\src\index.less
</span></span></span><span class="line"><span class="cl"><span class="cm">]
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="less-loader">less-loader
</h3><p>less-loader è¿”å›çš„æ˜¯ css ä»£ç ï¼Œä½†æ˜¯å¦‚æœè¿”å›çš„ä¸æ˜¯ä¸€æ®µ css ä»£ç è€Œæ˜¯ js ä»£ç çš„è¯ï¼Œå°±éœ€è¦åç»­çš„ loader å¯¹è¿”å›çš„æ˜¯ js ä»£ç ä¹Ÿè¦æä¾›æ”¯æŒã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">less</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;less&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">loader</span><span class="p">(</span><span class="nx">source</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// è¯¥loaderå‡½æ•°ä¸­çš„thiså°±æ˜¯ç”±loader-runneråº“ç»‘å®šçš„ï¼Œé‡Œé¢æœ‰ä¸€äº›æ–¹æ³•å’Œå±æ€§
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="kr">async</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">less</span><span class="p">.</span><span class="nx">render</span><span class="p">(</span><span class="nx">source</span><span class="p">,</span> <span class="p">{</span> <span class="nx">filename</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">resource</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">output</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// callback(err,output.css)  // ç›´æ¥è¿”å›cssä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="sb">`module.exports = </span><span class="si">${</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">output</span><span class="p">.</span><span class="nx">css</span><span class="p">)</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span> <span class="c1">// è¿”å›jsä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="loader-runner-å®ç°">loader-runner å®ç°
</h3><p>loader-runner çš„ä½¿ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">runLoaders</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./loader-runner&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">entryFile</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;src/index.js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">request</span> <span class="o">=</span> <span class="sb">`inline-loader1!inline-loader2!</span><span class="si">${</span><span class="nx">entryFile</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">rules</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;normal-loader1&#34;</span><span class="p">,</span> <span class="s2">&#34;normal-loader2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enforce</span><span class="o">:</span> <span class="s2">&#34;pre&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;pre-loader1&#34;</span><span class="p">,</span> <span class="s2">&#34;pre-loader2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/\.js$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">enforce</span><span class="o">:</span> <span class="s2">&#34;post&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">use</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;post-loader1&#34;</span><span class="p">,</span> <span class="s2">&#34;post-loader2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^-?!+/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">).</span><span class="nx">split</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">resource</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">inlineLoaders</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">preLoaders</span> <span class="o">=</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">postLoaders</span> <span class="o">=</span> <span class="p">[],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">normalLoaders</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">rules</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">rule</span> <span class="o">=</span> <span class="nx">rules</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">resource</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">test</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">enforce</span> <span class="o">==</span> <span class="s2">&#34;pre&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">preLoaders</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">rule</span><span class="p">.</span><span class="nx">use</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">rule</span><span class="p">.</span><span class="nx">enforce</span> <span class="o">==</span> <span class="s2">&#34;post&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">postLoaders</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">rule</span><span class="p">.</span><span class="nx">use</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">normalLoaders</span><span class="p">.</span><span class="nx">push</span><span class="p">(...</span><span class="nx">rule</span><span class="p">.</span><span class="nx">use</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">loaders</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&#34;!!&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaders</span> <span class="o">=</span> <span class="nx">inlineLoaders</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&#34;-!&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaders</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">postLoaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">inlineLoaders</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaders</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">postLoaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">inlineLoaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">preLoaders</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaders</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">postLoaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">inlineLoaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">normalLoaders</span><span class="p">,</span> <span class="p">...</span><span class="nx">preLoaders</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//æŠŠloaderä»ä¸€ä¸ªåç§°å˜æˆä¸€ä¸ªç»å¯¹è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">loaders</span> <span class="o">=</span> <span class="nx">loaders</span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="s2">&#34;loader-chain&#34;</span><span class="p">,</span> <span class="nx">loader</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">debugger</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">runLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resource</span><span class="p">,</span> <span class="c1">//è¦å¤„ç†çš„èµ„æºæ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">loaders</span><span class="p">,</span> <span class="c1">//èµ„æºæ–‡ä»¶éœ€è¦ç»è¿‡å‘äº›loaderçš„å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">context</span><span class="o">:</span> <span class="p">{</span> <span class="nx">age</span><span class="o">:</span> <span class="mi">18</span><span class="p">,</span> <span class="nx">author</span><span class="o">:</span> <span class="s2">&#34;zhufeng&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">readResource</span><span class="o">:</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFile</span><span class="p">,</span> <span class="c1">//è¯»æ–‡ä»¶ç”¨å“ªä¸ªæ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//finalCallback
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">result</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toString</span><span class="p">());</span> <span class="c1">//è½¬æ¢åçš„ç»“æœ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//è½¬æ¢å‰æºæ–‡ä»¶çš„å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">.</span><span class="nx">resourceBuffer</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">result</span><span class="p">.</span><span class="nx">resourceBuffer</span> <span class="o">?</span> <span class="nx">result</span><span class="p">.</span><span class="nx">resourceBuffer</span><span class="p">.</span><span class="nx">toString</span><span class="p">()</span> <span class="o">:</span> <span class="kc">null</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>loader çš„è¿è¡Œæµç¨‹</strong></p>
<p><img src="http://static.zhufengpeixun.com/loaderflow1_1661312752787.jpg"
	
	
	
	loading="lazy"
	
		alt="img"
	
	
></p>
<p><strong>å®ç°</strong></p>
<ul>
<li><a class="link" href="https://github.com/webpack/loader-runner/blob/v2.4.0/lib/LoaderRunner.js"  target="_blank" rel="noopener"
    >LoaderRunner.js</a></li>
<li><a class="link" href="https://github.com/webpack/webpack/blob/v4.39.3/lib/NormalModuleFactory.js#L180"  target="_blank" rel="noopener"
    >NormalModuleFactory.js</a></li>
<li><a class="link" href="https://github.com/webpack/webpack/blob/v4.39.3/lib/NormalModule.js#L292"  target="_blank" rel="noopener"
    >NormalModule.js</a></li>
</ul>
<p><img src="/blogs/post/webpack/images/image-20240217143955675.png"
	width="597"
	height="882"
	srcset="/blogs/post/webpack/images/image-20240217143955675_hu_f5f4f1eea21c161d.png 480w, /blogs/post/webpack/images/image-20240217143955675_hu_21345f4a993fb86b.png 1024w"
	loading="lazy"
	
		alt="image-20240217143955675"
	
	
		class="gallery-image" 
		data-flex-grow="67"
		data-flex-basis="162px"
	
></p>
<p><img src="/blogs/post/webpack/images/image-20240217144031893.png"
	width="1325"
	height="507"
	srcset="/blogs/post/webpack/images/image-20240217144031893_hu_8ce6265748fcacb9.png 480w, /blogs/post/webpack/images/image-20240217144031893_hu_29eacbd904f5ea4c.png 1024w"
	loading="lazy"
	
		alt="image-20240217144031893"
	
	
		class="gallery-image" 
		data-flex-grow="261"
		data-flex-basis="627px"
	
></p>
<p>æ¯ä¸ª loader å¯¼å‡ºçš„å‡½æ•°ä¸­çš„ this éƒ½æ˜¯ç”± loader-runner è¿™ä¸ªåº“ç»‘å®šçš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ ¹æ®loaderçš„ç»å¯¹è·¯å¾„åˆ›å»ºloaderå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param {*} loaderAbsPath
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">createLoaderObject</span><span class="p">(</span><span class="nx">loaderAbsPath</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">normal</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="nx">loaderAbsPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">pitch</span> <span class="o">=</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">pitch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å¦‚æœè®¾ç½®normal.rawå±æ€§ä¸ºtrueçš„è¯ï¼Œé‚£ä¹ˆloaderçš„normalå‡½æ•°å‚æ•°å°±æ˜¯ä¸€ä¸ªBuffer,å¦åˆ™å°±æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">raw</span> <span class="o">=</span> <span class="nx">normal</span><span class="p">.</span><span class="nx">raw</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">loaderAbsPath</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">normal</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pitch</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">raw</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">data</span><span class="o">:</span> <span class="p">{},</span> <span class="c1">//æ¯ä¸ªloaderéƒ½æœ‰ä¸€ä¸ªè‡ªå·²çš„è‡ªå®šå¯¹è±¡ï¼Œå¯ä»¥æœ‰ç”¨æ¥ä¿å­˜å’Œä¼ é€’æ•°æ®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">pitchExecuted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">//è¡¨ç¤ºæ­¤loaderçš„pitchå·²ç»æ‰§è¡Œè¿‡äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">normalExecuted</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span> <span class="c1">//è¡¨ç¤ºæ­¤loaderçš„normalå‡½æ•°å·²ç»æ‰§è¡Œè¿‡äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * è½¬æ¢loaderçš„å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param {*} args å‚æ•°
</span></span></span><span class="line"><span class="cl"><span class="cm"> * @param {*} raw å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºloaderæƒ³è¦å­—ç¬¦ä¸²è¿˜æ˜¯æƒ³è¦Buffer
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">convertArgs</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">raw</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">raw</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">Buffer</span><span class="p">.</span><span class="nx">isBuffer</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">from</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">raw</span> <span class="o">&amp;&amp;</span> <span class="nx">Buffer</span><span class="p">.</span><span class="nx">isBuffer</span><span class="p">(</span><span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">args</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">toString</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">iterateNormalLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">args</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">pitchingCallback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">currentLoader</span> <span class="o">=</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span><span class="p">[</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">currentLoader</span><span class="p">.</span><span class="nx">normalExecuted</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">iterateNormalLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">args</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">currentLoader</span><span class="p">.</span><span class="nx">normal</span><span class="p">;</span> <span class="c1">//å°±æ˜¯loaderé‡Œçš„normalå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">currentLoader</span><span class="p">.</span><span class="nx">normalExecuted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">convertArgs</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="nx">currentLoader</span><span class="p">.</span><span class="nx">raw</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//è¦ä»¥åŒæ­¥æˆ–è€…å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œfn
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">loaderContext</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">...</span><span class="nx">returnArgs</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="nx">pitchingCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">iterateNormalLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">returnArgs</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">loaderContext</span><span class="p">,</span> <span class="nx">args</span><span class="p">,</span> <span class="nx">runCallback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">isSync</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="c1">//é»˜è®¤fnçš„çš„æ‰§è¡Œæ˜¯åŒæ­¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">//è¡¨ç¤ºå½“å‰çš„å‡½æ•°æ˜¯å¦å·²ç»å®Œæˆäº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">isDone</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&#34;callback(): The callback was already called.&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//callback æ˜¯ä¸æ˜¯è¦åˆ¤æ–­ä¸‹isSyncçš„å€¼å•Š
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">runCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">...</span><span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaderContext</span><span class="p">.</span><span class="kr">async</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">isSync</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">callback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å¦‚æœå½“å‰çš„æ‰§è¡Œæ˜¯åŒæ­¥çš„è¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">if</span> <span class="p">(</span><span class="nx">isSync</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">runCallback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å¦‚æœæ˜¯å¼‚æ­¥ï¼Œä¸ä¼šç«‹åˆ»è°ƒç”¨runCallback,éœ€è¦ä½ åœ¨loaderçš„å†…éƒ¨æ‰‹å·¥è§¦å‘callback,ç„¶åæ‰§è¡ŒrunCallback
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">processResource</span><span class="p">(</span><span class="nx">processOptions</span><span class="p">,</span> <span class="nx">loaderContext</span><span class="p">,</span> <span class="nx">pitchingCallback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">processOptions</span><span class="p">.</span><span class="nx">readResource</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">resource</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">resourceBuffer</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">processOptions</span><span class="p">.</span><span class="nx">resourceBuffer</span> <span class="o">=</span> <span class="nx">resourceBuffer</span><span class="p">;</span> <span class="c1">//è¦åŠ è½½çš„èµ„æºçš„äºŒè¿›åˆ¶æ•°ç»„ Buffer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">iterateNormalLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">[</span><span class="nx">resourceBuffer</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">iteratePitchingLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span> <span class="o">&gt;=</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">processResource</span><span class="p">(</span><span class="nx">processOptions</span><span class="p">,</span> <span class="nx">loaderContext</span><span class="p">,</span> <span class="nx">pitchingCallback</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//è·å–å½“å‰ç´¢å¼•å¯¹åº”çš„loaderå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">currentLoader</span> <span class="o">=</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span><span class="p">[</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">currentLoader</span><span class="p">.</span><span class="nx">pitchExecuted</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">iteratePitchingLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å› ä¸ºæˆ‘ä»¬è¦ä¿è¯ä¸€ä¸ªloader pitchæˆ–è€…è¯´normalåªèµ°ä¸€æ¬¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//è·å–å½“å‰loaderå¯¹åº”çš„pitchå‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">fn</span> <span class="o">=</span> <span class="nx">currentLoader</span><span class="p">.</span><span class="nx">pitch</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">currentLoader</span><span class="p">.</span><span class="nx">pitchExecuted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">iteratePitchingLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">runSyncOrAsync</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fn</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">remainingRequest</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">previousRequest</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">data</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">...</span><span class="nx">returnArgs</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//åˆ¤æ–­pitchæ–¹æ³•çš„è¿”å›å€¼æœ‰æ²¡æœ‰ï¼Œå¦‚æœæœ‰åˆ™è·³è¿‡åé¢çš„loader,è¿”å›å¤´æ‰§è¡Œå‰ä¸€ä¸ªloader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">returnArgs</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">returnArgs</span><span class="p">.</span><span class="nx">some</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">item</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">iterateNormalLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">args</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">iteratePitchingLoaders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="nx">processOptions</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">loaderContext</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">pitchingCallback</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runLoaders</span><span class="p">(</span><span class="nx">options</span><span class="p">,</span> <span class="nx">finalCallback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//resourceè¦å¤„ç†çš„èµ„æºï¼Œæˆ–è€…è¯´è¦ç¼–è¯‘çš„æ¨¡å—è·¯å¾„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//loaderså¤„ç†æ­¤è·¯å¾„çš„loaders
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//contextæŒ‡çš„æ˜¯loaderå‡½æ•°åœ¨æ‰§è¡Œçš„æ—¶å€™thisæŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//readResourceè¯»å–æ–‡ä»¶çš„æ–¹æ³•fs.readFile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="p">{</span> <span class="nx">resource</span><span class="p">,</span> <span class="nx">loaders</span> <span class="o">=</span> <span class="p">[],</span> <span class="nx">context</span> <span class="o">=</span> <span class="p">{},</span> <span class="nx">readResource</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//loadersç°åœ¨æ˜¯ä¸€ä¸ªloaderæ¨¡å—çš„ç»å¯¹è·¯å¾„ï¼Œè½¬æˆä¸€ä¸ªå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">const</span> <span class="nx">loaderObjects</span> <span class="o">=</span> <span class="nx">loaders</span><span class="p">.</span><span class="nx">map</span><span class="p">(</span><span class="nx">createLoaderObject</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">loaderContext</span> <span class="o">=</span> <span class="nx">context</span><span class="p">;</span> <span class="c1">//è¿™ä¸ªå¯¹è±¡å°±æ˜¯loaderæ‰§è¡Œçš„æ—¶å€™çš„thisæŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">resource</span> <span class="o">=</span> <span class="nx">resource</span><span class="p">;</span> <span class="c1">//åŠ è½½çš„æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">readResource</span> <span class="o">=</span> <span class="nx">readResource</span><span class="p">;</span> <span class="c1">//è¯»å–æ–‡ä»¶çš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span> <span class="o">=</span> <span class="nx">loaderObjects</span><span class="p">;</span> <span class="c1">//å­˜æ”¾loaderså¯¹è±¡æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//å½“å‰æ­£åœ¨å¤„ç†çš„loaderçš„ç´¢å¼•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">//å¯ä»¥æ‰‹å·¥è°ƒç”¨æ­¤æ–¹æ³•å‘åæ‰§è¡Œä¸‹ä¸€ä¸ªloader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">loaderContext</span><span class="p">.</span><span class="kr">async</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span> <span class="c1">//å¯ä»¥æŠŠloaderè¿è¡Œä»åŒæ­¥å˜ä¸ºå¼‚æ­¥,å¹¶è¿”å›this.callback
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">//ä»£è¡¨æ•´ä¸ªè¯·æ±‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span> <span class="s2">&#34;request&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//æŠŠloaderçš„ç»å¯¹è·¯å¾„å’Œè¦åŠ è½½çš„èµ„æºçš„ç»å¯¹è·¯å¾„ç”¨!æ‹¼åœ¨ä¸€èµ·
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span> <span class="s2">&#34;remainingRequest&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span> <span class="s2">&#34;currentRequest&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">resource</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span> <span class="s2">&#34;previousRequest&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span> <span class="s2">&#34;data&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">get</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaders</span><span class="p">[</span><span class="nx">loaderContext</span><span class="p">.</span><span class="nx">loaderIndex</span><span class="p">].</span><span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">processOptions</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">readResource</span><span class="p">,</span> <span class="c1">//fs.readFile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">resourceBuffer</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="c1">//è¦è¯»å–çš„èµ„æºçš„æºä»£ç ï¼Œå®ƒæ˜¯ä¸€ä¸ªBuffer,å°±äºŒè¿›åˆ¶å­—èŠ‚æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">iteratePitchingLoaders</span><span class="p">(</span><span class="nx">processOptions</span><span class="p">,</span> <span class="nx">loaderContext</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//pitchingCallback
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">finalCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">result</span><span class="p">,</span> <span class="c1">//æ˜¯æœ€ç»ˆå¤„ç†çš„ç»“æœ ,å…¶å®å°±æ˜¯æœ€å·¦åˆ™çš„loaderçš„normal è¿”å›å€¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">resourceBuffer</span><span class="o">:</span> <span class="nx">processOptions</span><span class="p">.</span><span class="nx">resourceBuffer</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">exports</span><span class="p">.</span><span class="nx">runLoaders</span> <span class="o">=</span> <span class="nx">runLoaders</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¸€ä¸ªé¢è¯•é¢˜ï¼Œæœ‰ä¸¤ä¸ªå‡½æ•° A å’Œ Bï¼Œå…¶ä¸­ B å‡½æ•°ï¼Œæœ‰æ—¶å€™å¸Œæœ›å®ƒæ˜¯åœ¨ A æ‰§è¡ŒååŒæ­¥æ‰§è¡Œçš„ï¼Œæœ‰æ—¶å€™å¸Œæœ›å®ƒæ˜¯åœ¨ A æ‰§è¡Œåå¼‚æ­¥æ‰§è¡Œçš„ï¼Œå¦‚ä½•å®ç°è¿™ä¸ªå·¥å…·å‡½æ•°ï¼Œå®ƒæ¥å— Aï¼ŒB ä½œä¸ºå®å‚ï¼Ÿ</p>
<p>å¦‚æœè¯¥å‡½æ•°æ˜¯åŒæ­¥çš„ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°ä¼šä¾æ¬¡æ‰§è¡Œï¼Œå¦‚æœè¿™ä¸ªå‡½æ•°æ˜¯å¼‚æ­¥çš„ï¼Œé‚£ä¹ˆå¸Œæœ›åé¢é‚£ä¸ªå‡½æ•°åœ¨è¯¥å¼‚æ­¥å‡½æ•°æ‰§è¡Œå®Œåå†æ‰§è¡Œï¼Œç°åœ¨éœ€è¦å®ç°ä¸€ä¸ªå·¥å…·å‡½æ•°æ¥è¾¾åˆ°è¿™ä¸ªç›®çš„ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span><span class="nx">loaderContent</span><span class="p">,</span><span class="nx">args</span><span class="p">,</span><span class="nx">runCallback</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">isSync</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span><span class="c1">// é»˜è®¤åŒæ­¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kd">let</span> <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">false</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">err</span><span class="p">,...</span><span class="nx">args</span><span class="p">)=&gt;{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span><span class="p">(</span><span class="nx">isDone</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">            <span class="nx">thorow</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;å·²ç»æ‰§è¡Œè¿‡callbackå‡½æ•°ï¼Œæ— æ³•å†æ¬¡æ‰§è¡Œ&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">runCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">,...</span><span class="nx">args</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">loaderContext</span><span class="p">.</span><span class="kr">async</span> <span class="o">=</span> <span class="p">()=&gt;{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">isSync</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">loaderContext</span><span class="p">.</span><span class="nx">callback</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">loaderContext</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span><span class="p">(</span><span class="nx">isSync</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">        <span class="nx">isDone</span> <span class="o">=</span> <span class="kc">true</span>
</span></span><span class="line"><span class="cl">        <span class="nx">runCallback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span><span class="nx">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ‹ŸåŒæ­¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">normal</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;normal&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="s2">&#34;normal&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">cons</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;callback&#34;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ‹Ÿå¼‚æ­¥ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">normal</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;normal&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="kr">async</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">callback</span><span class="p">(</span><span class="s2">&#34;normal&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;callback&#34;</span> <span class="o">+</span> <span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">fn</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">contextFn</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">sync</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="nx">contextFn</span><span class="p">.</span><span class="kr">async</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">contextFn</span><span class="p">.</span><span class="nx">sync</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">callback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kr">const</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">contextFn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">contextFn</span><span class="p">.</span><span class="nx">sync</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">callback</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">runSyncOrAsync</span><span class="p">(</span><span class="nx">normal</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="æ¨¡æ‹Ÿå®ç°å¾®å‹çš„-webpack">æ¨¡æ‹Ÿå®ç°å¾®å‹çš„ webpack
</h2><p>æ¨¡æ‹Ÿä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ä¿±å…¨çš„å¾®å‹ Webpack éœ€è¦åŒ…å«ä»¥ä¸‹å‡ ä¸ªå…³é”®éƒ¨åˆ†ï¼š</p>
<ol>
<li><strong>å…¥å£æ–‡ä»¶çš„è§£æ</strong>ï¼šé€šè¿‡é€’å½’åˆ†æä¾èµ–å…³ç³»ï¼Œæ„å»ºæ¨¡å—ä¾èµ–å›¾ã€‚</li>
<li><strong>æ‰“åŒ…</strong>ï¼šå°†æ‰€æœ‰çš„æ¨¡å—åˆå¹¶æˆä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ã€‚</li>
<li><strong>Loader æœºåˆ¶</strong>ï¼šæ”¯æŒå¯¹ä¸åŒç±»å‹çš„æ–‡ä»¶è¿›è¡Œè½¬æ¢ï¼Œå¦‚å°† ES6 è½¬æ¢ä¸º ES5ã€‚</li>
<li><strong>æ’ä»¶æœºåˆ¶</strong>ï¼šé€šè¿‡ç”Ÿå‘½å‘¨æœŸé’©å­æ‰©å±• Webpack åŠŸèƒ½ã€‚</li>
</ol>
<p>æˆ‘ä»¬ä¼šä½¿ç”¨ Node.js å®ç°ä¸€ä¸ªå¾®å‹çš„ Webpackï¼Œè™½ç„¶ç®€åŒ–äº†å¾ˆå¤šåŠŸèƒ½ï¼Œä½†å®ƒèƒ½å¸®åŠ©ç†è§£ Webpack çš„æ ¸å¿ƒè®¾è®¡ã€‚</p>
<ol>
<li><strong>æ¨¡å—ä¾èµ–è§£æ</strong></li>
</ol>
<p>é¦–å…ˆï¼Œéœ€è¦é€’å½’è§£æå…¥å£æ–‡ä»¶åŠå…¶ä¾èµ–æ¨¡å—ã€‚è¿™é‡Œå¯ä»¥ç”¨ Node.js çš„ <code>fs</code> æ¨¡å—æ¥è¯»å–æ–‡ä»¶ï¼Œå¹¶é€šè¿‡ <code>babel</code> æ¥è§£æå¹¶è½¬æ¢æ¨¡å—ã€‚</p>
<ol start="2">
<li><strong>æ¨¡æ‹Ÿ Loader æœºåˆ¶</strong></li>
</ol>
<p>ä¸ºäº†æ¨¡æ‹Ÿ Loaderï¼Œä¼šå…è®¸é…ç½®ä¸€ä¸ªç®€å•çš„å‡½æ•°é“¾ï¼Œå¤„ç†æ¯ä¸ªæ¨¡å—çš„å†…å®¹ã€‚</p>
<ol start="3">
<li><strong>æ¨¡æ‹Ÿæ’ä»¶ç³»ç»Ÿ</strong></li>
</ol>
<p>æ’ä»¶ç³»ç»ŸåŸºäº Webpack çš„ç”Ÿå‘½å‘¨æœŸé’©å­æœºåˆ¶ï¼Œç”¨äº‹ä»¶é©±åŠ¨æ¨¡å‹æ¥å®ç°æ’ä»¶åŠŸèƒ½ã€‚</p>
<p><strong>ä»£ç å®ç°</strong></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ªç®€å•çš„å¾®å‹ Webpack çš„å®ç°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// å¾®å‹Webpackçš„å®ç°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;fs&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">babel</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;@babel/core&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">SyncHook</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span> <span class="c1">// ä½¿ç”¨Tapableæ¥æ¨¡æ‹Ÿäº‹ä»¶æœºåˆ¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">MiniWebpack</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">entry</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">entry</span><span class="p">;</span> <span class="c1">// å…¥å£æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">output</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">output</span><span class="p">;</span> <span class="c1">// è¾“å‡ºé…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">modules</span> <span class="o">=</span> <span class="p">[];</span> <span class="c1">// æ¨¡å—ä¾èµ–æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">loaders</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">loaders</span> <span class="o">||</span> <span class="p">[];</span> <span class="c1">// æ¨¡æ‹ŸLoaderæ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">=</span> <span class="nx">options</span><span class="p">.</span><span class="nx">plugins</span> <span class="o">||</span> <span class="p">[];</span> <span class="c1">// æ’ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">beforeRun</span><span class="o">:</span> <span class="k">new</span> <span class="nx">SyncHook</span><span class="p">([</span><span class="s2">&#34;compiler&#34;</span><span class="p">]),</span> <span class="c1">// æ³¨å†Œé’©å­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">afterCompile</span><span class="o">:</span> <span class="k">new</span> <span class="nx">SyncHook</span><span class="p">([</span><span class="s2">&#34;compiler&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">emit</span><span class="o">:</span> <span class="k">new</span> <span class="nx">SyncHook</span><span class="p">([</span><span class="s2">&#34;compiler&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">      <span class="nx">done</span><span class="o">:</span> <span class="k">new</span> <span class="nx">SyncHook</span><span class="p">([</span><span class="s2">&#34;stats&#34;</span><span class="p">]),</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// åº”ç”¨æ’ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">plugins</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">plugin</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">plugin</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// è¯»å–æ–‡ä»¶å†…å®¹å¹¶è§£æ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">parseModule</span><span class="p">(</span><span class="nx">filename</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">let</span> <span class="nx">content</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="s2">&#34;utf-8&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å¤„ç† Loader
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">loaders</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">loader</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">loader</span><span class="p">.</span><span class="nx">test</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">filename</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">content</span> <span class="o">=</span> <span class="nx">loader</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ä½¿ç”¨ Babel å°† ES6 è½¬æ¢ä¸º ES5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="p">{</span> <span class="nx">ast</span><span class="p">,</span> <span class="nx">code</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">babel</span><span class="p">.</span><span class="nx">transformSync</span><span class="p">(</span><span class="nx">content</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">ast</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">presets</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;@babel/preset-env&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æå–ä¾èµ–æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">dependencies</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">babel</span><span class="p">.</span><span class="nx">traverse</span><span class="p">(</span><span class="nx">ast</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">ImportDeclaration</span><span class="p">({</span> <span class="nx">node</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">dependencies</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span> <span class="nx">filename</span><span class="p">,</span> <span class="nx">code</span><span class="p">,</span> <span class="nx">dependencies</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// æ„å»ºæ¨¡å—ä¾èµ–å›¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">buildDependencyGraph</span><span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">entryModule</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseModule</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">graph</span> <span class="o">=</span> <span class="p">[</span><span class="nx">entryModule</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// é€’å½’è§£ææ¨¡å—ä¾èµ–çš„å…¶ä»–æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">mod</span> <span class="k">of</span> <span class="nx">graph</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">mod</span><span class="p">.</span><span class="nx">dependencies</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">dep</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">depPath</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">path</span><span class="p">.</span><span class="nx">dirname</span><span class="p">(</span><span class="nx">mod</span><span class="p">.</span><span class="nx">filename</span><span class="p">),</span> <span class="nx">dep</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kr">const</span> <span class="nx">depModule</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">parseModule</span><span class="p">(</span><span class="nx">depPath</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">graph</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">depModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">graph</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// ç”Ÿæˆæ‰“åŒ…åçš„ä»£ç 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">generateCode</span><span class="p">(</span><span class="nx">graph</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">modules</span> <span class="o">=</span> <span class="nx">graph</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">mod</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sb">`&#34;</span><span class="si">${</span><span class="nx">mod</span><span class="p">.</span><span class="nx">filename</span><span class="si">}</span><span class="sb">&#34;: function(require, module, exports) { </span><span class="si">${</span><span class="nx">mod</span><span class="p">.</span><span class="nx">code</span><span class="si">}</span><span class="sb"> }`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">})</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&#34;,&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="sb">`
</span></span></span><span class="line"><span class="cl"><span class="sb">      (function(modules) {
</span></span></span><span class="line"><span class="cl"><span class="sb">        function require(filename) {
</span></span></span><span class="line"><span class="cl"><span class="sb">          const fn = modules[filename];
</span></span></span><span class="line"><span class="cl"><span class="sb">          const module = { exports: {} };
</span></span></span><span class="line"><span class="cl"><span class="sb">          fn(require, module, module.exports);
</span></span></span><span class="line"><span class="cl"><span class="sb">          return module.exports;
</span></span></span><span class="line"><span class="cl"><span class="sb">        }
</span></span></span><span class="line"><span class="cl"><span class="sb">        require(&#34;</span><span class="si">${</span><span class="k">this</span><span class="p">.</span><span class="nx">entry</span><span class="si">}</span><span class="sb">&#34;);
</span></span></span><span class="line"><span class="cl"><span class="sb">      })({</span><span class="si">${</span><span class="nx">modules</span><span class="si">}</span><span class="sb">});
</span></span></span><span class="line"><span class="cl"><span class="sb">    `</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// æ‰§è¡Œæ‰“åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">beforeRun</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// æ„å»ºä¾èµ–å›¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">graph</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">buildDependencyGraph</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">afterCompile</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç”Ÿæˆä»£ç å¹¶å†™å…¥æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">output</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">generateCode</span><span class="p">(</span><span class="nx">graph</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">emit</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">fs</span><span class="p">.</span><span class="nx">writeFileSync</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">path</span><span class="p">,</span> <span class="nx">output</span><span class="p">,</span> <span class="s2">&#34;utf-8&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nx">call</span><span class="p">({</span> <span class="nx">output</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">MiniWebpack</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="ä½¿ç”¨æ–¹å¼">ä½¿ç”¨æ–¹å¼
</h3><h4 id="1-å®šä¹‰-loader">1. å®šä¹‰ Loader
</h4><p>åœ¨è¿™ä¸ªå¾®å‹ Webpack ä¸­ï¼ŒLoader åªæ˜¯ç®€å•çš„å‡½æ•°è½¬æ¢ã€‚æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªåŒ¹é…æ–‡ä»¶ç±»å‹çš„æ­£åˆ™è¡¨è¾¾å¼å’Œå¤„ç†å‡½æ•°ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">jså¤åˆ¶ä»£ç </span><span class="o">//</span> <span class="n">loaderä¾‹å­</span>
</span></span><span class="line"><span class="cl"><span class="n">module</span><span class="o">.</span><span class="n">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">test</span><span class="p">:</span> <span class="o">/</span>\<span class="o">.</span><span class="n">js</span><span class="o">$/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">use</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="o">//</span> <span class="err">ç®€å•çš„è½¬æ¢</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">content</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="o">/</span><span class="n">console</span>\<span class="o">.</span><span class="n">log</span><span class="o">/</span><span class="n">g</span><span class="p">,</span> <span class="s1">&#39;alert&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="2-å®šä¹‰æ’ä»¶">2. å®šä¹‰æ’ä»¶
</h4><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ’ä»¶æ¥æ‰©å±• Webpack çš„åŠŸèƒ½ï¼Œä¾‹å¦‚åœ¨æ‰“åŒ…çš„ä¸åŒé˜¶æ®µæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚æ’ä»¶é€šè¿‡ <code>apply</code> æ–¹æ³•æ³¨å†Œåˆ° Webpack ä¸­ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">jså¤åˆ¶ä»£ç </span><span class="o">//</span> <span class="n">pluginä¾‹å­</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="n">HelloWorldPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">apply</span><span class="p">(</span><span class="n">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">compiler</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">beforeRun</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="s1">&#39;HelloWorldPlugin&#39;</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Webpack æ„å»ºå¼€å§‹ï¼&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="n">compiler</span><span class="o">.</span><span class="n">hooks</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">tap</span><span class="p">(</span><span class="s1">&#39;HelloWorldPlugin&#39;</span><span class="p">,</span> <span class="n">stats</span> <span class="o">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="n">console</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="s1">&#39;Webpack æ„å»ºå®Œæˆï¼&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">module</span><span class="o">.</span><span class="n">exports</span> <span class="o">=</span> <span class="n">HelloWorldPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="3-webpack-é…ç½®">3. Webpack é…ç½®
</h4><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">jså¤åˆ¶ä»£ç const</span> <span class="n">MiniWebpack</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./mini-webpack&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">HelloWorldPlugin</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./hello-world-plugin&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">babelLoader</span> <span class="o">=</span> <span class="n">require</span><span class="p">(</span><span class="s1">&#39;./babel-loader&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">entry</span><span class="p">:</span> <span class="s1">&#39;./src/index.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="n">output</span><span class="p">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">path</span><span class="p">:</span> <span class="s1">&#39;./dist/bundle.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="n">loaders</span><span class="p">:</span> <span class="p">[</span><span class="n">babelLoader</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="n">plugins</span><span class="p">:</span> <span class="p">[</span><span class="n">new</span> <span class="n">HelloWorldPlugin</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">const</span> <span class="n">compiler</span> <span class="o">=</span> <span class="n">new</span> <span class="n">MiniWebpack</span><span class="p">(</span><span class="n">config</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="n">compiler</span><span class="o">.</span><span class="n">run</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="è¿è¡Œæ‰“åŒ…æµç¨‹">è¿è¡Œæ‰“åŒ…æµç¨‹
</h3><p>å‡è®¾æˆ‘ä»¬æœ‰ä»¥ä¸‹é¡¹ç›®ç»“æ„ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">bashå¤åˆ¶ä»£ç </span><span class="o">/</span><span class="n">src</span>
</span></span><span class="line"><span class="cl">  <span class="n">index</span><span class="o">.</span><span class="n">js</span>
</span></span><span class="line"><span class="cl">  <span class="n">other</span><span class="o">.</span><span class="n">js</span>
</span></span><span class="line"><span class="cl"><span class="n">mini</span><span class="o">-</span><span class="n">webpack</span><span class="o">.</span><span class="n">js</span>
</span></span><span class="line"><span class="cl"><span class="n">babel</span><span class="o">-</span><span class="n">loader</span><span class="o">.</span><span class="n">js</span>
</span></span><span class="line"><span class="cl"><span class="n">hello</span><span class="o">-</span><span class="n">world</span><span class="o">-</span><span class="n">plugin</span><span class="o">.</span><span class="n">js</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>index.js</code> é€šè¿‡ <code>import</code> ä¾èµ–äº† <code>other.js</code>ã€‚å½“æˆ‘ä»¬è¿è¡Œ <code>node build.js</code>ï¼ŒWebpack å°±ä¼šæŒ‰ç…§å¦‚ä¸‹æµç¨‹æ‰§è¡Œï¼š</p>
<ol>
<li><strong>è§£æå…¥å£æ–‡ä»¶</strong>ï¼šä» <code>entry</code> å¼€å§‹ï¼Œè§£æä»£ç ï¼Œæå–ä¾èµ–å…³ç³»ï¼Œå¹¶é€šè¿‡ Loader å¤„ç†æ–‡ä»¶ã€‚</li>
<li><strong>æ„å»ºä¾èµ–å›¾</strong>ï¼šé€’å½’è§£ææ‰€æœ‰çš„ä¾èµ–æ–‡ä»¶ï¼Œæ„å»ºå®Œæ•´çš„æ¨¡å—ä¾èµ–å›¾ã€‚</li>
<li><strong>ç”Ÿæˆä»£ç </strong>ï¼šæ ¹æ®ä¾èµ–å›¾ï¼Œå°†æ‰€æœ‰æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œä½¿ç”¨è‡ªå®šä¹‰çš„ <code>require</code> å‡½æ•°æ¥åŠ è½½æ¨¡å—ã€‚</li>
<li><strong>è§¦å‘æ’ä»¶</strong>ï¼šæ’ä»¶ä¼šåœ¨æ„å»ºçš„ä¸åŒé˜¶æ®µé€šè¿‡é’©å­ç³»ç»Ÿæ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</li>
</ol>
<h2 id="æ’ä»¶">æ’ä»¶
</h2><h3 id="å‰ç½®çŸ¥è¯†">å‰ç½®çŸ¥è¯†
</h3><p>é¢è¯•çš„æ—¶å€™æ‰‹å†™å¹¶å‘æ§åˆ¶ï¼Œå¼‚æ­¥æœºåˆ¶ä»£ç ï¼Œéƒ½å¯ä»¥å‚è€ƒ tapable åº“çš„è¿™äº›æ–¹æ³•ã€‚tapable å¯ä»¥ç‹¬ç«‹ä½¿ç”¨ã€‚</p>
<p>å¼‚æ­¥ä»»åŠ¡çš„å¹¶å‘æ•°æ§åˆ¶å‡½æ•°ã€‚</p>
<p>ä¾‹é¢˜ï¼š</p>
<blockquote>
<p>è¯·å®ç°å¦‚ä¸‹çš„å‡½æ•°ï¼Œå¯ä»¥æ‰¹é‡è¯·æ±‚æ•°æ®ï¼Œæ‰€æœ‰çš„ URL åœ°å€åœ¨ urls å‚æ•°ä¸­ï¼ŒåŒæ—¶å¯ä»¥é€šè¿‡ max å‚æ•°æ§åˆ¶è¯·æ±‚çš„å¹¶å‘åº¦ï¼Œå½“æ‰€æœ‰è¯·æ±‚ç»“æŸä¹‹åï¼Œéœ€è¦æ‰§è¡Œ callback å›è°ƒå‡½æ•°ï¼Œå‘è¯·æ±‚çš„å‡½æ•°å¯ä»¥ç›´æ¥ä½¿ç”¨ fetch å³å¯ã€‚</p>
<p>function sendRequest(urls:string[],max:number,callback:()=&gt;void){ }</p></blockquote>
<p>åœ¨ webpack ä¸­ï¼Œ<code>Compiler</code>å’Œ<code>Compilation</code>å®ä¾‹ä¸Šçš„ hooks ä½¿ç”¨äº†å¤šç§ç±»å‹ï¼Œä»¥æä¾›ä¸åŒçš„æ’ä»¶æœºåˆ¶ï¼Œä»è€Œå…è®¸æ’ä»¶å¼€å‘è€…åœ¨ webpack çš„ç¼–è¯‘è¿‡ç¨‹ä¸­çš„ä¸åŒé˜¶æ®µä»¥ä¸åŒçš„æ–¹å¼å‚ä¸è¿›æ¥ã€‚æ¯ç§ç±»å‹çš„ hook éƒ½æœ‰å…¶ç‰¹å®šçš„è¡Œä¸ºå’Œç”¨é€”ï¼Œè¿™ä½¿å¾— webpack çš„æ’ä»¶ç³»ç»Ÿéå¸¸çµæ´»å’Œå¼ºå¤§ã€‚</p>
<p>Webpack æœ¬è´¨ä¸Šæ˜¯ä¸€ç§äº‹ä»¶æµæœºåˆ¶ï¼Œå®ƒçš„æ ¸å¿ƒæ¶æ„è®¾è®¡å°±æ˜¯å›´ç»•ç€ <strong>äº‹ä»¶é©±åŠ¨</strong> å’Œ <strong>æ’ä»¶ç³»ç»Ÿ</strong> æ¥æ„å»ºçš„ã€‚è¿™ç§è®¾è®¡è®© Webpack æœ¬èº«éå¸¸çµæ´»ï¼Œèƒ½å¤Ÿé€šè¿‡æ’ä»¶ç³»ç»Ÿæ‰©å±•å…¶åŠŸèƒ½ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨æ’ä»¶æ·±å…¥æ§åˆ¶ Webpack çš„æ‰“åŒ…è¿‡ç¨‹ã€‚</p>
<p><strong>Webpack çš„æ ¸å¿ƒè®¾è®¡ç†å¿µ</strong></p>
<ol>
<li><strong>Tapable</strong>ï¼šWebpack åº•å±‚ä½¿ç”¨äº†ä¸€ä¸ªåä¸º <code>Tapable</code> çš„åº“ï¼Œè¿™æ˜¯ Webpack çš„äº‹ä»¶é©±åŠ¨æœºåˆ¶çš„æ ¸å¿ƒã€‚<code>Tapable</code> æä¾›äº†é’©å­ï¼ˆHooksï¼‰æœºåˆ¶ï¼Œç±»ä¼¼äºå‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼Œå¯ä»¥åœ¨ Webpack ç”Ÿå‘½å‘¨æœŸçš„å„ä¸ªå…³é”®èŠ‚ç‚¹ä¸ŠæŒ‚è½½äº‹ä»¶ï¼Œå¹¶è§¦å‘äº‹ä»¶ã€‚</li>
<li><strong>ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆHooksï¼‰</strong>ï¼šWebpack çš„æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹è¢«åˆ’åˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç”Ÿå‘½å‘¨æœŸé’©å­ï¼ˆHooksï¼‰ï¼Œå¦‚ï¼š<code>compile</code>ã€<code>emit</code>ã€<code>done</code> ç­‰ã€‚æ’ä»¶å¯ä»¥åœ¨è¿™äº›é’©å­ä¸ŠæŒ‚è½½è‡ªå®šä¹‰é€»è¾‘ï¼Œæ‰©å±• Webpack çš„åŠŸèƒ½ã€‚</li>
<li><strong>æ’ä»¶ç³»ç»Ÿï¼ˆPluginsï¼‰</strong>ï¼šWebpack çš„æ’ä»¶ç³»ç»Ÿä½¿å¾—æ’ä»¶å¯ä»¥åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­ä»»ä½•æ—¶åˆ»â€œæ’å…¥â€å®šåˆ¶åŒ–çš„åŠŸèƒ½ã€‚æ’ä»¶é€šè¿‡é’©å­ä¸ Webpack çš„äº‹ä»¶æµè¿›è¡Œäº¤äº’ï¼Œä»è€Œä¿®æ”¹ã€å¢å¼º Webpack çš„è¡Œä¸ºã€‚</li>
<li><strong>Loader æœºåˆ¶</strong>ï¼šWebpack ä¸­ loader æ˜¯ä¸“é—¨å¤„ç†æ¨¡å—è½¬æ¢çš„ï¼Œloader æ˜¯ä½œç”¨äºæ¨¡å—çš„ï¼Œä½†å’Œæ’ä»¶çš„è®¾è®¡ç†å¿µç›¸åŒï¼Œloader ä¹Ÿå¯ä»¥è¢«è®¤ä¸ºæ˜¯ webpack æ’ä»¶ç³»ç»Ÿçš„ä¸€éƒ¨åˆ†ã€‚å®ƒä»¬ä¸€èµ·å®Œæˆäº†å¯¹æ–‡ä»¶çš„è½¬åŒ–å’Œæ‰“åŒ…å·¥ä½œã€‚</li>
</ol>
<p><strong>Webpack åº•å±‚æ¶æ„è®¾è®¡çš„ä¸»è¦ç»„ä»¶</strong></p>
<ol>
<li><strong>Tapable åº“</strong></li>
</ol>
<p>Webpack ä¸­çš„ <code>Tapable</code> æ˜¯æ ¸å¿ƒåº“ï¼Œå®ƒç±»ä¼¼äºä¸€ä¸ªäº‹ä»¶å‘å¸ƒè®¢é˜…ç³»ç»Ÿï¼ŒWebpack çš„æ‰€æœ‰äº‹ä»¶éƒ½æ˜¯é€šè¿‡ Tapable çš„ hooks æ¥ç®¡ç†ã€‚<code>Tapable</code> æä¾›äº†å¤šç§ç±»å‹çš„ hooksï¼Œå¸¸ç”¨çš„å¦‚ <code>SyncHook</code>ã€<code>AsyncSeriesHook</code>ã€<code>AsyncParallelHook</code>ï¼Œè¿™äº› hooks æ§åˆ¶ç€åŒæ­¥ã€å¼‚æ­¥çš„æ’ä»¶æ‰§è¡Œæµç¨‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">SyncHook</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">MyPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compile</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;MyPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">params</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Compile is starting...&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">// è¿™ä¸ªä¾‹å­å±•ç¤ºäº†å¦‚ä½•åœ¨ compile é’©å­ä¸Šæ³¨å†Œä¸€ä¸ªåŒæ­¥é’©å­æ¥æ‰§è¡Œè‡ªå®šä¹‰ä»£ç ã€‚
</span></span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li><strong>Webpack ç”Ÿå‘½å‘¨æœŸå’Œé’©å­</strong></li>
</ol>
<p>Webpack çš„è¿è¡Œåˆ†ä¸ºå¤šä¸ªé˜¶æ®µï¼Œæ¯”å¦‚ï¼š</p>
<ul>
<li><strong>Initialization</strong>ï¼šåˆå§‹åŒ– Webpack é…ç½®æ–‡ä»¶ã€è§£ææ¨¡å—ä¾èµ–</li>
<li><strong>Compilation</strong>ï¼šé€’å½’å¤„ç†æ¨¡å—ä¾èµ–å›¾ï¼Œç”Ÿæˆæœ€ç»ˆçš„ä»£ç åŒ…</li>
<li><strong>Optimization</strong>ï¼šä»£ç ä¼˜åŒ–ï¼Œå¦‚ Tree Shakingã€ä»£ç å‹ç¼©ç­‰</li>
<li><strong>Emit</strong>ï¼šå°†æ‰“åŒ…å¥½çš„èµ„æºè¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿ</li>
</ul>
<p>æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œä¾‹å¦‚ <code>beforeCompile</code>ã€<code>afterCompile</code>ã€<code>emit</code> ç­‰ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡æ’ä»¶ç³»ç»Ÿåœ¨è¿™äº›ç”Ÿå‘½å‘¨æœŸä¸­æ³¨å†Œé’©å­ï¼Œæ‰©å±•åŠŸèƒ½ã€‚</p>
<ol start="3">
<li><strong>Compiler å’Œ Compilation</strong></li>
</ol>
<ul>
<li><strong>Compiler</strong> æ˜¯ Webpack çš„æ ¸å¿ƒå¯¹è±¡ï¼Œè´Ÿè´£å¯åŠ¨ Webpack çš„æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹ã€‚æ‰€æœ‰æ’ä»¶é€šè¿‡ <code>compiler</code> å¯¹è±¡ä¸ Webpack è¿›è¡Œäº¤äº’ã€‚</li>
<li><strong>Compilation</strong> ä»£è¡¨äº† Webpack æ‰“åŒ…è¿‡ç¨‹ä¸­æ¯ä¸€æ¬¡æ„å»ºçš„çŠ¶æ€ï¼ŒåŒ…å«äº†æ‰€æœ‰çš„æ¨¡å—ã€èµ„æºå’Œç”Ÿæˆä»£ç çš„è¯¦ç»†ä¿¡æ¯ã€‚æ’ä»¶å¯ä»¥é€šè¿‡ <code>compilation</code> å¯¹è±¡æ¥è®¿é—®å’Œä¿®æ”¹æ¨¡å—çš„å…·ä½“æ‰“åŒ…ç»“æœã€‚</li>
</ul>
<p><strong>Compiler å’Œ Compilation çš„å…³ç³»</strong>ï¼š</p>
<ul>
<li><code>Compiler</code> æ˜¯å…¨å±€çš„ï¼Œå®ƒè´Ÿè´£ç®¡ç†æ•´ä¸ª Webpack æ„å»ºç”Ÿå‘½å‘¨æœŸã€‚</li>
<li><code>Compilation</code> æ˜¯æ¯æ¬¡æ‰“åŒ…çš„ä¸Šä¸‹æ–‡ï¼Œå®ƒç®¡ç†æ„å»ºçš„ç»†èŠ‚ï¼ˆåŒ…æ‹¬æ¯ä¸ªæ¨¡å—çš„ä¾èµ–ã€å¤„ç†ã€ä¼˜åŒ–ç­‰ï¼‰ã€‚</li>
</ul>
<ol start="4">
<li><strong>æ’ä»¶æœºåˆ¶</strong></li>
</ol>
<p>Webpack çš„æ’ä»¶æœºåˆ¶é€šè¿‡ <code>Compiler</code> å’Œ <code>Compilation</code> æä¾›çš„é’©å­æœºåˆ¶å…è®¸å¼€å‘è€…åœ¨æ‰“åŒ…è¿‡ç¨‹ä¸­â€œæ‹¦æˆªâ€æˆ–â€œä¿®æ”¹â€ Webpack çš„è¡Œä¸ºã€‚æ’ä»¶é€šè¿‡ <code>apply</code> æ–¹æ³•æŒ‚è½½åˆ° <code>compiler</code> ä¸Šï¼Œå¹¶åˆ©ç”¨ç”Ÿå‘½å‘¨æœŸé’©å­æ‰§è¡Œè‡ªå®šä¹‰é€»è¾‘ã€‚</p>
<ol start="5">
<li><strong>Loader ç³»ç»Ÿ</strong></li>
</ol>
<ul>
<li><strong>Loader</strong> æ˜¯ç”¨æ¥è½¬æ¢æ¨¡å—çš„ï¼Œæ¯”å¦‚å°† <code>.scss</code> è½¬æ¢ä¸º <code>.css</code>ï¼Œå°† ES6+ è½¬æ¢ä¸º ES5ã€‚Loader è´Ÿè´£å°†ä¸åŒç±»å‹çš„æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ç­‰ï¼‰è½¬ä¸º Webpack å¯ä»¥ç†è§£çš„æ¨¡å—ã€‚</li>
<li>Loader åªä½œç”¨äºå•ä¸ªæ–‡ä»¶ï¼Œè€Œæ’ä»¶åˆ™å¯ä»¥ä½œç”¨äºæ•´ä¸ªæ„å»ºè¿‡ç¨‹ï¼ŒLoader å¯ä»¥ç»„åˆä½¿ç”¨å½¢æˆé“¾å¼å¤„ç†ï¼ŒLoader çš„é¡ºåºå’Œæ’ä»¶çš„æœºåˆ¶éƒ½å¯ä»¥é€šè¿‡ Webpack é…ç½®çµæ´»æ§åˆ¶ã€‚</li>
</ul>
<p><strong>Webpack æ’ä»¶ç³»ç»Ÿçš„ä¼˜åŠ¿</strong></p>
<ol>
<li><strong>çµæ´»æ€§</strong>ï¼šé€šè¿‡æ’ä»¶ï¼Œå¼€å‘è€…å¯ä»¥éå¸¸è½»æ¾åœ°æ‰©å±• Webpack çš„åŠŸèƒ½ï¼Œè€Œä¸éœ€è¦å»ä¿®æ”¹ Webpack æ ¸å¿ƒä»£ç ã€‚</li>
<li><strong>å¼ºå¤§çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†</strong>ï¼šWebpack æä¾›äº†ä¼—å¤šçš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå¼€å‘è€…å¯ä»¥åœ¨æ‰“åŒ…è¿‡ç¨‹çš„ä»»ä½•æ—¶åˆ»æ’å…¥è‡ªå·±çš„é€»è¾‘ï¼Œç²¾ç»†åœ°æ§åˆ¶æ‰“åŒ…è¿‡ç¨‹ã€‚</li>
<li><strong>æ’ä»¶ç”Ÿæ€ä¸°å¯Œ</strong>ï¼šWebpack çš„æ’ä»¶ç”Ÿæ€éå¸¸ä¸°å¯Œï¼Œä»ä»£ç ä¼˜åŒ–ã€æ–‡ä»¶å‹ç¼©åˆ°æ¨¡å—çƒ­æ›´æ–°ï¼ŒWebpack æ’ä»¶å‡ ä¹è¦†ç›–äº†æ‰€æœ‰å¸¸è§çš„éœ€æ±‚ã€‚</li>
<li><strong>äº‹ä»¶é©±åŠ¨æ¨¡å‹</strong>ï¼šWebpack é€šè¿‡äº‹ä»¶é©±åŠ¨çš„æ¶æ„å®ç°äº†é«˜åº¦çš„æ¨¡å—åŒ–å’Œè§£è€¦ï¼Œæ’ä»¶å¯ä»¥é€šè¿‡è®¢é˜…ä¸åŒçš„é’©å­æ¥æ§åˆ¶æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹ï¼Œè¿™ç§è®¾è®¡å¸¦æ¥äº†å¾ˆé«˜çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ã€‚</li>
</ol>
<p><strong>æ’ä»¶ç³»ç»Ÿçš„å®é™…åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li><strong>ä»£ç å‹ç¼©</strong>ï¼šé€šè¿‡æ’ä»¶åœ¨ <code>emit</code> é˜¶æ®µå°†ç”Ÿæˆçš„æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œä¾‹å¦‚ <code>TerserPlugin</code>ã€‚</li>
<li><strong>ä»£ç åˆ†ç¦»</strong>ï¼šé€šè¿‡æ’ä»¶å¯ä»¥å®ç°ä»£ç çš„æŒ‰éœ€åŠ è½½æˆ–åˆ†ç¦»ï¼Œ<code>SplitChunksPlugin</code> å°±æ˜¯ä¸€ä¸ªç»å…¸çš„åˆ†ç¦»ä»£ç çš„æ’ä»¶ã€‚</li>
<li><strong>è‡ªåŠ¨ç”Ÿæˆ HTML æ–‡ä»¶</strong>ï¼šä¾‹å¦‚ <code>HtmlWebpackPlugin</code> å¯ä»¥è‡ªåŠ¨ç”Ÿæˆå¸¦æœ‰æ­£ç¡®ä¾èµ–çš„ HTML æ–‡ä»¶ã€‚</li>
<li><strong>çƒ­æ¨¡å—æ›¿æ¢</strong>ï¼šé€šè¿‡ <code>HotModuleReplacementPlugin</code> å¯ä»¥å®ç°æ¨¡å—çš„çƒ­æ›´æ–°è€Œä¸éœ€è¦é‡æ–°åŠ è½½æ•´ä¸ªé¡µé¢ã€‚</li>
</ul>
<h4 id="æ’ä»¶æ ¸å¿ƒ-tapable">æ’ä»¶æ ¸å¿ƒ tapable
</h4><p>webpack æ’ä»¶æœºåˆ¶ï¼š</p>
<ul>
<li>
<p>webpack å®ç°æ’ä»¶æœºåˆ¶çš„å¤§ä½“æ–¹å¼æ˜¯ï¼š</p>
<ul>
<li>åˆ›å»º - webpack åœ¨å…¶å†…éƒ¨å¯¹è±¡ä¸Šåˆ›å»ºå„ç§é’©å­ï¼›ï¼ˆå¦‚ compiler å¯¹è±¡ä¸Šçš„ hooks ä¸Šçš„ run æˆ–è€… doneï¼‰</li>
<li>æ³¨å†Œ - æ’ä»¶å°†è‡ªå·±çš„æ–¹æ³•æ³¨å†Œåˆ°å¯¹åº”é’©å­ä¸Šï¼Œäº¤ç»™ webpackï¼›</li>
<li>è°ƒç”¨ - webpack ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œä¼šé€‚æ—¶åœ°è§¦å‘ç›¸åº”é’©å­ï¼Œå› æ­¤ä¹Ÿå°±è§¦å‘äº†æ’ä»¶çš„æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>
<p>Webpack æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>äº‹ä»¶æµçš„æœºåˆ¶</strong>ï¼Œå®ƒçš„å·¥ä½œæµç¨‹ä¼šå°†å„ä¸ªæ’ä»¶ä¸²è”èµ·æ¥ï¼Œè€Œå®ç°è¿™ä¸€åˆ‡çš„æ ¸å¿ƒå°±æ˜¯ Tapableï¼Œwebpack ä¸­æœ€æ ¸å¿ƒçš„è´Ÿè´£ç¼–è¯‘çš„ Compiler å’Œè´Ÿè´£åˆ›å»º bundle çš„ Compilation éƒ½ç»§æ‰¿è‡ª Tapable</p>
<p>æ‰€ä»¥ webpack ä¸­æ’ä»¶çš„å‹¾å­å‡½æ•°åˆ†å¸ƒåœ¨ Compiler ï¼ŒCompilation ç­‰å®ä¾‹å¯¹è±¡ä¸Šï¼Œä¹Ÿå°±å¯ä»¥é€‰æ‹©åœ¨è¿™äº›å¯¹è±¡çš„å‹¾å­ä¸Šæ³¨å†Œè‡ªå·±çš„æ’ä»¶ã€‚</p>
</li>
<li>
<p>é€šè¿‡äº‹ä»¶æ³¨å†Œå’Œç›‘å¬ï¼Œè§¦å‘ webpack ç”Ÿå‘½å‘¨æœŸä¸­çš„å‡½æ•°æ–¹æ³•</p>
</li>
</ul>
<p>webpack æ’ä»¶é’©å­ï¼ˆç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼‰å¯è§†åŒ–å·¥å…·ï¼š<a class="link" href="https://www.npmjs.com/package/wepback-plugin-visualizer"  target="_blank" rel="noopener"
    >wepback-plugin-visualizer</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SyncHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SyncBailHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SyncWaterfallHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SyncLoopHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AsyncParallelHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AsyncParallelBailHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AsyncSeriesHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AsyncSeriesBailHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">AsyncSeriesWaterfallHook</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tapable-åˆ†ç±»">tapable åˆ†ç±»
</h4><ol>
<li>
<h5 id="æŒ‰åŒæ­¥å¼‚æ­¥åˆ†ç±»">æŒ‰åŒæ­¥å¼‚æ­¥åˆ†ç±»
</h5><ul>
<li>
<p>Hook ç±»å‹å¯ä»¥åˆ†ä¸º<code>åŒæ­¥Sync</code>å’Œ<code>å¼‚æ­¥Async</code>ï¼Œå¼‚æ­¥åˆåˆ†ä¸º<code>å¹¶è¡Œ</code>(ä¸€èµ·å¼€å§‹ï¼Œå…¨éƒ¨ç»“æŸæ‰ç»“æŸ)å’Œ<code>ä¸²è¡Œ</code>ï¼ˆå‰ä¸€ä¸ªç»“æŸåä¸€ä¸ªæ‰å¼€å§‹ï¼‰</p>
<p><img src="/blogs/post/webpack/images/image-20230410195505070.png"
	width="1342"
	height="291"
	srcset="/blogs/post/webpack/images/image-20230410195505070_hu_6c03bc759587ef6.png 480w, /blogs/post/webpack/images/image-20230410195505070_hu_769b6e0d770aa904.png 1024w"
	loading="lazy"
	
		alt="image-20230410195505070"
	
	
		class="gallery-image" 
		data-flex-grow="461"
		data-flex-basis="1106px"
	
></p>
</li>
</ul>
</li>
<li>
<p><strong>æŒ‰è¿”å›å€¼åˆ†ç±»</strong></p>
<p><img src="/blogs/post/webpack/images/image-20230410195529852.png"
	width="1207"
	height="296"
	srcset="/blogs/post/webpack/images/image-20230410195529852_hu_3e6ff94fcc4f4d88.png 480w, /blogs/post/webpack/images/image-20230410195529852_hu_6c80dd9dd2214a91.png 1024w"
	loading="lazy"
	
		alt="image-20230410195529852"
	
	
		class="gallery-image" 
		data-flex-grow="407"
		data-flex-basis="978px"
	
></p>
<ul>
<li>
<p>basicï¼šæ‰§è¡Œæ¯ä¸€ä¸ªäº‹ä»¶å‡½æ•°ï¼Œä¸å…³å¿ƒå‡½æ•°çš„è¿”å›å€¼ï¼Œæœ‰ SyncHookã€AsyncParallelHookã€AsyncSeriesHook</p>
<p><img src="/blogs/post/webpack/images/image-20230410200044645.png"
	width="266"
	height="1391"
	srcset="/blogs/post/webpack/images/image-20230410200044645_hu_126b09258223200c.png 480w, /blogs/post/webpack/images/image-20230410200044645_hu_af3218e7bf92ca8e.png 1024w"
	loading="lazy"
	
		alt="image-20230410200044645"
	
	
		class="gallery-image" 
		data-flex-grow="19"
		data-flex-basis="45px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">SyncHook</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SyncHook</span><span class="p">([</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">]);</span> <span class="c1">// å½¢å‚æ•°ç»„ï¼Œå…¶ä¸­çš„å…ƒç´ çš„åå­—æ²¡æœ‰ä»€ä¹ˆæ„ä¹‰ï¼Œé‡è¦çš„æ˜¯è¿™ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œä»–çš„é•¿åº¦ä¼šæ˜¯ä¸‹é¢å›è°ƒå‡½æ•°æ¥å—åˆ°çš„å®é™…å‚æ•°çš„ä¸ªæ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// tapå‡½æ•°æ¥å—çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¡¨ç¤ºå›è°ƒçš„åå­—ï¼Œå…¶å®ä¹Ÿæ²¡æœ‰ä»€ä¹ˆç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;3&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&#34;tom&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>waterfallï¼šå¦‚æœå‰ä¸€ä¸ªäº‹ä»¶å‡½æ•°çš„ç»“æœ <code>result !== undefined</code>ï¼Œåˆ™ result ä¼šä½œä¸ºåä¸€ä¸ªäº‹ä»¶å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°,æœ‰ SyncWaterfallHookï¼ŒAsyncSeriesWaterfallHook</p>
<p><img src="/blogs/post/webpack/images/image-20230410200145319.png"
	width="366"
	height="1648"
	srcset="/blogs/post/webpack/images/image-20230410200145319_hu_8454303809c83b40.png 480w, /blogs/post/webpack/images/image-20230410200145319_hu_bd0cbe4ee3c25a83.png 1024w"
	loading="lazy"
	
		alt="image-20230410200145319"
	
	
		class="gallery-image" 
		data-flex-grow="22"
		data-flex-basis="53px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">SyncWaterfallHook</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å½¢å‚æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å½¢å‚çš„åä¹‰æ²¡æœ‰æ„ä¹‰
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SyncWaterfallHook</span><span class="p">([</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * tapçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å›è°ƒå‡½æ•°çš„åç§°ï¼Œä½†æ˜¯è¿™ä¸ªåå­—åªæ˜¯ç»™ç¨‹åºå‘˜çœ‹çš„
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span> <span class="c1">// &#39;zhufeng&#39;, 18
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="s2">&#34;result1&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span> <span class="c1">// &#39;result1&#39;, 18
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">return</span> <span class="s2">&#34;result2&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;3&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span> <span class="c1">// &#39;result2&#39;, 18
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&#34;zhufeng&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>bailï¼šæ‰§è¡Œæ¯ä¸€ä¸ªäº‹ä»¶å‡½æ•°ï¼Œé‡åˆ°ç¬¬ä¸€ä¸ªé’©å­çš„è¿”å›å€¼ç»“æœ <code>result !== undefined</code> ï¼Œåˆ™ä¸å†ç»§ç»­å¾€åæ‰§è¡Œã€‚æœ‰ï¼šSyncBailHookã€AsyncSeriesBailHook, AsyncParallelBailHook</p>
<p><img src="/blogs/post/webpack/images/image-20230410200127561.png"
	width="459"
	height="1558"
	srcset="/blogs/post/webpack/images/image-20230410200127561_hu_6cebd2ed9105b670.png 480w, /blogs/post/webpack/images/image-20230410200127561_hu_fb67a17575b93159.png 1024w"
	loading="lazy"
	
		alt="image-20230410200127561"
	
	
		class="gallery-image" 
		data-flex-grow="29"
		data-flex-basis="70px"
	
></p>
</li>
<li>
<p>loopï¼šä¸åœçš„å¾ªç¯æ‰§è¡Œäº‹ä»¶å‡½æ•°ï¼Œç›´åˆ°æ‰€æœ‰å‡½æ•°ç»“æœ <code>result === undefined</code>ï¼Œæœ‰ SyncLoopHook å’Œ AsyncSeriesLoopHook</p>
<p><img src="/blogs/post/webpack/images/image-20230410200204253.png"
	width="407"
	height="1597"
	srcset="/blogs/post/webpack/images/image-20230410200204253_hu_fcdf5458d9893e2e.png 480w, /blogs/post/webpack/images/image-20230410200204253_hu_ff0a2df7b39e25ba.png 1024w"
	loading="lazy"
	
		alt="image-20230410200204253"
	
	
		class="gallery-image" 
		data-flex-grow="25"
		data-flex-basis="61px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">SyncLoopHook</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä¸åœçš„æ‰§è¡Œå›è°ƒå‡½æ•°ï¼Œç›´åˆ°ç»“æœç­‰äºundefined
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SyncLoopHook</span><span class="p">([</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">counter1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">counter2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">counter3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">&#34;counter1&#34;</span><span class="p">,</span> <span class="nx">counter1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">counter1</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">counter1</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&#34;counter2&#34;</span><span class="p">,</span> <span class="nx">counter2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">counter2</span> <span class="o">===</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">counter2</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;3&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="s2">&#34;counter3&#34;</span><span class="p">,</span> <span class="nx">counter3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">counter3</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">counter3</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="s2">&#34;zhufeng&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ul>
</li>
</ol>
<p>å¼‚æ­¥çš„ hookï¼Œæ³¨å†Œæ–¹å¼æœ‰ 3 ç§ï¼š</p>
<ol>
<li>tapï¼šæ³¨å†ŒåŒæ­¥å›è°ƒå‡½æ•°</li>
<li>tapAsyncï¼šæ³¨å†Œå¼‚æ­¥å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥æ”¶çš„ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ª callback å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ª callback å‡½æ•°è¡¨ç¤ºè¯¥å¼‚æ­¥æ‰§è¡Œå®Œæˆäº†</li>
<li>tapPromiseï¼šæ³¨å†Œ promise çš„å›è°ƒå‡½æ•°ï¼Œå›è°ƒå‡½æ•°çš„è¿”å›å€¼å¿…é¡»æ˜¯ promise å®ä¾‹</li>
<li>è§¦å‘å°±æ²¡æœ‰ callï¼Œåªæœ‰ callAsyncã€promise</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">AsyncParallelHook</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;tapable&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">hook</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncParallelHook</span><span class="p">([</span><span class="s2">&#34;name&#34;</span><span class="p">,</span> <span class="s2">&#34;age&#34;</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å¼‚æ­¥çš„hookï¼Œæ³¨å†Œæ–¹å¼æœ‰3ç§  tap tapAsync tapPromise
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="cm">/* hook.tap(&#39;1&#39;, (name,age) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(1, name, age);
</span></span></span><span class="line"><span class="cl"><span class="cm">});
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.tap(&#39;2&#39;, (name,age) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(2, name, age);
</span></span></span><span class="line"><span class="cl"><span class="cm">});
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.tap(&#39;3&#39;, (name,age) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(3,name,age);
</span></span></span><span class="line"><span class="cl"><span class="cm">});
</span></span></span><span class="line"><span class="cl"><span class="cm">// è§¦å‘å°±æ²¡æœ‰call ï¼Œæœ‰callAsync promise
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.callAsync(&#39;zhufeng&#39;, 18, () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(&#39;done&#39;);
</span></span></span><span class="line"><span class="cl"><span class="cm">}); */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cm">/* console.time(&#39;cost&#39;);
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.tapAsync(&#39;1&#39;, (name,age,callback) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  setTimeout(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">    console.log(1, name, age);
</span></span></span><span class="line"><span class="cl"><span class="cm">    callback();
</span></span></span><span class="line"><span class="cl"><span class="cm">  }, 1000);
</span></span></span><span class="line"><span class="cl"><span class="cm">});
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.tapAsync(&#39;2&#39;, (name,age,callback) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  setTimeout(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">    console.log(2, name, age);
</span></span></span><span class="line"><span class="cl"><span class="cm">    callback();
</span></span></span><span class="line"><span class="cl"><span class="cm">  }, 2000);
</span></span></span><span class="line"><span class="cl"><span class="cm">});
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.tapAsync(&#39;3&#39;, (name,age,callback) =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  setTimeout(() =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">    console.log(3, name, age);
</span></span></span><span class="line"><span class="cl"><span class="cm">    callback();
</span></span></span><span class="line"><span class="cl"><span class="cm">  }, 3000);
</span></span></span><span class="line"><span class="cl"><span class="cm">});
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">//è§¦å‘å°±æ²¡æœ‰callï¼Œåªæœ‰callAsyncã€promise
</span></span></span><span class="line"><span class="cl"><span class="cm">hook.callAsync(&#39;zhufeng&#39;, 18, () =&gt; {
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.log(&#39;done&#39;);
</span></span></span><span class="line"><span class="cl"><span class="cm">  console.timeEnd(&#39;cost&#39;);
</span></span></span><span class="line"><span class="cl"><span class="cm">}); */</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">time</span><span class="p">(</span><span class="s2">&#34;cost&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tapPromise</span><span class="p">(</span><span class="s2">&#34;1&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">resolve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tapPromise</span><span class="p">(</span><span class="s2">&#34;2&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">resolve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">2000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">tapPromise</span><span class="p">(</span><span class="s2">&#34;3&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">age</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">resolve</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">hook</span><span class="p">.</span><span class="nx">promise</span><span class="p">(</span><span class="s2">&#34;zhufeng&#34;</span><span class="p">,</span> <span class="mi">18</span><span class="p">).</span><span class="nx">then</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;done&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">timeEnd</span><span class="p">(</span><span class="s2">&#34;cost&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="tapable-åŸç†">tapable åŸç†
</h4><h3 id="æ’ä»¶-1">æ’ä»¶
</h3><p>åœ¨ webpack çš„æ’ä»¶å¼€å‘ä¸­ï¼Œé€‰æ‹©åˆé€‚çš„ hook ç±»å‹å¯¹äºå®ç°æ’ä»¶çš„åŠŸèƒ½éå¸¸å…³é”®ã€‚ä¸åŒçš„ hooks å…è®¸æ’ä»¶åœ¨ç¼–è¯‘æµç¨‹çš„ä¸åŒé˜¶æ®µä»¥ä¸åŒçš„æ–¹å¼ä»‹å…¥ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å…·ä½“æ’ä»¶æ¡ˆä¾‹ï¼Œå±•ç¤ºäº†å®ƒä»¬ä¸ºä»€ä¹ˆä¼šé€‰æ‹©åœ¨ç›¸åº”çš„ hook ç±»å‹ä¸­æ³¨å†Œå‡½æ•°ï¼š</p>
<ol>
<li>SyncHook æ¡ˆä¾‹ - <code>HtmlWebpackPlugin</code></li>
</ol>
<p><code>HtmlWebpackPlugin</code>ä½¿ç”¨<code>SyncHook</code>æ¥æ“çºµç”Ÿæˆçš„ HTML æ–‡ä»¶ã€‚å®ƒåœ¨<code>compilation</code>çš„<code>html-webpack-plugin-before-html-generation</code>é˜¶æ®µæ³¨å†Œä¸€ä¸ªåŒæ­¥çš„ hookï¼Œè¿™å…è®¸å®ƒåœ¨ HTML æ–‡ä»¶è¢«ç”Ÿæˆä¹‹å‰ä¿®æ”¹ HTML çš„å†…å®¹ã€‚ç”±äºè¿™ä¸ªè¿‡ç¨‹ä¸éœ€è¦å¼‚æ­¥æ“ä½œï¼Œ<code>SyncHook</code>å°±è¶³å¤Ÿæ»¡è¶³éœ€æ±‚ã€‚</p>
<ol start="2">
<li>SyncBailHook æ¡ˆä¾‹ - <code>MiniCssExtractPlugin</code></li>
</ol>
<p><code>MiniCssExtractPlugin</code>å¯èƒ½ä¼šåœ¨<code>normal-module-loader</code>é˜¶æ®µä½¿ç”¨<code>SyncBailHook</code>ï¼Œè¿™æ˜¯å› ä¸ºå®ƒéœ€è¦åˆ¤æ–­æ˜¯å¦åº”è¯¥æå– CSS åˆ°å•ç‹¬çš„æ–‡ä»¶ã€‚å¦‚æœæŸä¸ªæ¡ä»¶æ»¡è¶³ï¼ˆä¾‹å¦‚ï¼Œæ¨¡å—æ˜¯ CSS æ¨¡å—ï¼‰ï¼Œå®ƒå¯ä»¥ç«‹å³è¿”å›ç»“æœå¹¶é˜»æ­¢åç»­æ’ä»¶çš„æ‰§è¡Œï¼Œå› æ­¤<code>SyncBailHook</code>é€‚åˆè¿™ç§åœºæ™¯ã€‚</p>
<ol start="3">
<li>SyncWaterfallHook æ¡ˆä¾‹ - <code>DefinePlugin</code></li>
</ol>
<p><code>DefinePlugin</code>ä½¿ç”¨<code>SyncWaterfallHook</code>åœ¨æ¨¡å—çš„æºä»£ç ä¸­æ›¿æ¢å…¨å±€å˜é‡ã€‚å®ƒåœ¨<code>compilation</code>çš„<code>compilation</code>é˜¶æ®µæ³¨å†Œå‡½æ•°ï¼Œå…è®¸å®ƒæ¥æ”¶å‰ä¸€ä¸ªæ’ä»¶å¤„ç†çš„ç»“æœï¼ˆæºä»£ç ï¼‰ï¼Œç„¶åæ·»åŠ æˆ–ä¿®æ”¹å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œå¹¶å°†ä¿®æ”¹åçš„æºä»£ç ä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæ’ä»¶ã€‚</p>
<ol start="4">
<li>AsyncParallelHook æ¡ˆä¾‹ - <code>CopyWebpackPlugin</code></li>
</ol>
<p><code>CopyWebpackPlugin</code>éœ€è¦å°†æ–‡ä»¶ä»ä¸€ä¸ªä½ç½®å¤åˆ¶åˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œè¿™ä¸ªè¿‡ç¨‹å¯ä»¥å¹¶è¡Œæ‰§è¡Œä»¥æé«˜æ•ˆç‡ã€‚å› æ­¤ï¼Œå®ƒåœ¨<code>emit</code>é˜¶æ®µä½¿ç”¨<code>AsyncParallelHook</code>ï¼Œè¿™æ ·å¯ä»¥åŒæ—¶å¼€å§‹å¤åˆ¶å¤šä¸ªæ–‡ä»¶è€Œä¸é˜»å¡ç¼–è¯‘è¿‡ç¨‹ã€‚</p>
<ol start="5">
<li>AsyncSeriesHook æ¡ˆä¾‹ - <code>CleanWebpackPlugin</code></li>
</ol>
<p><code>CleanWebpackPlugin</code>åœ¨ç¼–è¯‘å¼€å§‹ä¹‹å‰éœ€è¦æ¸…é™¤<code>output</code>ç›®å½•ä¸­çš„æ—§æ–‡ä»¶ã€‚è¿™ä¸ªè¿‡ç¨‹åº”è¯¥åœ¨å…¶ä»–å¼‚æ­¥ä»»åŠ¡å¼€å§‹ä¹‹å‰å®Œæˆï¼Œå› æ­¤å®ƒä½¿ç”¨<code>AsyncSeriesHook</code>åœ¨<code>compilation</code>çš„<code>emit</code>é˜¶æ®µæ³¨å†Œä¸€ä¸ªå¼‚æ­¥å‡½æ•°ï¼Œç¡®ä¿æ¸…é™¤æ“ä½œå®Œæˆåå†æ‰§è¡Œåç»­æ“ä½œã€‚</p>
<ol start="6">
<li>AsyncSeriesWaterfallHook æ¡ˆä¾‹ - <code>TerserWebpackPlugin</code></li>
</ol>
<p><code>TerserWebpackPlugin</code>ç”¨äºå‹ç¼© JavaScript ä»£ç ã€‚å®ƒå¯èƒ½åœ¨<code>optimize-chunk-assets</code>é˜¶æ®µä½¿ç”¨<code>AsyncSeriesWaterfallHook</code>ï¼Œè¿™æ ·å¯ä»¥æ¥æ”¶åˆ°å‰ä¸€ä¸ªæ’ä»¶å¤„ç†çš„ä»£ç ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ï¼Œç„¶åè¿›è¡Œå‹ç¼©æ“ä½œï¼Œå¹¶å°†ç»“æœä¼ é€’ç»™é“¾ä¸­çš„ä¸‹ä¸€ä¸ªæ’ä»¶ã€‚ç”±äºè¿™ä¸ªè¿‡ç¨‹ä¸­æ¯ä¸ªæ’ä»¶çš„è¾“å‡ºéƒ½å¯èƒ½æˆä¸ºä¸‹ä¸€ä¸ªæ’ä»¶çš„è¾“å…¥ï¼Œæ‰€ä»¥é€‰æ‹©<code>AsyncSeriesWaterfallHook</code>æ˜¯åˆé€‚çš„ã€‚</p>
<p>è¿™äº›æ¡ˆä¾‹å±•ç¤ºäº†ä¸åŒ hooks ç±»å‹åœ¨å®ç° webpack æ’ä»¶æ—¶çš„åº”ç”¨ã€‚é€‰æ‹©æ­£ç¡®çš„ hook ç±»å‹å¯¹äºæ’ä»¶èƒ½å¤Ÿæ­£ç¡®å¹¶é«˜æ•ˆåœ°å·¥ä½œè‡³å…³é‡è¦ã€‚é€šè¿‡è¿™äº› hooksï¼Œæ’ä»¶èƒ½å¤Ÿåœ¨ç¼–è¯‘æµç¨‹çš„é€‚å½“é˜¶æ®µä»¥æœŸæœ›çš„æ–¹å¼æ‰§è¡Œæ“ä½œï¼Œä»è€Œå®ç°å¤æ‚çš„æ„å»ºå’Œä¼˜åŒ–ä»»åŠ¡ã€‚</p>
<p>æ’ä»¶å‘ç¬¬ä¸‰æ–¹å¼€å‘è€…æä¾›äº† webpack å¼•æ“ä¸­å®Œæ•´çš„èƒ½åŠ›ã€‚ä½¿ç”¨é˜¶æ®µå¼çš„æ„å»ºå›è°ƒï¼Œå¼€å‘è€…å¯ä»¥å¼•å…¥å®ƒä»¬è‡ªå·±çš„è¡Œä¸ºåˆ° webpack æ„å»ºæµç¨‹ä¸­ã€‚webpack å†…éƒ¨ä¹Ÿæ˜¯é€šè¿‡å¤§é‡å†…éƒ¨æ’ä»¶å®ç°çš„ï¼Œæ’ä»¶å‡ ä¹èƒ½å¤Ÿä»»æ„æ›´æ”¹ webpack ç¼–è¯‘ç»“æœã€‚</p>
<p>åœ¨ webpack ä¸­ï¼Œä¸åŒç±»å‹çš„å®ä¾‹å¯¹è±¡å¾ˆå¤šï¼Œå¯¹è±¡ä¸Šçš„é’©å­ä¹Ÿæœ‰å¾ˆå¤šã€‚</p>
<p>webpack å†…éƒ¨å¯ä»¥åŠ è½½æ’ä»¶çš„å¸¸ç”¨å¯¹è±¡ï¼š</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">å¯¹è±¡</th>
          <th style="text-align: left">é’©å­</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left"><a class="link" href="https://github.com/webpack/webpack/blob/v4.39.3/lib/Compiler.js"  target="_blank" rel="noopener"
    >Compiler</a></td>
          <td style="text-align: left">run,compile,compilation,make,emit,done&hellip;</td>
      </tr>
      <tr>
          <td style="text-align: left"><a class="link" href="https://github.com/webpack/webpack/blob/v4.39.3/lib/Compilation.js"  target="_blank" rel="noopener"
    >Compilation</a></td>
          <td style="text-align: left">buildModule,normalModuleLoader,succeedModule,finishModules,seal,optimize,after-seal&hellip;</td>
      </tr>
      <tr>
          <td style="text-align: left"><a class="link" href="https://github.com/webpack/webpack/blob/master/lib/ModuleFactory.js"  target="_blank" rel="noopener"
    >Module Factory</a></td>
          <td style="text-align: left">beforeResolver,afterResolver,module,parser&hellip;</td>
      </tr>
      <tr>
          <td style="text-align: left">Module</td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left"><a class="link" href="https://github.com/webpack/webpack/blob/master/lib/Parser.js"  target="_blank" rel="noopener"
    >Parser</a></td>
          <td style="text-align: left">program,statement,call,expression&hellip;</td>
      </tr>
      <tr>
          <td style="text-align: left"><a class="link" href="https://github.com/webpack/webpack/blob/master/lib/Template.js"  target="_blank" rel="noopener"
    >Template</a></td>
          <td style="text-align: left">hash,bootstrap,localVars,render&hellip;</td>
      </tr>
  </tbody>
</table></div>
<p><a class="link" href="https://github.com/webpack/webpack/blob/v4.39.3/lib/Compiler.js"  target="_blank" rel="noopener"
    >Compiler</a>(ç¼–è¯‘å™¨å¯¹è±¡)</p>
<ul>
<li>runï¼šå¼€å¯ç¼–è¯‘</li>
<li>compileï¼šå¼€å§‹ç¼–è¯‘</li>
<li>compilationï¼šå¼€å§‹åˆ›å»ºä¸€æ¬¡æ–°çš„ç¼–è¯‘</li>
<li>makeï¼šæ„å»ºå…¥å£</li>
<li>emitï¼šå‡†å¤‡è¾“å‡ºç»“æœ</li>
<li>doneï¼šå®Œæˆç¼–è¯‘ï¼Œæ˜¯ä¸€ä¸ª asyncSeriesHook</li>
</ul>
<p><a class="link" href="https://github.com/webpack/webpack/blob/v4.39.3/lib/Compilation.js"  target="_blank" rel="noopener"
    >Compilation</a>ï¼ˆç¼–è¯‘å™¨å¯¹è±¡ï¼‰ï¼Œæ¯å½“å¼€å¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘å°±åˆ›å»ºä¸€ä¸ªæ–°çš„ compilation</p>
<ul>
<li>buildModuleï¼šæ„å»ºæ¨¡å—</li>
<li>normalModuleLoaderï¼šåŠ è½½æ™®é€šæ¨¡å—</li>
<li>succeedModuleï¼šæˆåŠŸç¼–è¯‘ä¸€ä¸ªæ¨¡å—</li>
<li>finishModulesï¼šæ‰€æœ‰æ¨¡å—éƒ½ç¼–è¯‘å®Œæˆ</li>
<li>sealï¼šå°è£…ä»£ç å—</li>
<li>optimizeï¼šä¼˜åŒ–</li>
<li>after-sealï¼šå°è£…å®Œæˆ</li>
</ul>
<p><a class="link" href="https://github.com/webpack/webpack/blob/master/lib/ModuleFactory.js"  target="_blank" rel="noopener"
    >Module Factory</a> ï¼ˆæ¨¡å—å·¥å‚ï¼‰</p>
<ul>
<li>beforeResolverï¼šè§£æä¹‹å‰ï¼ˆè§£æï¼šæ‹¿åˆ°å¯¹åº”æ¨¡å—çš„éœ€è¦è¢«é‚£äº› loader å¤„ç†çš„ loader æ–‡ä»¶çš„è·¯å¾„å’Œè¯¥æ¨¡å—èµ„æºæœ¬èº«ï¼‰</li>
<li>afterResolverï¼šè§£æåï¼ˆè§£æï¼šæ‹¿åˆ°å¯¹åº”æ¨¡å—çš„éœ€è¦è¢«é‚£äº› loader å¤„ç†çš„ loader æ–‡ä»¶çš„è·¯å¾„å’Œè¯¥æ¨¡å—èµ„æºæœ¬èº«ï¼‰</li>
<li>moduleï¼šåˆ›å»ºæ¨¡å—</li>
<li>parserï¼šé€šè¿‡è¯­æ³•æ ‘è§£ææ¨¡å—ä¾èµ–</li>
</ul>
<p><a class="link" href="https://github.com/webpack/webpack/blob/master/lib/Parser.js"  target="_blank" rel="noopener"
    >Parser</a> ï¼ˆè§£æè¯­æ³•æ ‘ï¼‰</p>
<p>éå†è¯­æ³•æ ‘æ—¶é‡åˆ°ä¸‹é¢è¿™äº›èŠ‚ç‚¹å°±è§¦å‘è¿™äº›èŠ‚ç‚¹åå‡½æ•°</p>
<ul>
<li>program</li>
<li>statement</li>
<li>call</li>
<li>expression</li>
</ul>
<p><a class="link" href="https://github.com/webpack/webpack/blob/master/lib/Template.js"  target="_blank" rel="noopener"
    >Template</a>ï¼Œæ ¹æ®æ¨¡æ¿ç”Ÿæˆæœ€åçš„æºä»£ç </p>
<ul>
<li>hash</li>
<li>bootstrap</li>
<li>localVars</li>
<li>render</li>
</ul>
<p><strong>åˆ›å»ºæ’ä»¶</strong></p>
<ul>
<li>æ’ä»¶æ˜¯ä¸€ä¸ªç±»</li>
<li>ç±»ä¸Šæœ‰ä¸€ä¸ª apply çš„å®ä¾‹æ–¹æ³•</li>
<li>apply çš„å‚æ•°æ˜¯ compiler</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">DonePlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">DonePlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>åœ¨æ’ä»¶å¼€å‘ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªèµ„æºå°±æ˜¯<code>compiler</code>å’Œ<code>compilation</code>å¯¹è±¡ã€‚</p>
<ul>
<li>compiler å¯¹è±¡ä»£è¡¨äº†å®Œæ•´çš„ webpack ç¯å¢ƒé…ç½®ã€‚è¿™ä¸ªå¯¹è±¡åœ¨å¯åŠ¨ webpack æ—¶è¢«ä¸€æ¬¡æ€§å»ºç«‹ï¼Œå¹¶é…ç½®å¥½æ‰€æœ‰å¯æ“ä½œçš„è®¾ç½®ï¼ŒåŒ…æ‹¬ optionsï¼Œloader å’Œ pluginã€‚å½“åœ¨ webpack ç¯å¢ƒä¸­åº”ç”¨ä¸€ä¸ªæ’ä»¶æ—¶ï¼Œæ’ä»¶å°†æ”¶åˆ°æ­¤ compiler å¯¹è±¡çš„å¼•ç”¨ã€‚å¯ä»¥ä½¿ç”¨å®ƒæ¥è®¿é—® webpack çš„ä¸»ç¯å¢ƒã€‚</li>
<li>compilation å¯¹è±¡ä»£è¡¨äº†ä¸€æ¬¡èµ„æºç‰ˆæœ¬æ„å»ºã€‚å½“è¿è¡Œ webpack å¼€å‘ç¯å¢ƒä¸­é—´ä»¶æ—¶ï¼Œæ¯å½“æ£€æµ‹åˆ°ä¸€ä¸ªæ–‡ä»¶å˜åŒ–ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ compilationï¼Œä»è€Œç”Ÿæˆä¸€ç»„æ–°çš„ç¼–è¯‘èµ„æºã€‚ä¸€ä¸ª compilation å¯¹è±¡è¡¨ç°äº†å½“å‰çš„æ¨¡å—èµ„æºã€ç¼–è¯‘ç”Ÿæˆèµ„æºã€å˜åŒ–çš„æ–‡ä»¶ã€ä»¥åŠè¢«è·Ÿè¸ªä¾èµ–çš„çŠ¶æ€ä¿¡æ¯ã€‚compilation å¯¹è±¡ä¹Ÿæä¾›äº†å¾ˆå¤šå…³é”®æ—¶æœºçš„å›è°ƒï¼Œä»¥ä¾›æ’ä»¶åšè‡ªå®šä¹‰å¤„ç†æ—¶é€‰æ‹©ä½¿ç”¨ã€‚</li>
</ul>
<p><strong>compiler ä¸Šçš„æ’ä»¶ï¼š</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">DonePlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// åŒæ­¥å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;DonePlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">stats</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;DonePlugin.tap&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// å¼‚æ­¥å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">done</span><span class="p">.</span><span class="nx">tapAsync</span><span class="p">(</span><span class="s2">&#34;DonePlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">stats</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;DonePlugin.tapAsync&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">DonePlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>compilation ä¸Šçš„æ’ä»¶ï¼š</strong></p>
<p>è¦è·å– compilation å®ä¾‹çš„è¯ï¼Œéœ€è¦é€šè¿‡ compiler.hooks.compilation è¿™ä¸ª hook æ¥è·å–ï¼Œè®¢é˜…è¿™ä¸ª hook åï¼Œè¯¥è®¢é˜…å‡½æ•°çš„å›è°ƒå‚æ•°å°±æ˜¯æ¥æ”¶ webpack å†…éƒ¨ä¼ é€’çš„ compilation å®ä¾‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * åœ¨ç¼–è¯‘å®Œæˆåï¼Œå¸Œæœ›æŠŠdistç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶æ‰“åœ¨ä¸€ä¸ªå‹ç¼©åŒ…ï¼Œä¿å­˜åˆ°è¾“å‡ºç›®å½•é‡Œ
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">jszip</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;jszip&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">RawSource</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack-sources&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ArchivePlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;ArchivePlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">compilation</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">processAssets</span><span class="p">.</span><span class="nx">tapAsync</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span> <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;ArchivePlugin&#34;</span> <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nx">assets</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="kr">const</span> <span class="nx">zip</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">jszip</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">pathname</span> <span class="k">in</span> <span class="nx">assets</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">assets</span><span class="p">[</span><span class="nx">pathname</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">sourceCode</span> <span class="o">=</span> <span class="nx">source</span><span class="p">.</span><span class="nx">source</span><span class="p">();</span> <span class="c1">//è¿”å›æºä»£ç å­—ç¬¦ä¸²
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">zip</span><span class="p">.</span><span class="nx">file</span><span class="p">(</span><span class="nx">pathname</span><span class="p">,</span> <span class="nx">sourceCode</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="k">return</span> <span class="nx">zip</span><span class="p">.</span><span class="nx">generateAsync</span><span class="p">({</span> <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;nodebuffer&#34;</span> <span class="p">}).</span><span class="nx">then</span><span class="p">((</span><span class="nx">content</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">assets</span><span class="p">[</span><span class="sb">`</span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">.zip`</span><span class="p">]</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">RawSource</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="cm">/*  assets[`${Date.now()}.zip`] = {
</span></span></span><span class="line"><span class="cl"><span class="cm">            source() {
</span></span></span><span class="line"><span class="cl"><span class="cm">              return content;
</span></span></span><span class="line"><span class="cl"><span class="cm">            }
</span></span></span><span class="line"><span class="cl"><span class="cm">          } */</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">ArchivePlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h4 id="è‡ªåŠ¨å¤–è”æ’ä»¶"><strong>è‡ªåŠ¨å¤–è”æ’ä»¶</strong>
</h4><ul>
<li><a class="link" href="https://github.com/webpack/webpack/blob/0d4607c68e04a659fa58499e1332c97d5376368a/lib/ExternalsPlugin.js"  target="_blank" rel="noopener"
    >ExternalsPlugin.js</a></li>
<li><a class="link" href="https://github.com/webpack/webpack/blob/eeafeee32ad5a1469e39ce66df671e3710332608/lib/ExternalModuleFactoryPlugin.js"  target="_blank" rel="noopener"
    >ExternalModuleFactoryPlugin</a></li>
<li><a class="link" href="https://github.com/webpack/webpack/blob/eeafeee32ad5a1469e39ce66df671e3710332608/lib/ExternalModule.js"  target="_blank" rel="noopener"
    >ExternalModule.js</a></li>
<li><a class="link" href="https://github.com/zhufengnodejs/webpack-analysis/blob/master/node_modules/_webpack%404.20.2%40webpack/lib/NormalModuleFactory.js#L87"  target="_blank" rel="noopener"
    >parser</a></li>
<li><a class="link" href="https://github.com/zhufengnodejs/webpack-analysis/blob/master/node_modules/_webpack%404.20.2%40webpack/lib/NormalModuleFactory.js#L66"  target="_blank" rel="noopener"
    >factory</a></li>
<li><a class="link" href="https://github.com/jantimon/html-webpack-plugin/blob/v3.2.0/index.js#L62"  target="_blank" rel="noopener"
    >htmlWebpackPluginAlterAssetTags</a></li>
</ul>
<p>ä¼ ç»Ÿåœ¨ wabpack ä¸­é…ç½® cdnï¼Œä¸€èˆ¬åœ¨é¡¹ç›®ä¸­å¼•å…¥ä¸€äº›è‘—åçš„å…¬å…±åº“çš„è¯ï¼Œå¦‚æœä¸åšä»»ä½•å¤„ç†ï¼Œè¯¥å…¬å…±åº“çš„æºä»£ç ä¼šè¢«ä¸€å¹¶æ‰“åŒ…åˆ°æœ€ç»ˆç”Ÿæˆçš„æ–‡ä»¶ä¸­ï¼Œå¢åŠ æ‰“åŒ…æ–‡ä»¶çš„ä½“ç§¯ã€‚ ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¯ä»¥é€šè¿‡ cdn æ¥è§£å†³ï¼Œä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>åœ¨ html-webpack-plugin æ’ä»¶çš„æ¨¡æ¿ html ä¸­æ·»åŠ  cdn å¤–é“¾è„šæœ¬ï¼Œä»–ä»¬ä¼šåœ¨å…¨å±€ window å¯¹è±¡ä¸ŠæŒ‚è½½å±æ€§ï¼Œæ¯”å¦‚ vueï¼Œ_ï¼Œ$ç­‰ï¼Œè‡ªå·±å¿…é¡»çŸ¥é“è¿™ä¸ªå˜é‡åå­—æ‰è¡Œ</p>
</li>
<li>
<p>åœ¨ webpakc é…ç½®ä¸­çš„ externals é€‰é¡¹ä¸­é…ç½®éœ€è¦æ’é™¤çš„ä¾èµ–åº“ï¼Œå¦‚ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;externals&#34;</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;jquery&#39;</span><span class="o">:</span><span class="s1">&#39;$&#39;</span><span class="p">,</span>  <span class="c1">// å½“é¡¹ç›®ä¸­å¼•å…¥jqueryåï¼Œå¼•å…¥çš„jqueryå¯¹åº”çš„å˜é‡åå­—ä¸å†å»node_modulesä¸­æ‰¾äº†ï¼Œç›´æ¥å»window.$ä¸Šæ‰¾
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="s1">&#39;lodash&#39;</span><span class="o">:</span><span class="s1">&#39;_&#39;</span><span class="err">ï¼Œ</span>
</span></span><span class="line"><span class="cl">        <span class="s1">&#39;vue&#39;</span><span class="o">:</span><span class="s1">&#39;vue&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>ç°åœ¨è‡ªå·±æ¥å†™ä¸€ä¸ªæ’ä»¶å°†ä¸Šé¢çš„ä¸¤æ­¥é€šè¿‡æ’ä»¶æ¥å®ç°ã€‚</p>
<p>ä½¿ç”¨æ’ä»¶å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="k">new</span> <span class="nx">AutoExternalPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">            <span class="nx">jquery</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">url</span><span class="o">:</span><span class="s1">&#39;http://xxx.cdn/xxx/xxx.js&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">variable</span><span class="o">:</span><span class="s1">&#39;$&#39;</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="c1">// ....
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        	<span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">})</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¯¥æ’ä»¶é™¤äº†è¦è¯†åˆ«æºç å†…éƒ¨æ˜¯å¦å¼•å…¥éœ€è¦è¢«æ’é™¤æ‰“åŒ…çš„åº“ï¼Œè¿˜éœ€è¦å’Œä½¿ç”¨ html-webpack-plugin ç”Ÿæˆçš„ html æ¨¡æ¿å†…å®¹è¿›è¡Œäº¤äº’ã€‚</p>
<ul>
<li><code>æ£€æµ‹ä¾èµ–</code> å½“æ£€æµ‹åˆ°æœ‰<code>importæˆ–è€…require</code>è¯¥æŒ‡å®šçš„<code>library</code>æ—¶ï¼Œå°†å…¶è®¾ç½®ä¸ºä¸æ‰“åŒ…ç±»ä¼¼<code>exteral</code>,å¹¶åœ¨æŒ‡å®šæ¨¡ç‰ˆä¸­åŠ å…¥ script,é‚£ä¹ˆå¦‚ä½•æ£€æµ‹æŸä¸ªæ¨¡å—ä¸­é€šè¿‡ import æˆ–è€… require æ–¹æ³•å¼•å…¥äº†éœ€è¦æ’é™¤çš„æ¨¡å—äº†ï¼Ÿè¿™é‡Œå°±ç”¨<code>Parser</code></li>
<li><code>externalä¾èµ–</code> éœ€è¦äº†è§£ external æ˜¯å¦‚ä½•å®ç°çš„ï¼Œwebpack çš„ external æ˜¯é€šè¿‡æ’ä»¶<code>ExternalsPlugin</code>å®ç°çš„ï¼ŒExternalsPlugin é€šè¿‡<code>tap</code> <code>NormalModuleFactory</code> åœ¨æ¯æ¬¡åˆ›å»º Module çš„æ—¶å€™åˆ¤æ–­æ˜¯å¦æ˜¯<code>ExternalModule</code>ï¼Œå¦‚æœæ˜¯åˆ™åˆ›å»ºå¤–éƒ¨æ¨¡å—ï¼Œå¦‚æœä¸æ˜¯åˆ™åˆ›å»ºæ™®é€šæ¨¡å—ï¼Œæ‰€ä»¥å°±ç”¨åˆ°äº† AsyncSeriesBailHookss</li>
<li>webpack4 åŠ å…¥äº†æ¨¡å—ç±»å‹ä¹‹åï¼Œ<code>Parser</code>è·å–éœ€è¦æŒ‡å®šç±»å‹ moduleType,ä¸€èˆ¬ä½¿ç”¨<code>javascript/auto</code>å³å¯</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span><span class="lnt">93
</span><span class="lnt">94
</span><span class="lnt">95
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">ExternalModule</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">AutoExternalPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">externalModules</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">importedModules</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//è·å–åˆ°æ™®é€šæ¨¡å—å·¥å‚,æ­¤å·¥å‚åœ¨Compileråˆ›å»ºçš„æ—¶å€™å°±ç›´æ¥åˆ›å»ºå¥½äº†ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//é¥­åº—=Compiler æ‹›è˜ä¸€ä¸ªå¨å¸ˆ normalModuleFactory
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//æ¯å½“æ¥åˆ°è®¢å•ï¼Œé¡¾å®¢ç‚¹ä¸ªè›‹ç‚’é¥­ï¼Œæˆ–è€…è¯´åˆ›å»ºä¸€ä¸ªæ¨¡å—ï¼Œä¼šç”±å¨å¸ˆnormalModuleFactoryåˆ›å»ºè¿™ä¸ªæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">normalModuleFactory</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">normalModuleFactory</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//æ¨¡å—å·¥å‚ä¼šè´Ÿè´£åˆ›å»ºæ¨¡å—ï¼Œåˆ›å»ºå®Œæ¨¡å—è¦ç¼–è¯‘æ¨¡å—ï¼Œå°±æ˜¯æŠŠæ¨¡å—æºç è½¬æˆè¯­æ³•æ ‘ASTï¼Œç„¶åéå†è¯­æ³•æ ‘æ‰¾ä¾èµ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//åœ¨éå†è¯­æ³•æ ‘çš„æ—¶å€™ï¼Œé‡åˆ°ä¸åŒçš„ç‚¹èŠ‚ä¼šè§¦å‘ä¸åŒçš„äº‹ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">normalModuleFactory</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">parser</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="s2">&#34;javascript/auto&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">parser</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">parser</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="kr">import</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="p">(</span><span class="nx">statement</span><span class="p">,</span> <span class="nx">source</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">externalModules</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                  <span class="k">this</span><span class="p">.</span><span class="nx">importedModules</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">//callæ˜¯ä¸€ä¸ªhookMap {key:Hook} åˆ¤æ–­callè¿™ä¸ªhookMapé‡Œæœ‰æ²¡æœ‰requireè¿™ä¸ªkeyå¯¹åº”çš„hook,å¦‚æœæœ‰è¿”å›ï¼Œæ²¡æœ‰åˆ™åˆ›å»ºå†è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">parser</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">call</span>
</span></span><span class="line"><span class="cl">              <span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="s2">&#34;require&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">              <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">expression</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="kr">const</span> <span class="nx">source</span> <span class="o">=</span> <span class="nx">expression</span><span class="p">.</span><span class="nx">arguments</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">                <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">externalModules</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">source</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">                  <span class="k">this</span><span class="p">.</span><span class="nx">importedModules</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">source</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">        <span class="c1">//2.æ”¹é€ æ¨¡å—çš„ç”Ÿäº§è¿‡ç¨‹ï¼Œæ‹¦æˆªç”Ÿæˆè¿‡ç¨‹ï¼Œåˆ¤æ–­å¦‚æœæ˜¯å¤–éƒ¨æ¨¡å—çš„è¯ï¼Œç”Ÿäº§ä¸€ä¸ªå¤–éƒ¨æ¨¡å—å¹¶è¿”å›
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">normalModuleFactory</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">factorize</span><span class="p">.</span><span class="nx">tapAsync</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nx">resolveData</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="p">{</span> <span class="nx">request</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">resolveData</span><span class="p">;</span> <span class="c1">//è·å–åŠ è½½çš„æ¨¡å—å request = jquery
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//å¦‚æœè¿™ä¸ªè¦åˆ›å»ºçš„æ¨¡å—æ˜¯å¤–éƒ¨æ¨¡å—çš„è¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">externalModules</span><span class="p">.</span><span class="nx">includes</span><span class="p">(</span><span class="nx">request</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="kd">let</span> <span class="p">{</span> <span class="nx">variable</span> <span class="p">}</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">request</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">              <span class="c1">// ExternalModuleå°±æ˜¯åŸç”Ÿçš„externalé…ç½®é¡¹åœ¨æºç ä¸­ä½¿ç”¨åˆ°çš„å·¥å…·ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="k">new</span> <span class="nx">ExternalModule</span><span class="p">(</span><span class="nx">variable</span><span class="p">,</span> <span class="s2">&#34;window&#34;</span><span class="p">,</span> <span class="nx">request</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//3.å‘äº§å‡ºçš„htmlé‡Œæ’å…¥CDNçš„è„šæœ¬
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">HtmlWebpackPlugin</span><span class="p">.</span><span class="nx">getHooks</span><span class="p">(</span><span class="nx">compilation</span><span class="p">).</span><span class="nx">alterAssetTags</span><span class="p">.</span><span class="nx">tapAsync</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;AutoExternalPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nx">data</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="kr">const</span> <span class="p">{</span> <span class="nx">assetTags</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">key</span> <span class="k">of</span> <span class="k">this</span><span class="p">.</span><span class="nx">importedModules</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">assetTags</span><span class="p">.</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">unshift</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">              <span class="nx">tagName</span><span class="o">:</span> <span class="s2">&#34;script&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">voidTag</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">defer</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">src</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">[</span><span class="nx">key</span><span class="p">].</span><span class="nx">url</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">assetTags</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">AutoExternalPlugin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å®ç°æ€è·¯
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1.æ‰¾åˆ°æœ¬é¡¹ç›®ä¸­çš„æ‰€æœ‰ä¾èµ–çš„æ¨¡å—ï¼Œçœ‹çœ‹å“ªäº›åœ¨AutoExternalPluginé…ç½®äº†
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä¹Ÿå°±æ˜¯è¯´çœ‹çœ‹é¡¹ç›®é‡Œæœ‰æ²¡æœ‰ä½¿ç”¨jqueryå’Œlodash
</span></span></span><span class="line"><span class="cl"><span class="cm"> * å› ä¸ºç”¨åˆ°äº†æ‰éœ€è¦å¤„ç†ä¸ºå¤–éƒ¨æ¨¡å—ï¼Œå¦‚æœæ²¡æœ‰ç”¨è¿‡å°±ä¸éœ€è¦ä»»ä½•å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2.å¦‚ä½•æ‰¾æœ¬é¡¹ç›®ä¾èµ–äº†å“ªäº›æ¨¡å—?
</span></span></span><span class="line"><span class="cl"><span class="cm"> * import &#39;lodash&#39;
</span></span></span><span class="line"><span class="cl"><span class="cm"> * require(&#39;query&#39;); callExpression
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ‰€ä»¥æˆ‘è¦æ‰¾é¡¹ç›®ä¸­çš„importå’Œrequireè¯­å¥ï¼Œæˆ–è€…è¯´èŠ‚ç‚¹
</span></span></span><span class="line"><span class="cl"><span class="cm"> * Compiler=&gt;NormalModuleFactory=&gt;Parser=&gt;import/require
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * HtmlWebpackPluginæ ¸å¿ƒåŠŸèƒ½
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1.ç¼–è¯‘HTMLæ¨¡æ¿
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2.æ ¹æ®webpackä¼ é€’è¿‡æ¥çš„èµ„æºä¿¡æ¯assets,ç”Ÿæˆæ ‡ç­¾.js=&gt;script,css=&gt;link
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 3.æŠŠæ ‡ç­¾æ³¨å…¥HTMLæ–‡ä»¶ä¸­
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 4.å†™å…¥ç¡¬ç›˜ emitå°±æ˜¯æŒ‡å†™å…¥ç¡¬ç›˜
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>html-webpack-plugin è¯¥æ’ä»¶ä¼šå‘ compilation ä¸ŠæŒ‚è½½ä¸€äº›é¢å¤–çš„ hook å®ä¾‹ã€‚</p>
<h2 id="asyncqueue">AsyncQueue
</h2><p>å¼‚æ­¥é˜Ÿåˆ—ã€‚é€šè¿‡å®ƒå¯ä»¥å®ç°å¹¶è¡Œæ‰§è¡Œä»»åŠ¡ã€‚</p>
<p>åœ¨ <strong>Webpack</strong> ä¸­ï¼Œ<strong>AsyncQueue</strong> æ˜¯ä¸€ä¸ªç”¨äºå¤„ç†å¼‚æ­¥ä»»åŠ¡çš„å†…éƒ¨æœºåˆ¶ã€‚å®ƒç®¡ç†å’Œè°ƒåº¦å¼‚æ­¥æ“ä½œï¼Œå¹¶ç¡®ä¿è¿™äº›æ“ä½œåœ¨åˆé€‚çš„æ—¶æœºæ‰§è¡Œã€‚Webpack éœ€è¦åœ¨æ„å»ºæµç¨‹ä¸­å¤„ç†å¤§é‡çš„å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚æ¨¡å—è§£æã€æ–‡ä»¶è¯»å–ã€æ’ä»¶æ“ä½œç­‰ï¼‰ï¼Œè€Œ <strong>AsyncQueue</strong> é€šè¿‡ä¸€ç§é˜Ÿåˆ—æœºåˆ¶ï¼Œå¸®åŠ©ç®¡ç†è¿™äº›ä»»åŠ¡ï¼Œç¡®ä¿å®ƒä»¬æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œï¼Œå¹¶é¿å…é‡å¤æ“ä½œã€‚</p>
<p><strong>AsyncQueue çš„æ ¸å¿ƒæ¦‚å¿µ</strong></p>
<p><strong>AsyncQueue</strong> å®è´¨ä¸Šæ˜¯ä¸€ä¸ªä»»åŠ¡é˜Ÿåˆ—ç³»ç»Ÿï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ï¼š</p>
<ul>
<li><strong>ç¼“å­˜ä»»åŠ¡ç»“æœ</strong>ï¼šå¯¹å·²ç»å¤„ç†è¿‡çš„ä»»åŠ¡è¿›è¡Œç¼“å­˜ï¼Œé¿å…é‡å¤æ‰§è¡Œã€‚</li>
<li><strong>ä»»åŠ¡å»é‡</strong>ï¼šåŒä¸€ä¸ªä»»åŠ¡åœ¨æœªå®Œæˆä¹‹å‰ï¼Œåªå…è®¸è¢«æ‰§è¡Œä¸€æ¬¡ï¼Œåç»­ç›¸åŒçš„ä»»åŠ¡ä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œç­‰ä»»åŠ¡å®Œæˆåç»Ÿä¸€å¤„ç†ã€‚</li>
<li><strong>ä»»åŠ¡å¹¶å‘ç®¡ç†</strong>ï¼šæ§åˆ¶ä»»åŠ¡çš„å¹¶å‘æ‰§è¡Œï¼Œç¡®ä¿åœ¨åˆé€‚çš„æ—¶æœºè°ƒåº¦ä»»åŠ¡ï¼Œé¿å…èµ„æºè€—å°½æˆ–ä¸å¿…è¦çš„å¹¶å‘æ“ä½œã€‚</li>
</ul>
<p><strong>AsyncQueue çš„ä½¿ç”¨åœºæ™¯</strong></p>
<ol>
<li><strong>æ¨¡å—è§£æ</strong>ï¼š
<ul>
<li>Webpack åœ¨è§£æä¾èµ–æ¨¡å—æ—¶ï¼Œä½¿ç”¨ <strong>AsyncQueue</strong> æ¥ç®¡ç†æ¨¡å—è§£æä»»åŠ¡ã€‚å½“æŸä¸ªæ¨¡å—æ­£åœ¨è¢«è§£ææ—¶ï¼Œå…¶ä»–ä¾èµ–äºè¯¥æ¨¡å—çš„ä»»åŠ¡å°†è¢«æš‚æ—¶æŒ‚èµ·ï¼Œç›´åˆ°è¯¥æ¨¡å—è§£æå®Œæˆã€‚</li>
</ul>
</li>
<li><strong>æ–‡ä»¶å¤„ç†</strong>ï¼š
<ul>
<li>åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼ŒWebpack éœ€è¦è¯»å–å’Œå¤„ç†å¤šä¸ªæ–‡ä»¶ï¼ˆå¦‚ JS æ–‡ä»¶ã€CSS æ–‡ä»¶ç­‰ï¼‰ã€‚è¿™äº›æ–‡ä»¶çš„è¯»å–å¾€å¾€æ˜¯å¼‚æ­¥çš„ã€‚é€šè¿‡ <strong>AsyncQueue</strong>ï¼ŒWebpack å¯ä»¥æœ‰æ•ˆåœ°ç®¡ç†è¿™äº›æ–‡ä»¶è¯»å–æ“ä½œï¼Œé¿å…é‡å¤è¯»å–ï¼Œå¹¶ç¡®ä¿åœ¨æ–‡ä»¶è¯»å–å®Œæ¯•åå†æ‰§è¡Œåç»­æ“ä½œã€‚</li>
</ul>
</li>
<li><strong>æ’ä»¶ç³»ç»Ÿ</strong>ï¼š
<ul>
<li>Webpack æ’ä»¶åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¯èƒ½ä¼šæ¶‰åŠå¤§é‡å¼‚æ­¥æ“ä½œï¼Œä¾‹å¦‚å‹ç¼©æ–‡ä»¶ã€è¾“å‡ºæ–‡ä»¶ç­‰ã€‚<strong>AsyncQueue</strong> å¸®åŠ©æ’ä»¶ç³»ç»Ÿç®¡ç†è¿™äº›å¼‚æ­¥ä»»åŠ¡ï¼Œä½¿å¾—æ’ä»¶ä¹‹é—´èƒ½å¤Ÿæœ‰æ•ˆååŒå·¥ä½œã€‚</li>
</ul>
</li>
</ol>
<p><strong>AsyncQueue çš„æ ¸å¿ƒæ–¹æ³•å’Œå·¥ä½œæµç¨‹</strong></p>
<ol>
<li><strong>enqueue</strong>ï¼šå°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œã€‚
<ul>
<li>æ¯ä¸ªä»»åŠ¡åœ¨è¢«æ”¾å…¥é˜Ÿåˆ—åä¼šè¢«ç«‹å³æ‰§è¡Œï¼Œæˆ–åœ¨å‰ç½®ä»»åŠ¡å®Œæˆåæ‰§è¡Œã€‚</li>
</ul>
</li>
<li><strong>process</strong>ï¼šå¤„ç†ä»»åŠ¡ï¼Œå¹¶å°†ä»»åŠ¡çš„ç»“æœç¼“å­˜ï¼Œé¿å…é‡å¤æ‰§è¡Œã€‚
<ul>
<li>å¤„ç†ä»»åŠ¡æ—¶ï¼Œè‹¥å‘ç°ä»»åŠ¡å·²ç»å­˜åœ¨ç¼“å­˜ï¼Œä¼šç›´æ¥è¿”å›ç¼“å­˜ç»“æœï¼Œè€Œä¸ä¼šé‡æ–°æ‰§è¡Œã€‚</li>
</ul>
</li>
<li><strong>resolve</strong>ï¼šå½“ä»»åŠ¡å®Œæˆæ—¶ï¼Œé€šçŸ¥é˜Ÿåˆ—è¯¥ä»»åŠ¡å·²ç»å¤„ç†å®Œæ¯•ï¼Œå¹¶å”¤é†’åç»­ä¾èµ–è¯¥ä»»åŠ¡çš„ä»»åŠ¡ã€‚</li>
</ol>
<p><strong>AsyncQueue çš„å·¥ä½œæµç¨‹</strong></p>
<ol>
<li><strong>ä»»åŠ¡å…¥é˜Ÿ</strong>ï¼šå½“ Webpack éœ€è¦æ‰§è¡ŒæŸä¸ªå¼‚æ­¥æ“ä½œï¼ˆå¦‚æ¨¡å—è§£æï¼‰æ—¶ï¼Œé¦–å…ˆæ£€æŸ¥è¯¥ä»»åŠ¡æ˜¯å¦å·²ç»å­˜åœ¨ç¼“å­˜ï¼Œè‹¥ä¸å­˜åœ¨åˆ™å°†ä»»åŠ¡æ”¾å…¥é˜Ÿåˆ—ã€‚</li>
<li><strong>ä»»åŠ¡æ‰§è¡Œ</strong>ï¼šé˜Ÿåˆ—æŒ‰ç…§ä¸€å®šé¡ºåºæ‰§è¡Œä»»åŠ¡ï¼Œå¹¶è®°å½•æ¯ä¸ªä»»åŠ¡çš„æ‰§è¡Œç»“æœã€‚è‹¥æŸä¸ªä»»åŠ¡ä¾èµ–å…¶ä»–ä»»åŠ¡ï¼Œåˆ™ä¼šç­‰å¾…ä¾èµ–ä»»åŠ¡å®Œæˆåå†æ‰§è¡Œã€‚</li>
<li><strong>ä»»åŠ¡ç¼“å­˜</strong>ï¼šä¸€æ—¦ä»»åŠ¡æ‰§è¡Œå®Œæˆï¼Œç»“æœä¼šè¢«ç¼“å­˜èµ·æ¥ï¼Œåç»­ç›¸åŒçš„ä»»åŠ¡ä¸ä¼šé‡å¤æ‰§è¡Œï¼Œè€Œæ˜¯ç›´æ¥è¿”å›ç¼“å­˜ç»“æœã€‚</li>
<li><strong>ä»»åŠ¡å®Œæˆ</strong>ï¼šå½“æ‰€æœ‰ä»»åŠ¡å®Œæˆåï¼ŒWebpack ç»§ç»­åç»­çš„æ„å»ºæµç¨‹ã€‚</li>
</ol>
<p><strong>AsyncQueue çš„å®é™…åº”ç”¨åœºæ™¯</strong></p>
<ul>
<li><strong>æ¨¡å—è§£æä¸æ–‡ä»¶è¯»å–</strong>ï¼šWebpack éœ€è¦å¼‚æ­¥åŠ è½½æ¨¡å—å’Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œ<strong>AsyncQueue</strong> èƒ½ç¡®ä¿æ¯ä¸ªæ¨¡å—æˆ–æ–‡ä»¶åªè¢«è§£æä¸€æ¬¡ï¼Œé¿å…é‡å¤è§£æå’Œè¯»å–ï¼Œæå‡æ„å»ºæ€§èƒ½ã€‚</li>
<li><strong>å¤šä»»åŠ¡è°ƒåº¦</strong>ï¼šWebpack æ’ä»¶ç³»ç»Ÿä¸­ï¼Œå¤šä¸ªæ’ä»¶ä¹‹é—´çš„ä»»åŠ¡è°ƒåº¦å¯èƒ½å­˜åœ¨ä¾èµ–ï¼Œ<strong>AsyncQueue</strong> èƒ½å¤Ÿå¸®åŠ©ç®¡ç†è¿™äº›å¤æ‚çš„ä»»åŠ¡ä¾èµ–å’Œæ‰§è¡Œé¡ºåºã€‚</li>
</ul>
<h3 id="æ€»ç»“-1"><strong>æ€»ç»“</strong>
</h3><p><strong>AsyncQueue</strong> æ˜¯ Webpack å†…éƒ¨çš„ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—æœºåˆ¶ï¼Œå®ƒå¸®åŠ©ç®¡ç†å’Œè°ƒåº¦å¼‚æ­¥ä»»åŠ¡ï¼Œé¿å…é‡å¤æ‰§è¡Œï¼Œæå‡æ„å»ºçš„æ•ˆç‡ã€‚å®ƒçš„ä¸»è¦ä½¿ç”¨åœºæ™¯åŒ…æ‹¬æ¨¡å—è§£æã€æ–‡ä»¶å¤„ç†å’Œæ’ä»¶æ‰§è¡Œï¼Œé€šè¿‡å®ƒçš„é˜Ÿåˆ—æœºåˆ¶ï¼ŒWebpack èƒ½æœ‰æ•ˆç®¡ç†å¤æ‚çš„å¼‚æ­¥æ“ä½œï¼Œç¡®ä¿ä»»åŠ¡çš„æ­£ç¡®æ‰§è¡Œé¡ºåºå’Œèµ„æºçš„é«˜æ•ˆåˆ©ç”¨ã€‚</p>
<p>é‡‡ç”¨ç¼“å­˜ï¼Œæ‡’ç¼–è¯‘å’Œå¹¶è¡Œç¼–è¯‘ç­‰æ–¹å¼æå‡ç¼–è¯‘é€Ÿåº¦ã€‚è€Œ AsyncQueue æ˜¯ webpack5 ä¸­æ–°å¢åŠ çš„ä¼˜åŒ–æœºåˆ¶ã€‚AsyncQueue å¯ä»¥å®ç°å¹¶è¡Œæ‰§è¡ŒæŒ‡å®šæ•°é‡çš„å¼‚æ­¥ä»»åŠ¡ã€‚å†…éƒ¨å¯¹ä»»åŠ¡è¿›è¡Œå¹¶å‘çš„æ§åˆ¶æˆ–è€…è¯´ç®¡ç†ã€‚</p>
<p>ç»™ä½ ä¸€ç³»åˆ—çš„å¼‚æ­¥ä»»åŠ¡ï¼Œè¦æ±‚å†™ä¸€ä¸ªç®¡ç†å™¨å»å¹¶å‘æ§åˆ¶ä»–ä»¬çš„æ‰§è¡Œï¼ŒåŒæ—¶èƒ½æŒ‡å®šå¹¶å‘çš„æ•°é‡ã€‚</p>
<p>ä½¿ç”¨ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//webpack ç¼“å­˜ æ‡’ç¼–è¯‘ å¹¶è¡Œç¼–è¯‘
</span></span></span><span class="line"><span class="cl"><span class="c1">//AsyncQueue å¯ä»¥å®ç°å¹¶è¡Œæ‰§è¡Œä»»åŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1">//ä»»åŠ¡çš„å¹¶å‘æ§åˆ¶æˆ–è€…è¯´ç®¡ç†å·¥å…· AsyncQueue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">AsyncQueue</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack/lib/util/AsyncQueue&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">processor</span><span class="p">(</span><span class="nx">module</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//å¼‚æ­¥æ˜¯æ¨¡æ‹Ÿå¼‚æ­¥åˆ›å»ºæ¨¡å—çš„è¿‡ç¨‹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">setTimeout</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;process &#34;</span><span class="p">,</span> <span class="nx">module</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="p">{</span> <span class="p">...</span><span class="nx">module</span><span class="p">,</span> <span class="nx">content</span><span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">key</span> <span class="o">+</span> <span class="s2">&#34;å†…å®¹&#34;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">getKey</span> <span class="o">=</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">key</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">queue</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncQueue</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;createModule&#34;</span><span class="p">,</span> <span class="c1">// é˜Ÿåˆ—çš„åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">parallelism</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">// å…è®¸çš„å¹¶å‘æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">processor</span><span class="p">,</span> <span class="c1">// å¤„ç†æ¨¡å—çš„æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">getKey</span><span class="p">,</span> <span class="c1">// é€šè¿‡è¿™ä¸ªæ–¹æ³•è·å–æ¯ä¸ªä»»åŠ¡å”¯ä¸€æ ‡è¯†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">start</span> <span class="o">=</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä»»åŠ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;module1&#34;</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">createdModule</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createdModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;module2&#34;</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">createdModule</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createdModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;module3&#34;</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">createdModule</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createdModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;module4&#34;</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">createdModule</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createdModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;module5&#34;</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">createdModule</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createdModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">queue</span><span class="p">.</span><span class="nx">add</span><span class="p">({</span> <span class="nx">key</span><span class="o">:</span> <span class="s2">&#34;module1&#34;</span> <span class="p">},</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">createdModule</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">createdModule</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">((</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span> <span class="o">-</span> <span class="nx">start</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æºç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span><span class="lnt">78
</span><span class="lnt">79
</span><span class="lnt">80
</span><span class="lnt">81
</span><span class="lnt">82
</span><span class="lnt">83
</span><span class="lnt">84
</span><span class="lnt">85
</span><span class="lnt">86
</span><span class="lnt">87
</span><span class="lnt">88
</span><span class="lnt">89
</span><span class="lnt">90
</span><span class="lnt">91
</span><span class="lnt">92
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">QUEUED_STATE</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//å·²ç» å…¥é˜Ÿï¼Œå¾…æ‰§è¡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">PROCESSING_STATE</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">//å¤„ç†ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">const</span> <span class="nx">DONE_STATE</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//å¤„ç†å®Œæˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">class</span> <span class="nx">ArrayQueue</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_list</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">enqueue</span><span class="p">(</span><span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_list</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span> <span class="c1">//[1,2,3]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">dequeue</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_list</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span> <span class="c1">//ç§»é™¤å¹¶è¿”å›æ•°ç»„ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">AsyncQueueEntry</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">item</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span> <span class="c1">//ä»»åŠ¡çš„æè¿°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">QUEUED_STATE</span><span class="p">;</span> <span class="c1">//è¿™ä¸ªæ¡ç›®å½“å‰çš„çŠ¶æ€
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="nx">callback</span><span class="p">;</span> <span class="c1">//ä»»åŠ¡å®Œæˆçš„å›è°ƒ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">AsyncQueue</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">({</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">parallelism</span><span class="p">,</span> <span class="nx">processor</span><span class="p">,</span> <span class="nx">getKey</span> <span class="p">})</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_name</span> <span class="o">=</span> <span class="nx">name</span><span class="p">;</span> <span class="c1">//é˜Ÿåˆ—çš„åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_parallelism</span> <span class="o">=</span> <span class="nx">parallelism</span><span class="p">;</span> <span class="c1">//å¹¶å‘æ‰§è¡Œçš„ä»»åŠ¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_processor</span> <span class="o">=</span> <span class="nx">processor</span><span class="p">;</span> <span class="c1">//é’ˆå¯¹é˜Ÿåˆ—ä¸­çš„æ¯ä¸ªæ¡ç›®æ‰§è¡Œä»€ä¹ˆæ“ä½œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_getKey</span> <span class="o">=</span> <span class="nx">getKey</span><span class="p">;</span> <span class="c1">//å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªkeyç”¨æ¥å”¯ä¸€æ ‡è¯†æ¯ä¸ªå…ƒç´ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_entries</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Map</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_queued</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayQueue</span><span class="p">();</span> <span class="c1">//å°†è¦æ‰§è¡Œçš„ä»»åŠ¡æ•°ç»„é˜Ÿåˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_activeTasks</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="c1">//å½“å‰æ­£åœ¨æ‰§è¡Œçš„æ•°ï¼Œé»˜è®¤å€¼1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_willEnsureProcessing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span> <span class="c1">//æ˜¯å¦å°†è¦å¼€å§‹å¤„ç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">add</span> <span class="o">=</span> <span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">key</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getKey</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span> <span class="c1">//è·å–è¿™ä¸ªæ¡ç›®å¯¹åº”çš„key
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kr">const</span> <span class="nx">entry</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_entries</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key</span><span class="p">);</span> <span class="c1">//è·å– è¿™ä¸ªkeyå¯¹åº”çš„è€çš„æ¡ç›®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">state</span> <span class="o">===</span> <span class="nx">DONE_STATE</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">process</span><span class="p">.</span><span class="nx">nextTick</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">error</span><span class="p">,</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">result</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">entry</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">=</span> <span class="p">[</span><span class="nx">callback</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">entry</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">callback</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">newEntry</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AsyncQueueEntry</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span> <span class="c1">//åˆ›å»ºä¸€ä¸ªæ–°çš„æ¡ç›®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_entries</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key</span><span class="p">,</span> <span class="nx">newEntry</span><span class="p">);</span> <span class="c1">//æ”¾åˆ°_entries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">this</span><span class="p">.</span><span class="nx">_queued</span><span class="p">.</span><span class="nx">enqueue</span><span class="p">(</span><span class="nx">newEntry</span><span class="p">);</span> <span class="c1">//æŠŠè¿™ä¸ªæ–°æ¡ç›®æ”¾æ”¾é˜Ÿåˆ—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_willEnsureProcessing</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">_willEnsureProcessing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setImmediate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ensureProcessing</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_ensureProcessing</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//å¦‚æœå½“å‰çš„æ¿€æ´»çš„æˆ–è€… è¯´æ­£åœ¨æ‰§è¡Œä»»åŠ¡æ•°è¡Œå°äºå¹¶å‘æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">while</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_activeTasks</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">_parallelism</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kr">const</span> <span class="nx">entry</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_queued</span><span class="p">.</span><span class="nx">dequeue</span><span class="p">();</span> <span class="c1">//å‡ºé˜Ÿ å…ˆå…¥å…ˆå‡º
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="p">(</span><span class="nx">entry</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">_activeTasks</span><span class="o">++</span><span class="p">;</span> <span class="c1">//å…ˆè®©æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡æ•°++
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">entry</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">PROCESSING_STATE</span><span class="p">;</span> <span class="c1">//æ¡ç›®çš„çŠ¶æ€è®¾ç½®ä¸ºæ‰§è¡Œä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">this</span><span class="p">.</span><span class="nx">_startProcessing</span><span class="p">(</span><span class="nx">entry</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_willEnsureProcessing</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_startProcessing</span> <span class="o">=</span> <span class="p">(</span><span class="nx">entry</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_processor</span><span class="p">(</span><span class="nx">entry</span><span class="p">.</span><span class="nx">item</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">_handleResult</span><span class="p">(</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">_handleResult</span> <span class="o">=</span> <span class="p">(</span><span class="nx">entry</span><span class="p">,</span> <span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">callback</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">callback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kr">const</span> <span class="nx">callbacks</span> <span class="o">=</span> <span class="nx">entry</span><span class="p">.</span><span class="nx">callbacks</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry</span><span class="p">.</span><span class="nx">state</span> <span class="o">=</span> <span class="nx">DONE_STATE</span><span class="p">;</span> <span class="c1">//æŠŠæ¡ç›®çš„çŠ¶æ€è®¾ç½®ä¸ºå·²ç»å®Œæˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">entry</span><span class="p">.</span><span class="nx">callback</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span> <span class="c1">//æŠŠcallback
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">entry</span><span class="p">.</span><span class="nx">callbacks</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry</span><span class="p">.</span><span class="nx">result</span> <span class="o">=</span> <span class="nx">result</span><span class="p">;</span> <span class="c1">//æŠŠç»“æœèµ‹ç»™entry
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">entry</span><span class="p">.</span><span class="nx">error</span> <span class="o">=</span> <span class="nx">error</span><span class="p">;</span> <span class="c1">//æŠŠé”™è¯¯å¯¹è±¡èµ‹ç»™entry
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">callbacks</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">callback</span> <span class="k">of</span> <span class="nx">callbacks</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">callback</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">_activeTasks</span><span class="o">--</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_willEnsureProcessing</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">this</span><span class="p">.</span><span class="nx">_willEnsureProcessing</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">setImmediate</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_ensureProcessing</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">AsyncQueue</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="webpack-ä¼˜åŒ–">webpack ä¼˜åŒ–
</h2><ol>
<li>
<p>æŸ¥æ‰¾æ¨¡å—æ—¶ï¼Œå°½é‡ç¼©å°æŸ¥æ‰¾èŒƒå›´</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">resolve</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">extensions</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;.js&#39;</span><span class="p">,</span><span class="s1">&#39;.jsx&#39;</span><span class="p">,</span><span class="s1">&#39;.ts&#39;</span><span class="p">,</span><span class="s1">&#39;.json&#39;</span><span class="p">],</span>  <span class="c1">// é…ç½®åï¼Œåœ¨é¡¹ç›®ä¸­requireæˆ–importå…¶ä»–æ¨¡å—æ—¶ï¼Œå¯ä»¥çœç•¥æ–‡ä»¶æ‰©å±•å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">alias</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        	<span class="err">@</span><span class="o">:</span><span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span><span class="s1">&#39;src&#39;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        	<span class="nx">myLib</span><span class="o">:</span><span class="s1">&#39;å…·ä½“çš„åº“æ‰€åœ¨ç›®å½•&#39;</span>
</span></span><span class="line"><span class="cl">    	<span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="nx">modules</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;my_modules&#39;</span><span class="p">,</span><span class="s1">&#39;node_modules&#39;</span><span class="p">],</span> <span class="c1">// å¯¹äºæŸ¥æ‰¾ç¬¬ä¸‰æ–¹åº“ï¼Œwebpacké»˜è®¤ä½¿ç”¨nodejsçš„é»˜è®¤è§„åˆ™ï¼Œå³å»node_modulesç›®å½•ä¸­æŸ¥æ‰¾ï¼Œå¦‚æœè‡ªå·±çš„åº“æƒ³æ¨¡æ‹Ÿè¿™ä¸ªæŸ¥æ‰¾è·¯å¾„ï¼Œå°±å¯ä»¥åœ¨è¿™ä¸ªå­—æ®µä¸­é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    	<span class="nx">mainFields</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;browser&#39;</span><span class="p">,</span> <span class="s1">&#39;module&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span><span class="p">],</span> <span class="c1">// é»˜è®¤å€¼ï¼ŒæŒ‡çš„æ˜¯å¯¹äºå¼•å…¥ä¸€ä¸ªåŒ…ï¼ŒæŸ¥æ‰¾æ–‡ä»¶æ—¶ï¼Œä¾æ¬¡å‚è€ƒpackage.jsonæ–‡ä»¶ä¸­çš„å“ªä¸ªå­—æ®µæŒ‡å‘çš„æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    	<span class="nx">mainFiles</span><span class="o">:</span><span class="p">[</span><span class="s1">&#39;index.js&#39;</span><span class="p">],</span> <span class="c1">// é»˜è®¤å€¼ï¼Œå½“ç›®å½•ä¸‹æ²¡æœ‰ package.json æ–‡ä»¶æ—¶ï¼Œä¼šé»˜è®¤ä½¿ç”¨ç›®å½•ä¸‹çš„ index.js è¿™ä¸ªæ–‡ä»¶å¯ä»¥åœ¨è¿™é‡Œé…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// resolveLoader ç”¨äºé…ç½®è§£æ loader æ—¶çš„ resolve é…ç½®,é»˜è®¤çš„é…ç½®
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">resolveLoader</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s1">&#39;node_modules&#39;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">extensions</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;.js&#39;</span><span class="p">,</span> <span class="s1">&#39;.json&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">        <span class="nx">mainFields</span><span class="o">:</span> <span class="p">[</span> <span class="s1">&#39;loader&#39;</span><span class="p">,</span> <span class="s1">&#39;main&#39;</span> <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// å¯ä»¥ç”¨äºé…ç½®å“ªäº›æ¨¡å—æ–‡ä»¶çš„å†…å®¹ä¸éœ€è¦è¿›è¡Œè§£æ,ä¸éœ€è¦è§£æä¾èµ–ï¼ˆå³æ— ä¾èµ–ï¼‰ çš„ç¬¬ä¸‰æ–¹å¤§å‹ç±»åº“ç­‰ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ªå­—æ®µæ¥é…ç½®ï¼Œä»¥æé«˜æ•´ä½“çš„æ„å»ºé€Ÿåº¦
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// ä¸€èˆ¬æ¥è¯´æˆ‘ä»¬æ‹¿åˆ°æ¨¡å—åè¦åˆ†æé‡Œé¢çš„ä¾èµ–çš„æ¨¡å—import/require
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// æœ‰äº›æ¨¡å—æˆ‘ä»¬çŸ¥é“å®ƒè‚¯å®šæ²¡æœ‰ä¾èµ–åˆ«çš„æ¨¡å—å¦‚jquery lodash,æ‰€ä»¥å¯ä»¥çœè¿™ä¸€æ­¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">//noParse: /jquery|lodash/, // æ­£åˆ™è¡¨è¾¾å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// æˆ–è€…ä½¿ç”¨å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">noParse</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="sr">/jquery|lodash/</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">     <span class="p">},</span>
</span></span><span class="line"><span class="cl">     <span class="nx">plugins</span><span class="o">:</span><span class="p">[</span>
</span></span><span class="line"><span class="cl">         <span class="c1">// IgnorePluginç”¨äºå¿½ç•¥æŸäº›ç‰¹å®šçš„æ¨¡å—ï¼Œè®© webpack ä¸æŠŠè¿™äº›æŒ‡å®šçš„æ¨¡å—æ‰“åŒ…è¿›å»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">IgnorePlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">             <span class="nx">contextRegExp</span><span class="o">:</span><span class="sr">/moment$/</span><span class="p">,</span>  <span class="c1">// ç›®æ ‡åº“çš„æ­£åˆ™   åŒ¹é…å¼•å…¥æ¨¡å—è·¯å¾„çš„æ­£åˆ™è¡¨è¾¾å¼
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>             <span class="nx">resourceRegExp</span><span class="o">:</span> <span class="sr">/^\.\/locale/</span>   <span class="c1">// åº“ä¸­éœ€è¦å¿½ç•¥æ–‡ä»¶å¤¹çš„æ­£åˆ™   åŒ¹é…æ¨¡å—çš„å¯¹åº”ä¸Šä¸‹æ–‡ï¼Œå³æ‰€åœ¨ç›®å½•å
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="p">})</span>
</span></span><span class="line"><span class="cl">     <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<p>IgnorePlugin çš„å…¸å‹ä½¿ç”¨å°±æ˜¯ç”¨äºå¿½ç•¥ moment è¿™ä¸ªåŒ…çš„è¯­è¨€åº“æ–‡ä»¶ï¼Œå¯¹äºè‡ªå·±éœ€è¦çš„è¯­è¨€æ–‡ä»¶ï¼Œè‡ªå·±è‡ªè¡Œå•ç‹¬å¯¼å…¥åˆ°é¡¹ç›®ä¸­å³å¯ã€‚</p>
<p><img src="/blogs/post/webpack/images/image-20230502192840848.png"
	width="1391"
	height="1216"
	srcset="/blogs/post/webpack/images/image-20230502192840848_hu_c9267a4470fa14a9.png 480w, /blogs/post/webpack/images/image-20230502192840848_hu_2051c0b35b4ab5c7.png 1024w"
	loading="lazy"
	
		alt="image-20230502192840848"
	
	
		class="gallery-image" 
		data-flex-grow="114"
		data-flex-basis="274px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">moment</span> <span class="nx">from</span> <span class="s2">&#34;moment&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span> <span class="s2">&#34;moment/locale/zh-cn&#34;</span><span class="p">;</span> <span class="c1">// è‡ªè¡Œå¯¼å…¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">moment</span><span class="p">().</span><span class="nx">format</span><span class="p">(</span><span class="s2">&#34;MMMM Do YYYY, h:mm:ss a&#34;</span><span class="p">));</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ol start="2">
<li>
<p>æ‰“åŒ…è€—æ—¶åˆ†æ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">SpeedMeasureWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;speed-measure-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">smw</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">SpeedMeasureWebpackPlugin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">smw</span><span class="p">.</span><span class="nx">wrap</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
<li>
<p>æ‰“åŒ…ä½“ç§¯åˆ†æ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">BundleAnalyzerPlugin</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack-bundle-analyzer&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">BundleAnalyzerPlugin</span><span class="p">()],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div></li>
</ol>
<h2 id="webpack-æ„å»ºåº“">webpack æ„å»ºåº“
</h2><ul>
<li>
<p>webpack çš„é…ç½®æ–‡ä»¶ä¸­çš„ output å¯¹è±¡ä¸­çš„ library é€‰é¡¹å…è®¸å°†æ¨¡å—å¯¼å‡ºçš„å†…å®¹ä½œä¸ºåº“ï¼ˆlibraryï¼‰æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨</p>
</li>
<li>
<p><code>library</code>å±æ€§ç”¨äºæŒ‡å®šåº“çš„åç§°ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å°†å…¶ä½œä¸ºå…¨å±€å˜é‡æš´éœ²ç»™æµè§ˆå™¨ç¯å¢ƒã€‚å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯ä»¥åœ¨å¯¹è±¡ä¸­æŒ‡å®š library çš„åç§°å’Œå¯¼å‡ºæ–¹å¼ç­‰ç›¸å…³é€‰é¡¹</p>
</li>
<li>
<p><code>libraryExport</code>å±æ€§ç”¨äºæŒ‡å®šè¦å¯¼å‡ºçš„å†…å®¹ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„æˆ–è€…ä¸€ä¸ªå¯¹è±¡ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™å°†è¯¥å­—ç¬¦ä¸²æŒ‡å®šçš„å¯¼å‡ºå†…å®¹æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ï¼Œåˆ™å°†æ•°ç»„ä¸­æŒ‡å®šçš„å¯¼å‡ºå†…å®¹æš´éœ²ç»™å¤–éƒ¨ä½¿ç”¨ã€‚å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œåˆ™å¯ä»¥åœ¨å¯¹è±¡ä¸­æŒ‡å®šè¦å¯¼å‡ºçš„å†…å®¹å’Œå¯¼å‡ºæ–¹å¼ç­‰ç›¸å…³é€‰é¡¹</p>
</li>
<li>
<p>libraryTarget å±æ€§ç”¨äºæŒ‡å®šåº“çš„å¯¼å‡ºæ–¹å¼ï¼Œå¯ä»¥æ˜¯ä»¥ä¸‹å€¼ä¹‹ä¸€ï¼š</p>
<ul>
<li><code>var</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹å¯ç”¨</li>
<li><code>assign</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡åœ¨å…¨å±€ä½œç”¨åŸŸä¸‹å¯ç”¨ï¼Œä½†å¯ä»¥è¢«å…¶ä»–åº“æˆ–æ¨¡å—è¦†ç›–</li>
<li><code>this</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡åœ¨ this å¯¹è±¡ä¸‹å¯ç”¨</li>
<li><code>window</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡åœ¨ window å¯¹è±¡ä¸‹å¯ç”¨ï¼ˆä»…åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹æœ‰æ•ˆï¼‰</li>
<li><code>global</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ªå˜é‡ï¼Œè¯¥å˜é‡åœ¨ global å¯¹è±¡ä¸‹å¯ç”¨ï¼ˆä»…åœ¨ Node.js ç¯å¢ƒä¸‹æœ‰æ•ˆï¼‰</li>
<li><code>commonjs</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ª CommonJS æ¨¡å—ï¼Œè¯¥æ¨¡å—åœ¨ Node.js ç¯å¢ƒä¸‹å¯ç”¨</li>
<li><code>commonjs2</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ª CommonJS2 æ¨¡å—ï¼Œè¯¥æ¨¡å—åœ¨ Node.js ç¯å¢ƒä¸‹å¯ç”¨</li>
<li><code>amd</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ª AMD æ¨¡å—ï¼Œè¯¥æ¨¡å—åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹å¯ç”¨</li>
<li><code>umd</code>ï¼šå°†åº“å¯¼å‡ºä¸ºä¸€ä¸ª UMD æ¨¡å—ï¼Œè¯¥æ¨¡å—æ—¢å¯åœ¨æµè§ˆå™¨ç¯å¢ƒä¸‹ï¼Œä¹Ÿå¯åœ¨ Node.js ç¯å¢ƒä¸‹ä½¿ç”¨</li>
</ul>
</li>
<li>
<p><a class="link" href="https://webpack.js.org/configuration/output/#outputlibrarytarget"  target="_blank" rel="noopener"
    >output librarytarget</a></p>
</li>
<li>
<p>åœ¨ä½¿ç”¨ webpack ç¼–å†™è‡ªå·±å¼€å‘çš„åº“ç»™åˆ«äººä½¿ç”¨æ—¶ï¼Œéœ€è¦é…ç½®è¿™ä¸ªå­—æ®µä¸­çš„å€¼</p>
</li>
<li>
<p>å½“ç”¨ Webpack å»æ„å»ºä¸€ä¸ªå¯ä»¥è¢«å…¶ä»–æ¨¡å—å¯¼å…¥ä½¿ç”¨çš„åº“æ—¶éœ€è¦ç”¨åˆ°</p>
</li>
<li>
<p><code>output.library</code> é…ç½®å¯¼å‡ºåº“çš„åç§°</p>
</li>
<li>
<p><code>output.libraryExport</code> é…ç½®è¦å¯¼å‡ºçš„æ¨¡å—ä¸­å“ªäº›å­æ¨¡å—éœ€è¦è¢«å¯¼å‡ºã€‚ å®ƒåªæœ‰åœ¨ output.libraryTarget è¢«è®¾ç½®æˆ commonjs æˆ–è€… commonjs2 æ—¶ä½¿ç”¨æ‰æœ‰æ„ä¹‰</p>
</li>
<li>
<p><code>output.libraryTarget</code> é…ç½®ä»¥ä½•ç§æ–¹å¼å¯¼å‡ºåº“,æ˜¯å­—ç¬¦ä¸²çš„æšä¸¾ç±»å‹ï¼Œæ”¯æŒä»¥ä¸‹é…ç½®</p>
</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">libraryTarget</th>
          <th style="text-align: left">ä½¿ç”¨è€…çš„å¼•å…¥æ–¹å¼</th>
          <th style="text-align: left">ä½¿ç”¨è€…æä¾›ç»™è¢«ä½¿ç”¨è€…çš„æ¨¡å—çš„æ–¹å¼</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">var</td>
          <td style="text-align: left">åªèƒ½ä»¥ script æ ‡ç­¾çš„å½¢å¼å¼•å…¥æˆ‘ä»¬çš„åº“</td>
          <td style="text-align: left">åªèƒ½ä»¥å…¨å±€å˜é‡çš„å½¢å¼æä¾›è¿™äº›è¢«ä¾èµ–çš„æ¨¡å—</td>
      </tr>
      <tr>
          <td style="text-align: left">commonjs</td>
          <td style="text-align: left">åªèƒ½æŒ‰ç…§ commonjs çš„è§„èŒƒå¼•å…¥æˆ‘ä»¬çš„åº“</td>
          <td style="text-align: left">è¢«ä¾èµ–æ¨¡å—éœ€è¦æŒ‰ç…§ commonjs è§„èŒƒå¼•å…¥</td>
      </tr>
      <tr>
          <td style="text-align: left">commonjs2</td>
          <td style="text-align: left">åªèƒ½æŒ‰ç…§ commonjs2 çš„è§„èŒƒå¼•å…¥æˆ‘ä»¬çš„åº“</td>
          <td style="text-align: left">è¢«ä¾èµ–æ¨¡å—éœ€è¦æŒ‰ç…§ commonjs2 è§„èŒƒå¼•å…¥</td>
      </tr>
      <tr>
          <td style="text-align: left">amd</td>
          <td style="text-align: left">åªèƒ½æŒ‰ amd è§„èŒƒå¼•å…¥</td>
          <td style="text-align: left">è¢«ä¾èµ–çš„æ¨¡å—éœ€è¦æŒ‰ç…§ amd è§„èŒƒå¼•å…¥</td>
      </tr>
      <tr>
          <td style="text-align: left">this</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">window</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">global</td>
          <td style="text-align: left"></td>
          <td style="text-align: left"></td>
      </tr>
      <tr>
          <td style="text-align: left">umd</td>
          <td style="text-align: left">å¯ä»¥ç”¨ scriptã€commonjsã€amd å¼•å…¥</td>
          <td style="text-align: left">æŒ‰å¯¹åº”çš„æ–¹å¼å¼•å…¥</td>
      </tr>
  </tbody>
</table></div>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s2">&#34;./src/index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">path</span><span class="o">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="s2">&#34;build&#34;</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name].js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">library</span><span class="o">:</span> <span class="s2">&#34;myTools&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">libraryTarget</span><span class="o">:</span> <span class="s2">&#34;var&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ç°ä»£åŒ–çš„ npm åŒ…éƒ½ä¼šæ‰“åŒ…è¾“å‡ºå¤šç§æ¨¡å—åŒ–è§„èŒƒçš„æ–‡ä»¶</p>
<p>webpack ç›®å‰ä¸æ”¯æŒæ‰“åŒ…æˆ esmodule æ ¼å¼çš„åº“ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;path&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="p">{</span> <span class="nx">merge</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpack-merge&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">baseConfig</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="s2">&#34;./src/index.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">externals</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//nodeExternals()  //æ’é™¤æ‰€æœ‰çš„ç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå°±æ˜¯æŠŠnode_modulesé‡Œçš„æ¨¡å—å…¨éƒ¨è®¾ç½®ä¸ºå¤–éƒ¨æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//library:&#39;math&#39;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//libraryExport:&#39;add&#39;,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">  <span class="nx">merge</span><span class="p">(</span><span class="nx">baseConfig</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name]-window.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">libraryTarget</span><span class="o">:</span> <span class="s2">&#34;window&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">merge</span><span class="p">(</span><span class="nx">baseConfig</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name]-commonjs.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">libraryTarget</span><span class="o">:</span> <span class="s2">&#34;commonjs2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">merge</span><span class="p">(</span><span class="nx">baseConfig</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name]-umd.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">libraryTarget</span><span class="o">:</span> <span class="s2">&#34;umd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="nx">merge</span><span class="p">(</span><span class="nx">baseConfig</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;[name]-amd.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">libraryTarget</span><span class="o">:</span> <span class="s2">&#34;amd&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="p">}),</span>
</span></span><span class="line"><span class="cl"><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>externals</strong></p>
<p>ä¸€èˆ¬ç¼–å†™ä¸€ä¸ªåº“çš„æ—¶å€™ï¼Œè‡ªå·±çš„é¡¹ç›®ä¸­å¹¶ä¸è¦æ‰“åŒ…ç¬¬ä¸‰æ–¹ä¾èµ–åˆ°è‡ªå·±æœ€åæ‰“åŒ…çš„æ–‡ä»¶ä¸­ï¼Œè€Œæ˜¯åœ¨ package.json ä¸­é€šè¿‡åŒç­‰ä¾èµ–é…ç½®é¡¹æ¥è¿›è¡Œè®¾ç½®ã€‚åœ¨ç”¨æˆ·å®‰è£…äº†è‡ªå·±çš„åŒ…ä¹‹åï¼Œç›´æ¥ä½¿ç”¨ç”¨æˆ·é¡¹ç›®ç¯å¢ƒä¸­å®‰è£…çš„åŒç­‰ä¾èµ–åŒ…ã€‚</p>
<ul>
<li><code>externals</code>é€‰é¡¹ç”¨äºæŒ‡å®šå“ªäº›æ¨¡å—åº”è¯¥è¢«è§†ä¸ºå¤–éƒ¨æ¨¡å—ï¼Œä¸åº”è¯¥è¢«æ‰“åŒ…è¿›è¾“å‡ºçš„ bundle ä¸­</li>
<li>externals é€‰é¡¹å¯ä»¥æ˜¯ä¸€ä¸ªå¯¹è±¡ã€ä¸€ä¸ªå­—ç¬¦ä¸²ã€ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼æˆ–è€…ä¸€ä¸ªå‡½æ•°
<ul>
<li>å¦‚æœæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™è¡¨ç¤ºè¦æ’é™¤çš„æ¨¡å—åç§°</li>
<li>å¦‚æœæ˜¯ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼ï¼Œåˆ™è¡¨ç¤ºè¦æ’é™¤çš„æ¨¡å—åç§°ä¸è¯¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ‰€æœ‰æ¨¡å—ã€‚</li>
<li>å¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™åœ¨å‡½æ•°ä¸­å¯ä»¥è‡ªå®šä¹‰åˆ¤æ–­å“ªäº›æ¨¡å—åº”è¯¥è¢«æ’é™¤åœ¨æ‰“åŒ…ä¹‹å¤–ï¼Œéœ€è¦è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æ¥è¡¨ç¤ºæ˜¯å¦æ’é™¤è¯¥æ¨¡å—</li>
</ul>
</li>
<li>å¦‚æœæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡çš„é”®è¡¨ç¤ºè¦æ’é™¤çš„æ¨¡å—åç§°ï¼Œå€¼è¡¨ç¤ºåœ¨å“ªç§ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥æ¨¡å—ã€‚å¯ä»¥æŒ‡å®š<code>commonjs</code>ã€<code>commonjs2</code>ã€<code>amd</code>æˆ–è€…<code>root</code>ç­‰é€‰é¡¹æ¥æŒ‡å®šåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹ä½¿ç”¨è¯¥æ¨¡å—æ—¶çš„åç§°</li>
</ul>
<p><img src="/blogs/post/webpack/images/image-20241227191314855.png"
	width="481"
	height="459"
	srcset="/blogs/post/webpack/images/image-20241227191314855_hu_e0cbfa95afe7fecc.png 480w, /blogs/post/webpack/images/image-20241227191314855_hu_a41c94aaeed6baf.png 1024w"
	loading="lazy"
	
		alt="image-20241227191314855"
	
	
		class="gallery-image" 
		data-flex-grow="104"
		data-flex-basis="251px"
	
></p>
<p>å¦‚æœä¾èµ–äº†å¾ˆå¤šç¬¬ä¸‰æ–¹æ¨¡å—ï¼Œå¯ä»¥ä½¿ç”¨ webpack-node-externals æ’ä»¶å³å¯ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="err">externals:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="err">nodeExternals()</span>
</span></span><span class="line"><span class="cl"><span class="p">]</span><span class="err">,</span>
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li><code>webpack-node-externals</code>æ˜¯ä¸€ä¸ª npm åŒ…ï¼Œå®ƒå¯ä»¥å¸®åŠ©æ’é™¤ Node.js åº”ç”¨ç¨‹åºä¸­ä¸éœ€è¦æ‰“åŒ…çš„ç¬¬ä¸‰æ–¹æ¨¡å—ã€‚ä¸ webpack çš„ externals é€‰é¡¹ç±»ä¼¼ï¼Œwebpack-node-externals ä¹Ÿå¯ä»¥å°†æŒ‡å®šçš„æ¨¡å—æ’é™¤åœ¨ webpack æ‰“åŒ…ä¹‹å¤–ï¼Œä»è€Œå‡å°è¾“å‡ºçš„ bundle ä½“ç§¯ï¼Œæé«˜åº”ç”¨ç¨‹åºçš„åŠ è½½é€Ÿåº¦</li>
<li><code>nodeExternals</code>å‡½æ•°å°†è¿”å›ä¸€ä¸ªæ’é™¤æ‰€æœ‰<code>node_modules</code>ä¸­çš„æ¨¡å—çš„ externals å¯¹è±¡ã€‚è¿™æ ·ï¼Œæ‰€æœ‰çš„<code>node_modules</code>ä¸­çš„æ¨¡å—éƒ½å°†è¢«æ’é™¤åœ¨ webpack æ‰“åŒ…ä¹‹å¤–</li>
</ul>
<h2 id="æå–-css">æå– CSS
</h2><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install  mini-css-extract-plugin --save-dev
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#39;path&#39;);
</span></span><span class="line"><span class="cl">const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;);
</span></span><span class="line"><span class="cl"><span class="gi">+const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>module.exports = {
</span></span><span class="line"><span class="cl">  mode: &#39;development&#39;,
</span></span><span class="line"><span class="cl">  devtool: false,
</span></span><span class="line"><span class="cl">  entry: &#39;./src/index.js&#39;,
</span></span><span class="line"><span class="cl">  output: {
</span></span><span class="line"><span class="cl">    path: path.resolve(__dirname, &#39;dist&#39;),
</span></span><span class="line"><span class="cl">    filename: &#39;[name].js&#39;,
</span></span><span class="line"><span class="cl"><span class="gi">+    publicPath: &#39;/&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  },
</span></span><span class="line"><span class="cl">  module: {
</span></span><span class="line"><span class="cl">    rules: [
</span></span><span class="line"><span class="cl"><span class="gi">+      { test: /\.css$/, use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;] },
</span></span></span><span class="line"><span class="cl"><span class="gi">+      { test: /\.less$/, use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;less-loader&#39;] },
</span></span></span><span class="line"><span class="cl"><span class="gi">+      { test: /\.scss$/, use: [MiniCssExtractPlugin.loader, &#39;css-loader&#39;, &#39;sass-loader&#39;] },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    ]
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  plugins: [
</span></span><span class="line"><span class="cl">    new HtmlWebpackPlugin({ template: &#39;./src/index.html&#39; }),
</span></span><span class="line"><span class="cl"><span class="gi">+   new MiniCssExtractPlugin({
</span></span></span><span class="line"><span class="cl"><span class="gi">+      filename: &#39;style/[name].css&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi">+   })
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  ]
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å¼€å‘æ¨¡å¼ä¸‹å‹ç¼©æ–‡ä»¶">å¼€å‘æ¨¡å¼ä¸‹å‹ç¼©æ–‡ä»¶
</h2><ul>
<li><a class="link" href="https://www.npmjs.com/package/optimize-css-assets-webpack-plugin"  target="_blank" rel="noopener"
    >optimize-css-assets-webpack-plugin</a>æ˜¯ä¸€ä¸ªä¼˜åŒ–å’Œå‹ç¼© CSS èµ„æºçš„æ’ä»¶</li>
<li><a class="link" href="https://www.npmjs.com/package/terser-webpack-plugin"  target="_blank" rel="noopener"
    >terser-webpack-plugin</a>æ˜¯ä¸€ä¸ªä¼˜åŒ–å’Œå‹ç¼© JS èµ„æºçš„æ’ä»¶</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#39;path&#39;);
</span></span><span class="line"><span class="cl">const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;);
</span></span><span class="line"><span class="cl">const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;);
</span></span><span class="line"><span class="cl"><span class="gi">+ const OptimizeCssAssetsWebpackPlugin = require(&#39;optimize-css-assets-webpack-plugin&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi">+ const TerserPlugin = require(&#39;terser-webpack-plugin&#39;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl"><span class="gi">+  mode: &#39;none&#39;,   // å¦‚æœmodeæ˜¯production,ä¼šè‡ªåŠ¨å¯ç”¨å‹ç¼©æ’ä»¶,å¦‚æœé…ç½®ä¸ºnoneè¡¨ç¤ºä¸ä¼šå¯ç”¨å‹ç¼©æ’ä»¶ï¼Œä½†å¯ä»¥è‡ªå·±é…
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  devtool: false,
</span></span><span class="line"><span class="cl">  entry: &#39;./src/index.js&#39;,
</span></span><span class="line"><span class="cl"><span class="gi">+  // jsæ–‡ä»¶çš„å‹ç¼©
</span></span></span><span class="line"><span class="cl"><span class="gi">+  optimization: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+    minimize: true,
</span></span></span><span class="line"><span class="cl"><span class="gi">+    minimizer: [
</span></span></span><span class="line"><span class="cl"><span class="gi">+      new TerserPlugin(),
</span></span></span><span class="line"><span class="cl"><span class="gi">+    ],
</span></span></span><span class="line"><span class="cl"><span class="gi">+  },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  output: {
</span></span><span class="line"><span class="cl">    path: path.resolve(__dirname, &#39;dist&#39;),
</span></span><span class="line"><span class="cl">    filename: &#39;[name].js&#39;,
</span></span><span class="line"><span class="cl">    publicPath: &#39;/&#39;,
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  devServer: {
</span></span><span class="line"><span class="cl">    contentBase: path.resolve(__dirname, &#39;dist&#39;),
</span></span><span class="line"><span class="cl">    compress: true,
</span></span><span class="line"><span class="cl">    port: 8080,
</span></span><span class="line"><span class="cl">    open: true,
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  module: {
</span></span><span class="line"><span class="cl">    rules: [
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.(jpg|png|gif|bmp|svg)$/,
</span></span><span class="line"><span class="cl">        type:&#39;asset/resource&#39;,
</span></span><span class="line"><span class="cl">        generator:{
</span></span><span class="line"><span class="cl">          filename:&#39;images/[contenthash][ext]&#39;
</span></span><span class="line"><span class="cl">        }
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.html$/,
</span></span><span class="line"><span class="cl">        loader: &#39;html-loader&#39;,
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl">    ],
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  plugins: [
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="gi">+   // htmlæ–‡ä»¶å‹ç¼©
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    new HtmlWebpackPlugin({
</span></span><span class="line"><span class="cl">    template: &#39;./src/index.html&#39;,
</span></span><span class="line"><span class="cl"><span class="gi">+     minify: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+        collapseWhitespace: true,
</span></span></span><span class="line"><span class="cl"><span class="gi">+        removeComments: true
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>      }
</span></span><span class="line"><span class="cl">    }),
</span></span><span class="line"><span class="cl">    new MiniCssExtractPlugin({
</span></span><span class="line"><span class="cl">      filename: &#39;css/[name].css&#39;,
</span></span><span class="line"><span class="cl">    }),
</span></span><span class="line"><span class="cl"><span class="gi">+    new OptimizeCssAssetsWebpackPlugin(),  // cssæ–‡ä»¶å‹ç¼©
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  ],
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="cdn">CDN
</h2><ul>
<li>
<p><a class="link" href="https://webpack.js.org/guides/public-path/#root"  target="_blank" rel="noopener"
    >public-path</a></p>
</li>
<li>
<p><a class="link" href="https://npmmirror.com/package/external-remotes-plugin"  target="_blank" rel="noopener"
    >external-remotes-plugin</a></p>
</li>
<li>
<p>HTML æ–‡ä»¶ä¸ç¼“å­˜ï¼Œæ”¾åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå…³é—­è‡ªå·±æœåŠ¡å™¨çš„ç¼“å­˜ï¼Œé™æ€èµ„æºçš„ URL å˜æˆæŒ‡å‘ CDN æœåŠ¡å™¨çš„åœ°å€</p>
</li>
<li>
<p>é™æ€çš„ JavaScriptã€CSSã€å›¾ç‰‡ç­‰æ–‡ä»¶å¼€å¯ CDN å’Œç¼“å­˜ï¼Œå¹¶ä¸”æ–‡ä»¶åå¸¦ä¸Š HASH å€¼</p>
</li>
<li>
<p>ä¸ºäº†å¹¶è¡ŒåŠ è½½ä¸é˜»å¡ï¼ŒæŠŠä¸åŒçš„é™æ€èµ„æºåˆ†é…åˆ°ä¸åŒçš„ CDN æœåŠ¡å™¨ä¸Š</p>
</li>
<li>
<p>å¯ä»¥é€šè¿‡åœ¨ HTML HEAD æ ‡ç­¾ä¸­ åŠ å…¥<code>&lt;link rel=&quot;dns-prefetch&quot; href=&quot;http://img.zhufengpeixun.cn&quot;&gt;</code>å»é¢„è§£æåŸŸåï¼Œä»¥é™ä½åŸŸåè§£æå¸¦æ¥çš„å»¶è¿Ÿ</p>
</li>
</ul>
<h2 id="æ–‡ä»¶æŒ‡çº¹">æ–‡ä»¶æŒ‡çº¹
</h2><ul>
<li>æ‰“åŒ…åè¾“å‡ºçš„æ–‡ä»¶åå’Œåç¼€</li>
<li>hash ä¸€èˆ¬æ˜¯ç»“åˆ CDN ç¼“å­˜æ¥ä½¿ç”¨ï¼Œé€šè¿‡ webpack æ„å»ºä¹‹åï¼Œç”Ÿæˆå¯¹åº”æ–‡ä»¶åè‡ªåŠ¨å¸¦ä¸Šå¯¹åº”çš„ MD5 å€¼ã€‚å¦‚æœæ–‡ä»¶å†…å®¹æ”¹å˜çš„è¯ï¼Œé‚£ä¹ˆå¯¹åº”æ–‡ä»¶å“ˆå¸Œå€¼ä¹Ÿä¼šæ”¹å˜ï¼Œå¯¹åº”çš„ HTML å¼•ç”¨çš„ URL åœ°å€ä¹Ÿä¼šæ”¹å˜ï¼Œè§¦å‘ CDN æœåŠ¡å™¨ä»æºæœåŠ¡å™¨ä¸Šæ‹‰å–å¯¹åº”æ•°æ®ï¼Œè¿›è€Œæ›´æ–°æœ¬åœ°ç¼“å­˜ã€‚</li>
<li><strong>å¦‚æœ webpack æ‰“åŒ…æ—¶ä»»ä½•æ–‡ä»¶éƒ½æ²¡æœ‰å˜åŠ¨ï¼Œåˆ™æœ¬æ¬¡æ‰“åŒ…çš„ hash å’Œä¸Šä¸€æ¬¡çš„ hash ä¸€æ ·</strong></li>
</ul>
<p>æŒ‡çº¹å ä½ç¬¦</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">å ä½ç¬¦åç§°</th>
          <th style="text-align: left">å«ä¹‰</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">ext</td>
          <td style="text-align: left">èµ„æºåç¼€å</td>
      </tr>
      <tr>
          <td style="text-align: left">name</td>
          <td style="text-align: left">æ–‡ä»¶åç§°</td>
      </tr>
      <tr>
          <td style="text-align: left">path</td>
          <td style="text-align: left">æ–‡ä»¶çš„ç›¸å¯¹è·¯å¾„</td>
      </tr>
      <tr>
          <td style="text-align: left">folder</td>
          <td style="text-align: left">æ–‡ä»¶æ‰€åœ¨çš„æ–‡ä»¶å¤¹</td>
      </tr>
      <tr>
          <td style="text-align: left">hash</td>
          <td style="text-align: left">æ¯æ¬¡ webpack æ„å»ºæ—¶ç”Ÿæˆä¸€ä¸ªå”¯ä¸€çš„ hash å€¼</td>
      </tr>
      <tr>
          <td style="text-align: left">chunkhash</td>
          <td style="text-align: left">æ ¹æ® chunk ç”Ÿæˆ hash å€¼ï¼Œæ¥æºäºåŒä¸€ä¸ª chunkï¼Œåˆ™ chunkhash å€¼å°±ä¸€æ ·</td>
      </tr>
      <tr>
          <td style="text-align: left">contenthash</td>
          <td style="text-align: left">æ ¹æ®å†…å®¹ç”Ÿæˆ hash å€¼ï¼Œæ–‡ä»¶å†…å®¹ç›¸åŒ hash å€¼å°±ç›¸åŒ</td>
      </tr>
  </tbody>
</table></div>
<ul>
<li>hashï¼šæ¯æ¬¡æ„å»ºé¡¹ç›®ç”Ÿæˆçš„å”¯ä¸€ hash å€¼ï¼Œæ‰€æœ‰æ–‡ä»¶å…±äº«åŒä¸€ä¸ª hash å€¼ã€‚åªè¦é¡¹ç›®æ–‡ä»¶æœ‰ä»»ä½•æ”¹å˜ï¼Œæ•´ä¸ªé¡¹ç›®çš„ hash å€¼éƒ½ä¼šæ”¹å˜ã€‚å› æ­¤ï¼Œå¦‚æœä½ ä½¿ç”¨äº† hash å¹¶ä¸”åªæ˜¯æ”¹å˜äº†é¡¹ç›®ä¸­çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶éƒ½ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ hashï¼Œè¿™å°†å¯¼è‡´å®¢æˆ·ç«¯éœ€è¦é‡æ–°ä¸‹è½½æ‰€æœ‰æ–‡ä»¶ï¼Œå³ä½¿å¤§éƒ¨åˆ†æ–‡ä»¶å®é™…ä¸Šå¹¶æœªæ”¹å˜ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#34;path&#34;);
</span></span><span class="line"><span class="cl">const glob = require(&#34;glob&#34;);
</span></span><span class="line"><span class="cl">const PurgecssPlugin = require(&#34;purgecss-webpack-plugin&#34;);  // åˆ é™¤å¤šä½™çš„css
</span></span><span class="line"><span class="cl">const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;);
</span></span><span class="line"><span class="cl">const PATHS = {
</span></span><span class="line"><span class="cl">  src: path.join(__dirname, &#39;src&#39;)
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">  mode: &#34;production&#34;,
</span></span><span class="line"><span class="cl"><span class="gi">+  entry: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+    main: &#39;./src/index.js&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+    vender:[&#39;lodash&#39;]
</span></span></span><span class="line"><span class="cl"><span class="gi">+  },
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  output:{
</span></span><span class="line"><span class="cl">    path:path.resolve(__dirname,&#39;dist&#39;),
</span></span><span class="line"><span class="cl"><span class="gi">+    filename:&#39;[name].[hash:8].js&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  },
</span></span><span class="line"><span class="cl">  module: {
</span></span><span class="line"><span class="cl">    rules: [
</span></span><span class="line"><span class="cl">      {
</span></span><span class="line"><span class="cl">        test: /\.css$/,
</span></span><span class="line"><span class="cl">        include: path.resolve(__dirname, &#34;src&#34;),
</span></span><span class="line"><span class="cl">        exclude: /node_modules/,
</span></span><span class="line"><span class="cl">        use: [
</span></span><span class="line"><span class="cl">          {
</span></span><span class="line"><span class="cl">            loader: MiniCssExtractPlugin.loader,
</span></span><span class="line"><span class="cl">          },
</span></span><span class="line"><span class="cl">          &#34;css-loader&#34;,
</span></span><span class="line"><span class="cl">        ],
</span></span><span class="line"><span class="cl">      },
</span></span><span class="line"><span class="cl">    ],
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  plugins: [
</span></span><span class="line"><span class="cl">    new MiniCssExtractPlugin({
</span></span><span class="line"><span class="cl"><span class="gi">+      filename: &#34;[name].[hash:8].css&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    }),
</span></span><span class="line"><span class="cl">    new PurgecssPlugin({
</span></span><span class="line"><span class="cl">      paths: glob.sync(`${PATHS.src}/**/*`,  { nodir: true }),
</span></span><span class="line"><span class="cl">    }),
</span></span><span class="line"><span class="cl">  ],
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>chunkhashï¼šå®ƒæ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(Entry)æˆ–è€…ä¸åŒçš„ chunk è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„ chunkï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒé‡ŒæŠŠä¸€äº›å…¬å…±åº“å’Œç¨‹åºå…¥å£æ–‡ä»¶åŒºåˆ†å¼€ï¼Œå•ç‹¬æ‰“åŒ…æ„å»ºï¼Œæ¥ç€é‡‡ç”¨ chunkhash çš„æ–¹å¼ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆåªè¦ä¸æ”¹åŠ¨å…¬å…±åº“çš„ä»£ç ï¼Œå°±å¯ä»¥ä¿è¯å…¶å“ˆå¸Œå€¼ä¸ä¼šå—å½±å“ã€‚
åªæœ‰æ‰€å± chunk çš„å†…å®¹æ”¹å˜æ—¶ï¼Œhash å€¼æ‰ä¼šæ”¹å˜ã€‚è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœä½ åœ¨é¡¹ç›®ä¸­æ”¹å˜äº†ä¸€ä¸ªæ–‡ä»¶ï¼Œåªæœ‰è¿™ä¸ªæ–‡ä»¶æ‰€åœ¨çš„ chunk çš„ hash å€¼ä¼šæ”¹å˜ï¼Œå…¶ä»–çš„ chunk ä¸ä¼šæ”¹å˜ã€‚è¿™å®é™…ä¸Šå¯ä»¥è®©å®¢æˆ·ç«¯åªä¸‹è½½æ”¹å˜äº†çš„æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æ‰€æœ‰æ–‡ä»¶ã€‚</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#34;path&#34;);
</span></span><span class="line"><span class="cl">const glob = require(&#34;glob&#34;);
</span></span><span class="line"><span class="cl">const PurgecssPlugin = require(&#34;purgecss-webpack-plugin&#34;);
</span></span><span class="line"><span class="cl">const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;);
</span></span><span class="line"><span class="cl">const PATHS = {
</span></span><span class="line"><span class="cl">  src: path.join(__dirname, &#39;src&#39;)
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">  mode: &#34;production&#34;,
</span></span><span class="line"><span class="cl">  entry: {
</span></span><span class="line"><span class="cl">    main: &#39;./src/index.js&#39;,
</span></span><span class="line"><span class="cl">    vender:[&#39;lodash&#39;]
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  output:{
</span></span><span class="line"><span class="cl">    path:path.resolve(__dirname,&#39;dist&#39;),
</span></span><span class="line"><span class="cl"><span class="gi">+    filename:&#39;[name].[chunkhash].js&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  },
</span></span><span class="line"><span class="cl">  plugins: [
</span></span><span class="line"><span class="cl">    new MiniCssExtractPlugin({
</span></span><span class="line"><span class="cl"><span class="gi">+      filename: &#34;[name].[chunkhash].css&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    })
</span></span><span class="line"><span class="cl">  ],
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><ul>
<li>contenthashï¼šä½¿ç”¨ chunkhash å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œå°±æ˜¯å½“åœ¨ä¸€ä¸ª JS æ–‡ä»¶ä¸­å¼•å…¥ CSS æ–‡ä»¶ï¼Œç¼–è¯‘åå®ƒä»¬çš„ chunkhash æ˜¯ç›¸åŒçš„ï¼Œè€Œä¸”åªè¦ js æ–‡ä»¶å‘ç”Ÿæ”¹å˜ ï¼Œå…³è”çš„ css æ–‡ä»¶ chunkhash ä¹Ÿä¼šæ”¹å˜ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨<code>mini-css-extract-plugin</code>é‡Œçš„<code>contenthash</code>å€¼ï¼Œä¿è¯å³ä½¿ css æ–‡ä»¶æ‰€å¤„çš„æ¨¡å—é‡Œå°±ç®—å…¶ä»–æ–‡ä»¶å†…å®¹æ”¹å˜ï¼Œåªè¦ css æ–‡ä»¶å†…å®¹ä¸å˜ï¼Œé‚£ä¹ˆä¸ä¼šé‡å¤æ„å»º</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#34;path&#34;);
</span></span><span class="line"><span class="cl">const MiniCssExtractPlugin = require(&#39;mini-css-extract-plugin&#39;);
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">  output:{
</span></span><span class="line"><span class="cl">    path:path.resolve(__dirname,&#39;dist&#39;),
</span></span><span class="line"><span class="cl">    filename:&#39;[name].[chunkhash].js&#39;
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  plugins: [
</span></span><span class="line"><span class="cl">    new MiniCssExtractPlugin({
</span></span><span class="line"><span class="cl"><span class="gi">+      filename: &#34;[name].[contenthash].css&#34;
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    }),
</span></span><span class="line"><span class="cl">  ],
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åçš„å†…å®¹ä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨åï¼ŒCDN æœåŠ¡å™¨å¹¶ä¸ä¼šä¸»åŠ¨è¯·æ±‚æˆ‘ä»¬çš„æœåŠ¡å™¨ä»¥æ›´æ–°æœ€æ–°çš„èµ„æºæ–‡ä»¶ï¼Œä½†å¯ä»¥å¼€å‘ä¸€ä¸ªæ’ä»¶ï¼Œå°†æ‰“åŒ…åçš„æ–‡ä»¶è‡ªåŠ¨æ¨é€åˆ° CDN æœåŠ¡å™¨ä¸Šã€‚</p>
<p>ä¸åŒ hash çš„ç‰¹ç‚¹ï¼š</p>
<p><img src="http://img.zhufengpeixun.com/variableHash.jpg"
	
	
	
	loading="lazy"
	
		alt="variableHash"
	
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">createHash</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;crypto&#34;</span><span class="p">).</span><span class="nx">createHash</span><span class="p">(</span><span class="s2">&#34;md5&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸¤ä¸ªå…¥å£æ–‡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">entry</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry1</span><span class="o">:</span> <span class="s2">&#34;entry1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry2</span><span class="o">:</span> <span class="s2">&#34;entry2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸¤ä¸ªæ–‡ä»¶å†…éƒ¨çš„å…·ä½“å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">entry1</span> <span class="o">=</span> <span class="s2">&#34;requir(&#39;depModule1&#39;)&#34;</span><span class="p">;</span> <span class="c1">//æ¨¡å—entry1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">entry2</span> <span class="o">=</span> <span class="s2">&#34;require(&#39;depModule2&#39;)&#34;</span><span class="p">;</span> <span class="c1">//æ¨¡å—entry2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// ä¸¤ä¸ªå…¥å£æ–‡ä»¶åˆ†åˆ«ä¾èµ–çš„æ¨¡å—æ–‡ä»¶ä¸­çš„å†…å®¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">depModule1</span> <span class="o">=</span> <span class="s2">&#34;depModule1&#34;</span><span class="p">;</span> <span class="c1">//æ¨¡å—depModule1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">depModule2</span> <span class="o">=</span> <span class="s2">&#34;depModule2&#34;</span><span class="p">;</span> <span class="c1">//æ¨¡å—depModule2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//å¦‚æœéƒ½ä½¿ç”¨hashçš„è¯ï¼Œå› ä¸ºè¿™æ˜¯å·¥ç¨‹çº§åˆ«çš„ï¼Œå³æ¯æ¬¡ä¿®æ”¹ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰€æœ‰æ–‡ä»¶åçš„hashè‡³éƒ½å°†æ”¹å˜ã€‚æ‰€ä»¥ä¸€æ—¦ä¿®æ”¹äº†ä»»ä½•ä¸€ä¸ªæ–‡ä»¶ï¼Œæ•´ä¸ªé¡¹ç›®çš„æ–‡ä»¶ç¼“å­˜éƒ½å°†å¤±æ•ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">hash</span> <span class="o">=</span> <span class="nx">createHash</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;entry1ID&#34;</span><span class="p">)</span> <span class="c1">// å¹¶ä¸æ˜¯ä½¿ç”¨çš„æ¨¡å—æ–‡ä»¶ä¸­çš„å†…å®¹ç”Ÿæˆhashï¼Œè€Œæ˜¯ä½¿ç”¨çš„æ¨¡å—çš„idåå­—æ¥ç”Ÿæˆhashï¼Œä¸€æ—¦æœ‰æ–‡ä»¶å˜åŒ–ï¼Œè¿™ä¸ªæ¨¡å—IDå°±ä¼šå˜åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;entry2ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;depModule1ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;depModule2ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;hash&#34;</span><span class="p">,</span> <span class="nx">hash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//chunkhashæ ¹æ®ä¸åŒçš„å…¥å£æ–‡ä»¶(Entry)è¿›è¡Œä¾èµ–æ–‡ä»¶è§£æã€æ„å»ºå¯¹åº”çš„chunkï¼Œç”Ÿæˆå¯¹åº”çš„å“ˆå¸Œå€¼ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1">//åœ¨ç”Ÿäº§ç¯å¢ƒé‡ŒæŠŠä¸€äº›å…¬å…±åº“å’Œç¨‹åºå…¥å£æ–‡ä»¶åŒºåˆ†å¼€ï¼Œå•ç‹¬æ‰“åŒ…æ„å»ºï¼Œæ¥ç€é‡‡ç”¨chunkhashçš„æ–¹å¼ç”Ÿæˆå“ˆå¸Œå€¼ï¼Œé‚£ä¹ˆåªè¦ä¸æ”¹åŠ¨å…¬å…±åº“çš„ä»£ç ï¼Œå°±å¯ä»¥ä¿è¯å…¶å“ˆå¸Œå€¼ä¸ä¼šå—å½±å“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">entry1ChunkHash</span> <span class="o">=</span> <span class="nx">createHash</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;entry1ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;depModule1ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entry1ChunkHash&#34;</span><span class="p">,</span> <span class="nx">entry1ChunkHash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">entry2ChunkHash</span> <span class="o">=</span> <span class="nx">createHash</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;entry2ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="s2">&#34;depModule2ID&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entry2ChunkHash&#34;</span><span class="p">,</span> <span class="nx">entry2ChunkHash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">entry1ContentHash</span> <span class="o">=</span> <span class="nx">createHash</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">entry1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">update</span><span class="p">(</span><span class="nx">depModule1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entry1ContentHash&#34;</span><span class="p">,</span> <span class="nx">entry1ContentHash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">entry2File</span> <span class="o">=</span> <span class="nx">entry2</span> <span class="o">+</span> <span class="nx">depModule2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">entry2ContentHash</span> <span class="o">=</span> <span class="nx">createHash</span><span class="p">().</span><span class="nx">update</span><span class="p">(</span><span class="nx">entry2File</span><span class="p">).</span><span class="nx">digest</span><span class="p">(</span><span class="s2">&#34;hex&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;entry2ContentHash&#34;</span><span class="p">,</span> <span class="nx">entry2ContentHash</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è‡ªå·±å†™çš„ä¿®æ”¹ hash çš„ pluginï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">HashPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;HashPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//å¦‚æœä½ æƒ³æ”¹å˜hashå€¼ï¼Œå¯ä»¥åœ¨hashç”Ÿæˆè¿™åä¿®æ”¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">compilation</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">afterHash</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;HashPlugin&#34;</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">fullhash</span> <span class="o">=</span> <span class="s2">&#34;fullhash&#34;</span><span class="p">;</span> <span class="c1">//æ—¶é—´æˆ³
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;æœ¬æ¬¡ç¼–è¯‘çš„compilation.hash&#34;</span><span class="p">,</span> <span class="nx">compilation</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">compilation</span><span class="p">.</span><span class="nx">hash</span> <span class="o">=</span> <span class="nx">fullhash</span><span class="p">;</span> <span class="c1">//output.filename [fullhash]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">chunk</span> <span class="k">of</span> <span class="nx">compilation</span><span class="p">.</span><span class="nx">chunks</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;chunk.hash&#34;</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">hash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nx">chunk</span><span class="p">.</span><span class="nx">renderedHash</span> <span class="o">=</span> <span class="s2">&#34;chunkHash&#34;</span><span class="p">;</span> <span class="c1">//å¯ä»¥æ”¹å˜chunkhash  renderedHashå°±æ˜¯chunkhash
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;chunk.contentHash&#34;</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">contentHash</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="nx">chunk</span><span class="p">.</span><span class="nx">contentHash</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">javascript</span><span class="o">:</span> <span class="s2">&#34;javascriptContentHash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="s2">&#34;css/mini-extract&#34;</span><span class="o">:</span> <span class="s2">&#34;cssContentHash&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">HashPlugin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * ä¸‰ç§hash
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 1. hash compilation.hash
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 2. chunkHash æ¯ä¸ªchunkéƒ½ä¼šæœ‰ä¸€ä¸ªhash
</span></span></span><span class="line"><span class="cl"><span class="cm"> * 3. contentHash å†…å®¹hash æ¯ä¸ªæ–‡ä»¶ä¼šå¯èƒ½æœ‰ä¸€ä¸ªhashå€¼
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="moduleids--chunkids-çš„ä¼˜åŒ–">moduleIds &amp; chunkIds çš„ä¼˜åŒ–
</h2><ul>
<li>module: æ¯ä¸€ä¸ªæ–‡ä»¶(js,css,jpg,å­—ä½“ç­‰)å…¶å®éƒ½å¯ä»¥çœ‹æˆä¸€ä¸ª module</li>
<li>chunk: webpack æ‰“åŒ…æœ€ç»ˆçš„ä»£ç å—ï¼Œä»£ç å—ä¼šç”Ÿæˆæ–‡ä»¶ï¼Œä¸€ä¸ª chunk å¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒæ—¶æ¯ä¸ª entry å…¥å£éƒ½ä¼šå¯¹åº”ä¸€ä¸ª chunkï¼Œä¸€ä¸ª chunk éƒ½ä¼šå¯¹åº”çš„ä¸€ä¸ªæ–‡ä»¶ã€‚ä½†æ˜¯åä¹‹ï¼Œä¸€ä¸ªæ–‡ä»¶å¹¶ä¸ä¸€å®šéƒ½æ˜¯æ ¹æ® entry æ¥ç”Ÿæˆçš„ï¼Œæœ‰å¯èƒ½æ˜¯ import åŠ¨æ€å¯¼å…¥å¯¼è‡´ä»£ç åˆ†å‰²ç”Ÿæˆçš„æ–‡ä»¶</li>
<li>åœ¨ webpack5 ä¹‹å‰ï¼Œä¸æ˜¯æ ¹æ® entry é…ç½®æ‰“åŒ…ç”Ÿæˆçš„ chunk æ–‡ä»¶ï¼ˆ<strong>é€šè¿‡ import æ–¹æ³•åŠ¨æ€å¯¼å…¥çš„æ¨¡å—</strong>ï¼‰ï¼Œéƒ½ä¼šä»¥ 1ã€2ã€3&hellip;çš„æ–‡ä»¶å‘½åæ–¹å¼è¾“å‡ºï¼Œåˆ é™¤æŸäº›æ–‡ä»¶å¯èƒ½ä¼šå¯¼è‡´ç¼“å­˜å¤±æ•ˆ</li>
<li>åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œé»˜è®¤å¯ç”¨è¿™äº›åŠŸèƒ½ chunkIds: &ldquo;deterministic&rdquo;, moduleIds: &ldquo;deterministic&rdquo;ï¼Œæ­¤ç®—æ³•é‡‡ç”¨<code>ç¡®å®šæ€§</code>çš„æ–¹å¼å°†çŸ­æ•°å­— ID(3 æˆ– 4 ä¸ªå­—ç¬¦)ï¼ŒçŸ­ hash å€¼åˆ†é…ç»™ modules å’Œ chunks</li>
<li>chunkId è®¾ç½®ä¸º deterministicï¼Œåˆ™ output ä¸­ chunkFilename é‡Œçš„[name]ä¼šè¢«æ›¿æ¢æˆç¡®å®šæ€§çŸ­æ•°å­— ID</li>
<li>è™½ç„¶ chunkId ä¸å˜(ä¸ç®¡å€¼æ˜¯ deterministic | natural | named)ï¼Œä½†æ›´æ”¹ chunk å†…å®¹ï¼Œchunkhash è¿˜æ˜¯ä¼šæ”¹å˜çš„</li>
</ul>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th style="text-align: left">å¯é€‰å€¼</th>
          <th style="text-align: left">å«ä¹‰</th>
          <th style="text-align: left">ç¤ºä¾‹</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td style="text-align: left">naturalï¼ˆé»˜è®¤å€¼ï¼‰è‡ªç„¶æ•°</td>
          <td style="text-align: left">æŒ‰ä½¿ç”¨é¡ºåºçš„æ•°å­— ID</td>
          <td style="text-align: left">1</td>
      </tr>
      <tr>
          <td style="text-align: left">named</td>
          <td style="text-align: left">æ–¹ä¾¿è°ƒè¯•çš„é«˜å¯è¯»æ€§ id</td>
          <td style="text-align: left">src_two_js.js</td>
      </tr>
      <tr>
          <td style="text-align: left">deterministic</td>
          <td style="text-align: left">æ ¹æ®æ¨¡å—åç§°ç”Ÿæˆç®€çŸ­çš„ hash å€¼</td>
          <td style="text-align: left">915</td>
      </tr>
      <tr>
          <td style="text-align: left">size</td>
          <td style="text-align: left">æ ¹æ®æ¨¡å—å¤§å°ç”Ÿæˆçš„æ•°å­— id</td>
          <td style="text-align: left">0</td>
      </tr>
  </tbody>
</table></div>
<p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const path = require(&#39;path&#39;);
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">    mode: &#39;development&#39;,
</span></span><span class="line"><span class="cl">    devtool:false,
</span></span><span class="line"><span class="cl"><span class="gi">+   optimization:{
</span></span></span><span class="line"><span class="cl"><span class="gi">+       moduleIds:&#39;deterministic&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi">+       chunkIds:&#39;deterministic&#39;
</span></span></span><span class="line"><span class="cl"><span class="gi">+   }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>}
</span></span></code></pre></td></tr></table>
</div>
</div><p>src\index.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span><span class="p">(</span><span class="s2">&#34;./one&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span><span class="p">(</span><span class="s2">&#34;./two&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span><span class="p">(</span><span class="s2">&#34;./three&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>one.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="s2">&#34;one&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>two å’Œ three çš„æ–‡ä»¶å†…å®¹å’Œ one ç±»ä¼¼ã€‚</p>
<p>åœ¨ webpack çš„é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="o">+</span>   <span class="nx">optimization</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>       <span class="nx">moduleIds</span><span class="o">:</span><span class="s1">&#39;natural&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>       <span class="nx">chunkIds</span><span class="o">:</span><span class="s1">&#39;natural&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>   <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶çš„åå­—å¦‚ä¸‹ï¼ˆä»¥å‰é»˜è®¤å°±æ˜¯ naturalï¼‰ï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20241104145153320.png"
	width="718"
	height="478"
	srcset="/blogs/post/webpack/images/image-20241104145153320_hu_f09f7082675da6c.png 480w, /blogs/post/webpack/images/image-20241104145153320_hu_7b55f4263c6da060.png 1024w"
	loading="lazy"
	
		alt="image-20241104145153320"
	
	
		class="gallery-image" 
		data-flex-grow="150"
		data-flex-basis="360px"
	
></p>
<p>é‡‡ç”¨ natural çš„ç¼ºç‚¹ï¼š</p>
<p>å¦‚æœä»£ç ä¸­ç§»é™¤äº† two çš„ä¾èµ–ï¼Œé‚£ä¹ˆåŸæ¥çš„ three å°±ä¼šå˜æˆæ–°çš„ 2ï¼Œå¦‚æœåœ¨æ²¡æœ‰é‡‡ç”¨ hash æˆ–è€… chunkhash ç­‰çš„æƒ…å†µä¸‹ï¼Œä¼šå¯¼è‡´æ–‡ä»¶çš„ç¼“å­˜å¤±æ•ˆã€‚</p>
<p>åœ¨ webpack çš„é…ç½®æ–‡ä»¶ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="o">+</span>   <span class="nx">optimization</span><span class="o">:</span><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>       <span class="nx">moduleIds</span><span class="o">:</span><span class="s1">&#39;deterministic&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>       <span class="nx">chunkIds</span><span class="o">:</span><span class="s1">&#39;deterministic&#39;</span>
</span></span><span class="line"><span class="cl"><span class="o">+</span>   <span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åç”Ÿæˆçš„æ–‡ä»¶çš„åå­—å¦‚ä¸‹ï¼ˆç°åœ¨é»˜è®¤å°±æ˜¯ deterministicï¼‰ï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20241104145716760.png"
	width="615"
	height="540"
	srcset="/blogs/post/webpack/images/image-20241104145716760_hu_6db833cae63e2df7.png 480w, /blogs/post/webpack/images/image-20241104145716760_hu_cf5f6ca5bc618e22.png 1024w"
	loading="lazy"
	
		alt="image-20241104145716760"
	
	
		class="gallery-image" 
		data-flex-grow="113"
		data-flex-basis="273px"
	
></p>
<p>é‚£ä¹ˆåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœæºç ä¸­å†æ¬¡ç§»é™¤ twoï¼Œè¿™æ—¶ï¼Œæ‰“åŒ…åçš„ç»“æœï¼Œone å’Œ three å¯¹åº”ä»ç„¶æ˜¯åŸæ¥çš„æ–‡ä»¶åè€Œæ²¡æœ‰æ”¹å˜ã€‚</p>
<p><img src="/blogs/post/webpack/images/image-20241104145858973.png"
	width="507"
	height="233"
	srcset="/blogs/post/webpack/images/image-20241104145858973_hu_ffca2a82a20cf534.png 480w, /blogs/post/webpack/images/image-20241104145858973_hu_a36de952530f8fc8.png 1024w"
	loading="lazy"
	
		alt="image-20241104145858973"
	
	
		class="gallery-image" 
		data-flex-grow="217"
		data-flex-basis="522px"
	
></p>
<p>è¿™æ ·å°±èƒ½é•¿æœŸç¼“å­˜ã€‚</p>
<p>å¦‚æœæƒ³æŠŠåŠ¨æ€åŠ è½½çš„å¤šä¸ªæ¨¡å—æ ¹æ®éœ€è¦åˆå¹¶ä¸ºä¸€ä¸ªæ–‡ä»¶ï¼Œé‚£å°±éœ€è¦å€ŸåŠ© splitChunksPlugin é…ç½®æ¥å®ç°ã€‚</p>
<p>å®ç°å¾®å‰ç«¯çš„æ–¹å¼ï¼š</p>
<ol>
<li>iframe</li>
<li>qiankun</li>
<li>æ¨¡å—è”é‚¦</li>
</ol>
<h2 id="æ¨¡å—è”é‚¦">æ¨¡å—è”é‚¦
</h2><p>ä¸€èˆ¬ç”¨äºå®ç°å¾®å‰ç«¯ã€‚ å…¸å‹çš„äº§å“ï¼šqiankunã€‚</p>
<ul>
<li>
<p>Module Federation çš„åŠ¨æœºæ˜¯ä¸ºäº†ä¸åŒå¼€å‘å°ç»„é—´å…±åŒå¼€å‘ä¸€ä¸ªæˆ–è€…å¤šä¸ªåº”ç”¨</p>
</li>
<li>
<p>åº”ç”¨å°†è¢«åˆ’åˆ†ä¸ºæ›´å°çš„åº”ç”¨å—ï¼Œä¸€ä¸ªåº”ç”¨å—ï¼Œå¯ä»¥æ˜¯æ¯”å¦‚å¤´éƒ¨å¯¼èˆªæˆ–è€…ä¾§è¾¹æ çš„å‰ç«¯ç»„ä»¶ï¼Œä¹Ÿå¯ä»¥æ˜¯æ•°æ®è·å–é€»è¾‘çš„é€»è¾‘ç»„ä»¶</p>
</li>
<li>
<p>æ¯ä¸ªåº”ç”¨å—ç”±ä¸åŒçš„ç»„å¼€å‘</p>
</li>
<li>
<p>åº”ç”¨æˆ–åº”ç”¨å—å…±äº«å…¶ä»–å…¶ä»–åº”ç”¨å—æˆ–è€…åº“</p>
</li>
<li>
<p><strong>ä½¿ç”¨ Module Federation æ—¶ï¼Œæ¯ä¸ªåº”ç”¨å—éƒ½æ˜¯ä¸€ä¸ªç‹¬ç«‹çš„æ„å»ºï¼Œæœ‰è‡ªå·±çš„æ‰“åŒ…é…ç½®ï¼Œè¿™äº›æ„å»ºéƒ½å°†ç¼–è¯‘ä¸ºå®¹å™¨</strong></p>
</li>
<li>
<p>å®¹å™¨å¯ä»¥è¢«å…¶ä»–åº”ç”¨æˆ–è€…å…¶ä»–å®¹å™¨åº”ç”¨</p>
</li>
<li>
<p>ä¸€ä¸ªè¢«å¼•ç”¨çš„å®¹å™¨è¢«ç§°ä¸º remoteï¼Œå¼•ç”¨è€…è¢«ç§°ä¸º host ï¼Œ remote æš´éœ²æ¨¡å—ç»™ hostï¼Œhost åˆ™å¯ä»¥ä½¿ç”¨è¿™äº›æš´éœ²çš„æ¨¡å—ï¼Œè¿™äº›æ¨¡å—è¢«æˆä¸º remote æ¨¡å—</p>
</li>
</ul>
<p><img src="/blogs/post/webpack/images/image-20230503091426077.png"
	width="2189"
	height="565"
	srcset="/blogs/post/webpack/images/image-20230503091426077_hu_bcc1747f1c0d4cf4.png 480w, /blogs/post/webpack/images/image-20230503091426077_hu_1e1562a7d7c86036.png 1024w"
	loading="lazy"
	
		alt="image-20230503091426077"
	
	
		class="gallery-image" 
		data-flex-grow="387"
		data-flex-basis="929px"
	
></p>
<p><strong>æ¨¡å—è”é‚¦å¿…é¡»å¼‚æ­¥å¯¼å…¥ï¼ˆ import(&lsquo;xxxx.js&rsquo;) ï¼‰ã€‚</strong></p>
<p>ä½¿ç”¨äº†æ¨¡å—è”é‚¦åçš„é¡¹ç›®ï¼Œä¸åŒçš„å®¹å™¨é¡¹ç›®å¯ä»¥é€‰æ‹©ä¸åŒçš„æŠ€æœ¯æ ˆï¼Œä½†æ˜¯å¯èƒ½æ¯”è¾ƒéš¾è¿›è¡Œä¸åŒåº”ç”¨å—ä¹‹é—´çš„ç»„ä»¶é—´é€šä¿¡ï¼Œä½†æ˜¯å¿…é¡»éƒ½ä¾èµ–äº webpack5ã€‚</p>
<div class="table-wrapper"><table>
  <thead>
      <tr>
          <th>å­—æ®µ</th>
          <th>ç±»å‹</th>
          <th>å«ä¹‰</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>name</td>
          <td>string</td>
          <td>å¿…ä¼ å€¼ï¼Œå³è¾“å‡ºçš„æ¨¡å—åï¼Œè¢«è¿œç¨‹å¼•ç”¨æ—¶è·¯å¾„ä¸º${name}/${expose}</td>
      </tr>
      <tr>
          <td>library</td>
          <td>object</td>
          <td>å£°æ˜å…¨å±€å˜é‡çš„æ–¹å¼ï¼Œname ä¸º umd çš„ name</td>
      </tr>
      <tr>
          <td>filename</td>
          <td>string</td>
          <td>æ„å»ºè¾“å‡ºçš„æ–‡ä»¶å</td>
      </tr>
      <tr>
          <td>remotes</td>
          <td>object</td>
          <td>è¿œç¨‹å¼•ç”¨çš„åº”ç”¨ååŠå…¶åˆ«åçš„æ˜ å°„ï¼Œä½¿ç”¨æ—¶ä»¥ key å€¼ä½œä¸º name</td>
      </tr>
      <tr>
          <td>exposes</td>
          <td>object</td>
          <td>è¢«è¿œç¨‹å¼•ç”¨æ—¶å¯æš´éœ²çš„èµ„æºè·¯å¾„åŠå…¶åˆ«å</td>
      </tr>
      <tr>
          <td>shared</td>
          <td>object</td>
          <td>ä¸å…¶ä»–åº”ç”¨ä¹‹é—´å¯ä»¥å…±äº«çš„ç¬¬ä¸‰æ–¹ä¾èµ–ï¼Œä½¿ä½ çš„ä»£ç ä¸­ä¸ç”¨é‡å¤åŠ è½½åŒä¸€ä»½ä¾èµ–</td>
      </tr>
  </tbody>
</table></div>
<h2 id="ä»£ç åˆ†å‰²">ä»£ç åˆ†å‰²
</h2><h3 id="æ–¹å¼ä¸€"><strong>æ–¹å¼ä¸€</strong>
</h3><p>é€šè¿‡é…ç½® entry ä¸ºå¤šä¸ªå…¥å£å®ç°ä»£ç åˆ†å‰²ï¼Œæ¯ä¸ªå…¥å£å’Œå®ƒçš„ä¾èµ–éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä»£ç å—è€Œç”Ÿæˆå•ç‹¬çš„æ–‡ä»¶</p>
<p>è¿™ç§æ–¹å¼çš„ä¸è¶³ï¼š</p>
<ol>
<li>ä¸å¤Ÿçµæ´»ï¼Œä¸€ä¸ªå…¥å£å¯¹åº”ä¸€ä¸ªä»£ç å—ï¼Œå¯¹åº”ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸èƒ½å°†æ ¸å¿ƒçš„åº”ç”¨ç¨‹åºè¿›è¡Œæ‹†åˆ†</li>
<li>å¦‚æœå…¥å£ chunks ä¹‹é—´åŒ…å«é‡å¤çš„æ¨¡å—(å¦‚ï¼šlodash)ï¼Œé‚£äº›é‡å¤æ¨¡å—éƒ½ä¼šè¢«å¼•å…¥åˆ°å„è‡ªç”Ÿæˆçš„æ–‡ä»¶ä¸­</li>
</ol>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry1</span><span class="o">:</span> <span class="s2">&#34;./src/entry1.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">entry2</span><span class="o">:</span> <span class="s2">&#34;./src/entry2.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>entry1.js å’Œ entry.js ä»£ç ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">title</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./title&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>title.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;title&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…ç”Ÿæˆä¸¤ä¸ªæ–‡ä»¶ entry1.js å’Œ entry2.jsï¼Œå®ƒä»¬å†…éƒ¨éƒ½æœ‰ä»¥ä¸‹ä»£ç æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackModules</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;./src/title.js&#34;</span><span class="o">:</span> <span class="p">(</span><span class="nx">module</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;title&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>html ä¸­ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;entry1.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;entry2.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="æ–¹å¼äºŒ"><strong>æ–¹å¼äºŒ</strong>
</h3><p>åŠ¨æ€å¯¼å…¥å’Œæ‡’åŠ è½½ã€‚</p>
<p>import()æ˜¯ä¸€ä¸ª JS è¯­æ³•ï¼Œwebpack åœ¨æ‰“åŒ…ç¼–è¯‘çš„æ—¶å€™ï¼Œå¦‚æœé‡åˆ° import è¯­æ³•ä¼šæŠŠå®ƒè½¬æ¢æˆ require.eï¼Œrequire.e æ˜¯é€šè¿‡åŠ¨æ€åˆ›å»º script æ ‡ç­¾å®ç°çš„ã€‚</p>
<ul>
<li>ç”¨æˆ·å½“å‰éœ€è¦ç”¨ä»€ä¹ˆåŠŸèƒ½å°±åªåŠ è½½è¿™ä¸ªåŠŸèƒ½å¯¹åº”çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æŒ‰éœ€åŠ è½½ï¼Œåœ¨ç»™å•é¡µåº”ç”¨åšæŒ‰éœ€åŠ è½½ä¼˜åŒ–æ—¶</li>
<li>ä¸€èˆ¬é‡‡ç”¨ä»¥ä¸‹åŸåˆ™ï¼š
<ul>
<li>å¯¹ç½‘ç«™åŠŸèƒ½è¿›è¡Œåˆ’åˆ†ï¼Œæ¯ä¸€ç±»ä¸€ä¸ª chunk</li>
<li>å¯¹äºé¦–æ¬¡æ‰“å¼€é¡µé¢éœ€è¦çš„åŠŸèƒ½ç›´æ¥åŠ è½½ï¼Œå°½å¿«å±•ç¤ºç»™ç”¨æˆ·,æŸäº›ä¾èµ–å¤§é‡ä»£ç çš„åŠŸèƒ½ç‚¹å¯ä»¥æŒ‰éœ€åŠ è½½</li>
<li>è¢«åˆ†å‰²å‡ºå»çš„ä»£ç éœ€è¦ä¸€ä¸ªæŒ‰éœ€åŠ è½½çš„æ—¶æœº</li>
</ul>
</li>
</ul>
<p>webpack.config.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>video.jsï¼Œå‡è®¾è¿™ä¸ªæ–‡ä»¶éå¸¸å¤§</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;video&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>index.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;btn&#34;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">import</span><span class="p">(</span><span class="s2">&#34;./video&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>index.html</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">button</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;play&#34;</span><span class="p">&gt;</span>æ’­æ”¾<span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥ä¸Šé¢çš„ä»£ç æ‰“åŒ…åï¼Œç”Ÿæˆæ–‡ä»¶æ”¾åˆ°æµè§ˆå™¨ä¸­è¿è¡Œæ—¶ï¼Œæµè§ˆå™¨å…ˆè¯·æ±‚ html æ–‡ä»¶ï¼Œhtml æ–‡ä»¶å†…å®¹æœ‰å¦‚ä¸‹ä»£ç æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;main.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;btn&#34;</span><span class="p">&gt;</span>æŒ‰é’®<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¼šå†å»è¯·æ±‚ main.js æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶è¯·æ±‚å›æ¥åè¿›è¡Œæ‰§è¡Œï¼Œç»™ button ç»‘å®šä¸Š click äº‹ä»¶ï¼Œä½†æ˜¯å› ä¸ºæ²¡æœ‰è§¦å‘è¯¥ç‚¹å‡»äº‹ä»¶ï¼Œæ‰€ä»¥ä¸ä¼šè‡ªåŠ¨çš„å»åŠ è½½å¯¹åº”çš„æ‡’åŠ è½½æ–‡ä»¶ï¼Œå½“ç‚¹å‡»åæ‰ä¼šå‘èµ·ç½‘ç»œè¯·æ±‚å¹¶åŠ è½½å¯¹åº”çš„æ–‡ä»¶ã€‚</p>
<p>ç‚¹å‡»æŒ‰é’®å‰çš„ç½‘ç»œé¢æ¿è¯·æ±‚é¢æ¿å¦‚ä¸‹ï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230522224854354.png"
	width="2053"
	height="297"
	srcset="/blogs/post/webpack/images/image-20230522224854354_hu_ae745b08033174cd.png 480w, /blogs/post/webpack/images/image-20230522224854354_hu_efc7c8e45e38ecee.png 1024w"
	loading="lazy"
	
		alt="image-20230522224854354"
	
	
		class="gallery-image" 
		data-flex-grow="691"
		data-flex-basis="1658px"
	
></p>
<p>ç‚¹å‡»æŒ‰é’®åï¼Œç½‘ç»œé¢æ¿å¦‚ä¸‹ï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230522224927703.png"
	width="1982"
	height="347"
	srcset="/blogs/post/webpack/images/image-20230522224927703_hu_c5f92f96b071b26c.png 480w, /blogs/post/webpack/images/image-20230522224927703_hu_973139749773feec.png 1024w"
	loading="lazy"
	
		alt="image-20230522224927703"
	
	
		class="gallery-image" 
		data-flex-grow="571"
		data-flex-basis="1370px"
	
></p>
<p><strong>ä¸æ–¹å¼äºŒç›¸å…³çš„ preload å’Œ prefetch</strong></p>
<p>import(/*_ webpackPreload:true _/ &ldquo;./video&rdquo;)ä¸­çš„å³ä½¿ä½¿ç”¨äº†é­”æ³•æ³¨é‡Šä¹Ÿä¸ä¼šç”Ÿæ•ˆï¼Œå¿…é¡»é…ç½®ä¸€ä¸ªæ’ä»¶æ‰è¡Œã€‚<code>@vue/preload-webpack-plugin </code>ã€‚</p>
<p><img src="/blogs/post/webpack/images/image-20241104195759783.png"
	width="1006"
	height="297"
	srcset="/blogs/post/webpack/images/image-20241104195759783_hu_8ad34be8a7011937.png 480w, /blogs/post/webpack/images/image-20241104195759783_hu_2482310b7a37a5af.png 1024w"
	loading="lazy"
	
		alt="image-20241104195759783"
	
	
		class="gallery-image" 
		data-flex-grow="338"
		data-flex-basis="812px"
	
></p>
<p>ä¸ºä»€ä¹ˆé…ç½®äº† webpackPreload:true æ²¡æœ‰æ•ˆæœï¼Ÿ</p>
<p>å¦‚æœæƒ³ä¸€ä¸ª script è„šæœ¬è®¾ç½®ä¸º preloadï¼Œé¢„å…ˆæ‹‰å–ï¼Œå®ƒçš„ä¼˜å…ˆçº§æ˜¯éå¸¸é«˜çš„ï¼Œå®ƒåº”è¯¥å’Œ main.js å¹¶è¡ŒåŠ è½½ï¼Œæ‰€ä»¥è¯´ä¸å¯èƒ½æŠŠæ’ preload çš„ link æ ‡ç­¾çš„æ“ä½œåŠ¨ä½œæ”¾åœ¨ main.js é‡Œé¢æ‰§è¡Œï¼Œåªèƒ½æŠŠè¿™ä¸ªå·¥ä½œäº¤ç»™ html-webpack-pluginï¼ŒåŠ¨æ€çš„å‘ html æ–‡ä»¶é‡Œæ’å…¥é“¾æ¥ã€‚</p>
<p>ä¸ºäº†èƒ½å°½å¿«çš„åŠ è½½éœ€è¦çš„æ–‡ä»¶ï¼ˆæ¯”å¦‚åŠ è½½å®Œä¸»è¦æ–‡ä»¶åï¼Œè‡ªåŠ¨å»åŠ è½½ä¸€äº›æ‡’åŠ è½½æ–‡ä»¶ï¼Œä¸ç”¨ç‚¹å‡»æŒ‰é’®å†åŠ è½½é‚£äº›æ‡’åŠ è½½æ–‡ä»¶ï¼‰ï¼Œè¿™æ˜¯å°±éœ€è¦ä½¿ç”¨ prefetch æˆ–è€… preload è§£å†³æ–¹æ¡ˆäº†ã€‚å…·ä½“å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">npm install @vue/preload-webpack-plugin -D
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»¥å‰çš„å°±åŒ…åå«ï¼š webpackpreload-webpack-pluginã€‚@vue/preload-webpack-plugin åˆ™æ˜¯æ–°åŒ…åã€‚</p>
<p><strong>preload</strong></p>
<ul>
<li>preload é€šå¸¸ç”¨äºæœ¬é¡µé¢è¦ç”¨åˆ°çš„å…³é”®èµ„æºï¼ŒåŒ…æ‹¬å…³é”® jsã€å­—ä½“ã€css æ–‡ä»¶ï¼Œéœ€è¦ preload çš„èµ„æºä¼šåœ¨åŠ è½½åˆ° html æ–‡ä»¶åï¼Œå’Œå…¶ä»–é€šè¿‡ script å¼•å…¥çš„è„šæœ¬æœ‰ä¸€æ ·çš„ä¼˜å…ˆçº§ï¼Œå¹¶è¡ŒåŠ è½½</li>
<li>preload å°†ä¼šæŠŠèµ„æºçš„ä¸‹è½½é¡ºåºæƒé‡æé«˜ï¼Œä½¿å¾—å…³é”®æ•°æ®æå‰ä¸‹è½½å¥½,ä¼˜åŒ–é¡µé¢æ‰“å¼€é€Ÿåº¦</li>
<li>åœ¨èµ„æºä¸Šæ·»åŠ é¢„å…ˆåŠ è½½çš„æ³¨é‡Šï¼Œä½ æŒ‡æ˜è¯¥æ¨¡å—éœ€è¦ç«‹å³è¢«ä½¿ç”¨</li>
<li>ä¸€ä¸ªèµ„æºçš„åŠ è½½çš„ä¼˜å…ˆçº§è¢«åˆ†ä¸ºäº”ä¸ªçº§åˆ«,åˆ†åˆ«æ˜¯
<ul>
<li>Highest æœ€é«˜</li>
<li>High é«˜</li>
<li>Medium ä¸­ç­‰</li>
<li>Low ä½</li>
<li>Lowest æœ€ä½</li>
</ul>
</li>
<li>æœªä½œ preload æˆ–è€… prefetch å¤„ç†çš„å¼‚æ­¥/å»¶è¿Ÿ/æ’å…¥çš„è„šæœ¬ï¼ˆæ— è®ºåœ¨ä»€ä¹ˆä½ç½®ï¼‰åœ¨ç½‘ç»œä¼˜å…ˆçº§ä¸­æ˜¯ <code>Low</code></li>
<li><a class="link" href="https://medium.com/webpack/link-rel-prefetch-preload-in-webpack-51a52358f84c"  target="_blank" rel="noopener"
    >link-rel-prefetch-preload-in-webpack</a></li>
<li><a class="link" href="https://github.com/jantimon/html-webpack-plugin/issues/1317"  target="_blank" rel="noopener"
    >Support for webpackPrefetch and webpackPreload</a></li>
<li><a class="link" href="https://www.npmjs.com/package/@vue/preload-webpack-plugin"  target="_blank" rel="noopener"
    >preload-webpack-plugin</a></li>
<li><a class="link" href="https://www.npmjs.com/package/webpackpreload-webpack-plugin"  target="_blank" rel="noopener"
    >webpackpreload-webpack-plugin</a></li>
<li><a class="link" href="https://github.com/webpack/webpack/blob/c181294865dca01b28e6e316636fef5f2aad4eb6/lib/dependencies/ImportParserPlugin.js#L108-L121"  target="_blank" rel="noopener"
    >ImportPlugin.js</a></li>
</ul>
<p><img src="http://img.zhufengpeixun.cn/prefetchpreload.png"
	
	
	
	loading="lazy"
	
		alt="prefetchpreload"
	
	
></p>
<p>webpack.config.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const HtmlWebpackPlugin = require(&#34;html-webpack-plugin&#34;);
</span></span><span class="line"><span class="cl"><span class="gi">+ const PreloadWebpackPlugin = require(&#34;@vue/preload-webpack-plugin&#34;);
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">  output: {
</span></span><span class="line"><span class="cl">    clean: true,
</span></span><span class="line"><span class="cl">  },
</span></span><span class="line"><span class="cl">  mode: &#34;development&#34;,
</span></span><span class="line"><span class="cl">  devtool: false,
</span></span><span class="line"><span class="cl">  plugins: [
</span></span><span class="line"><span class="cl">    new HtmlWebpackPlugin({
</span></span><span class="line"><span class="cl">      template: &#34;./src/index.html&#34;,
</span></span><span class="line"><span class="cl">    }),
</span></span><span class="line"><span class="cl"><span class="gi">+    new PreloadWebpackPlugin(),
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>  ],
</span></span><span class="line"><span class="cl">};
</span></span></code></pre></td></tr></table>
</div>
</div><p>index.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;btn&#34;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kr">import</span><span class="p">(</span><span class="s2">&#34;./video&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä»–çš„ video.jsï¼Œhtml æ¨¡æ¿æ–‡ä»¶éƒ½æ²¡å˜ã€‚</p>
<p>æ‰§è¡Œæ‰“åŒ…æ“ä½œåç”Ÿæˆçš„ html æ–‡ä»¶ä¸­æœ‰å¦‚ä¸‹ä»£ç æ®µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">	<span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;main.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">link</span> <span class="na">href</span><span class="o">=</span><span class="s">&#34;src_video_js.js&#34;</span> <span class="na">rel</span><span class="o">=</span><span class="s">&#34;preload&#34;</span> <span class="na">as</span><span class="o">=</span><span class="s">&#34;script&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">link</span><span class="p">&gt;</span>  // å¤šå‡ºäº†è¿™è¡Œé¢„åŠ è½½ä»£ç ï¼Œè¿™å°±æ˜¯é‚£ä¸ªæ’ä»¶çš„åŸç†
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;btn&#34;</span><span class="p">&gt;</span>æŒ‰é’®<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>é¡¹ç›®åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€åï¼Œç½‘ç»œé¢æ¿çš„æƒ…å†µï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230522230333865.png"
	width="2064"
	height="293"
	srcset="/blogs/post/webpack/images/image-20230522230333865_hu_5e1f32991fc310bf.png 480w, /blogs/post/webpack/images/image-20230522230333865_hu_9d3af0031e675e71.png 1024w"
	loading="lazy"
	
		alt="image-20230522230333865"
	
	
		class="gallery-image" 
		data-flex-grow="704"
		data-flex-basis="1690px"
	
></p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ²¡æœ‰ç‚¹å‡»æŒ‰é’®çš„æƒ…å†µä¸‹ï¼Œæ‡’åŠ è½½æ–‡ä»¶å°±è¢«é¢„å…ˆåŠ è½½åˆ°æœ¬åœ°äº†ï¼Œä½†æ˜¯æŒ‰é’®çš„ç‚¹å‡»äº‹ä»¶å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œæ§åˆ¶å°å¹¶æ²¡æœ‰æ‰“å°å†…å®¹ï¼Œå½“ç‚¹å‡»æŒ‰é’®åï¼Œæ²¡æœ‰å†å‘èµ·ç½‘ç»œæƒ…å†µï¼Œè€Œç›´æ¥æ‰“å°äº†æ‡’åŠ è½½æ–‡ä»¶çš„å†…å®¹ã€‚è¿™å°±åŠ é€Ÿçš„èµ„æºæ–‡ä»¶çš„è·å–é€Ÿåº¦ï¼Œå®ç°çš„æƒ³è¦çš„ç›®çš„ã€‚</p>
<p><strong>è‡ªè¡Œå®ç°@vue/preload-webpack-plugin æ’ä»¶ï¼Œå®Œå…¨ä¸€æ‘¸ä¸€æ ·çš„å®ç°ã€‚è¯¥æ’ä»¶ä¸ä¼šå»è¯»å– import å‡½æ•°ä¸­ç¼–å†™çš„é­”æ³•æ³¨é‡Šï¼Œåªè¦æ˜¯ import æ–¹æ³•åŠ è½½çš„æ¨¡å—ï¼Œéƒ½ä¼šè‡ªåŠ¨åŠ ä¸Šå…¶å¯¹åº”<code>&lt;link href=&quot;moduleID.js&quot; rel=&quot;preload&quot; as=&quot;script&quot;&gt;</code></strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="cm">/**
</span></span></span><span class="line"><span class="cl"><span class="cm"> * åŸç†å’Œæ€è·¯
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æ­¤æ’ä»¶ä¼šæŸ¥æ‰¾æœ¬é¡¹ç›®ä¸­æ‰€æœ‰çš„å¼‚æ­¥ä»£ç å—ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="cm"> * æŠŠè¿™äº›å¼‚æ­¥ä»£ç å—å¯¹åº”çš„JSæ–‡ä»¶éƒ½æ·»åŠ ä¸€ä¸ªlinkæ ‡ç­¾, &lt;link href=&#34;moduleID.js&#34; rel=&#34;preload&#34; as=&#34;script&#34;&gt;
</span></span></span><span class="line"><span class="cl"><span class="cm"> */</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">PreloadWebpackPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">()</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ç›‘å¬compilationé’©å­ï¼Œè·å–compilationå¯¹è±¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;PreloadWebpackPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="kd">function</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è·å–HtmlWebpackPluginå‘compilationæ·»åŠ çš„é’©å­,alterAssetTags
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">HtmlWebpackPlugin</span><span class="p">.</span><span class="nx">getHooks</span><span class="p">(</span><span class="nx">compilation</span><span class="p">).</span><span class="nx">alterAssetTags</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;PreloadWebpackPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nx">htmlData</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="p">{</span> <span class="nx">chunks</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compilation</span><span class="p">;</span> <span class="c1">// chunksè¡¨ç¤ºç¼–è¯‘å¾—åˆ°çš„æ‰€æœ‰ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kr">const</span> <span class="nx">files</span> <span class="o">=</span> <span class="nx">chunks</span>
</span></span><span class="line"><span class="cl">              <span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">chunk</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="o">!</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">canBeInitial</span><span class="p">())</span> <span class="c1">// chunk.canBeInitial()è¡¨ç¤ºæ˜¯å¦æ˜¯åŒæ­¥å¼•å…¥çš„æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>              <span class="p">.</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">files</span><span class="p">,</span> <span class="nx">chunk</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="k">return</span> <span class="nx">files</span><span class="p">.</span><span class="nx">add</span><span class="p">(...</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">files</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="p">},</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">            <span class="nx">files</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">file</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">htmlData</span><span class="p">.</span><span class="nx">assetTags</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">unshift</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">tagName</span><span class="o">:</span> <span class="s2">&#34;link&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">rel</span><span class="o">:</span> <span class="s2">&#34;preload&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">href</span><span class="o">:</span> <span class="nx">file</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">PreloadWebpackPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»æ’ä»¶çš„æºç å¯ä»¥å¾—åˆ° preload çš„åŸç†æ˜¯åœ¨ webpack æ‰“åŒ…é˜¶æ®µå°±å°†æ‰€æœ‰çš„å¼‚æ­¥åŠ è½½çš„æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸€å¯¹åº”çš„<code>&lt;link href=&quot;moduleID.js&quot; rel=&quot;preload&quot; as=&quot;script&quot;&gt;</code>ï¼Œç„¶åç›´æ¥æ·»åŠ  html çš„åˆ° head æ ‡ç­¾ä¸­ã€‚å½“æµè§ˆå™¨ä¸€åŠ è½½åˆ° index.html ä¸­ï¼Œåœ¨è§£æ link æ ‡ç­¾æ—¶å°±ä¼šç›´æ¥å»<strong>é˜»å¡åŠ è½½å¹¶æ‰§è¡Œ</strong>å¯¹åº”çš„è„šæœ¬æ–‡ä»¶ã€‚</p>
<p>preload ä¸æ˜¯ webpack åŸç”Ÿæ”¯æŒçš„ï¼Œå¿…é¡»å®‰è£…å¯¹åº”çš„æ’ä»¶ï¼Œå¹¶ä¸”è¯¥æ’ä»¶<strong>ä¸ä¼š</strong>æ ¹æ® webpack é­”æ³•æ³¨é‡Šæ¥è®¾ç½®æŒ‡å®šè„šæœ¬çš„ preloadï¼Œè€Œæ˜¯ç›´æ¥å°†é¡¹ç›®ä¸­æ‰€æœ‰çš„å¼‚æ­¥åŠ è½½è„šæœ¬éƒ½ preloadï¼Œæ‰€ä»¥éœ€è¦æ…ç”¨ã€‚</p>
<p><a class="link" href="https://webpack.docschina.org/api/module-methods#magic-comments"  target="_blank" rel="noopener"
    >https://webpack.docschina.org/api/module-methods#magic-comments</a></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">// å•ä¸ªç›®æ ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackChunkName: &#34;my-chunk-name&#34; */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackMode: &#34;lazy&#34; */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackExports: [&#34;default&#34;, &#34;named&#34;] */</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;module&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// å¤šä¸ªå¯èƒ½çš„ç›®æ ‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kr">import</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackInclude: /\.json$/ */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackExclude: /\.noimport\.json$/ */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackChunkName: &#34;my-chunk-name&#34; */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackMode: &#34;lazy&#34; */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackPrefetch: true */</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* webpackPreload: true */</span>
</span></span><span class="line"><span class="cl">  <span class="sb">`./locale/</span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb">`</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><a class="link" href="https://webpack.docschina.org/guides/code-splitting/#prefetchingpreloading-modules"  target="_blank" rel="noopener"
    >https://webpack.docschina.org/guides/code-splitting/#prefetchingpreloading-modules</a></p>
<p><strong>prefetch(é¢„å…ˆæ‹‰å–)</strong></p>
<ul>
<li>prefetch è·Ÿ preload ä¸åŒï¼Œå®ƒçš„ä½œç”¨æ˜¯å‘Šè¯‰æµè§ˆå™¨æœªæ¥å¯èƒ½ä¼šä½¿ç”¨åˆ°çš„æŸä¸ªèµ„æºï¼Œæµè§ˆå™¨å°±ä¼šåœ¨<strong>é—²æ—¶</strong>ï¼ˆå°±æ˜¯è„šæœ¬æ‰§è¡Œå®Œåï¼‰å»åŠ è½½å¯¹åº”çš„èµ„æºï¼Œè‹¥èƒ½é¢„æµ‹åˆ°ç”¨æˆ·çš„è¡Œä¸ºï¼Œæ¯”å¦‚æ‡’åŠ è½½ï¼Œç‚¹å‡»åˆ°å…¶å®ƒé¡µé¢ç­‰åˆ™ç›¸å½“äºæå‰é¢„åŠ è½½äº†éœ€è¦çš„èµ„æº</li>
<li>prefetch é­”æ³•æ³¨é‡Šæ˜¯ webpack åŸç”Ÿå°±æ”¯æŒçš„ï¼Œä¸éœ€è¦é…ç½®ä»»ä½•æ’ä»¶ï¼Œè€Œä¸” webpack å¯¹äº<code>/* webpackPrefetch:true */</code>é­”æ³•æ³¨é‡Šæ˜¯èƒ½è¯†åˆ«çš„ï¼Œåªæœ‰åŠ äº†<code>/* webpackPrefetch:true */</code>çš„è„šæœ¬æ‰ä¼šæœ‰ prefetch çš„æ•ˆæœ</li>
<li>==prefetch çš„åŸç†æ˜¯ï¼Œåœ¨<strong>æ‰“åŒ…çš„è„šæœ¬ä¸­åŠ¨æ€</strong>çš„ä¸ºéœ€è¦ prefetch çš„è„šæœ¬åˆ›å»º link æ ‡ç­¾<code>&lt;link rel=&quot;prefetch&quot; as=&quot;script&quot; href=&quot;url/moduleID&quot;&gt;</code>å¹¶æ·»åŠ åˆ° head ä¸­ï¼Œå¹¶ä¸æ˜¯åœ¨ webpack æ‰“åŒ…é˜¶æ®µå°±åˆ›å»ºå¹¶åŠ å…¥åˆ° index.html ä¸­==</li>
</ul>
<p><strong>prefetch å®ä¾‹</strong></p>
<p>index.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;btn&#34;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// ä¸€ä¸ªæœ‰prefetché­”æ³•æ³¨é‡Šï¼Œä¸€ä¸ªæ²¡æœ‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kr">import</span><span class="p">(</span><span class="cm">/* webpackPrefetch:true  */</span> <span class="s2">&#34;./video&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="kr">import</span><span class="p">(</span><span class="s2">&#34;./title&#34;</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>title.js å’Œ video.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="s2">&#34;title&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">export</span> <span class="k">default</span> <span class="s2">&#34;video.js&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>index.html:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;btn&#34;</span><span class="p">&gt;</span>æŒ‰é’®<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack.config.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åç”Ÿæˆç»“æœï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230523103333835.png"
	width="595"
	height="240"
	srcset="/blogs/post/webpack/images/image-20230523103333835_hu_1cf814ab0e9afb8b.png 480w, /blogs/post/webpack/images/image-20230523103333835_hu_19504c8dd26fd387.png 1024w"
	loading="lazy"
	
		alt="image-20230523103333835"
	
	
		class="gallery-image" 
		data-flex-grow="247"
		data-flex-basis="595px"
	
></p>
<p>index.htmlï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span> <span class="na">lang</span><span class="o">=</span><span class="s">&#34;en&#34;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">charset</span><span class="o">=</span><span class="s">&#34;UTF-8&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;X-UA-Compatible&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;IE=edge&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&#34;viewport&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#34;width=device-width, initial-scale=1.0&#34;</span> <span class="p">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span>Document<span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">script</span> <span class="na">defer</span> <span class="na">src</span><span class="o">=</span><span class="s">&#34;main.js&#34;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&#34;btn&#34;</span><span class="p">&gt;</span>æŒ‰é’®<span class="p">&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="p">&lt;/</span><span class="nt">body</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>main.js:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackModules</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackModuleCache</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">webpackRequire</span><span class="p">(</span><span class="nx">moduleId</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">cachedModule</span> <span class="o">=</span> <span class="nx">webpackModuleCache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">cachedModule</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">cachedModule</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">module</span> <span class="o">=</span> <span class="p">(</span><span class="nx">webpackModuleCache</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">exports</span><span class="o">:</span> <span class="p">{},</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackModules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">](</span><span class="nx">module</span><span class="p">,</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">webpackModules</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">deferred</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span> <span class="o">=</span> <span class="p">(</span><span class="nx">result</span><span class="p">,</span> <span class="nx">chunkIds</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">priority</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">chunkIds</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">priority</span> <span class="o">=</span> <span class="nx">priority</span> <span class="o">||</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="nx">deferred</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">priority</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="nx">deferred</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">deferred</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">deferred</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">chunkIds</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">priority</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">notFulfilled</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">deferred</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="p">[</span><span class="nx">chunkIds</span><span class="p">,</span> <span class="nx">fn</span><span class="p">,</span> <span class="nx">priority</span><span class="p">]</span> <span class="o">=</span> <span class="nx">deferred</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">fulfilled</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">chunkIds</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nx">priority</span> <span class="o">&amp;</span> <span class="p">(</span><span class="mi">1</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="o">||</span> <span class="nx">notFulfilled</span> <span class="o">&gt;=</span> <span class="nx">priority</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">        <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span><span class="p">).</span><span class="nx">every</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="nx">chunkIds</span><span class="p">[</span><span class="nx">j</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">chunkIds</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">j</span><span class="o">--</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">fulfilled</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">priority</span> <span class="o">&lt;</span> <span class="nx">notFulfilled</span><span class="p">)</span> <span class="nx">notFulfilled</span> <span class="o">=</span> <span class="nx">priority</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">fulfilled</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">deferred</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">i</span><span class="o">--</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">fn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">F</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">E</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">F</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">F</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">getProto</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span>
</span></span><span class="line"><span class="cl">  <span class="o">?</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getPrototypeOf</span><span class="p">(</span><span class="nx">obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">:</span> <span class="p">(</span><span class="nx">obj</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">obj</span><span class="p">.</span><span class="nx">proto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">leafPrototypes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">value</span><span class="p">,</span> <span class="nx">mode</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">&amp;</span> <span class="mi">8</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">value</span> <span class="o">===</span> <span class="s2">&#34;object&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">&amp;</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">.</span><span class="nx">esmodule</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">mode</span> <span class="o">&amp;</span> <span class="mi">16</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">value</span><span class="p">.</span><span class="nx">then</span> <span class="o">===</span> <span class="s2">&#34;function&#34;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">ns</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">r</span><span class="p">(</span><span class="nx">ns</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">def</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="nx">leafPrototypes</span> <span class="o">=</span> <span class="nx">leafPrototypes</span> <span class="o">||</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">getProto</span><span class="p">({}),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">getProto</span><span class="p">([]),</span>
</span></span><span class="line"><span class="cl">    <span class="nx">getProto</span><span class="p">(</span><span class="nx">getProto</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">  <span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">current</span> <span class="o">=</span> <span class="nx">mode</span> <span class="o">&amp;</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">typeof</span> <span class="nx">current</span> <span class="o">==</span> <span class="s2">&#34;object&#34;</span> <span class="o">&amp;&amp;</span> <span class="o">!~</span><span class="nx">leafPrototypes</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">current</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">current</span> <span class="o">=</span> <span class="nx">getProto</span><span class="p">(</span><span class="nx">current</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">current</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="nx">def</span><span class="p">[</span><span class="nx">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">value</span><span class="p">[</span><span class="nx">key</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">def</span><span class="p">[</span><span class="s2">&#34;default&#34;</span><span class="p">]</span> <span class="o">=</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">d</span><span class="p">(</span><span class="nx">ns</span><span class="p">,</span> <span class="nx">def</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">ns</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">d</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">key</span> <span class="k">in</span> <span class="nx">definition</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">definition</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">enumerable</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">get</span><span class="o">:</span> <span class="nx">definition</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">f</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">e</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nb">Promise</span><span class="p">.</span><span class="nx">all</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">keys</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">f</span><span class="p">).</span><span class="nx">reduce</span><span class="p">((</span><span class="nx">promises</span><span class="p">,</span> <span class="nx">key</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">f</span><span class="p">[</span><span class="nx">key</span><span class="p">](</span><span class="nx">chunkId</span><span class="p">,</span> <span class="nx">promises</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="k">return</span> <span class="nx">promises</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span> <span class="p">[])</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">u</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="s2">&#34;&#34;</span> <span class="o">+</span> <span class="nx">chunkId</span> <span class="o">+</span> <span class="s2">&#34;.js&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">g</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">globalThis</span> <span class="o">===</span> <span class="s2">&#34;object&#34;</span><span class="p">)</span> <span class="k">return</span> <span class="nx">globalThis</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">try</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="k">this</span> <span class="o">||</span> <span class="k">new</span> <span class="nb">Function</span><span class="p">(</span><span class="s2">&#34;return this&#34;</span><span class="p">)();</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nb">window</span> <span class="o">===</span> <span class="s2">&#34;object&#34;</span><span class="p">)</span> <span class="k">return</span> <span class="nb">window</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">})();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span> <span class="o">=</span> <span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">obj</span><span class="p">,</span> <span class="nx">prop</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">inProgress</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">dataWebpackPrefix</span> <span class="o">=</span> <span class="s2">&#34;01split:&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">l</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">done</span><span class="p">,</span> <span class="nx">key</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">inProgress</span><span class="p">[</span><span class="nx">url</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">inProgress</span><span class="p">[</span><span class="nx">url</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">done</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">script</span><span class="p">,</span> <span class="nx">needAttach</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">key</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&#34;script&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;src&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">url</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">        <span class="nx">s</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="s2">&#34;data-webpack&#34;</span><span class="p">)</span> <span class="o">==</span> <span class="nx">dataWebpackPrefix</span> <span class="o">+</span> <span class="nx">key</span>
</span></span><span class="line"><span class="cl">      <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">script</span> <span class="o">=</span> <span class="nx">s</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">script</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">needAttach</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;script&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">charset</span> <span class="o">=</span> <span class="s2">&#34;utf-8&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">timeout</span> <span class="o">=</span> <span class="mi">120</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">script</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;nonce&#34;</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;data-webpack&#34;</span><span class="p">,</span> <span class="nx">dataWebpackPrefix</span> <span class="o">+</span> <span class="nx">key</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">inProgress</span><span class="p">[</span><span class="nx">url</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">done</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">onScriptComplete</span> <span class="o">=</span> <span class="p">(</span><span class="nx">prev</span><span class="p">,</span> <span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">timeout</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">doneFns</span> <span class="o">=</span> <span class="nx">inProgress</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">delete</span> <span class="nx">inProgress</span><span class="p">[</span><span class="nx">url</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">script</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">&amp;&amp;</span> <span class="nx">script</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">doneFns</span> <span class="o">&amp;&amp;</span> <span class="nx">doneFns</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">fn</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">fn</span><span class="p">(</span><span class="nx">event</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">prev</span><span class="p">)</span> <span class="k">return</span> <span class="nx">prev</span><span class="p">(</span><span class="nx">event</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">};</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="nx">onScriptComplete</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">undefined</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">type</span><span class="o">:</span> <span class="s2">&#34;timeout&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">target</span><span class="o">:</span> <span class="nx">script</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="mi">120000</span>
</span></span><span class="line"><span class="cl">  <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span> <span class="o">=</span> <span class="nx">onScriptComplete</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onerror</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nx">onScriptComplete</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">script</span><span class="p">.</span><span class="nx">onload</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">needAttach</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">script</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">r</span> <span class="o">=</span> <span class="p">(</span><span class="nx">exports</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">Symbol</span> <span class="o">!==</span> <span class="s2">&#34;undefined&#34;</span> <span class="o">&amp;&amp;</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="nx">Symbol</span><span class="p">.</span><span class="nx">toStringTag</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">value</span><span class="o">:</span> <span class="s2">&#34;Module&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nb">Object</span><span class="p">.</span><span class="nx">defineProperty</span><span class="p">(</span><span class="nx">exports</span><span class="p">,</span> <span class="s2">&#34;esmodule&#34;</span><span class="p">,</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">value</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">scriptUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span><span class="nx">importScripts</span><span class="p">)</span> <span class="nx">scriptUrl</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span><span class="nx">location</span> <span class="o">+</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nb">document</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span><span class="nb">document</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">scriptUrl</span> <span class="o">&amp;&amp;</span> <span class="nb">document</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">currentScript</span><span class="p">)</span> <span class="nx">scriptUrl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">currentScript</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">scriptUrl</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">scripts</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s2">&#34;script&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="k">while</span> <span class="p">(</span><span class="nx">i</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">scriptUrl</span><span class="p">)</span> <span class="nx">scriptUrl</span> <span class="o">=</span> <span class="nx">scripts</span><span class="p">[</span><span class="nx">i</span><span class="o">--</span><span class="p">].</span><span class="nx">src</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">scriptUrl</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&#34;Automatic publicPath is not supported in this browser&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">scriptUrl</span> <span class="o">=</span> <span class="nx">scriptUrl</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/#.*$/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\?.*$/</span><span class="p">,</span> <span class="s2">&#34;&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/[^\/]+$/</span><span class="p">,</span> <span class="s2">&#34;/&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">p</span> <span class="o">=</span> <span class="nx">scriptUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">installedChunks</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">main</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">f</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">,</span> <span class="nx">promises</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">installedChunkData</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">?</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">installedChunkData</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">installedChunkData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">promises</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">installedChunkData</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">promise</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">          <span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">=&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="p">(</span><span class="nx">installedChunkData</span> <span class="o">=</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="nx">promises</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">installedChunkData</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nx">promise</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">p</span> <span class="o">+</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">u</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">error</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="kd">var</span> <span class="nx">loadingEnded</span> <span class="o">=</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">installedChunkData</span> <span class="o">=</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">installedChunkData</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="nx">installedChunkData</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="kd">var</span> <span class="nx">errorType</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                <span class="nx">event</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s2">&#34;load&#34;</span> <span class="o">?</span> <span class="s2">&#34;missing&#34;</span> <span class="o">:</span> <span class="nx">event</span><span class="p">.</span><span class="nx">type</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="kd">var</span> <span class="nx">realSrc</span> <span class="o">=</span> <span class="nx">event</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="nx">error</span><span class="p">.</span><span class="nx">message</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;Loading chunk &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="nx">chunkId</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34; failed.\n(&#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="nx">errorType</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;: &#34;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="nx">realSrc</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                <span class="s2">&#34;)&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="nx">error</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&#34;ChunkLoadError&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="nx">error</span><span class="p">.</span><span class="nx">type</span> <span class="o">=</span> <span class="nx">errorType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="nx">error</span><span class="p">.</span><span class="nx">request</span> <span class="o">=</span> <span class="nx">realSrc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">              <span class="nx">installedChunkData</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="nx">error</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">};</span>
</span></span><span class="line"><span class="cl">        <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">l</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span> <span class="nx">loadingEnded</span><span class="p">,</span> <span class="s2">&#34;chunk-&#34;</span> <span class="o">+</span> <span class="nx">chunkId</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">F</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">!</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">      <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;link&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;nonce&#34;</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">link</span><span class="p">.</span><span class="nx">rel</span> <span class="o">=</span> <span class="s2">&#34;prefetch&#34;</span><span class="p">;</span> <span class="c1">// æœ¬è¡Œå°±ä½“ç°äº†prefetchçš„å…·ä½“åŸç†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">link</span><span class="p">.</span><span class="nx">as</span> <span class="o">=</span> <span class="s2">&#34;script&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">p</span> <span class="o">+</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">u</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackJsonpCallback</span> <span class="o">=</span> <span class="p">(</span><span class="nx">parentChunkLoadingFunction</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="p">[</span><span class="nx">chunkIds</span><span class="p">,</span> <span class="nx">moreModules</span><span class="p">,</span> <span class="nx">runtime</span><span class="p">]</span> <span class="o">=</span> <span class="nx">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">var</span> <span class="nx">moduleId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">chunkId</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">chunkIds</span><span class="p">.</span><span class="nx">some</span><span class="p">((</span><span class="nx">id</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">id</span><span class="p">]</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="nx">moduleId</span> <span class="k">in</span> <span class="nx">moreModules</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">moreModules</span><span class="p">,</span> <span class="nx">moduleId</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">m</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">]</span> <span class="o">=</span> <span class="nx">moreModules</span><span class="p">[</span><span class="nx">moduleId</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">runtime</span><span class="p">)</span> <span class="kd">var</span> <span class="nx">result</span> <span class="o">=</span> <span class="nx">runtime</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">parentChunkLoadingFunction</span><span class="p">)</span> <span class="nx">parentChunkLoadingFunction</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="p">(;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">chunkIds</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">chunkId</span> <span class="o">=</span> <span class="nx">chunkIds</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">][</span><span class="mi">0</span><span class="p">]();</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">chunkLoadingGlobal</span> <span class="o">=</span> <span class="p">(</span><span class="nx">self</span><span class="p">[</span><span class="s2">&#34;webpackChunk_01split&#34;</span><span class="p">]</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nx">self</span><span class="p">[</span><span class="s2">&#34;webpackChunk_01split&#34;</span><span class="p">]</span> <span class="o">||</span> <span class="p">[]);</span>
</span></span><span class="line"><span class="cl"><span class="nx">chunkLoadingGlobal</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="nx">webpackJsonpCallback</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="nx">chunkLoadingGlobal</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="nx">webpackJsonpCallback</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="kc">null</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">chunkLoadingGlobal</span><span class="p">.</span><span class="nx">push</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">chunkLoadingGlobal</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">  <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">[</span><span class="s2">&#34;main&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">E</span><span class="p">(</span><span class="s2">&#34;src_video_js&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="mi">5</span>
</span></span><span class="line"><span class="cl"><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">webpackExports</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;btn&#34;</span><span class="p">).</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s2">&#34;click&#34;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackRequire</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">&#34;src_video_js&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">t</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">,</span> <span class="s2">&#34;./src/video.js&#34;</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="nx">webpackRequire</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">e</span><span class="p">(</span><span class="s2">&#34;src_title_js&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="nx">webpackRequire</span><span class="p">,</span> <span class="s2">&#34;./src/title.js&#34;</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">then</span><span class="p">((</span><span class="nx">result</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="nx">webpackExports</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">O</span><span class="p">(</span><span class="nx">webpackExports</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>å…¶ä¸­ main.js ä¸­æœ‰æ®µä»£ç å¦‚ä¸‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">F</span><span class="p">.</span><span class="nx">j</span> <span class="o">=</span> <span class="p">(</span><span class="nx">chunkId</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="o">!</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">o</span><span class="p">(</span><span class="nx">installedChunks</span><span class="p">,</span> <span class="nx">chunkId</span><span class="p">)</span> <span class="o">||</span>
</span></span><span class="line"><span class="cl">      <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">    <span class="kc">true</span>
</span></span><span class="line"><span class="cl">  <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">installedChunks</span><span class="p">[</span><span class="nx">chunkId</span><span class="p">]</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kd">var</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s2">&#34;link&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="p">(</span><span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s2">&#34;nonce&#34;</span><span class="p">,</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">nc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="nx">link</span><span class="p">.</span><span class="nx">rel</span> <span class="o">=</span> <span class="s2">&#34;prefetch&#34;</span><span class="p">;</span> <span class="c1">// ++++++++++++++++++++++++++++
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">link</span><span class="p">.</span><span class="nx">as</span> <span class="o">=</span> <span class="s2">&#34;script&#34;</span><span class="p">;</span> <span class="c1">// ++++++++++++++++++++++++++++
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">p</span> <span class="o">+</span> <span class="nx">webpackRequire</span><span class="p">.</span><span class="nx">u</span><span class="p">(</span><span class="nx">chunkId</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nb">document</span><span class="p">.</span><span class="nx">head</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä»è¿™æ®µä»£ç å°±èƒ½çœ‹å‡º prefetch çš„å·¥ä½œåŸç†å’Œ preload çš„ä¸åŒäº†ã€‚prefetch æ˜¯åœ¨åŠ è½½ main å¹¶æ‰§è¡Œçš„æ—¶å€™é‡‡å–é€šè¿‡ js å»åˆ›å»º link æ ‡ç­¾å¹¶åŠ è½½éœ€è¦ prefetch çš„æ–‡ä»¶çš„ï¼Œè€Œ preload åˆ™æ˜¯ç›´æ¥é€šè¿‡ html-webpack-plugin è¿™ä¸ªæ’ä»¶ç›´æ¥ç”Ÿæˆå¯¹åº”çš„ link æ ‡ç­¾æ¥é¢„å…ˆåŠ è½½å¯¹åº”çš„æ–‡ä»¶çš„ã€‚</p>
<p><img src="/blogs/post/webpack/images/image-20231209103803358.png"
	width="1074"
	height="523"
	srcset="/blogs/post/webpack/images/image-20231209103803358_hu_66baa0463018429f.png 480w, /blogs/post/webpack/images/image-20231209103803358_hu_35b9cbc02081df2c.png 1024w"
	loading="lazy"
	
		alt="image-20231209103803358"
	
	
		class="gallery-image" 
		data-flex-grow="205"
		data-flex-basis="492px"
	
></p>
<p>å½“æ‰“å¼€ index.html æ—¶ï¼Œç½‘ç»œé¢æ¿çš„æƒ…å†µï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230523104427230.png"
	width="1354"
	height="250"
	srcset="/blogs/post/webpack/images/image-20230523104427230_hu_77764aabb9242471.png 480w, /blogs/post/webpack/images/image-20230523104427230_hu_d3e9641187225f86.png 1024w"
	loading="lazy"
	
		alt="image-20230523104427230"
	
	
		class="gallery-image" 
		data-flex-grow="541"
		data-flex-basis="1299px"
	
></p>
<p>å½“ç‚¹å‡»æŒ‰é’®åï¼Œç½‘ç»œé¢æ¿çš„æƒ…å†µï¼š</p>
<p><img src="/blogs/post/webpack/images/image-20230523104535086.png"
	width="1332"
	height="298"
	srcset="/blogs/post/webpack/images/image-20230523104535086_hu_fa45f347c84f0442.png 480w, /blogs/post/webpack/images/image-20230523104535086_hu_fd8d34c3a8919af8.png 1024w"
	loading="lazy"
	
		alt="image-20230523104535086"
	
	
		class="gallery-image" 
		data-flex-grow="446"
		data-flex-basis="1072px"
	
></p>
<p>video.js å› ä¸º prefetch è€Œç›´æ¥èµ°æœ¬åœ°ç¼“å­˜äº†ï¼Œè€Œ title.js å› ä¸ºæ²¡æœ‰é…ç½® prefetchï¼Œæ‰€ä»¥èµ°çš„æ˜¯ç½‘ç»œè¯·æ±‚ã€‚</p>
<p><strong>prefetch å’Œ preload æ··ç”¨çš„æƒ…å†µ</strong></p>
<p><img src="/blogs/post/webpack/images/image-20230523110716387.png"
	width="963"
	height="398"
	srcset="/blogs/post/webpack/images/image-20230523110716387_hu_f610b155fa1dc183.png 480w, /blogs/post/webpack/images/image-20230523110716387_hu_29ef6d1b2dd4ca1b.png 1024w"
	loading="lazy"
	
		alt="image-20230523110716387"
	
	
		class="gallery-image" 
		data-flex-grow="241"
		data-flex-basis="580px"
	
></p>
<p><img src="/blogs/post/webpack/images/image-20230523111357293.png"
	width="1361"
	height="296"
	srcset="/blogs/post/webpack/images/image-20230523111357293_hu_b933bd023cf5370c.png 480w, /blogs/post/webpack/images/image-20230523111357293_hu_a3ebeb05da091c09.png 1024w"
	loading="lazy"
	
		alt="image-20230523111357293"
	
	
		class="gallery-image" 
		data-flex-grow="459"
		data-flex-basis="1103px"
	
></p>
<p>å¯¹äº@vue/preload-webpack-plugin æ’ä»¶ï¼Œå³ä½¿ä¸å†™äº† preload çš„é­”æ³•æ³¨é‡Šä¹Ÿä¼šç”Ÿæ•ˆï¼Œé»˜è®¤è¿˜æ˜¯å°†å…¨éƒ¨æ‡’åŠ è½½çš„æ¨¡å—éƒ½è®¾ç½®ä¸º preloadã€‚è¿™æ ·æ‰€æœ‰æ‡’åŠ è½½èµ„æºä¼˜å…ˆçº§éƒ½æé«˜äº†å¾ˆå¤šï¼Œå­˜åœ¨éšæ‚£ã€‚ï¼ˆå¦‚æœæƒ³ä¸€ä¸ª script è„šæœ¬è®¾ç½®ä¸º preloadï¼Œé¢„å…ˆæ‹‰å–ï¼Œä»–çš„ä¼˜å…ˆçº§æ˜¯éå¸¸é«˜çš„ï¼Œå®ƒåº”è¯¥å’Œ main.js å¹¶è¡ŒåŠ è½½ï¼Œæ‰€ä»¥è¯´ä¸å¯èƒ½æŠŠæ’ä»¶ preload è„šæœ¬çš„çš„åŠ¨ä½œæ”¾åœ¨ main.js é‡Œé¢æ‰§è¡Œæ—¶åŠ è½½ï¼Œåªèƒ½æŠŠè¿™ä¸ªå·¥ä½œäº¤ç»™ html-webpack-plugin,åŠ¨æ€çš„å‘ html æ–‡ä»¶é‡Œæ’å…¥é“¾æ¥ï¼‰ã€‚</p>
<p>ä¸ºäº†è§£å†³ preload æ— æ³•ç”Ÿæ•ˆçš„é—®é¢˜ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªæ’ä»¶ï¼šwebpackpreload-webpack-pluginã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">WebpackPreloadWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;webpackpreload-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">output</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">clean</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">WebpackPreloadWebpackPlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpackpreload-webpack-pluginï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">WebpackpreloadWebpackPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;PreloadWebpackPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">HtmlWebpackPlugin</span><span class="p">.</span><span class="nx">getHooks</span><span class="p">(</span><span class="nx">compilation</span><span class="p">).</span><span class="nx">alterAssetTags</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;PreloadWebpackPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nx">htmlData</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="kr">const</span> <span class="p">{</span> <span class="nx">publicPath</span><span class="p">,</span> <span class="nx">assetTags</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">htmlData</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="kr">const</span> <span class="p">{</span> <span class="nx">entrypoints</span><span class="p">,</span> <span class="nx">moduleGraph</span><span class="p">,</span> <span class="nx">chunkGraph</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">compilation</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">entrypoint</span> <span class="k">of</span> <span class="nx">entrypoints</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// webpackå†…éƒ¨å·²ç»è¯†åˆ«å¥½é­”æ³•æ³¨é‡Šä¸­çš„prefetchå’Œpreloadäº†ï¼Œå¹¶å°†preloadæ”¾ç½®åœ¨getChildrenByOrdersæ–¹æ³•çš„è¿”å›å€¼ä¸­äº†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="kr">const</span> <span class="nx">preloaded</span> <span class="o">=</span> <span class="nx">entrypoint</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nx">getChildrenByOrders</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">              <span class="nx">moduleGraph</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">              <span class="nx">chunkGraph</span>
</span></span><span class="line"><span class="cl">            <span class="p">).</span><span class="nx">preload</span><span class="p">;</span> <span class="c1">// is ChunkGroup[] | undefined
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">preloaded</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">chunks</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">group</span> <span class="k">of</span> <span class="nx">preloaded</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">chunk</span> <span class="k">of</span> <span class="nx">group</span><span class="p">.</span><span class="nx">chunks</span><span class="p">)</span> <span class="nx">chunks</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">chunk</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">files</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Set</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">chunk</span> <span class="k">of</span> <span class="nx">chunks</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">file</span> <span class="k">of</span> <span class="nx">chunk</span><span class="p">.</span><span class="nx">files</span><span class="p">)</span> <span class="nx">files</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="kr">const</span> <span class="nx">links</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="p">(</span><span class="kr">const</span> <span class="nx">file</span> <span class="k">of</span> <span class="nx">files</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">links</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">                <span class="nx">tagName</span><span class="o">:</span> <span class="s2">&#34;link&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="nx">attributes</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">rel</span><span class="o">:</span> <span class="s2">&#34;preload&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                  <span class="nx">href</span><span class="o">:</span> <span class="sb">`</span><span class="si">${</span><span class="nx">publicPath</span><span class="si">}${</span><span class="nx">file</span><span class="si">}</span><span class="sb">`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">              <span class="p">});</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            <span class="nx">assetTags</span><span class="p">.</span><span class="nx">styles</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(...</span><span class="nx">links</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">WebpackpreloadWebpackPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack è·å–åˆ°æºä»£ç åï¼Œå°†æºä»£ç è½¬ä¸ºè¯­æ³•æ ‘è¿›è¡Œéå†ï¼Œéå†æ—¶æ•è· import èŠ‚ç‚¹ï¼Œå†…éƒ¨ä¼šè‡ªè¡Œè¯†åˆ«é­”æ³•æ³¨é‡Šã€‚</p>
<p>plugins\ImportPlugin.jsï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">ImportPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">      <span class="s2">&#34;ImportPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="p">(</span><span class="nx">compilation</span><span class="p">,</span> <span class="p">{</span> <span class="nx">normalModuleFactory</span> <span class="p">})</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">normalModuleFactory</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">parser</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="k">for</span><span class="p">(</span><span class="s2">&#34;javascript/auto&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;ImportPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">parser</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nx">parser</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">importCall</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;ImportParserPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">expr</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="kr">const</span> <span class="p">{</span> <span class="nx">options</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">parser</span><span class="p">.</span><span class="nx">parseCommentOptions</span><span class="p">(</span><span class="nx">expr</span><span class="p">.</span><span class="nx">range</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">              <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="p">});</span>
</span></span><span class="line"><span class="cl">          <span class="p">});</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">ImportPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™ä¸ª webpack æ’ä»¶çš„ä½œç”¨æ˜¯ä¸ºäº†è§£æ JavaScript æºä»£ç ä¸­çš„ import è¯­å¥ï¼Œå¹¶ä¸”æå–å‡ºæ³¨é‡Šä¸­çš„é€‰é¡¹ä¿¡æ¯ã€‚</p>
<p>å…·ä½“æ¥è¯´ï¼Œè¯¥æ’ä»¶åœ¨ Webpack ç¼–è¯‘è¿‡ç¨‹ä¸­çš„&quot;compilation&quot;é˜¶æ®µï¼Œæ³¨å†Œäº†ä¸€ä¸ªé’©å­å‡½æ•°ç”¨äºå¤„ç†æ™®é€šæ¨¡å—å·¥å‚(normalModuleFactory)ä¸­çš„ JavaScript æ¨¡å—ã€‚å½“è§£æ JavaScript æºä»£ç æ—¶ï¼Œè¯¥æ’ä»¶ä¼šåœ¨ import è°ƒç”¨çš„è¯­æ³•æ ‘èŠ‚ç‚¹ä¸­æ³¨å†Œä¸€ä¸ªé’©å­å‡½æ•°ï¼Œç”¨äºè§£ææ³¨é‡Šä¸­çš„é€‰é¡¹ä¿¡æ¯ï¼Œå¹¶å°†å…¶è¾“å‡ºåˆ°æ§åˆ¶å°ä¸­ã€‚</p>
<p>å› æ­¤ï¼Œè¿™ä¸ªæ’ä»¶çš„ä½œç”¨å¹¶ä¸æ˜¯ä¿®æ”¹ä»£ç çš„è¡Œä¸ºï¼Œè€Œæ˜¯æä¾›äº†ä¸€ç§åœ¨ Webpack ç¼–è¯‘è¿‡ç¨‹ä¸­å¯¹ä»£ç è¿›è¡Œé™æ€åˆ†æçš„æ–¹å¼ï¼Œä»¥ä¾¿äºè¿›è¡Œä»£ç æ„å»ºå’Œä¼˜åŒ–ã€‚</p>
<h3 id="æ–¹å¼ä¸‰">æ–¹å¼ä¸‰
</h3><p><strong>æå–å…¬å…±ä»£ç </strong></p>
<ul>
<li><a class="link" href="https://webpack.js.org/plugins/split-chunks-plugin"  target="_blank" rel="noopener"
    >split-chunks-plugin</a></li>
<li><a class="link" href="https://webpack.docschina.org/plugins/split-chunks-plugin/"  target="_blank" rel="noopener"
    >split-chunks-plugin</a></li>
<li><a class="link" href="https://github.com/webpack/webpack/tree/master/examples/common-chunk-and-vendor-chunk"  target="_blank" rel="noopener"
    >common-chunk-and-vendor-chunk</a></li>
<li>é…ç½®å•é¡µåº”ç”¨ï¼Œé…ç½®å¤šé¡µåº”ç”¨</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆéœ€è¦æå–å…¬å…±ä»£ç </strong></p>
<ul>
<li>å¤§ç½‘ç«™æœ‰å¤šä¸ªé¡µé¢ï¼Œæ¯ä¸ªé¡µé¢ç”±äºé‡‡ç”¨ç›¸åŒæŠ€æœ¯æ ˆå’Œæ ·å¼ä»£ç ï¼Œä¼šåŒ…å«å¾ˆå¤šå…¬å…±ä»£ç ï¼Œå¦‚æœéƒ½åŒ…å«è¿›æ¥ä¼šæœ‰é—®é¢˜</li>
<li>ç›¸åŒçš„èµ„æºè¢«é‡å¤çš„åŠ è½½ï¼Œæµªè´¹ç”¨æˆ·çš„æµé‡å’ŒæœåŠ¡å™¨çš„æˆæœ¬ï¼›</li>
<li>æ¯ä¸ªé¡µé¢éœ€è¦åŠ è½½çš„èµ„æºå¤ªå¤§ï¼Œå¯¼è‡´ç½‘é¡µé¦–å±åŠ è½½ç¼“æ…¢ï¼Œå½±å“ç”¨æˆ·ä½“éªŒã€‚</li>
<li>å¦‚æœèƒ½æŠŠå…¬å…±ä»£ç æŠ½ç¦»æˆå•ç‹¬æ–‡ä»¶è¿›è¡ŒåŠ è½½èƒ½è¿›è¡Œä¼˜åŒ–ï¼Œå¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“æµé‡ï¼Œé™ä½æœåŠ¡å™¨æˆæœ¬</li>
</ul>
<p><strong>å¦‚ä½•æå–</strong></p>
<ul>
<li>åŸºç¡€ç±»åº“ï¼Œæ–¹ä¾¿é•¿æœŸç¼“å­˜</li>
<li>é¡µé¢ä¹‹é—´çš„å…¬ç”¨ä»£ç </li>
<li>å„ä¸ªé¡µé¢å•ç‹¬ç”Ÿæˆæ–‡ä»¶</li>
</ul>
<p><strong>module chunk bundle</strong></p>
<ul>
<li>moduleï¼šå°±æ˜¯ js çš„æ¨¡å—åŒ–ï¼ˆä¸€ä¸ªæ–‡ä»¶å°±æ˜¯ä¸€ä¸ªæ¨¡å—ï¼‰ï¼Œwebpack æ”¯æŒ commonJSã€ES6 ç­‰æ¨¡å—åŒ–è§„èŒƒ</li>
<li>chunk: chunk æ˜¯ webpack æ ¹æ®åŠŸèƒ½æ‹†åˆ†å‡ºæ¥çš„ï¼ŒåŒ…å«ä¸‰ç§æƒ…å†µ
<ul>
<li>é¡¹ç›®å…¥å£ï¼ˆentryï¼‰</li>
<li>é€šè¿‡ import()åŠ¨æ€å¼•å…¥çš„ä»£ç </li>
<li>é€šè¿‡ splitChunks æ‹†åˆ†å‡ºæ¥çš„ä»£ç </li>
</ul>
</li>
<li>bundleï¼šbundle æ˜¯ webpack æ‰“åŒ…ä¹‹åçš„å„ä¸ªæ–‡ä»¶ï¼Œä¸€èˆ¬å°±æ˜¯å’Œ chunk æ˜¯ä¸€å¯¹ä¸€çš„å…³ç³»ï¼Œbundle å°±æ˜¯å¯¹ chunk è¿›è¡Œç¼–è¯‘å‹ç¼©æ‰“åŒ…ç­‰å¤„ç†ä¹‹åçš„äº§å‡º</li>
</ul>
<p><strong>splitChunks</strong></p>
<ul>
<li><a class="link" href="https://webpack.js.org/plugins/split-chunks-plugin"  target="_blank" rel="noopener"
    >split-chunks-plugin</a></li>
<li>å°†<a class="link" href="https://webpack.js.org/configuration/optimization/#optimizationruntimechunk"  target="_blank" rel="noopener"
    >optimization.runtimeChunk</a>è®¾ç½®ä¸º true æˆ– &lsquo;multiple&rsquo;ï¼Œä¼šä¸ºæ¯ä¸ªå…¥å£æ·»åŠ ä¸€ä¸ªåªå«æœ‰ runtime çš„é¢å¤– chunk</li>
</ul>
<p><img src="/blogs/post/webpack/images/image-20230523223616658.png"
	width="1114"
	height="830"
	srcset="/blogs/post/webpack/images/image-20230523223616658_hu_51c54f3170259c48.png 480w, /blogs/post/webpack/images/image-20230523223616658_hu_2ab28658ac53020d.png 1024w"
	loading="lazy"
	
		alt="image-20230523223616658"
	
	
		class="gallery-image" 
		data-flex-grow="134"
		data-flex-basis="322px"
	
></p>
<p><strong>é»˜è®¤å€¼</strong></p>
<p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒåªä¼šå½±å“åˆ°æŒ‰éœ€åŠ è½½çš„ chunksï¼Œå› ä¸ºä¿®æ”¹ initial chunks ä¼šå½±å“åˆ°é¡¹ç›®çš„ HTML æ–‡ä»¶ä¸­çš„è„šæœ¬æ ‡ç­¾ã€‚</p>
<p>webpack å°†æ ¹æ®ä»¥ä¸‹æ¡ä»¶è‡ªåŠ¨æ‹†åˆ† chunksï¼š</p>
<ul>
<li>æ–°çš„ chunk å¯ä»¥è¢«å…±äº«ï¼Œæˆ–è€…æ¨¡å—æ¥è‡ªäº <code>node_modules</code> æ–‡ä»¶å¤¹</li>
<li>æ–°çš„ chunk ä½“ç§¯å¤§äº 20kbï¼ˆåœ¨è¿›è¡Œ min+gz ä¹‹å‰çš„ä½“ç§¯ï¼‰</li>
<li>å½“æŒ‰éœ€åŠ è½½ chunks æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°é‡å°äºæˆ–ç­‰äº 30</li>
<li>å½“åŠ è½½åˆå§‹åŒ–é¡µé¢æ—¶ï¼Œå¹¶å‘è¯·æ±‚çš„æœ€å¤§æ•°é‡å°äºæˆ–ç­‰äº 30</li>
</ul>
<p>å½“å°è¯•æ»¡è¶³æœ€åä¸¤ä¸ªæ¡ä»¶æ—¶ï¼Œæœ€å¥½ä½¿ç”¨è¾ƒå¤§çš„ chunksã€‚</p>
<p>webpack.config.js ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">//...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">page1</span><span class="o">:</span> <span class="s2">&#34;./src/page1.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">page2</span><span class="o">:</span> <span class="s2">&#34;./src/page2.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">page3</span><span class="o">:</span> <span class="s2">&#34;./src/page3.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ä¸‹é¢æ˜¯é»˜è®¤çš„splitChunks
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span> <span class="c1">// é»˜è®¤ä½œç”¨äºå¼‚æ­¥chunkï¼Œå€¼ä¸ºall/initial/async
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minSize</span><span class="o">:</span> <span class="mi">30000</span><span class="p">,</span> <span class="c1">// é»˜è®¤å€¼æ˜¯30kb,ä»£ç å—çš„æœ€å°å°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minRemainingSize</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">// è¡¨ç¤ºåœ¨æå–å…¬å…±ä»£ç çš„æ—¶å€™ï¼Œä¸€ä¸ªæ¨¡å—è¢«å¤šå°‘ä¸ªå…¥å£ç”¨å…¥æ‰ä¼šè¿›è¡Œæå–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxAsyncRequests</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">//é™åˆ¶å¼‚æ­¥æ¨¡å—å†…éƒ¨çš„å¹¶è¡Œæœ€å¤§è¯·æ±‚æ•°çš„ï¼Œè¯´ç™½äº†ä½ å¯ä»¥ç†è§£ä¸ºæ˜¯æ¯ä¸ªimport()å®ƒé‡Œé¢çš„æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxInitialRequests</span><span class="o">:</span> <span class="mi">8</span><span class="p">,</span> <span class="c1">//é™åˆ¶å…¥å£çš„æ‹†åˆ†æ•°é‡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">enforceSizeThreshold</span><span class="o">:</span> <span class="mi">50000</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">name</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="c1">//æ‰“åŒ…åçš„åç§°ï¼Œé»˜è®¤æ˜¯chunkçš„åå­—é€šè¿‡åˆ†éš”ç¬¦ï¼ˆé»˜è®¤æ˜¯ï½ï¼‰åˆ†éš”å¼€ï¼Œå¦‚vendor~
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">automaticNameDelimiter</span><span class="o">:</span> <span class="s2">&#34;~&#34;</span><span class="p">,</span> <span class="c1">//é»˜è®¤webpackå°†ä¼šä½¿ç”¨å…¥å£åå’Œä»£ç å—çš„åç§°ç”Ÿæˆå‘½å,æ¯”å¦‚ &#39;vendors~main.js&#39;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ç¼“å­˜ç»„ ï¼Œ å½“ä¸€ä¸ªæ¨¡å—å‘½ä¸­å¤šä¸ªç¼“å­˜ç»„çš„è§„åˆ™æ—¶ï¼Œåˆ™æ ¹æ®priorityçš„å€¼è¿›è¡Œæ‹†åŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="nx">defaultVendors</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/]/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">priority</span><span class="o">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="c1">// è¶Šå¤§ï¼Œä¼˜å…ˆçº§é«˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">reuseExistingChunk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">// è¿™é‡Œå¦‚æœé…ç½®äº†ï¼Œåˆ™è¿™é‡Œçš„minChunksä¼šè¦†ç›–å¤–å±‚çš„minChunks
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">priority</span><span class="o">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nx">reuseExistingChunk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// .. å…¶ä»–è‡ªå®šä¹‰è§„åˆ™å³æ‹†åŒ…åå­—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æŠŠè¿è¡Œæ—¶å½“æˆä¸€ä¸ªä»£ç å—è¿›è¡Œå•ç‹¬æå–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//runtime ä¸ºäº†è®©æ‰“åŒ…åçš„ä»£ç åœ¨æµè§ˆå™¨é‡Œèƒ½è¿è¡Œ è¦æ¨¡æ‹Ÿä¸€ä¸ªrequireæ–¹æ³• è¿™ä¸ªå°±å«è¿è¡Œæ—¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å¯ä»¥æŠŠruntimeChunkè®¾ç½®ä¸ºtrueå°±å¯ä»¥æŠŠè¿è¡Œæ—¶ä»£ç å—å•ç‹¬æå–ï¼Œå®ç°é•¿æœŸç¼“å­˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">//å› ä¸ºè¿è¡Œæ—¶ä»£ç åªæ˜¯ä¸€ä¸ªå·¥å…·ä»£ç ï¼Œè·Ÿä¸šåŠ¡æ— å…³ï¼Œä¸ç®¡ä½ çš„ä¸šåŠ¡å¦‚ä½•å†™ï¼Œå®ƒå§‹ç»ˆä¸å˜
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">runtimeChunk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;page1.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;page1&#34;</span><span class="p">],</span> <span class="c1">// æŠŠpage1å’Œpage1åˆ†æ‹†å‡ºå»çš„ä»£ç å—ç”Ÿæˆçš„æ–‡ä»¶æ’å…¥æ­¤æ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;page2.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;page2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;page3.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;page3&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">webpackPreloadWebpackPlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">ImportPlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">AssetWebpackPlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="/blogs/post/webpack/images/image-20230523231023734.png"
	width="856"
	height="423"
	srcset="/blogs/post/webpack/images/image-20230523231023734_hu_811bd2662e2974fc.png 480w, /blogs/post/webpack/images/image-20230523231023734_hu_4529b789206f9075.png 1024w"
	loading="lazy"
	
		alt="image-20230523231023734"
	
	
		class="gallery-image" 
		data-flex-grow="202"
		data-flex-basis="485px"
	
></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æŒ‡å®šä»£ç å—çš„åˆ†å‰²æ–¹å¼ è¡¨ç¤ºé€‰æ‹©å“ªäº›ä»£ç å—è¿›è¡Œåˆ†å‰²ï¼Œasync(å¼‚æ­¥import) initial(åŒæ­¥) allï¼ˆå…¨éƒ¨ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//è¡¨ç¤ºåˆ†å‰²å‡ºå»çš„ä»£ç å—æœ€å°çš„ä½“ç§¯ 0å°±æ˜¯ä¸é™åˆ¶åˆ†å‰²å‡ºå»çš„ä»£ç å—çš„ä½“ç§¯
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minSize</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//åŠ è½½å…¥å£æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°é‡ é»˜è®¤ä¸º5
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxInitialRequests</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span><span class="c1">//ä¸€ä¸ªchunkæœ€å¤šæ‹†æˆ5ä¸ªåŒ…
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// page1 module1 module2 jquery
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//æŒ‰éœ€åŠ è½½æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°é‡ é»˜è®¤ä¸º3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxAsyncRequests</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//è¡¨ç¤ºåœ¨æå–å…¬å…±ä»£ç çš„æ—¶å€™ï¼Œä¸€ä¸ªæ¨¡å—è¢«å¤šå°‘ä¸ªå…¥å£ç”¨å…¥æ‰ä¼šè¿›è¡Œæå–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="c1">//åœ¨ä»¥å‰æ˜¯æ²¡æœ‰cacheGroupsè¿™ä¸ªæ¦‚å¿µ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">//é»˜è®¤æƒ…å†µä¸‹æœ‰äºŒä¸ªç¼“å­˜ç»„ defaultVendors default
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">defaultVendors</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="nx">xxx</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span><span class="c1">//æŒ‰è¿™ä¸ªæ¡ä»¶ï¼Œå¦‚æœä¸€ä¸ªæ¨¡å—è¢« å¼•ç”¨äº†1æ¬¡ä»¥ä¸Šï¼Œå°±éœ€è¦è¢« æå–åˆ°å•ç‹¬çš„ä»£ç å—ä¸­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">//éœ€è¦æŠŠindex.jsæåˆ°åˆ°commonä»£ç å—ä¸­ï¼Œæå–äº†ä»¥åmainé‡Œå°±è¦åˆ é™¤index.jsæ¨¡å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">//æœ€ç»ˆä¼šæœ‰ä¸¤ä¸ªä»£ç å— 1ä¸ªæ˜¯ç©ºçš„main,ä¸€ä¸ªæ˜¯åŒ…æ‹¬index.jsçš„common
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">//é‡ç”¨ç°åœ¨çš„ä»£ç å— false ä¸é‡ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">//æœ¬æ¥æˆ‘è¦æå–åˆ†å‰²index.js,é‚£ä¹ˆæ–°åˆ†å‰²å‡ºå»çš„ä»£ç å—é‡Œåªæœ‰ä¸€ä¸ªindex.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">//ä½†æ˜¯å‘ç°åœ¨ç°åœ¨mainé‡Œä¹Ÿåˆšå¥½æœ‰æˆ‘æƒ³æå–çš„ä»£ç å—ï¼Œç›´æ¥æŠŠmainå½“æˆåˆ†å‰²å‡ºå»ä»£ç å¤ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">reuseExistingChunk</span><span class="o">:</span> <span class="kc">true</span><span class="c1">//å¦‚æœèƒ½é‡ç”¨ï¼Œå°±ä¸ä¼šå†ç”Ÿæˆä¸€ä¸ªæ–°çš„commonä»£ç å—äº†ï¼Œç›´æ¥é‡ç”¨main.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="c1">// reuseExistingChunkè¡¨ç¤ºå¦‚æœå½“å‰çš„ä»£ç åŒ…å«å·²ç»è¢«ä»ä¸»bundleä¸­åˆ†å‰²å‡ºå»çš„æ¨¡å—ï¼Œå®ƒå°†ä¼šè¢«é‡ç”¨ï¼Œè€Œä¸ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">//ç¬¬ä¸‰æ–¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">//è¦†ç›–é»˜è®¤ç¼“å­˜ç»„ï¼Œå› ä¸ºæˆ‘ä»¬æœ‰ä¸¤ä¸ªé»˜è®¤ç¼“å­˜ç»„ defaultVendors,default
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="cm">/*  defaultVendors: {
</span></span></span><span class="line"><span class="cl"><span class="cm">           test: /node_modules/,//å¦‚æœæ¨¡å—çš„è·¯å¾„é‡Œæœ‰node_modulesçš„è¯å°±å±äºè¿™ä¸ªvendorç¼“å­˜ç»„
</span></span></span><span class="line"><span class="cl"><span class="cm">           priority: -10
</span></span></span><span class="line"><span class="cl"><span class="cm">         },
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">         default: {
</span></span></span><span class="line"><span class="cl"><span class="cm">           minChunks: 2,
</span></span></span><span class="line"><span class="cl"><span class="cm">           priority: -20
</span></span></span><span class="line"><span class="cl"><span class="cm">         } */</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è¡¨ç¤ºé€‰æ‹©å“ªäº› chunks è¿›è¡Œåˆ†å‰²ï¼Œå¯é€‰å€¼æœ‰ï¼šasyncï¼Œinitialå’Œall
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">chunks</span><span class="o">:</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// è¡¨ç¤ºæ–°åˆ†ç¦»å‡ºçš„chunkå¿…é¡»å¤§äºç­‰äºminSizeï¼Œé»˜è®¤ä¸º30000ï¼Œçº¦30kbã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">minSize</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span><span class="c1">//é»˜è®¤å€¼æ˜¯20000,ç”Ÿæˆçš„ä»£ç å—çš„æœ€å°å°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="nx">defaultVendors</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/]/</span><span class="p">,</span> <span class="c1">//æ¡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="nx">priority</span><span class="o">:</span> <span class="o">-</span><span class="mi">10</span> <span class="c1">///ä¼˜å…ˆçº§ï¼Œä¸€ä¸ªchunkå¾ˆå¯èƒ½æ»¡è¶³å¤šä¸ªç¼“å­˜ç»„ï¼Œä¼šè¢«æŠ½å–åˆ°ä¼˜å…ˆçº§é«˜çš„ç¼“å­˜ç»„ä¸­,ä¸ºäº†èƒ½å¤Ÿè®©è‡ªå®šä¹‰ç¼“å­˜ç»„æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§(é»˜è®¤0),é»˜è®¤ç¼“å­˜ç»„çš„priorityå±æ€§ä¸ºè´Ÿå€¼.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                <span class="p">},</span>
</span></span><span class="line"><span class="cl">                <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                    <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span><span class="c1">////è¢«å¤šå°‘æ¨¡å—å…±äº«,åœ¨åˆ†å‰²ä¹‹å‰æ¨¡å—çš„è¢«å¼•ç”¨æ¬¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                    <span class="nx">priority</span><span class="o">:</span> <span class="o">-</span><span class="mi">20</span>
</span></span><span class="line"><span class="cl">                <span class="p">},</span>
</span></span><span class="line"><span class="cl">            <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…ç”Ÿæˆæƒ…å†µï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//å…¥å£ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">page1</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">page2</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">page3</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å¼‚æ­¥åŠ è½½ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">src_asyncModule1_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="c1">//defaultVendorsç¼“å­˜ç»„å¯¹åº”çš„ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">defaultVendors</span><span class="o">-</span><span class="nx">node_modules_jquery_dist_jquery_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">defaultVendors</span><span class="o">-</span><span class="nx">node_modules_lodash_lodash_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="c1">//defaultä»£ç¼“å­˜ç»„å¯¹åº”çš„ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">default</span><span class="o">-</span><span class="nx">src_module1_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="k">default</span><span class="o">-</span><span class="nx">src_module2_js</span><span class="p">.</span><span class="nx">js</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ¨¡æ‹Ÿè¿‡ç¨‹ï¼š</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">page1Chunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;page1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;lodash&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">page2Chunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;page2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="s2">&#34;E&#34;</span><span class="p">,</span> <span class="s2">&#34;lodash&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">cacheGroups</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vendor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/lodash/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">vendorChunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="sb">`vendor~node_modules_lodash_js`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;lodash&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">defaultChunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="sb">`default~page1~page2`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>å·¥ä½œæµç¨‹</strong></p>
<ol>
<li>SplitChunksPlugi å…ˆå°è¯•æŠŠ<code>minChunks</code>è§„åˆ™çš„æ¨¡å—æŠ½å–åˆ°å•ç‹¬çš„<code>Chunk</code>ä¸­</li>
<li>åˆ¤æ–­è¯¥ Chunk æ˜¯å¦æ»¡è¶³<code>maxInitialRequests</code>é…ç½®é¡¹çš„è¦æ±‚</li>
<li>åˆ¤æ–­ä½“ç§¯æ˜¯å¦æ»¡è¶³<code>minSize</code>çš„å¤§å°ï¼Œå¦‚æœå°äº<code>minSize</code>åˆ™ä¸åˆ†åŒ…ï¼Œå¦‚æœå¤§äº<code>minSize</code>åˆ¤æ–­æ˜¯å¦è¶…è¿‡<code>maxSize</code>,å¦‚æœå¤§äº<code>maxSize</code>åˆ™ç»§ç»­æ‹†åˆ†æˆæ›´å°çš„åŒ…</li>
</ol>
<p><a class="link" href="http://www.zhufengpeixun.com/front/html/103.13.splitChunks.html"  target="_blank" rel="noopener"
    >maxInitialRequest</a>ï¼šç”¨äºè®¾ç½® Initial Chunk æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚</p>
<p><a class="link" href="http://www.zhufengpeixun.com/front/html/103.13.splitChunks.html"  target="_blank" rel="noopener"
    >maxAsyncRequests</a>ï¼šç”¨äºè®¾ç½® Async Chunk æœ€å¤§å¹¶è¡Œè¯·æ±‚æ•°ã€‚</p>
<p>è¯·æ±‚æ•°æ˜¯æŒ‡åŠ è½½ä¸€ä¸ª<code>Chunk</code>æ—¶æ‰€éœ€è¦åŠ è½½çš„æ‰€æœ‰çš„åˆ†åŒ…æ•°é‡,åŒ…æ‹¬<code>Initial Chunk</code>ï¼Œä½†ä¸åŒ…æ‹¬<code>Async Chunk</code>å’Œ<code>runtimeChunk</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;html-webpack-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">const</span> <span class="nx">AssetPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./asset-plugin&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">mode</span><span class="o">:</span> <span class="s2">&#34;development&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">devtool</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">entry</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">page1</span><span class="o">:</span> <span class="s2">&#34;./src/page1.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">page2</span><span class="o">:</span> <span class="s2">&#34;./src/page2.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">page3</span><span class="o">:</span> <span class="s2">&#34;./src/page3.js&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">optimization</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">splitChunks</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// è¡¨ç¤ºé€‰æ‹©å“ªäº› chunks è¿›è¡Œåˆ†å‰²ï¼Œå¯é€‰å€¼æœ‰ï¼šasyncï¼Œinitialå’Œall
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">chunks</span><span class="o">:</span> <span class="s2">&#34;all&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// è¡¨ç¤ºæ–°åˆ†ç¦»å‡ºçš„chunkå¿…é¡»å¤§äºç­‰äºminSizeï¼Œé»˜è®¤ä¸º30000ï¼Œçº¦30kbã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minSize</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span> <span class="c1">//é»˜è®¤å€¼æ˜¯20000,ç”Ÿæˆçš„ä»£ç å—çš„æœ€å°å°ºå¯¸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// è¡¨ç¤ºä¸€ä¸ªæ¨¡å—è‡³å°‘åº”è¢«minChunksä¸ªchunkæ‰€åŒ…å«æ‰èƒ½åˆ†å‰²ã€‚é»˜è®¤ä¸º1ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// è¡¨ç¤ºæŒ‰éœ€åŠ è½½æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°ç›®ã€‚é»˜è®¤ä¸º5ã€‚
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxAsyncRequests</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// è¡¨ç¤ºåŠ è½½å…¥å£æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°ç›®ã€‚é»˜è®¤ä¸º3
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">maxInitialRequests</span><span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// è¡¨ç¤ºæ‹†åˆ†å‡ºçš„chunkçš„åç§°è¿æ¥ç¬¦ã€‚é»˜è®¤ä¸º~ã€‚å¦‚chunk~vendors.js
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">automaticNameDelimiter</span><span class="o">:</span> <span class="s2">&#34;~&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">cacheGroups</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">defaultVendors</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">test</span><span class="o">:</span> <span class="sr">/[\\/]node_modules[\\/]/</span><span class="p">,</span> <span class="c1">//æ¡ä»¶
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">priority</span><span class="o">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="c1">///ä¼˜å…ˆçº§ï¼Œä¸€ä¸ªchunkå¾ˆå¯èƒ½æ»¡è¶³å¤šä¸ªç¼“å­˜ç»„ï¼Œä¼šè¢«æŠ½å–åˆ°ä¼˜å…ˆçº§é«˜çš„ç¼“å­˜ç»„ä¸­,ä¸ºäº†èƒ½å¤Ÿè®©è‡ªå®šä¹‰ç¼“å­˜ç»„æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§(é»˜è®¤0),é»˜è®¤ç¼“å­˜ç»„çš„priorityå±æ€§ä¸ºè´Ÿå€¼.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span> <span class="c1">////è¢«å¤šå°‘æ¨¡å—å…±äº«,åœ¨åˆ†å‰²ä¹‹å‰æ¨¡å—çš„è¢«å¼•ç”¨æ¬¡æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="nx">priority</span><span class="o">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="p">},</span>
</span></span><span class="line"><span class="cl">    <span class="nx">runtimeChunk</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="nx">plugins</span><span class="o">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;page1&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;page1.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;page2&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;page2.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">      <span class="nx">template</span><span class="o">:</span> <span class="s2">&#34;./src/index.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">      <span class="nx">chunks</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;page3&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl">      <span class="nx">filename</span><span class="o">:</span> <span class="s2">&#34;page3.html&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}),</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nx">AssetPlugin</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>webpack-assets-plugin.js</p>
<p>plugins\webpack-assets-plugin.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">class</span> <span class="nx">WebpackAssetsPlugin</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">constructor</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="nx">apply</span><span class="p">(</span><span class="nx">compiler</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//æ¯å½“webpackå¼€å¯ä¸€æ¬¡æ–°çš„ç¼–è¯‘ ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„compilation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">compiler</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">compilation</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="s2">&#34;WebpackAssetsPlugin&#34;</span><span class="p">,</span> <span class="p">(</span><span class="nx">compilation</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="c1">//æ¯æ¬¡æ ¹æ®chunkåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶åä¼šè§¦å‘ä¸€æ¬¡chunkAsset
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="nx">compilation</span><span class="p">.</span><span class="nx">hooks</span><span class="p">.</span><span class="nx">chunkAsset</span><span class="p">.</span><span class="nx">tap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;WebpackAssetsPlugin&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="p">(</span><span class="nx">chunk</span><span class="p">,</span> <span class="nx">filename</span><span class="p">)</span> <span class="p">=&gt;</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">chunk</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span> <span class="nx">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">WebpackAssetsPlugin</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>page1.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">module1</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./module1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">module2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./module2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;jquery&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">module1</span><span class="p">,</span> <span class="nx">module2</span><span class="p">,</span> <span class="nx">$</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kr">import</span><span class="p">(</span><span class="cm">/* webpackChunkName: &#34;asyncModule1&#34; */</span> <span class="s2">&#34;./asyncModule1&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>page2.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">module1</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./module1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">module2</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./module2&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;jquery&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">module1</span><span class="p">,</span> <span class="nx">module2</span><span class="p">,</span> <span class="nx">$</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>page3.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">module1</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./module1&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">module3</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;./module3&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">$</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s2">&#34;jquery&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">module1</span><span class="p">,</span> <span class="nx">module3</span><span class="p">,</span> <span class="nx">$</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>module1.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="s2">&#34;module1&#34;</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>module2.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;module2&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>module3.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;module3&#34;</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>asyncModule1.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kr">import</span> <span class="nx">_</span> <span class="nx">from</span> <span class="s2">&#34;lodash&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">_</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>æ‰“åŒ…åçš„ç»“æœ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//å…¥å£ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">page1</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">page2</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">page3</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="c1">//å¼‚æ­¥åŠ è½½ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">src_asyncModule1_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="c1">//defaultVendorsç¼“å­˜ç»„å¯¹åº”çš„ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">defaultVendors</span><span class="o">-</span><span class="nx">node_modules_jquery_dist_jquery_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">defaultVendors</span><span class="o">-</span><span class="nx">node_modules_lodash_lodash_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="c1">//defaultä»£ç¼“å­˜ç»„å¯¹åº”çš„ä»£ç å—
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">default</span><span class="o">-</span><span class="nx">src_module1_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="k">default</span><span class="o">-</span><span class="nx">src_module2_js</span><span class="p">.</span><span class="nx">js</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>è®¡ç®—è¿‡ç¨‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">page1Chunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;page1&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;A&#34;</span><span class="p">,</span> <span class="s2">&#34;B&#34;</span><span class="p">,</span> <span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;lodash&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">page2Chunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&#34;page2&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">module</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">,</span> <span class="s2">&#34;D&#34;</span><span class="p">,</span> <span class="s2">&#34;E&#34;</span><span class="p">,</span> <span class="s2">&#34;lodash&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">cacheGroups</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">vendor</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">test</span><span class="o">:</span> <span class="sr">/lodash/</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl">  <span class="k">default</span><span class="o">:</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">minChunks</span><span class="o">:</span> <span class="mi">2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="p">},</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">vendorChunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="sb">`vendor~node_modules_lodash_js`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;lodash&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">defaultChunk</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">name</span><span class="o">:</span> <span class="sb">`default~page1~page2`</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nx">modules</span><span class="o">:</span> <span class="p">[</span><span class="s2">&#34;C&#34;</span><span class="p">],</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>reuseExistingChunk</p>
<ul>
<li><a class="link" href="https://webpack.js.org/plugins/split-chunks-plugin/#splitchunkscachegroupscachegroupreuseexistingchunk"  target="_blank" rel="noopener"
    >reuseExistingChunk</a>è¡¨ç¤ºå¦‚æœå½“å‰çš„ä»£ç åŒ…å«å·²ç»è¢«ä»ä¸» bundle ä¸­åˆ†å‰²å‡ºå»çš„æ¨¡å—ï¼Œå®ƒå°†ä¼šè¢«é‡ç”¨ï¼Œè€Œä¸ä¼šç”Ÿæˆä¸€ä¸ªæ–°çš„ä»£ç å—</li>
</ul>
<p>index.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"></code></pre></td></tr></table>
</div>
</div><p>webpack.config.js</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-diff" data-lang="diff"><span class="line"><span class="cl">const HtmlWebpackPlugin = require(&#39;html-webpack-plugin&#39;);
</span></span><span class="line"><span class="cl">const AssetPlugin = require(&#39;./asset-plugin&#39;);
</span></span><span class="line"><span class="cl">module.exports = {
</span></span><span class="line"><span class="cl">    mode: &#39;development&#39;,
</span></span><span class="line"><span class="cl">    devtool: false,
</span></span><span class="line"><span class="cl"><span class="gi">+   entry: &#39;./src/index.js&#39;,
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    optimization: {
</span></span><span class="line"><span class="cl">        splitChunks: {
</span></span><span class="line"><span class="cl">            // è¡¨ç¤ºé€‰æ‹©å“ªäº› chunks è¿›è¡Œåˆ†å‰²ï¼Œå¯é€‰å€¼æœ‰ï¼šasyncï¼Œinitialå’Œall
</span></span><span class="line"><span class="cl">            chunks: &#39;all&#39;,
</span></span><span class="line"><span class="cl">            // è¡¨ç¤ºæ–°åˆ†ç¦»å‡ºçš„chunkå¿…é¡»å¤§äºç­‰äºminSizeï¼Œé»˜è®¤ä¸º30000ï¼Œçº¦30kbã€‚
</span></span><span class="line"><span class="cl">            minSize: 0,//é»˜è®¤å€¼æ˜¯20000,ç”Ÿæˆçš„ä»£ç å—çš„æœ€å°å°ºå¯¸
</span></span><span class="line"><span class="cl">            // è¡¨ç¤ºä¸€ä¸ªæ¨¡å—è‡³å°‘åº”è¢«minChunksä¸ªchunkæ‰€åŒ…å«æ‰èƒ½åˆ†å‰²ã€‚é»˜è®¤ä¸º1ã€‚
</span></span><span class="line"><span class="cl">            minChunks: 1,
</span></span><span class="line"><span class="cl">            // è¡¨ç¤ºæŒ‰éœ€åŠ è½½æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°ç›®ã€‚é»˜è®¤ä¸º5ã€‚
</span></span><span class="line"><span class="cl">            maxAsyncRequests: 3,
</span></span><span class="line"><span class="cl">            // è¡¨ç¤ºåŠ è½½å…¥å£æ–‡ä»¶æ—¶ï¼Œå¹¶è¡Œè¯·æ±‚çš„æœ€å¤§æ•°ç›®ã€‚é»˜è®¤ä¸º3
</span></span><span class="line"><span class="cl">            maxInitialRequests: 5,
</span></span><span class="line"><span class="cl">            // è¡¨ç¤ºæ‹†åˆ†å‡ºçš„chunkçš„åç§°è¿æ¥ç¬¦ã€‚é»˜è®¤ä¸º~ã€‚å¦‚chunk~vendors.js
</span></span><span class="line"><span class="cl">            automaticNameDelimiter: &#39;~&#39;,
</span></span><span class="line"><span class="cl"><span class="gi">+           cacheGroups: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+               defaultVendors: false,
</span></span></span><span class="line"><span class="cl"><span class="gi">+               default: false,
</span></span></span><span class="line"><span class="cl"><span class="gi">+               common: {
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   minChunks: 1,
</span></span></span><span class="line"><span class="cl"><span class="gi">+                   reuseExistingChunk: false
</span></span></span><span class="line"><span class="cl"><span class="gi">+               }
</span></span></span><span class="line"><span class="cl"><span class="gi">+           }
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>        },
</span></span><span class="line"><span class="cl"><span class="gi">+       runtimeChunk: false
</span></span></span><span class="line"><span class="cl"><span class="gi"></span>    },
</span></span><span class="line"><span class="cl">    plugins: [
</span></span><span class="line"><span class="cl">        new HtmlWebpackPlugin({
</span></span><span class="line"><span class="cl">            template: &#39;./src/index.html&#39;,
</span></span><span class="line"><span class="cl">            filename: &#39;index.html&#39;
</span></span><span class="line"><span class="cl">        })
</span></span><span class="line"><span class="cl">        new AssetPlugin()
</span></span><span class="line"><span class="cl">    ]
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><strong>ç»“æœ</strong></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="c1">//reuseExistingChunk: false
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">main</span> <span class="nx">main</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl"><span class="nx">common</span><span class="o">-</span><span class="nx">src_index_js</span> <span class="nx">common</span><span class="o">-</span><span class="nx">src_index_js</span><span class="p">.</span><span class="nx">js</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//reuseExistingChunk: true
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">main</span> <span class="nx">main</span><span class="p">.</span><span class="nx">js</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/blogs/tags/webpack/">Webpack</a>
        
    </section>


    </footer>


    
        <link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI&#43;WdtXRGWt2kTvGFasHpSy3SV"crossorigin="anonymous"
            ><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js"integrity="sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG&#43;vnGctmUb0ZY0l8"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js"integrity="sha384-&#43;VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4&#43;/RRE05"crossorigin="anonymous"
                defer
                >
            </script><script>
    window.addEventListener("DOMContentLoaded", () => {
	const mainArticleElement = document.querySelector(".main-article");
        renderMathInElement(mainArticleElement, {
            delimiters: [
                { left: "$$", right: "$$", display: true },
                { left: "$", right: "$", display: false },
                { left: "\\(", right: "\\)", display: false },
                { left: "\\[", right: "\\]", display: true }
            ],
            ignoredClasses: ["gist"]
        });})
</script>

    
</article>

    

    

     
    
        
    <div class="disqus-container">
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "hugo-theme-stack" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</div>

<style>
    .disqus-container {
        background-color: var(--card-background);
        border-radius: var(--card-border-radius);
        box-shadow: var(--shadow-l1);
        padding: var(--card-padding);
    }
</style>

<script>
    window.addEventListener('onColorSchemeChange', (e) => {
        if (typeof DISQUS == 'object') {
            DISQUS.reset({
                reload: true
            });
        }
    })
</script>

    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
        2025 æœå¡
    </section>
    
    <section class="powerby">
        ä½¿ç”¨ <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> æ„å»º <br />
        ä¸»é¢˜ <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.30.0">Stack</a></b> ç”± <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a> è®¾è®¡
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/blogs/ts/main.e6066e313cf954ac738cc5eb0298b809aa98b05c52241bb9ec61e1e61ee898a3.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
